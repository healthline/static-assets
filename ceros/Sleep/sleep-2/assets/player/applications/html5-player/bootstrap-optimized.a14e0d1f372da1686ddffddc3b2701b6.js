!function(e){define("modernizr",[],function(){return function(){return window.Modernizr=function(e,t,i){function n(e){h.cssText=e}function r(e,t){return typeof e===t}var o,s,a={},u=t.documentElement,l="modernizr",c=t.createElement(l),h=c.style,d=" -webkit- -moz- -o- -ms- ".split(" "),f={},p=[],g=p.slice,m=function(e,i,n,r){var o,s,a,c,h=t.createElement("div"),d=t.body,f=d||t.createElement("body");if(parseInt(n,10))for(;n--;)a=t.createElement("div"),a.id=r?r[n]:l+(n+1),h.appendChild(a);return o=["&#173;",'<style id="s',l,'">',e,"</style>"].join(""),h.id=l,(d?h:f).innerHTML+=o,f.appendChild(h),d||(f.style.background="",f.style.overflow="hidden",c=u.style.overflow,u.style.overflow="hidden",u.appendChild(f)),s=i(h,e),d?h.parentNode.removeChild(h):(f.parentNode.removeChild(f),u.style.overflow=c),!!s},v={}.hasOwnProperty;s=r(v,"undefined")||r(v.call,"undefined")?function(e,t){return t in e&&r(e.constructor.prototype[t],"undefined")}:function(e,t){return v.call(e,t)},Function.prototype.bind||(Function.prototype.bind=function(e){var t=this;if("function"!=typeof t)throw new TypeError;var i=g.call(arguments,1),n=function(){if(this instanceof n){var r=function(){};r.prototype=t.prototype;var o=new r,s=t.apply(o,i.concat(g.call(arguments)));return Object(s)===s?s:o}return t.apply(e,i.concat(g.call(arguments)))};return n}),f.canvas=function(){var e=t.createElement("canvas");return!(!e.getContext||!e.getContext("2d"))},f.touch=function(){var i;return"ontouchstart"in e||e.DocumentTouch&&t instanceof DocumentTouch?i=!0:m(["@media (",d.join("touch-enabled),("),l,")","{#modernizr{top:9px;position:absolute}}"].join(""),function(e){i=9===e.offsetTop}),i},f.video=function(){var e=t.createElement("video"),i=!1;try{(i=!!e.canPlayType)&&(i=new Boolean(i),i.ogg=e.canPlayType('video/ogg; codecs="theora"').replace(/^no$/,""),i.h264=e.canPlayType('video/mp4; codecs="avc1.42E01E"').replace(/^no$/,""),i.webm=e.canPlayType('video/webm; codecs="vp8, vorbis"').replace(/^no$/,""))}catch(e){}return i};for(var y in f)s(f,y)&&(o=y.toLowerCase(),a[o]=f[y](),p.push((a[o]?"":"no-")+o));return a.addTest=function(e,t){if("object"==typeof e)for(var n in e)s(e,n)&&a.addTest(n,e[n]);else{if(e=e.toLowerCase(),a[e]!==i)return a;t="function"==typeof t?t():t,"undefined"!=typeof enableClasses&&enableClasses&&(u.className+=" "+(t?"":"no-")+e),a[e]=t}return a},n(""),c=null,function(e,t){function i(e,t){var i=e.createElement("p"),n=e.getElementsByTagName("head")[0]||e.documentElement;return i.innerHTML="x<style>"+t+"</style>",n.insertBefore(i.lastChild,n.firstChild)}function n(){var e=v.elements;return"string"==typeof e?e.split(" "):e}function r(e){var t=m[e[p]];return t||(t={},g++,e[p]=g,m[g]=t),t}function o(e,i,n){if(i||(i=t),c)return i.createElement(e);n||(n=r(i));var o;return o=n.cache[e]?n.cache[e].cloneNode():f.test(e)?(n.cache[e]=n.createElem(e)).cloneNode():n.createElem(e),o.canHaveChildren&&!d.test(e)?n.frag.appendChild(o):o}function s(e,i){if(e||(e=t),c)return e.createDocumentFragment();i=i||r(e);for(var o=i.frag.cloneNode(),s=0,a=n(),u=a.length;s<u;s++)o.createElement(a[s]);return o}function a(e,t){t.cache||(t.cache={},t.createElem=e.createElement,t.createFrag=e.createDocumentFragment,t.frag=t.createFrag()),e.createElement=function(i){return v.shivMethods?o(i,e,t):t.createElem(i)},e.createDocumentFragment=Function("h,f","return function(){var n=f.cloneNode(),c=n.createElement;h.shivMethods&&("+n().join().replace(/\w+/g,function(e){return t.createElem(e),t.frag.createElement(e),'c("'+e+'")'})+");return n}")(v,t.frag)}function u(e){e||(e=t);var n=r(e);return!v.shivCSS||l||n.hasCSS||(n.hasCSS=!!i(e,"article,aside,figcaption,figure,footer,header,hgroup,nav,section{display:block}mark{background:#FF0;color:#000}")),c||a(e,n),e}var l,c,h=e.html5||{},d=/^<|^(?:button|map|select|textarea|object|iframe|option|optgroup)$/i,f=/^(?:a|b|code|div|fieldset|h1|h2|h3|h4|h5|h6|i|label|li|ol|p|q|span|strong|style|table|tbody|td|th|tr|ul)$/i,p="_html5shiv",g=0,m={};!function(){try{var e=t.createElement("a");e.innerHTML="<xyz></xyz>",l="hidden"in e,c=1==e.childNodes.length||function(){t.createElement("a");var e=t.createDocumentFragment();return void 0===e.cloneNode||void 0===e.createDocumentFragment||void 0===e.createElement}()}catch(e){l=!0,c=!0}}();var v={elements:h.elements||"abbr article aside audio bdi canvas data datalist details figcaption figure footer header hgroup mark meter nav output progress section summary time video",shivCSS:!1!==h.shivCSS,supportsUnknownElements:c,shivMethods:!1!==h.shivMethods,type:"default",shivDocument:u,createElement:o,createDocumentFragment:s};e.html5=v,u(t)}(this,t),a._version="2.6.2",a._prefixes=d,a.testStyles=m,a}(this,this.document),e.Modernizr=Modernizr}.apply(e,arguments)})}(this),function(){function e(e,t){return e.set(t[0],t[1]),e}function t(e,t){return e.add(t),e}function i(e,t,i){switch(i.length){case 0:return e.call(t);case 1:return e.call(t,i[0]);case 2:return e.call(t,i[0],i[1]);case 3:return e.call(t,i[0],i[1],i[2])}return e.apply(t,i)}function n(e,t,i,n){for(var r=-1,o=e?e.length:0;++r<o;){var s=e[r];t(n,s,i(s),e)}return n}function r(e,t){for(var i=-1,n=e?e.length:0;++i<n&&!1!==t(e[i],i,e););return e}function o(e,t){for(var i=e?e.length:0;i--&&!1!==t(e[i],i,e););return e}function s(e,t){for(var i=-1,n=e?e.length:0;++i<n;)if(!t(e[i],i,e))return!1;return!0}function a(e,t){for(var i=-1,n=e?e.length:0,r=0,o=[];++i<n;){var s=e[i];t(s,i,e)&&(o[r++]=s)}return o}function u(e,t){return!!(e?e.length:0)&&b(e,t,0)>-1}function l(e,t,i){for(var n=-1,r=e?e.length:0;++n<r;)if(i(t,e[n]))return!0;return!1}function c(e,t){for(var i=-1,n=e?e.length:0,r=Array(n);++i<n;)r[i]=t(e[i],i,e);return r}function h(e,t){for(var i=-1,n=t.length,r=e.length;++i<n;)e[r+i]=t[i];return e}function d(e,t,i,n){var r=-1,o=e?e.length:0;for(n&&o&&(i=e[++r]);++r<o;)i=t(i,e[r],r,e);return i}function f(e,t,i,n){var r=e?e.length:0;for(n&&r&&(i=e[--r]);r--;)i=t(i,e[r],r,e);return i}function p(e,t){for(var i=-1,n=e?e.length:0;++i<n;)if(t(e[i],i,e))return!0;return!1}function g(e){return e.split("")}function m(e){return e.match(Et)||[]}function v(e,t,i){var n;return i(e,function(e,i,r){if(t(e,i,r))return n=i,!1}),n}function y(e,t,i,n){for(var r=e.length,o=i+(n?1:-1);n?o--:++o<r;)if(t(e[o],o,e))return o;return-1}function b(e,t,i){if(t!==t)return y(e,E,i);for(var n=i-1,r=e.length;++n<r;)if(e[n]===t)return n;return-1}function w(e,t,i,n){for(var r=i-1,o=e.length;++r<o;)if(n(e[r],t))return r;return-1}function E(e){return e!==e}function _(e,t){var i=e?e.length:0;return i?I(e,t)/i:Pe}function T(e){return function(t){return null==t?Q:t[e]}}function S(e){return function(t){return null==e?Q:e[t]}}function A(e,t,i,n,r){return r(e,function(e,r,o){i=n?(n=!1,e):t(i,e,r,o)}),i}function P(e,t){var i=e.length;for(e.sort(t);i--;)e[i]=e[i].value;return e}function I(e,t){for(var i,n=-1,r=e.length;++n<r;){var o=t(e[n]);o!==Q&&(i=i===Q?o:i+o)}return i}function x(e,t){for(var i=-1,n=Array(e);++i<e;)n[i]=t(i);return n}function C(e,t){return c(t,function(t){return[t,e[t]]})}function R(e){return function(t){return e(t)}}function k(e,t){return c(t,function(t){return e[t]})}function O(e,t){return e.has(t)}function L(e,t){for(var i=-1,n=e.length;++i<n&&b(t,e[i],0)>-1;);return i}function D(e,t){for(var i=e.length;i--&&b(t,e[i],0)>-1;);return i}function M(e,t){for(var i=e.length,n=0;i--;)e[i]===t&&n++;return n}function N(e,t){return null==e?Q:e[t]}function F(e){return Xt.test(e)}function V(e){return Zt.test(e)}function U(e){var t=!1;if(null!=e&&"function"!=typeof e.toString)try{t=!!(e+"")}catch(e){}return t}function B(e){for(var t,i=[];!(t=e.next()).done;)i.push(t.value);return i}function G(e){var t=-1,i=Array(e.size);return e.forEach(function(e,n){i[++t]=[n,e]}),i}function H(e,t){return function(i){return e(t(i))}}function j(e,t){for(var i=-1,n=e.length,r=0,o=[];++i<n;){var s=e[i];s!==t&&s!==ne||(e[i]=ne,o[r++]=i)}return o}function W(e){var t=-1,i=Array(e.size);return e.forEach(function(e){i[++t]=e}),i}function $(e){var t=-1,i=Array(e.size);return e.forEach(function(e){i[++t]=[e,e]}),i}function Y(e){return F(e)?z(e):wi(e)}function q(e){return F(e)?K(e):g(e)}function z(e){for(var t=zt.lastIndex=0;zt.test(e);)t++;return t}function K(e){return e.match(zt)||[]}function X(e){return e.match(Kt)||[]}function Z(g){function S(e){if(Pa(e)&&!Rh(e)&&!(e instanceof Et)){if(e instanceof K)return e;if(Fl.call(e,"__wrapped__"))return _o(e)}return new K(e)}function z(){}function K(e,t){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!t,this.__index__=0,this.__values__=Q}function Et(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=Ie,this.__views__=[]}function kt(){var e=new Et(this.__wrapped__);return e.__actions__=fr(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=fr(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=fr(this.__views__),e}function Ot(){if(this.__filtered__){var e=new Et(this);e.__dir__=-1,e.__filtered__=!0}else e=this.clone(),e.__dir__*=-1;return e}function Lt(){var e=this.__wrapped__.value(),t=this.__dir__,i=Rh(e),n=t<0,r=i?e.length:0,o=Xr(0,r,this.__views__),s=o.start,a=o.end,u=a-s,l=n?a:s-1,c=this.__iteratees__,h=c.length,d=0,f=lc(u,this.__takeCount__);if(!i||r<ee||r==u&&f==u)return zn(e,this.__actions__);var p=[];e:for(;u--&&d<f;){l+=t;for(var g=-1,m=e[l];++g<h;){var v=c[g],y=v.iteratee,b=v.type,w=y(m);if(b==Ee)m=w;else if(!w){if(b==we)continue e;break e}}p[d++]=m}return p}function Dt(e){var t=-1,i=e?e.length:0;for(this.clear();++t<i;){var n=e[t];this.set(n[0],n[1])}}function Mt(){this.__data__=yc?yc(null):{}}function Nt(e){return this.has(e)&&delete this.__data__[e]}function Ft(e){var t=this.__data__;if(yc){var i=t[e];return i===ie?Q:i}return Fl.call(t,e)?t[e]:Q}function Vt(e){var t=this.__data__;return yc?t[e]!==Q:Fl.call(t,e)}function Ut(e,t){return this.__data__[e]=yc&&t===Q?ie:t,this}function Bt(e){var t=-1,i=e?e.length:0;for(this.clear();++t<i;){var n=e[t];this.set(n[0],n[1])}}function Gt(){this.__data__=[]}function Ht(e){var t=this.__data__,i=Ri(t,e);return!(i<0)&&(i==t.length-1?t.pop():Xl.call(t,i,1),!0)}function jt(e){var t=this.__data__,i=Ri(t,e);return i<0?Q:t[i][1]}function Wt(e){return Ri(this.__data__,e)>-1}function $t(e,t){var i=this.__data__,n=Ri(i,e);return n<0?i.push([e,t]):i[n][1]=t,this}function zt(e){var t=-1,i=e?e.length:0;for(this.clear();++t<i;){var n=e[t];this.set(n[0],n[1])}}function Kt(){this.__data__={hash:new Dt,map:new(pc||Bt),string:new Dt}}function Xt(e){return qr(this,e).delete(e)}function Zt(e){return qr(this,e).get(e)}function ti(e){return qr(this,e).has(e)}function ii(e,t){return qr(this,e).set(e,t),this}function ni(e){var t=-1,i=e?e.length:0;for(this.__data__=new zt;++t<i;)this.add(e[t])}function si(e){return this.__data__.set(e,ie),this}function ai(e){return this.__data__.has(e)}function li(e){this.__data__=new Bt(e)}function ci(){this.__data__=new Bt}function di(e){return this.__data__.delete(e)}function fi(e){return this.__data__.get(e)}function wi(e){return this.__data__.has(e)}function Ai(e,t){var i=this.__data__;if(i instanceof Bt){var n=i.__data__;if(!pc||n.length<ee-1)return n.push([e,t]),this;i=this.__data__=new zt(n)}return i.set(e,t),this}function Pi(e,t){var i=Rh(e)||da(e)?x(e.length,Cl):[],n=i.length,r=!!n;for(var o in e)!t&&!Fl.call(e,o)||r&&("length"==o||ro(o,n))||i.push(o);return i}function Ii(e,t,i,n){return e===Q||ha(e,Ll[i])&&!Fl.call(n,i)?t:e}function xi(e,t,i){(i===Q||ha(e[t],i))&&("number"!=typeof t||i!==Q||t in e)||(e[t]=i)}function Ci(e,t,i){var n=e[t];Fl.call(e,t)&&ha(n,i)&&(i!==Q||t in e)||(e[t]=i)}function Ri(e,t){for(var i=e.length;i--;)if(ha(e[i][0],t))return i;return-1}function ki(e,t,i,n){return kc(e,function(e,r,o){t(n,e,i(e),o)}),n}function Oi(e,t){return e&&pr(t,au(t),e)}function Li(e,t){for(var i=-1,n=null==e,r=t.length,o=_l(r);++i<r;)o[i]=n?Q:ru(e,t[i]);return o}function Di(e,t,i){return e===e&&(i!==Q&&(e=e<=i?e:i),t!==Q&&(e=e>=t?e:t)),e}function Mi(e,t,i,n,o,s,a){var u;if(n&&(u=s?n(e,o,s,a):n(e)),u!==Q)return u;if(!Aa(e))return e;var l=Rh(e);if(l){if(u=Jr(e),!t)return fr(e,u)}else{var c=Gc(e),h=c==Ne||c==Fe;if(Oh(e))return tr(e,t);if(c==Be||c==ke||h&&!s){if(U(e))return s?e:{};if(u=eo(h?{}:e),!t)return gr(e,Oi(u,e))}else{if(!ei[c])return s?e:{};u=to(e,c,Mi,t)}}a||(a=new li);var d=a.get(e);if(d)return d;if(a.set(e,u),!l)var f=i?Hr(e):au(e);return r(f||e,function(r,o){f&&(o=r,r=e[o]),Ci(u,o,Mi(r,t,i,n,o,e,a))}),u}function Ni(e){var t=au(e);return function(i){return Fi(i,e,t)}}function Fi(e,t,i){var n=i.length;if(null==e)return!n;for(e=Il(e);n--;){var r=i[n],o=t[r],s=e[r];if(s===Q&&!(r in e)||!o(s))return!1}return!0}function Vi(e){return Aa(e)?zl(e):{}}function Ui(e,t,i){if("function"!=typeof e)throw new Rl(te);return Wc(function(){e.apply(Q,i)},t)}function Bi(e,t,i,n){var r=-1,o=u,s=!0,a=e.length,h=[],d=t.length;if(!a)return h;i&&(t=c(t,R(i))),n?(o=l,s=!1):t.length>=ee&&(o=O,s=!1,t=new ni(t));e:for(;++r<a;){var f=e[r],p=i?i(f):f;if(f=n||0!==f?f:0,s&&p===p){for(var g=d;g--;)if(t[g]===p)continue e;h.push(f)}else o(t,p,n)||h.push(f)}return h}function Gi(e,t){var i=!0;return kc(e,function(e,n,r){return i=!!t(e,n,r)}),i}function Hi(e,t,i){for(var n=-1,r=e.length;++n<r;){var o=e[n],s=t(o);if(null!=s&&(a===Q?s===s&&!Fa(s):i(s,a)))var a=s,u=o}return u}function ji(e,t,i,n){var r=e.length;for(i=ja(i),i<0&&(i=-i>r?0:r+i),n=n===Q||n>r?r:ja(n),n<0&&(n+=r),n=i>n?0:Wa(n);i<n;)e[i++]=t;return e}function Wi(e,t){var i=[];return kc(e,function(e,n,r){t(e,n,r)&&i.push(e)}),i}function $i(e,t,i,n,r){var o=-1,s=e.length;for(i||(i=no),r||(r=[]);++o<s;){var a=e[o];t>0&&i(a)?t>1?$i(a,t-1,i,n,r):h(r,a):n||(r[r.length]=a)}return r}function Yi(e,t){return e&&Lc(e,t,au)}function qi(e,t){return e&&Dc(e,t,au)}function zi(e,t){return a(t,function(t){return _a(e[t])})}function Ki(e,t){t=so(t,e)?[t]:Jn(t);for(var i=0,n=t.length;null!=e&&i<n;)e=e[bo(t[i++])];return i&&i==n?e:Q}function Xi(e,t,i){var n=t(e);return Rh(e)?n:h(n,i(e))}function Zi(e){return Bl.call(e)}function Qi(e,t){return e>t}function Ji(e,t){return null!=e&&Fl.call(e,t)}function en(e,t){return null!=e&&t in Il(e)}function tn(e,t,i){return e>=lc(t,i)&&e<uc(t,i)}function nn(e,t,i){for(var n=i?l:u,r=e[0].length,o=e.length,s=o,a=_l(o),h=1/0,d=[];s--;){var f=e[s];s&&t&&(f=c(f,R(t))),h=lc(f.length,h),a[s]=!i&&(t||r>=120&&f.length>=120)?new ni(s&&f):Q}f=e[0];var p=-1,g=a[0];e:for(;++p<r&&d.length<h;){var m=f[p],v=t?t(m):m;if(m=i||0!==m?m:0,!(g?O(g,v):n(d,v,i))){for(s=o;--s;){var y=a[s];if(!(y?O(y,v):n(e[s],v,i)))continue e}g&&g.push(v),d.push(m)}}return d}function rn(e,t,i,n){return Yi(e,function(e,r,o){t(n,i(e),r,o)}),n}function on(e,t,n){so(t,e)||(t=Jn(t),e=vo(e,t),t=Go(t));var r=null==e?e:e[bo(t)];return null==r?Q:i(r,e,n)}function sn(e){return Pa(e)&&Bl.call(e)==ze}function an(e){return Pa(e)&&Bl.call(e)==De}function un(e,t,i,n,r){return e===t||(null==e||null==t||!Aa(e)&&!Pa(t)?e!==e&&t!==t:ln(e,t,un,i,n,r))}function ln(e,t,i,n,r,o){var s=Rh(e),a=Rh(t),u=Oe,l=Oe;s||(u=Gc(e),u=u==ke?Be:u),a||(l=Gc(t),l=l==ke?Be:l);var c=u==Be&&!U(e),h=l==Be&&!U(t),d=u==l;if(d&&!c)return o||(o=new li),s||Fh(e)?Ur(e,t,i,n,r,o):Br(e,t,u,i,n,r,o);if(!(r&ge)){var f=c&&Fl.call(e,"__wrapped__"),p=h&&Fl.call(t,"__wrapped__");if(f||p){var g=f?e.value():e,m=p?t.value():t;return o||(o=new li),i(g,m,n,r,o)}}return!!d&&(o||(o=new li),Gr(e,t,i,n,r,o))}function cn(e){return Pa(e)&&Gc(e)==Ve}function hn(e,t,i,n){var r=i.length,o=r,s=!n;if(null==e)return!o;for(e=Il(e);r--;){var a=i[r];if(s&&a[2]?a[1]!==e[a[0]]:!(a[0]in e))return!1}for(;++r<o;){a=i[r];var u=a[0],l=e[u],c=a[1];if(s&&a[2]){if(l===Q&&!(u in e))return!1}else{var h=new li;if(n)var d=n(l,c,u,e,t,h);if(!(d===Q?un(c,l,n,pe|ge,h):d))return!1}}return!0}function dn(e){return!(!Aa(e)||lo(e))&&(_a(e)||U(e)?Hl:It).test(wo(e))}function fn(e){return Aa(e)&&Bl.call(e)==He}function pn(e){return Pa(e)&&Gc(e)==je}function gn(e){return Pa(e)&&Sa(e.length)&&!!Jt[Bl.call(e)]}function mn(e){return"function"==typeof e?e:null==e?Xu:"object"==typeof e?Rh(e)?_n(e[0],e[1]):En(e):rl(e)}function vn(e){if(!co(e))return ac(e);var t=[];for(var i in Il(e))Fl.call(e,i)&&"constructor"!=i&&t.push(i);return t}function yn(e){if(!Aa(e))return mo(e);var t=co(e),i=[];for(var n in e)("constructor"!=n||!t&&Fl.call(e,n))&&i.push(n);return i}function bn(e,t){return e<t}function wn(e,t){var i=-1,n=fa(e)?_l(e.length):[];return kc(e,function(e,r,o){n[++i]=t(e,r,o)}),n}function En(e){var t=zr(e);return 1==t.length&&t[0][2]?fo(t[0][0],t[0][1]):function(i){return i===e||hn(i,e,t)}}function _n(e,t){return so(e)&&ho(t)?fo(bo(e),t):function(i){var n=ru(i,e);return n===Q&&n===t?su(i,e):un(t,n,Q,pe|ge)}}function Tn(e,t,i,n,o){if(e!==t){if(!Rh(t)&&!Fh(t))var s=yn(t);r(s||t,function(r,a){if(s&&(a=r,r=t[a]),Aa(r))o||(o=new li),Sn(e,t,a,i,Tn,n,o);else{var u=n?n(e[a],r,a+"",e,t,o):Q;u===Q&&(u=r),xi(e,a,u)}})}}function Sn(e,t,i,n,r,o,s){var a=e[i],u=t[i],l=s.get(u);if(l)return void xi(e,i,l);var c=o?o(a,u,i+"",e,t,s):Q,h=c===Q;h&&(c=u,Rh(u)||Fh(u)?Rh(a)?c=a:pa(a)?c=fr(a):(h=!1,c=Mi(u,!0)):Da(u)||da(u)?da(a)?c=Ya(a):!Aa(a)||n&&_a(a)?(h=!1,c=Mi(u,!0)):c=a:h=!1),h&&(s.set(u,c),r(c,u,n,o,s),s.delete(u)),xi(e,i,c)}function An(e,t){var i=e.length;if(i)return t+=t<0?i:0,ro(t,i)?e[t]:Q}function Pn(e,t,i){var n=-1;return t=c(t.length?t:[Xu],R(Yr())),P(wn(e,function(e,i,r){return{criteria:c(t,function(t){return t(e)}),index:++n,value:e}}),function(e,t){return cr(e,t,i)})}function In(e,t){return e=Il(e),xn(e,t,function(t,i){return i in e})}function xn(e,t,i){for(var n=-1,r=t.length,o={};++n<r;){var s=t[n],a=e[s];i(a,s)&&(o[s]=a)}return o}function Cn(e){return function(t){return Ki(t,e)}}function Rn(e,t,i,n){var r=n?w:b,o=-1,s=t.length,a=e;for(e===t&&(t=fr(t)),i&&(a=c(e,R(i)));++o<s;)for(var u=0,l=t[o],h=i?i(l):l;(u=r(a,h,u,n))>-1;)a!==e&&Xl.call(a,u,1),Xl.call(e,u,1);return e}function kn(e,t){for(var i=e?t.length:0,n=i-1;i--;){var r=t[i];if(i==n||r!==o){var o=r;if(ro(r))Xl.call(e,r,1);else if(so(r,e))delete e[bo(r)];else{var s=Jn(r),a=vo(e,s);null!=a&&delete a[bo(Go(s))]}}}return e}function On(e,t){return e+ic(hc()*(t-e+1))}function Ln(e,t,i,n){for(var r=-1,o=uc(tc((t-e)/(i||1)),0),s=_l(o);o--;)s[n?o:++r]=e,e+=i;return s}function Dn(e,t){var i="";if(!e||t<1||t>Se)return i;do{t%2&&(i+=e),(t=ic(t/2))&&(e+=e)}while(t);return i}function Mn(e,t){return t=uc(t===Q?e.length-1:t,0),function(){for(var n=arguments,r=-1,o=uc(n.length-t,0),s=_l(o);++r<o;)s[r]=n[t+r];r=-1;for(var a=_l(t+1);++r<t;)a[r]=n[r];return a[t]=s,i(e,this,a)}}function Nn(e,t,i,n){if(!Aa(e))return e;t=so(t,e)?[t]:Jn(t);for(var r=-1,o=t.length,s=o-1,a=e;null!=a&&++r<o;){var u=bo(t[r]),l=i;if(r!=s){var c=a[u];l=n?n(c,u,a):Q,l===Q&&(l=Aa(c)?c:ro(t[r+1])?[]:{})}Ci(a,u,l),a=a[u]}return e}function Fn(e,t,i){var n=-1,r=e.length;t<0&&(t=-t>r?0:r+t),i=i>r?r:i,i<0&&(i+=r),r=t>i?0:i-t>>>0,t>>>=0;for(var o=_l(r);++n<r;)o[n]=e[n+t];return o}function Vn(e,t){var i;return kc(e,function(e,n,r){return!(i=t(e,n,r))}),!!i}function Un(e,t,i){var n=0,r=e?e.length:n;if("number"==typeof t&&t===t&&r<=Ce){for(;n<r;){var o=n+r>>>1,s=e[o];null!==s&&!Fa(s)&&(i?s<=t:s<t)?n=o+1:r=o}return r}return Bn(e,t,Xu,i)}function Bn(e,t,i,n){t=i(t);for(var r=0,o=e?e.length:0,s=t!==t,a=null===t,u=Fa(t),l=t===Q;r<o;){var c=ic((r+o)/2),h=i(e[c]),d=h!==Q,f=null===h,p=h===h,g=Fa(h);if(s)var m=n||p;else m=l?p&&(n||d):a?p&&d&&(n||!f):u?p&&d&&!f&&(n||!g):!f&&!g&&(n?h<=t:h<t);m?r=c+1:o=c}return lc(o,xe)}function Gn(e,t){for(var i=-1,n=e.length,r=0,o=[];++i<n;){var s=e[i],a=t?t(s):s;if(!i||!ha(a,u)){var u=a;o[r++]=0===s?0:s}}return o}function Hn(e){return"number"==typeof e?e:Fa(e)?Pe:+e}function jn(e){if("string"==typeof e)return e;if(Fa(e))return Rc?Rc.call(e):"";var t=e+"";return"0"==t&&1/e==-Te?"-0":t}function Wn(e,t,i){var n=-1,r=u,o=e.length,s=!0,a=[],c=a;if(i)s=!1,r=l;else if(o>=ee){var h=t?null:Fc(e);if(h)return W(h);s=!1,r=O,c=new ni}else c=t?[]:a;e:for(;++n<o;){var d=e[n],f=t?t(d):d;if(d=i||0!==d?d:0,s&&f===f){for(var p=c.length;p--;)if(c[p]===f)continue e;t&&c.push(f),a.push(d)}else r(c,f,i)||(c!==a&&c.push(f),a.push(d))}return a}function $n(e,t){t=so(t,e)?[t]:Jn(t),e=vo(e,t);var i=bo(Go(t));return!(null!=e&&Fl.call(e,i))||delete e[i]}function Yn(e,t,i,n){return Nn(e,t,i(Ki(e,t)),n)}function qn(e,t,i,n){for(var r=e.length,o=n?r:-1;(n?o--:++o<r)&&t(e[o],o,e););return i?Fn(e,n?0:o,n?o+1:r):Fn(e,n?o+1:0,n?r:o)}function zn(e,t){var i=e;return i instanceof Et&&(i=i.value()),d(t,function(e,t){return t.func.apply(t.thisArg,h([e],t.args))},i)}function Kn(e,t,i){for(var n=-1,r=e.length;++n<r;)var o=o?h(Bi(o,e[n],t,i),Bi(e[n],o,t,i)):e[n];return o&&o.length?Wn(o,t,i):[]}function Xn(e,t,i){for(var n=-1,r=e.length,o=t.length,s={};++n<r;){var a=n<o?t[n]:Q;i(s,e[n],a)}return s}function Zn(e){return pa(e)?e:[]}function Qn(e){return"function"==typeof e?e:Xu}function Jn(e){return Rh(e)?e:Yc(e)}function er(e,t,i){var n=e.length;return i=i===Q?n:i,!t&&i>=n?e:Fn(e,t,i)}function tr(e,t){if(t)return e.slice();var i=new e.constructor(e.length);return e.copy(i),i}function ir(e){var t=new e.constructor(e.byteLength);return new $l(t).set(new $l(e)),t}function nr(e,t){var i=t?ir(e.buffer):e.buffer;return new e.constructor(i,e.byteOffset,e.byteLength)}function rr(t,i,n){return d(i?n(G(t),!0):G(t),e,new t.constructor)}function or(e){var t=new e.constructor(e.source,Tt.exec(e));return t.lastIndex=e.lastIndex,t}function sr(e,i,n){return d(i?n(W(e),!0):W(e),t,new e.constructor)}function ar(e){return Cc?Il(Cc.call(e)):{}}function ur(e,t){var i=t?ir(e.buffer):e.buffer;return new e.constructor(i,e.byteOffset,e.length)}function lr(e,t){if(e!==t){var i=e!==Q,n=null===e,r=e===e,o=Fa(e),s=t!==Q,a=null===t,u=t===t,l=Fa(t);if(!a&&!l&&!o&&e>t||o&&s&&u&&!a&&!l||n&&s&&u||!i&&u||!r)return 1;if(!n&&!o&&!l&&e<t||l&&i&&r&&!n&&!o||a&&i&&r||!s&&r||!u)return-1}return 0}function cr(e,t,i){for(var n=-1,r=e.criteria,o=t.criteria,s=r.length,a=i.length;++n<s;){var u=lr(r[n],o[n]);if(u){if(n>=a)return u;return u*("desc"==i[n]?-1:1)}}return e.index-t.index}function hr(e,t,i,n){for(var r=-1,o=e.length,s=i.length,a=-1,u=t.length,l=uc(o-s,0),c=_l(u+l),h=!n;++a<u;)c[a]=t[a];for(;++r<s;)(h||r<o)&&(c[i[r]]=e[r]);for(;l--;)c[a++]=e[r++];return c}function dr(e,t,i,n){for(var r=-1,o=e.length,s=-1,a=i.length,u=-1,l=t.length,c=uc(o-a,0),h=_l(c+l),d=!n;++r<c;)h[r]=e[r];for(var f=r;++u<l;)h[f+u]=t[u];for(;++s<a;)(d||r<o)&&(h[f+i[s]]=e[r++]);return h}function fr(e,t){var i=-1,n=e.length;for(t||(t=_l(n));++i<n;)t[i]=e[i];return t}function pr(e,t,i,n){i||(i={});for(var r=-1,o=t.length;++r<o;){var s=t[r],a=n?n(i[s],e[s],s,i,e):Q;Ci(i,s,a===Q?e[s]:a)}return i}function gr(e,t){return pr(e,Uc(e),t)}function mr(e,t){return function(i,r){var o=Rh(i)?n:ki,s=t?t():{};return o(i,e,Yr(r,2),s)}}function vr(e){return Mn(function(t,i){var n=-1,r=i.length,o=r>1?i[r-1]:Q,s=r>2?i[2]:Q;for(o=e.length>3&&"function"==typeof o?(r--,o):Q,s&&oo(i[0],i[1],s)&&(o=r<3?Q:o,r=1),t=Il(t);++n<r;){var a=i[n];a&&e(t,a,n,o)}return t})}function yr(e,t){return function(i,n){if(null==i)return i;if(!fa(i))return e(i,n);for(var r=i.length,o=t?r:-1,s=Il(i);(t?o--:++o<r)&&!1!==n(s[o],o,s););return i}}function br(e){return function(t,i,n){for(var r=-1,o=Il(t),s=n(t),a=s.length;a--;){var u=s[e?a:++r];if(!1===i(o[u],u,o))break}return t}}function wr(e,t,i){function n(){return(this&&this!==ui&&this instanceof n?o:e).apply(r?i:this,arguments)}var r=t&re,o=Tr(e);return n}function Er(e){return function(t){t=za(t);var i=F(t)?q(t):Q,n=i?i[0]:t.charAt(0),r=i?er(i,1).join(""):t.slice(1);return n[e]()+r}}function _r(e){return function(t){return d($u(Pu(t).replace(Yt,"")),e,"")}}function Tr(e){return function(){var t=arguments;switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3]);case 5:return new e(t[0],t[1],t[2],t[3],t[4]);case 6:return new e(t[0],t[1],t[2],t[3],t[4],t[5]);case 7:return new e(t[0],t[1],t[2],t[3],t[4],t[5],t[6])}var i=Vi(e.prototype),n=e.apply(i,t);return Aa(n)?n:i}}function Sr(e,t,n){function r(){for(var s=arguments.length,a=_l(s),u=s,l=$r(r);u--;)a[u]=arguments[u];var c=s<3&&a[0]!==l&&a[s-1]!==l?[]:j(a,l);return(s-=c.length)<n?Mr(e,t,Ir,r.placeholder,Q,a,c,Q,Q,n-s):i(this&&this!==ui&&this instanceof r?o:e,this,a)}var o=Tr(e);return r}function Ar(e){return function(t,i,n){var r=Il(t);if(!fa(t)){var o=Yr(i,3);t=au(t),i=function(e){return o(r[e],e,r)}}var s=e(t,i,n);return s>-1?r[o?t[s]:s]:Q}}function Pr(e){return Mn(function(t){t=$i(t,1);var i=t.length,n=i,r=K.prototype.thru;for(e&&t.reverse();n--;){var o=t[n];if("function"!=typeof o)throw new Rl(te);if(r&&!s&&"wrapper"==Wr(o))var s=new K([],!0)}for(n=s?n:i;++n<i;){o=t[n];var a=Wr(o),u="wrapper"==a?Vc(o):Q;s=u&&uo(u[0])&&u[1]==(he|ae|le|de)&&!u[4].length&&1==u[9]?s[Wr(u[0])].apply(s,u[3]):1==o.length&&uo(o)?s[a]():s.thru(o)}return function(){var e=arguments,n=e[0];if(s&&1==e.length&&Rh(n)&&n.length>=ee)return s.plant(n).value();for(var r=0,o=i?t[r].apply(this,e):n;++r<i;)o=t[r].call(this,o);return o}})}function Ir(e,t,i,n,r,o,s,a,u,l){function c(){for(var v=arguments.length,y=_l(v),b=v;b--;)y[b]=arguments[b];if(p)var w=$r(c),E=M(y,w);if(n&&(y=hr(y,n,r,p)),o&&(y=dr(y,o,s,p)),v-=E,p&&v<l){var _=j(y,w);return Mr(e,t,Ir,c.placeholder,i,y,_,a,u,l-v)}var T=d?i:this,S=f?T[e]:e;return v=y.length,a?y=yo(y,a):g&&v>1&&y.reverse(),h&&u<v&&(y.length=u),this&&this!==ui&&this instanceof c&&(S=m||Tr(S)),S.apply(T,y)}var h=t&he,d=t&re,f=t&oe,p=t&(ae|ue),g=t&fe,m=f?Q:Tr(e);return c}function xr(e,t){return function(i,n){return rn(i,e,t(n),{})}}function Cr(e,t){return function(i,n){var r;if(i===Q&&n===Q)return t;if(i!==Q&&(r=i),n!==Q){if(r===Q)return n;"string"==typeof i||"string"==typeof n?(i=jn(i),n=jn(n)):(i=Hn(i),n=Hn(n)),r=e(i,n)}return r}}function Rr(e){return Mn(function(t){return t=1==t.length&&Rh(t[0])?c(t[0],R(Yr())):c($i(t,1),R(Yr())),Mn(function(n){var r=this;return e(t,function(e){return i(e,r,n)})})})}function kr(e,t){t=t===Q?" ":jn(t);var i=t.length;if(i<2)return i?Dn(t,e):t;var n=Dn(t,tc(e/Y(t)));return F(t)?er(q(n),0,e).join(""):n.slice(0,e)}function Or(e,t,n,r){function o(){for(var t=-1,u=arguments.length,l=-1,c=r.length,h=_l(c+u),d=this&&this!==ui&&this instanceof o?a:e;++l<c;)h[l]=r[l];for(;u--;)h[l++]=arguments[++t];return i(d,s?n:this,h)}var s=t&re,a=Tr(e);return o}function Lr(e){return function(t,i,n){return n&&"number"!=typeof n&&oo(t,i,n)&&(i=n=Q),t=Ha(t),i===Q?(i=t,t=0):i=Ha(i),n=n===Q?t<i?1:-1:Ha(n),Ln(t,i,n,e)}}function Dr(e){return function(t,i){return"string"==typeof t&&"string"==typeof i||(t=$a(t),i=$a(i)),e(t,i)}}function Mr(e,t,i,n,r,o,s,a,u,l){var c=t&ae,h=c?s:Q,d=c?Q:s,f=c?o:Q,p=c?Q:o;t|=c?le:ce,(t&=~(c?ce:le))&se||(t&=~(re|oe));var g=[e,t,r,f,h,p,d,a,u,l],m=i.apply(Q,g);return uo(e)&&jc(m,g),m.placeholder=n,$c(m,e,t)}function Nr(e){var t=Pl[e];return function(e,i){if(e=$a(e),i=lc(ja(i),292)){var n=(za(e)+"e").split("e");return n=(za(t(n[0]+"e"+(+n[1]+i)))+"e").split("e"),+(n[0]+"e"+(+n[1]-i))}return t(e)}}function Fr(e){return function(t){var i=Gc(t);return i==Ve?G(t):i==je?$(t):C(t,e(t))}}function Vr(e,t,i,n,r,o,s,a){var u=t&oe;if(!u&&"function"!=typeof e)throw new Rl(te);var l=n?n.length:0;if(l||(t&=~(le|ce),n=r=Q),s=s===Q?s:uc(ja(s),0),a=a===Q?a:ja(a),l-=r?r.length:0,t&ce){var c=n,h=r;n=r=Q}var d=u?Q:Vc(e),f=[e,t,i,n,r,c,h,o,s,a];if(d&&po(f,d),e=f[0],t=f[1],i=f[2],n=f[3],r=f[4],a=f[9]=null==f[9]?u?0:e.length:uc(f[9]-l,0),!a&&t&(ae|ue)&&(t&=~(ae|ue)),t&&t!=re)p=t==ae||t==ue?Sr(e,t,a):t!=le&&t!=(re|le)||r.length?Ir.apply(Q,f):Or(e,t,i,n);else var p=wr(e,t,i);return $c((d?Mc:jc)(p,f),e,t)}function Ur(e,t,i,n,r,o){var s=r&ge,a=e.length,u=t.length;if(a!=u&&!(s&&u>a))return!1;var l=o.get(e);if(l&&o.get(t))return l==t;var c=-1,h=!0,d=r&pe?new ni:Q;for(o.set(e,t),o.set(t,e);++c<a;){var f=e[c],g=t[c];if(n)var m=s?n(g,f,c,t,e,o):n(f,g,c,e,t,o);if(m!==Q){if(m)continue;h=!1;break}if(d){if(!p(t,function(e,t){if(!d.has(t)&&(f===e||i(f,e,n,r,o)))return d.add(t)})){h=!1;break}}else if(f!==g&&!i(f,g,n,r,o)){h=!1;break}}return o.delete(e),o.delete(t),h}function Br(e,t,i,n,r,o,s){switch(i){case Ke:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case ze:return!(e.byteLength!=t.byteLength||!n(new $l(e),new $l(t)));case Le:case De:case Ue:return ha(+e,+t);case Me:return e.name==t.name&&e.message==t.message;case He:case We:return e==t+"";case Ve:var a=G;case je:var u=o&ge;if(a||(a=W),e.size!=t.size&&!u)return!1;var l=s.get(e);if(l)return l==t;o|=pe,s.set(e,t);var c=Ur(a(e),a(t),n,r,o,s);return s.delete(e),c;case $e:if(Cc)return Cc.call(e)==Cc.call(t)}return!1}function Gr(e,t,i,n,r,o){var s=r&ge,a=au(e),u=a.length;if(u!=au(t).length&&!s)return!1;for(var l=u;l--;){var c=a[l];if(!(s?c in t:Fl.call(t,c)))return!1}var h=o.get(e);if(h&&o.get(t))return h==t;var d=!0;o.set(e,t),o.set(t,e);for(var f=s;++l<u;){c=a[l];var p=e[c],g=t[c];if(n)var m=s?n(g,p,c,t,e,o):n(p,g,c,e,t,o);if(!(m===Q?p===g||i(p,g,n,r,o):m)){d=!1;break}f||(f="constructor"==c)}if(d&&!f){var v=e.constructor,y=t.constructor;v!=y&&"constructor"in e&&"constructor"in t&&!("function"==typeof v&&v instanceof v&&"function"==typeof y&&y instanceof y)&&(d=!1)}return o.delete(e),o.delete(t),d}function Hr(e){return Xi(e,au,Uc)}function jr(e){return Xi(e,uu,Bc)}function Wr(e){for(var t=e.name+"",i=_c[t],n=Fl.call(_c,t)?i.length:0;n--;){var r=i[n],o=r.func;if(null==o||o==e)return r.name}return t}function $r(e){return(Fl.call(S,"placeholder")?S:e).placeholder}function Yr(){var e=S.iteratee||Zu;return e=e===Zu?mn:e,arguments.length?e(arguments[0],arguments[1]):e}function qr(e,t){var i=e.__data__;return ao(t)?i["string"==typeof t?"string":"hash"]:i.map}function zr(e){for(var t=au(e),i=t.length;i--;){var n=t[i],r=e[n];t[i]=[n,r,ho(r)]}return t}function Kr(e,t){var i=N(e,t);return dn(i)?i:Q}function Xr(e,t,i){for(var n=-1,r=i.length;++n<r;){var o=i[n],s=o.size;switch(o.type){case"drop":e+=s;break;case"dropRight":t-=s;break;case"take":t=lc(t,e+s);break;case"takeRight":e=uc(e,t-s)}}return{start:e,end:t}}function Zr(e){var t=e.match(bt);return t?t[1].split(wt):[]}function Qr(e,t,i){t=so(t,e)?[t]:Jn(t);for(var n,r=-1,o=t.length;++r<o;){var s=bo(t[r]);if(!(n=null!=e&&i(e,s)))break;e=e[s]}if(n)return n;var o=e?e.length:0;return!!o&&Sa(o)&&ro(s,o)&&(Rh(e)||da(e))}function Jr(e){var t=e.length,i=e.constructor(t);return t&&"string"==typeof e[0]&&Fl.call(e,"index")&&(i.index=e.index,i.input=e.input),i}function eo(e){return"function"!=typeof e.constructor||co(e)?{}:Vi(Yl(e))}function to(e,t,i,n){var r=e.constructor;switch(t){case ze:return ir(e);case Le:case De:return new r(+e);case Ke:return nr(e,n);case Xe:case Ze:case Qe:case Je:case et:case tt:case it:case nt:case rt:return ur(e,n);case Ve:return rr(e,n,i);case Ue:case We:return new r(e);case He:return or(e);case je:return sr(e,n,i);case $e:return ar(e)}}function io(e,t){var i=t.length,n=i-1;return t[n]=(i>1?"& ":"")+t[n],t=t.join(i>2?", ":" "),e.replace(yt,"{\n/* [wrapped with "+t+"] */\n")}function no(e){return Rh(e)||da(e)||!!(Zl&&e&&e[Zl])}function ro(e,t){return!!(t=null==t?Se:t)&&("number"==typeof e||Ct.test(e))&&e>-1&&e%1==0&&e<t}function oo(e,t,i){if(!Aa(i))return!1;var n=typeof t;return!!("number"==n?fa(i)&&ro(t,i.length):"string"==n&&t in i)&&ha(i[t],e)}function so(e,t){if(Rh(e))return!1;var i=typeof e;return!("number"!=i&&"symbol"!=i&&"boolean"!=i&&null!=e&&!Fa(e))||(ct.test(e)||!lt.test(e)||null!=t&&e in Il(t))}function ao(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}function uo(e){var t=Wr(e),i=S[t];if("function"!=typeof i||!(t in Et.prototype))return!1;if(e===i)return!0;var n=Vc(i);return!!n&&e===n[0]}function lo(e){return!!Ml&&Ml in e}function co(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||Ll)}function ho(e){return e===e&&!Aa(e)}function fo(e,t){return function(i){return null!=i&&(i[e]===t&&(t!==Q||e in Il(i)))}}function po(e,t){var i=e[1],n=t[1],r=i|n,o=r<(re|oe|he),s=n==he&&i==ae||n==he&&i==de&&e[7].length<=t[8]||n==(he|de)&&t[7].length<=t[8]&&i==ae;if(!o&&!s)return e
;n&re&&(e[2]=t[2],r|=i&re?0:se);var a=t[3];if(a){var u=e[3];e[3]=u?hr(u,a,t[4]):a,e[4]=u?j(e[3],ne):t[4]}return a=t[5],a&&(u=e[5],e[5]=u?dr(u,a,t[6]):a,e[6]=u?j(e[5],ne):t[6]),a=t[7],a&&(e[7]=a),n&he&&(e[8]=null==e[8]?t[8]:lc(e[8],t[8])),null==e[9]&&(e[9]=t[9]),e[0]=t[0],e[1]=r,e}function go(e,t,i,n,r,o){return Aa(e)&&Aa(t)&&(o.set(t,e),Tn(e,t,Q,go,o),o.delete(t)),e}function mo(e){var t=[];if(null!=e)for(var i in Il(e))t.push(i);return t}function vo(e,t){return 1==t.length?e:Ki(e,Fn(t,0,-1))}function yo(e,t){for(var i=e.length,n=lc(t.length,i),r=fr(e);n--;){var o=t[n];e[n]=ro(o,i)?r[o]:Q}return e}function bo(e){if("string"==typeof e||Fa(e))return e;var t=e+"";return"0"==t&&1/e==-Te?"-0":t}function wo(e){if(null!=e){try{return Nl.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function Eo(e,t){return r(Re,function(i){var n="_."+i[0];t&i[1]&&!u(e,n)&&e.push(n)}),e.sort()}function _o(e){if(e instanceof Et)return e.clone();var t=new K(e.__wrapped__,e.__chain__);return t.__actions__=fr(e.__actions__),t.__index__=e.__index__,t.__values__=e.__values__,t}function To(e,t,i){t=(i?oo(e,t,i):t===Q)?1:uc(ja(t),0);var n=e?e.length:0;if(!n||t<1)return[];for(var r=0,o=0,s=_l(tc(n/t));r<n;)s[o++]=Fn(e,r,r+=t);return s}function So(e){for(var t=-1,i=e?e.length:0,n=0,r=[];++t<i;){var o=e[t];o&&(r[n++]=o)}return r}function Ao(){for(var e=arguments.length,t=_l(e?e-1:0),i=arguments[0],n=e;n--;)t[n-1]=arguments[n];return e?h(Rh(i)?fr(i):[i],$i(t,1)):[]}function Po(e,t,i){var n=e?e.length:0;return n?(t=i||t===Q?1:ja(t),Fn(e,t<0?0:t,n)):[]}function Io(e,t,i){var n=e?e.length:0;return n?(t=i||t===Q?1:ja(t),t=n-t,Fn(e,0,t<0?0:t)):[]}function xo(e,t){return e&&e.length?qn(e,Yr(t,3),!0,!0):[]}function Co(e,t){return e&&e.length?qn(e,Yr(t,3),!0):[]}function Ro(e,t,i,n){var r=e?e.length:0;return r?(i&&"number"!=typeof i&&oo(e,t,i)&&(i=0,n=r),ji(e,t,i,n)):[]}function ko(e,t,i){var n=e?e.length:0;if(!n)return-1;var r=null==i?0:ja(i);return r<0&&(r=uc(n+r,0)),y(e,Yr(t,3),r)}function Oo(e,t,i){var n=e?e.length:0;if(!n)return-1;var r=n-1;return i!==Q&&(r=ja(i),r=i<0?uc(n+r,0):lc(r,n-1)),y(e,Yr(t,3),r,!0)}function Lo(e){return(e?e.length:0)?$i(e,1):[]}function Do(e){return(e?e.length:0)?$i(e,Te):[]}function Mo(e,t){return(e?e.length:0)?(t=t===Q?1:ja(t),$i(e,t)):[]}function No(e){for(var t=-1,i=e?e.length:0,n={};++t<i;){var r=e[t];n[r[0]]=r[1]}return n}function Fo(e){return e&&e.length?e[0]:Q}function Vo(e,t,i){var n=e?e.length:0;if(!n)return-1;var r=null==i?0:ja(i);return r<0&&(r=uc(n+r,0)),b(e,t,r)}function Uo(e){return(e?e.length:0)?Fn(e,0,-1):[]}function Bo(e,t){return e?sc.call(e,t):""}function Go(e){var t=e?e.length:0;return t?e[t-1]:Q}function Ho(e,t,i){var n=e?e.length:0;if(!n)return-1;var r=n;if(i!==Q&&(r=ja(i),r=(r<0?uc(n+r,0):lc(r,n-1))+1),t!==t)return y(e,E,r-1,!0);for(;r--;)if(e[r]===t)return r;return-1}function jo(e,t){return e&&e.length?An(e,ja(t)):Q}function Wo(e,t){return e&&e.length&&t&&t.length?Rn(e,t):e}function $o(e,t,i){return e&&e.length&&t&&t.length?Rn(e,t,Yr(i,2)):e}function Yo(e,t,i){return e&&e.length&&t&&t.length?Rn(e,t,Q,i):e}function qo(e,t){var i=[];if(!e||!e.length)return i;var n=-1,r=[],o=e.length;for(t=Yr(t,3);++n<o;){var s=e[n];t(s,n,e)&&(i.push(s),r.push(n))}return kn(e,r),i}function zo(e){return e?dc.call(e):e}function Ko(e,t,i){var n=e?e.length:0;return n?(i&&"number"!=typeof i&&oo(e,t,i)?(t=0,i=n):(t=null==t?0:ja(t),i=i===Q?n:ja(i)),Fn(e,t,i)):[]}function Xo(e,t){return Un(e,t)}function Zo(e,t,i){return Bn(e,t,Yr(i,2))}function Qo(e,t){var i=e?e.length:0;if(i){var n=Un(e,t);if(n<i&&ha(e[n],t))return n}return-1}function Jo(e,t){return Un(e,t,!0)}function es(e,t,i){return Bn(e,t,Yr(i,2),!0)}function ts(e,t){if(e?e.length:0){var i=Un(e,t,!0)-1;if(ha(e[i],t))return i}return-1}function is(e){return e&&e.length?Gn(e):[]}function ns(e,t){return e&&e.length?Gn(e,Yr(t,2)):[]}function rs(e){var t=e?e.length:0;return t?Fn(e,1,t):[]}function os(e,t,i){return e&&e.length?(t=i||t===Q?1:ja(t),Fn(e,0,t<0?0:t)):[]}function ss(e,t,i){var n=e?e.length:0;return n?(t=i||t===Q?1:ja(t),t=n-t,Fn(e,t<0?0:t,n)):[]}function as(e,t){return e&&e.length?qn(e,Yr(t,3),!1,!0):[]}function us(e,t){return e&&e.length?qn(e,Yr(t,3)):[]}function ls(e){return e&&e.length?Wn(e):[]}function cs(e,t){return e&&e.length?Wn(e,Yr(t,2)):[]}function hs(e,t){return e&&e.length?Wn(e,Q,t):[]}function ds(e){if(!e||!e.length)return[];var t=0;return e=a(e,function(e){if(pa(e))return t=uc(e.length,t),!0}),x(t,function(t){return c(e,T(t))})}function fs(e,t){if(!e||!e.length)return[];var n=ds(e);return null==t?n:c(n,function(e){return i(t,Q,e)})}function ps(e,t){return Xn(e||[],t||[],Ci)}function gs(e,t){return Xn(e||[],t||[],Nn)}function ms(e){var t=S(e);return t.__chain__=!0,t}function vs(e,t){return t(e),e}function ys(e,t){return t(e)}function bs(){return ms(this)}function ws(){return new K(this.value(),this.__chain__)}function Es(){this.__values__===Q&&(this.__values__=Ga(this.value()));var e=this.__index__>=this.__values__.length;return{done:e,value:e?Q:this.__values__[this.__index__++]}}function _s(){return this}function Ts(e){for(var t,i=this;i instanceof z;){var n=_o(i);n.__index__=0,n.__values__=Q,t?r.__wrapped__=n:t=n;var r=n;i=i.__wrapped__}return r.__wrapped__=e,t}function Ss(){var e=this.__wrapped__;if(e instanceof Et){var t=e;return this.__actions__.length&&(t=new Et(this)),t=t.reverse(),t.__actions__.push({func:ys,args:[zo],thisArg:Q}),new K(t,this.__chain__)}return this.thru(zo)}function As(){return zn(this.__wrapped__,this.__actions__)}function Ps(e,t,i){var n=Rh(e)?s:Gi;return i&&oo(e,t,i)&&(t=Q),n(e,Yr(t,3))}function Is(e,t){return(Rh(e)?a:Wi)(e,Yr(t,3))}function xs(e,t){return $i(Ds(e,t),1)}function Cs(e,t){return $i(Ds(e,t),Te)}function Rs(e,t,i){return i=i===Q?1:ja(i),$i(Ds(e,t),i)}function ks(e,t){return(Rh(e)?r:kc)(e,Yr(t,3))}function Os(e,t){return(Rh(e)?o:Oc)(e,Yr(t,3))}function Ls(e,t,i,n){e=fa(e)?e:wu(e),i=i&&!n?ja(i):0;var r=e.length;return i<0&&(i=uc(r+i,0)),Na(e)?i<=r&&e.indexOf(t,i)>-1:!!r&&b(e,t,i)>-1}function Ds(e,t){return(Rh(e)?c:wn)(e,Yr(t,3))}function Ms(e,t,i,n){return null==e?[]:(Rh(t)||(t=null==t?[]:[t]),i=n?Q:i,Rh(i)||(i=null==i?[]:[i]),Pn(e,t,i))}function Ns(e,t,i){var n=Rh(e)?d:A,r=arguments.length<3;return n(e,Yr(t,4),i,r,kc)}function Fs(e,t,i){var n=Rh(e)?f:A,r=arguments.length<3;return n(e,Yr(t,4),i,r,Oc)}function Vs(e,t){return(Rh(e)?a:Wi)(e,Qs(Yr(t,3)))}function Us(e){var t=fa(e)?e:wu(e),i=t.length;return i>0?t[On(0,i-1)]:Q}function Bs(e,t,i){var n=-1,r=Ga(e),o=r.length,s=o-1;for(t=(i?oo(e,t,i):t===Q)?1:Di(ja(t),0,o);++n<t;){var a=On(n,s),u=r[a];r[a]=r[n],r[n]=u}return r.length=t,r}function Gs(e){return Bs(e,Ie)}function Hs(e){if(null==e)return 0;if(fa(e))return Na(e)?Y(e):e.length;var t=Gc(e);return t==Ve||t==je?e.size:vn(e).length}function js(e,t,i){var n=Rh(e)?p:Vn;return i&&oo(e,t,i)&&(t=Q),n(e,Yr(t,3))}function Ws(e,t){if("function"!=typeof t)throw new Rl(te);return e=ja(e),function(){if(--e<1)return t.apply(this,arguments)}}function $s(e,t,i){return t=i?Q:t,t=e&&null==t?e.length:t,Vr(e,he,Q,Q,Q,Q,t)}function Ys(e,t){var i;if("function"!=typeof t)throw new Rl(te);return e=ja(e),function(){return--e>0&&(i=t.apply(this,arguments)),e<=1&&(t=Q),i}}function qs(e,t,i){t=i?Q:t;var n=Vr(e,ae,Q,Q,Q,Q,Q,t);return n.placeholder=qs.placeholder,n}function zs(e,t,i){t=i?Q:t;var n=Vr(e,ue,Q,Q,Q,Q,Q,t);return n.placeholder=zs.placeholder,n}function Ks(e,t,i){function n(t){var i=d,n=f;return d=f=Q,y=t,g=e.apply(n,i)}function r(e){return y=e,m=Wc(a,t),b?n(e):g}function o(e){var i=e-v,n=e-y,r=t-i;return w?lc(r,p-n):r}function s(e){var i=e-v,n=e-y;return v===Q||i>=t||i<0||w&&n>=p}function a(){var e=bh();if(s(e))return u(e);m=Wc(a,o(e))}function u(e){return m=Q,E&&d?n(e):(d=f=Q,g)}function l(){m!==Q&&Nc(m),y=0,d=v=f=m=Q}function c(){return m===Q?g:u(bh())}function h(){var e=bh(),i=s(e);if(d=arguments,f=this,v=e,i){if(m===Q)return r(v);if(w)return m=Wc(a,t),n(v)}return m===Q&&(m=Wc(a,t)),g}var d,f,p,g,m,v,y=0,b=!1,w=!1,E=!0;if("function"!=typeof e)throw new Rl(te);return t=$a(t)||0,Aa(i)&&(b=!!i.leading,w="maxWait"in i,p=w?uc($a(i.maxWait)||0,t):p,E="trailing"in i?!!i.trailing:E),h.cancel=l,h.flush=c,h}function Xs(e){return Vr(e,fe)}function Zs(e,t){if("function"!=typeof e||t&&"function"!=typeof t)throw new Rl(te);var i=function(){var n=arguments,r=t?t.apply(this,n):n[0],o=i.cache;if(o.has(r))return o.get(r);var s=e.apply(this,n);return i.cache=o.set(r,s),s};return i.cache=new(Zs.Cache||zt),i}function Qs(e){if("function"!=typeof e)throw new Rl(te);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}function Js(e){return Ys(2,e)}function ea(e,t){if("function"!=typeof e)throw new Rl(te);return t=t===Q?t:ja(t),Mn(e,t)}function ta(e,t){if("function"!=typeof e)throw new Rl(te);return t=t===Q?0:uc(ja(t),0),Mn(function(n){var r=n[t],o=er(n,0,t);return r&&h(o,r),i(e,this,o)})}function ia(e,t,i){var n=!0,r=!0;if("function"!=typeof e)throw new Rl(te);return Aa(i)&&(n="leading"in i?!!i.leading:n,r="trailing"in i?!!i.trailing:r),Ks(e,t,{leading:n,maxWait:t,trailing:r})}function na(e){return $s(e,1)}function ra(e,t){return t=null==t?Xu:t,Ah(t,e)}function oa(){if(!arguments.length)return[];var e=arguments[0];return Rh(e)?e:[e]}function sa(e){return Mi(e,!1,!0)}function aa(e,t){return Mi(e,!1,!0,t)}function ua(e){return Mi(e,!0,!0)}function la(e,t){return Mi(e,!0,!0,t)}function ca(e,t){return null==t||Fi(e,t,au(t))}function ha(e,t){return e===t||e!==e&&t!==t}function da(e){return pa(e)&&Fl.call(e,"callee")&&(!Kl.call(e,"callee")||Bl.call(e)==ke)}function fa(e){return null!=e&&Sa(e.length)&&!_a(e)}function pa(e){return Pa(e)&&fa(e)}function ga(e){return!0===e||!1===e||Pa(e)&&Bl.call(e)==Le}function ma(e){return!!e&&1===e.nodeType&&Pa(e)&&!Da(e)}function va(e){if(fa(e)&&(Rh(e)||"string"==typeof e||"function"==typeof e.splice||Oh(e)||da(e)))return!e.length;var t=Gc(e);if(t==Ve||t==je)return!e.size;if(Ec||co(e))return!ac(e).length;for(var i in e)if(Fl.call(e,i))return!1;return!0}function ya(e,t){return un(e,t)}function ba(e,t,i){i="function"==typeof i?i:Q;var n=i?i(e,t):Q;return n===Q?un(e,t,i):!!n}function wa(e){return!!Pa(e)&&(Bl.call(e)==Me||"string"==typeof e.message&&"string"==typeof e.name)}function Ea(e){return"number"==typeof e&&oc(e)}function _a(e){var t=Aa(e)?Bl.call(e):"";return t==Ne||t==Fe}function Ta(e){return"number"==typeof e&&e==ja(e)}function Sa(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=Se}function Aa(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function Pa(e){return!!e&&"object"==typeof e}function Ia(e,t){return e===t||hn(e,t,zr(t))}function xa(e,t,i){return i="function"==typeof i?i:Q,hn(e,t,zr(t),i)}function Ca(e){return La(e)&&e!=+e}function Ra(e){if(Hc(e))throw new Sl("This method is not supported with core-js. Try https://github.com/es-shims.");return dn(e)}function ka(e){return null===e}function Oa(e){return null==e}function La(e){return"number"==typeof e||Pa(e)&&Bl.call(e)==Ue}function Da(e){if(!Pa(e)||Bl.call(e)!=Be||U(e))return!1;var t=Yl(e);if(null===t)return!0;var i=Fl.call(t,"constructor")&&t.constructor;return"function"==typeof i&&i instanceof i&&Nl.call(i)==Ul}function Ma(e){return Ta(e)&&e>=-Se&&e<=Se}function Na(e){return"string"==typeof e||!Rh(e)&&Pa(e)&&Bl.call(e)==We}function Fa(e){return"symbol"==typeof e||Pa(e)&&Bl.call(e)==$e}function Va(e){return e===Q}function Ua(e){return Pa(e)&&Gc(e)==Ye}function Ba(e){return Pa(e)&&Bl.call(e)==qe}function Ga(e){if(!e)return[];if(fa(e))return Na(e)?q(e):fr(e);if(ql&&e[ql])return B(e[ql]());var t=Gc(e);return(t==Ve?G:t==je?W:wu)(e)}function Ha(e){if(!e)return 0===e?e:0;if((e=$a(e))===Te||e===-Te){return(e<0?-1:1)*Ae}return e===e?e:0}function ja(e){var t=Ha(e),i=t%1;return t===t?i?t-i:t:0}function Wa(e){return e?Di(ja(e),0,Ie):0}function $a(e){if("number"==typeof e)return e;if(Fa(e))return Pe;if(Aa(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=Aa(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(gt,"");var i=Pt.test(e);return i||xt.test(e)?oi(e.slice(2),i?2:8):At.test(e)?Pe:+e}function Ya(e){return pr(e,uu(e))}function qa(e){return Di(ja(e),-Se,Se)}function za(e){return null==e?"":jn(e)}function Ka(e,t){var i=Vi(e);return t?Oi(i,t):i}function Xa(e,t){return v(e,Yr(t,3),Yi)}function Za(e,t){return v(e,Yr(t,3),qi)}function Qa(e,t){return null==e?e:Lc(e,Yr(t,3),uu)}function Ja(e,t){return null==e?e:Dc(e,Yr(t,3),uu)}function eu(e,t){return e&&Yi(e,Yr(t,3))}function tu(e,t){return e&&qi(e,Yr(t,3))}function iu(e){return null==e?[]:zi(e,au(e))}function nu(e){return null==e?[]:zi(e,uu(e))}function ru(e,t,i){var n=null==e?Q:Ki(e,t);return n===Q?i:n}function ou(e,t){return null!=e&&Qr(e,t,Ji)}function su(e,t){return null!=e&&Qr(e,t,en)}function au(e){return fa(e)?Pi(e):vn(e)}function uu(e){return fa(e)?Pi(e,!0):yn(e)}function lu(e,t){var i={};return t=Yr(t,3),Yi(e,function(e,n,r){i[t(e,n,r)]=e}),i}function cu(e,t){var i={};return t=Yr(t,3),Yi(e,function(e,n,r){i[n]=t(e,n,r)}),i}function hu(e,t){return du(e,Qs(Yr(t)))}function du(e,t){return null==e?{}:xn(e,jr(e),Yr(t))}function fu(e,t,i){t=so(t,e)?[t]:Jn(t);var n=-1,r=t.length;for(r||(e=Q,r=1);++n<r;){var o=null==e?Q:e[bo(t[n])];o===Q&&(n=r,o=i),e=_a(o)?o.call(e):o}return e}function pu(e,t,i){return null==e?e:Nn(e,t,i)}function gu(e,t,i,n){return n="function"==typeof n?n:Q,null==e?e:Nn(e,t,i,n)}function mu(e,t,i){var n=Rh(e)||Fh(e);if(t=Yr(t,4),null==i)if(n||Aa(e)){var o=e.constructor;i=n?Rh(e)?new o:[]:_a(o)?Vi(Yl(e)):{}}else i={};return(n?r:Yi)(e,function(e,n,r){return t(i,e,n,r)}),i}function vu(e,t){return null==e||$n(e,t)}function yu(e,t,i){return null==e?e:Yn(e,t,Qn(i))}function bu(e,t,i,n){return n="function"==typeof n?n:Q,null==e?e:Yn(e,t,Qn(i),n)}function wu(e){return e?k(e,au(e)):[]}function Eu(e){return null==e?[]:k(e,uu(e))}function _u(e,t,i){return i===Q&&(i=t,t=Q),i!==Q&&(i=$a(i),i=i===i?i:0),t!==Q&&(t=$a(t),t=t===t?t:0),Di($a(e),t,i)}function Tu(e,t,i){return t=Ha(t),i===Q?(i=t,t=0):i=Ha(i),e=$a(e),tn(e,t,i)}function Su(e,t,i){if(i&&"boolean"!=typeof i&&oo(e,t,i)&&(t=i=Q),i===Q&&("boolean"==typeof t?(i=t,t=Q):"boolean"==typeof e&&(i=e,e=Q)),e===Q&&t===Q?(e=0,t=1):(e=Ha(e),t===Q?(t=e,e=0):t=Ha(t)),e>t){var n=e;e=t,t=n}if(i||e%1||t%1){var r=hc();return lc(e+r*(t-e+ri("1e-"+((r+"").length-1))),t)}return On(e,t)}function Au(e){return ld(za(e).toLowerCase())}function Pu(e){return(e=za(e))&&e.replace(Rt,Ei).replace(qt,"")}function Iu(e,t,i){e=za(e),t=jn(t);var n=e.length;i=i===Q?n:Di(ja(i),0,n);var r=i;return(i-=t.length)>=0&&e.slice(i,r)==t}function xu(e){return e=za(e),e&&ut.test(e)?e.replace(st,_i):e}function Cu(e){return e=za(e),e&&pt.test(e)?e.replace(ft,"\\$&"):e}function Ru(e,t,i){e=za(e),t=ja(t);var n=t?Y(e):0;if(!t||n>=t)return e;var r=(t-n)/2;return kr(ic(r),i)+e+kr(tc(r),i)}function ku(e,t,i){e=za(e),t=ja(t);var n=t?Y(e):0;return t&&n<t?e+kr(t-n,i):e}function Ou(e,t,i){e=za(e),t=ja(t);var n=t?Y(e):0;return t&&n<t?kr(t-n,i)+e:e}function Lu(e,t,i){return i||null==t?t=0:t&&(t=+t),e=za(e).replace(gt,""),cc(e,t||(St.test(e)?16:10))}function Du(e,t,i){return t=(i?oo(e,t,i):t===Q)?1:ja(t),Dn(za(e),t)}function Mu(){var e=arguments,t=za(e[0]);return e.length<3?t:t.replace(e[1],e[2])}function Nu(e,t,i){return i&&"number"!=typeof i&&oo(e,t,i)&&(t=i=Q),(i=i===Q?Ie:i>>>0)?(e=za(e),e&&("string"==typeof t||null!=t&&!Mh(t))&&!(t=jn(t))&&F(e)?er(q(e),0,i):e.split(t,i)):[]}function Fu(e,t,i){return e=za(e),i=Di(ja(i),0,e.length),t=jn(t),e.slice(i,i+t.length)==t}function Vu(e){return za(e).toLowerCase()}function Uu(e){return za(e).toUpperCase()}function Bu(e,t,i){if((e=za(e))&&(i||t===Q))return e.replace(gt,"");if(!e||!(t=jn(t)))return e;var n=q(e),r=q(t);return er(n,L(n,r),D(n,r)+1).join("")}function Gu(e,t,i){if((e=za(e))&&(i||t===Q))return e.replace(vt,"");if(!e||!(t=jn(t)))return e;var n=q(e);return er(n,0,D(n,q(t))+1).join("")}function Hu(e,t,i){if((e=za(e))&&(i||t===Q))return e.replace(mt,"");if(!e||!(t=jn(t)))return e;var n=q(e);return er(n,L(n,q(t))).join("")}function ju(e,t){var i=me,n=ve;if(Aa(t)){var r="separator"in t?t.separator:r;i="length"in t?ja(t.length):i,n="omission"in t?jn(t.omission):n}e=za(e);var o=e.length;if(F(e)){var s=q(e);o=s.length}if(i>=o)return e;var a=i-Y(n);if(a<1)return n;var u=s?er(s,0,a).join(""):e.slice(0,a);if(r===Q)return u+n;if(s&&(a+=u.length-a),Mh(r)){if(e.slice(a).search(r)){var l,c=u;for(r.global||(r=xl(r.source,za(Tt.exec(r))+"g")),r.lastIndex=0;l=r.exec(c);)var h=l.index;u=u.slice(0,h===Q?a:h)}}else if(e.indexOf(jn(r),a)!=a){var d=u.lastIndexOf(r);d>-1&&(u=u.slice(0,d))}return u+n}function Wu(e){return e=za(e),e&&at.test(e)?e.replace(ot,Ti):e}function $u(e,t,i){return e=za(e),t=i?Q:t,t===Q?V(e)?X(e):m(e):e.match(t)||[]}function Yu(e){var t=e?e.length:0,n=Yr();return e=t?c(e,function(e){if("function"!=typeof e[1])throw new Rl(te);return[n(e[0]),e[1]]}):[],Mn(function(n){for(var r=-1;++r<t;){var o=e[r];if(i(o[0],this,n))return i(o[1],this,n)}})}function qu(e){return Ni(Mi(e,!0))}function zu(e){return function(){return e}}function Ku(e,t){return null==e||e!==e?t:e}function Xu(e){return e}function Zu(e){return mn("function"==typeof e?e:Mi(e,!0))}function Qu(e){return En(Mi(e,!0))}function Ju(e,t){return _n(e,Mi(t,!0))}function el(e,t,i){var n=au(t),o=zi(t,n);null!=i||Aa(t)&&(o.length||!n.length)||(i=t,t=e,e=this,o=zi(t,au(t)));var s=!(Aa(i)&&"chain"in i&&!i.chain),a=_a(e);return r(o,function(i){var n=t[i];e[i]=n,a&&(e.prototype[i]=function(){var t=this.__chain__;if(s||t){var i=e(this.__wrapped__);return(i.__actions__=fr(this.__actions__)).push({func:n,args:arguments,thisArg:e}),i.__chain__=t,i}return n.apply(e,h([this.value()],arguments))})}),e}function tl(){return ui._===this&&(ui._=Gl),this}function il(){}function nl(e){return e=ja(e),Mn(function(t){return An(t,e)})}function rl(e){return so(e)?T(bo(e)):Cn(e)}function ol(e){return function(t){return null==e?Q:Ki(e,t)}}function sl(){return[]}function al(){return!1}function ul(){return{}}function ll(){return""}function cl(){return!0}function hl(e,t){if((e=ja(e))<1||e>Se)return[];var i=Ie,n=lc(e,Ie);t=Yr(t),e-=Ie;for(var r=x(n,t);++i<e;)t(i);return r}function dl(e){return Rh(e)?c(e,bo):Fa(e)?[e]:fr(Yc(e))}function fl(e){var t=++Vl;return za(e)+t}function pl(e){return e&&e.length?Hi(e,Xu,Qi):Q}function gl(e,t){return e&&e.length?Hi(e,Yr(t,2),Qi):Q}function ml(e){return _(e,Xu)}function vl(e,t){return _(e,Yr(t,2))}function yl(e){return e&&e.length?Hi(e,Xu,bn):Q}function bl(e,t){return e&&e.length?Hi(e,Yr(t,2),bn):Q}function wl(e){return e&&e.length?I(e,Xu):0}function El(e,t){return e&&e.length?I(e,Yr(t,2)):0}g=g?Si.defaults(ui.Object(),g,Si.pick(ui,Qt)):ui;var _l=g.Array,Tl=g.Date,Sl=g.Error,Al=g.Function,Pl=g.Math,Il=g.Object,xl=g.RegExp,Cl=g.String,Rl=g.TypeError,kl=_l.prototype,Ol=Al.prototype,Ll=Il.prototype,Dl=g["__core-js_shared__"],Ml=function(){var e=/[^.]+$/.exec(Dl&&Dl.keys&&Dl.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),Nl=Ol.toString,Fl=Ll.hasOwnProperty,Vl=0,Ul=Nl.call(Il),Bl=Ll.toString,Gl=ui._,Hl=xl("^"+Nl.call(Fl).replace(ft,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),jl=hi?g.Buffer:Q,Wl=g.Symbol,$l=g.Uint8Array,Yl=H(Il.getPrototypeOf,Il),ql=Wl?Wl.iterator:Q,zl=Il.create,Kl=Ll.propertyIsEnumerable,Xl=kl.splice,Zl=Wl?Wl.isConcatSpreadable:Q,Ql=g.clearTimeout!==ui.clearTimeout&&g.clearTimeout,Jl=Tl&&Tl.now!==ui.Date.now&&Tl.now,ec=g.setTimeout!==ui.setTimeout&&g.setTimeout,tc=Pl.ceil,ic=Pl.floor,nc=Il.getOwnPropertySymbols,rc=jl?jl.isBuffer:Q,oc=g.isFinite,sc=kl.join,ac=H(Il.keys,Il),uc=Pl.max,lc=Pl.min,cc=g.parseInt,hc=Pl.random,dc=kl.reverse,fc=Kr(g,"DataView"),pc=Kr(g,"Map"),gc=Kr(g,"Promise"),mc=Kr(g,"Set"),vc=Kr(g,"WeakMap"),yc=Kr(Il,"create"),bc=function(){var e=Kr(Il,"defineProperty"),t=Kr.name;return t&&t.length>2?e:Q}(),wc=vc&&new vc,Ec=!Kl.call({valueOf:1},"valueOf"),_c={},Tc=wo(fc),Sc=wo(pc),Ac=wo(gc),Pc=wo(mc),Ic=wo(vc),xc=Wl?Wl.prototype:Q,Cc=xc?xc.valueOf:Q,Rc=xc?xc.toString:Q;S.prototype=z.prototype,S.prototype.constructor=S,K.prototype=Vi(z.prototype),K.prototype.constructor=K,Et.prototype=Vi(z.prototype),Et.prototype.constructor=Et,Dt.prototype.clear=Mt,Dt.prototype.delete=Nt,Dt.prototype.get=Ft,Dt.prototype.has=Vt,Dt.prototype.set=Ut,Bt.prototype.clear=Gt,Bt.prototype.delete=Ht,Bt.prototype.get=jt,Bt.prototype.has=Wt,Bt.prototype.set=$t,zt.prototype.clear=Kt,zt.prototype.delete=Xt,zt.prototype.get=Zt,zt.prototype.has=ti,zt.prototype.set=ii,ni.prototype.add=ni.prototype.push=si,ni.prototype.has=ai,li.prototype.clear=ci,li.prototype.delete=di,li.prototype.get=fi,li.prototype.has=wi,li.prototype.set=Ai;var kc=yr(Yi),Oc=yr(qi,!0),Lc=br(),Dc=br(!0),Mc=wc?function(e,t){return wc.set(e,t),e}:Xu,Nc=Ql||function(e){return ui.clearTimeout(e)},Fc=mc&&1/W(new mc([,-0]))[1]==Te?function(e){return new mc(e)}:il,Vc=wc?function(e){return wc.get(e)}:il,Uc=nc?H(nc,Il):sl,Bc=nc?function(e){for(var t=[];e;)h(t,Uc(e)),e=Yl(e);return t}:sl,Gc=Zi;(fc&&Gc(new fc(new ArrayBuffer(1)))!=Ke||pc&&Gc(new pc)!=Ve||gc&&Gc(gc.resolve())!=Ge||mc&&Gc(new mc)!=je||vc&&Gc(new vc)!=Ye)&&(Gc=function(e){var t=Bl.call(e),i=t==Be?e.constructor:Q,n=i?wo(i):Q;if(n)switch(n){case Tc:return Ke;case Sc:return Ve;case Ac:return Ge;case Pc:return je;case Ic:return Ye}return t});var Hc=Dl?_a:al,jc=function(){var e=0,t=0;return function(i,n){var r=bh(),o=be-(r-t);if(t=r,o>0){if(++e>=ye)return i}else e=0;return Mc(i,n)}}(),Wc=ec||function(e,t){return ui.setTimeout(e,t)},$c=bc?function(e,t,i){var n=t+"";return bc(e,"toString",{configurable:!0,enumerable:!1,value:zu(io(n,Eo(Zr(n),i)))})}:Xu,Yc=Zs(function(e){e=za(e);var t=[];return ht.test(e)&&t.push(""),e.replace(dt,function(e,i,n,r){t.push(n?r.replace(_t,"$1"):i||e)}),t}),qc=Mn(function(e,t){return pa(e)?Bi(e,$i(t,1,pa,!0)):[]}),zc=Mn(function(e,t){var i=Go(t);return pa(i)&&(i=Q),pa(e)?Bi(e,$i(t,1,pa,!0),Yr(i,2)):[]}),Kc=Mn(function(e,t){var i=Go(t);return pa(i)&&(i=Q),pa(e)?Bi(e,$i(t,1,pa,!0),Q,i):[]}),Xc=Mn(function(e){var t=c(e,Zn);return t.length&&t[0]===e[0]?nn(t):[]}),Zc=Mn(function(e){var t=Go(e),i=c(e,Zn);return t===Go(i)?t=Q:i.pop(),i.length&&i[0]===e[0]?nn(i,Yr(t,2)):[]}),Qc=Mn(function(e){var t=Go(e),i=c(e,Zn);return t===Go(i)?t=Q:i.pop(),i.length&&i[0]===e[0]?nn(i,Q,t):[]}),Jc=Mn(Wo),eh=Mn(function(e,t){t=$i(t,1);var i=e?e.length:0,n=Li(e,t);return kn(e,c(t,function(e){return ro(e,i)?+e:e}).sort(lr)),n}),th=Mn(function(e){return Wn($i(e,1,pa,!0))}),ih=Mn(function(e){var t=Go(e);return pa(t)&&(t=Q),Wn($i(e,1,pa,!0),Yr(t,2))}),nh=Mn(function(e){var t=Go(e);return pa(t)&&(t=Q),Wn($i(e,1,pa,!0),Q,t)}),rh=Mn(function(e,t){return pa(e)?Bi(e,t):[]}),oh=Mn(function(e){return Kn(a(e,pa))}),sh=Mn(function(e){var t=Go(e);return pa(t)&&(t=Q),Kn(a(e,pa),Yr(t,2))}),ah=Mn(function(e){var t=Go(e);return pa(t)&&(t=Q),Kn(a(e,pa),Q,t)}),uh=Mn(ds),lh=Mn(function(e){var t=e.length,i=t>1?e[t-1]:Q;return i="function"==typeof i?(e.pop(),i):Q,fs(e,i)}),ch=Mn(function(e){e=$i(e,1);var t=e.length,i=t?e[0]:0,n=this.__wrapped__,r=function(t){return Li(t,e)};return!(t>1||this.__actions__.length)&&n instanceof Et&&ro(i)?(n=n.slice(i,+i+(t?1:0)),n.__actions__.push({func:ys,args:[r],thisArg:Q}),new K(n,this.__chain__).thru(function(e){return t&&!e.length&&e.push(Q),e})):this.thru(r)}),hh=mr(function(e,t,i){Fl.call(e,i)?++e[i]:e[i]=1}),dh=Ar(ko),fh=Ar(Oo),ph=mr(function(e,t,i){Fl.call(e,i)?e[i].push(t):e[i]=[t]}),gh=Mn(function(e,t,n){var r=-1,o="function"==typeof t,s=so(t),a=fa(e)?_l(e.length):[];return kc(e,function(e){var u=o?t:s&&null!=e?e[t]:Q;a[++r]=u?i(u,e,n):on(e,t,n)}),a}),mh=mr(function(e,t,i){e[i]=t}),vh=mr(function(e,t,i){e[i?0:1].push(t)},function(){return[[],[]]}),yh=Mn(function(e,t){if(null==e)return[];var i=t.length;return i>1&&oo(e,t[0],t[1])?t=[]:i>2&&oo(t[0],t[1],t[2])&&(t=[t[0]]),Pn(e,$i(t,1),[])}),bh=Jl||function(){return ui.Date.now()},wh=Mn(function(e,t,i){var n=re;if(i.length){var r=j(i,$r(wh));n|=le}return Vr(e,n,t,i,r)}),Eh=Mn(function(e,t,i){var n=re|oe;if(i.length){var r=j(i,$r(Eh));n|=le}return Vr(t,n,e,i,r)}),_h=Mn(function(e,t){return Ui(e,1,t)}),Th=Mn(function(e,t,i){return Ui(e,$a(t)||0,i)});Zs.Cache=zt;var Sh=Mn(function(e,t){t=1==t.length&&Rh(t[0])?c(t[0],R(Yr())):c($i(t,1),R(Yr()));var n=t.length;return Mn(function(r){for(var o=-1,s=lc(r.length,n);++o<s;)r[o]=t[o].call(this,r[o]);return i(e,this,r)})}),Ah=Mn(function(e,t){var i=j(t,$r(Ah));return Vr(e,le,Q,t,i)}),Ph=Mn(function(e,t){var i=j(t,$r(Ph));return Vr(e,ce,Q,t,i)}),Ih=Mn(function(e,t){return Vr(e,de,Q,Q,Q,$i(t,1))}),xh=Dr(Qi),Ch=Dr(function(e,t){return e>=t}),Rh=_l.isArray,kh=pi?R(pi):sn,Oh=rc||al,Lh=gi?R(gi):an,Dh=mi?R(mi):cn,Mh=vi?R(vi):fn,Nh=yi?R(yi):pn,Fh=bi?R(bi):gn,Vh=Dr(bn),Uh=Dr(function(e,t){return e<=t}),Bh=vr(function(e,t){if(Ec||co(t)||fa(t))return void pr(t,au(t),e);for(var i in t)Fl.call(t,i)&&Ci(e,i,t[i])}),Gh=vr(function(e,t){pr(t,uu(t),e)}),Hh=vr(function(e,t,i,n){pr(t,uu(t),e,n)}),jh=vr(function(e,t,i,n){pr(t,au(t),e,n)}),Wh=Mn(function(e,t){return Li(e,$i(t,1))}),$h=Mn(function(e){return e.push(Q,Ii),i(Hh,Q,e)}),Yh=Mn(function(e){return e.push(Q,go),i(Zh,Q,e)}),qh=xr(function(e,t,i){e[t]=i},zu(Xu)),zh=xr(function(e,t,i){Fl.call(e,t)?e[t].push(i):e[t]=[i]},Yr),Kh=Mn(on),Xh=vr(function(e,t,i){Tn(e,t,i)}),Zh=vr(function(e,t,i,n){Tn(e,t,i,n)}),Qh=Mn(function(e,t){return null==e?{}:(t=c($i(t,1),bo),In(e,Bi(jr(e),t)))}),Jh=Mn(function(e,t){return null==e?{}:In(e,c($i(t,1),bo))}),ed=Fr(au),td=Fr(uu),id=_r(function(e,t,i){return t=t.toLowerCase(),e+(i?Au(t):t)}),nd=_r(function(e,t,i){return e+(i?"-":"")+t.toLowerCase()}),rd=_r(function(e,t,i){return e+(i?" ":"")+t.toLowerCase()}),od=Er("toLowerCase"),sd=_r(function(e,t,i){return e+(i?"_":"")+t.toLowerCase()}),ad=_r(function(e,t,i){return e+(i?" ":"")+ld(t)}),ud=_r(function(e,t,i){return e+(i?" ":"")+t.toUpperCase()}),ld=Er("toUpperCase"),cd=Mn(function(e,t){try{return i(e,Q,t)}catch(e){return wa(e)?e:new Sl(e)}}),hd=Mn(function(e,t){return r($i(t,1),function(t){t=bo(t),e[t]=wh(e[t],e)}),e}),dd=Pr(),fd=Pr(!0),pd=Mn(function(e,t){return function(i){return on(i,e,t)}}),gd=Mn(function(e,t){return function(i){return on(e,i,t)}}),md=Rr(c),vd=Rr(s),yd=Rr(p),bd=Lr(),wd=Lr(!0),Ed=Cr(function(e,t){return e+t},0),_d=Nr("ceil"),Td=Cr(function(e,t){return e/t},1),Sd=Nr("floor"),Ad=Cr(function(e,t){return e*t},1),Pd=Nr("round"),Id=Cr(function(e,t){return e-t},0);return S.after=Ws,S.ary=$s,S.assign=Bh,S.assignIn=Gh,S.assignInWith=Hh,S.assignWith=jh,S.at=Wh,S.before=Ys,S.bind=wh,S.bindAll=hd,S.bindKey=Eh,S.castArray=oa,S.chain=ms,S.chunk=To,S.compact=So,S.concat=Ao,S.cond=Yu,S.conforms=qu,S.constant=zu,S.countBy=hh,S.create=Ka,S.curry=qs,S.curryRight=zs,S.debounce=Ks,S.defaults=$h,S.defaultsDeep=Yh,S.defer=_h,S.delay=Th,S.difference=qc,S.differenceBy=zc,S.differenceWith=Kc,S.drop=Po,S.dropRight=Io,S.dropRightWhile=xo,S.dropWhile=Co,S.fill=Ro,S.filter=Is,S.flatMap=xs,S.flatMapDeep=Cs,S.flatMapDepth=Rs,S.flatten=Lo,S.flattenDeep=Do,S.flattenDepth=Mo,S.flip=Xs,S.flow=dd,S.flowRight=fd,S.fromPairs=No,S.functions=iu,S.functionsIn=nu,S.groupBy=ph,S.initial=Uo,S.intersection=Xc,S.intersectionBy=Zc,S.intersectionWith=Qc,S.invert=qh,S.invertBy=zh,S.invokeMap=gh,S.iteratee=Zu,S.keyBy=mh,S.keys=au,S.keysIn=uu,S.map=Ds,S.mapKeys=lu,S.mapValues=cu,S.matches=Qu,S.matchesProperty=Ju,S.memoize=Zs,S.merge=Xh,S.mergeWith=Zh,S.method=pd,S.methodOf=gd,S.mixin=el,S.negate=Qs,S.nthArg=nl,S.omit=Qh,S.omitBy=hu,S.once=Js,S.orderBy=Ms,S.over=md,S.overArgs=Sh,S.overEvery=vd,S.overSome=yd,S.partial=Ah,S.partialRight=Ph,S.partition=vh,S.pick=Jh,S.pickBy=du,S.property=rl,S.propertyOf=ol,S.pull=Jc,S.pullAll=Wo,S.pullAllBy=$o,S.pullAllWith=Yo,S.pullAt=eh,S.range=bd,S.rangeRight=wd,S.rearg=Ih,S.reject=Vs,S.remove=qo,S.rest=ea,S.reverse=zo,S.sampleSize=Bs,S.set=pu,S.setWith=gu,S.shuffle=Gs,S.slice=Ko,S.sortBy=yh,S.sortedUniq=is,S.sortedUniqBy=ns,S.split=Nu,S.spread=ta,S.tail=rs,S.take=os,S.takeRight=ss,S.takeRightWhile=as,S.takeWhile=us,S.tap=vs,S.throttle=ia,S.thru=ys,S.toArray=Ga,S.toPairs=ed,S.toPairsIn=td,S.toPath=dl,S.toPlainObject=Ya,S.transform=mu,S.unary=na,S.union=th,S.unionBy=ih,S.unionWith=nh,S.uniq=ls,S.uniqBy=cs,S.uniqWith=hs,S.unset=vu,S.unzip=ds,S.unzipWith=fs,S.update=yu,S.updateWith=bu,S.values=wu,S.valuesIn=Eu,S.without=rh,S.words=$u,S.wrap=ra,S.xor=oh,S.xorBy=sh,S.xorWith=ah,S.zip=uh,S.zipObject=ps,S.zipObjectDeep=gs,S.zipWith=lh,S.entries=ed,S.entriesIn=td,S.extend=Gh,S.extendWith=Hh,el(S,S),S.add=Ed,S.attempt=cd,S.camelCase=id,S.capitalize=Au,S.ceil=_d,S.clamp=_u,S.clone=sa,S.cloneDeep=ua,S.cloneDeepWith=la,S.cloneWith=aa,S.conformsTo=ca,S.deburr=Pu,S.defaultTo=Ku,S.divide=Td,S.endsWith=Iu,S.eq=ha,S.escape=xu,S.escapeRegExp=Cu,S.every=Ps,S.find=dh,S.findIndex=ko,S.findKey=Xa,S.findLast=fh,S.findLastIndex=Oo,S.findLastKey=Za,S.floor=Sd,S.forEach=ks,S.forEachRight=Os,S.forIn=Qa,S.forInRight=Ja,S.forOwn=eu,S.forOwnRight=tu,S.get=ru,S.gt=xh,S.gte=Ch,S.has=ou,S.hasIn=su,S.head=Fo,S.identity=Xu,S.includes=Ls,S.indexOf=Vo,S.inRange=Tu,S.invoke=Kh,S.isArguments=da,S.isArray=Rh,S.isArrayBuffer=kh,S.isArrayLike=fa,S.isArrayLikeObject=pa,S.isBoolean=ga,S.isBuffer=Oh,S.isDate=Lh,S.isElement=ma,S.isEmpty=va,S.isEqual=ya,S.isEqualWith=ba,S.isError=wa,S.isFinite=Ea,S.isFunction=_a,S.isInteger=Ta,S.isLength=Sa,S.isMap=Dh,S.isMatch=Ia,S.isMatchWith=xa,S.isNaN=Ca,S.isNative=Ra,S.isNil=Oa,S.isNull=ka,S.isNumber=La,S.isObject=Aa,S.isObjectLike=Pa,S.isPlainObject=Da,S.isRegExp=Mh,S.isSafeInteger=Ma,S.isSet=Nh,S.isString=Na,S.isSymbol=Fa,S.isTypedArray=Fh,S.isUndefined=Va,S.isWeakMap=Ua,S.isWeakSet=Ba,S.join=Bo,S.kebabCase=nd,S.last=Go,S.lastIndexOf=Ho,S.lowerCase=rd,S.lowerFirst=od,S.lt=Vh,S.lte=Uh,S.max=pl,S.maxBy=gl,S.mean=ml,S.meanBy=vl,S.min=yl,S.minBy=bl,S.stubArray=sl,S.stubFalse=al,S.stubObject=ul,S.stubString=ll,S.stubTrue=cl,S.multiply=Ad,S.nth=jo,S.noConflict=tl,S.noop=il,S.now=bh,S.pad=Ru,S.padEnd=ku,S.padStart=Ou,S.parseInt=Lu,S.random=Su,S.reduce=Ns,S.reduceRight=Fs,S.repeat=Du,S.replace=Mu,S.result=fu,S.round=Pd,S.runInContext=Z,S.sample=Us,S.size=Hs,S.snakeCase=sd,S.some=js,S.sortedIndex=Xo,S.sortedIndexBy=Zo,S.sortedIndexOf=Qo,S.sortedLastIndex=Jo,S.sortedLastIndexBy=es,S.sortedLastIndexOf=ts,S.startCase=ad,S.startsWith=Fu,S.subtract=Id,S.sum=wl,S.sumBy=El,S.times=hl,S.toFinite=Ha,S.toInteger=ja,S.toLength=Wa,S.toLower=Vu,S.toNumber=$a,S.toSafeInteger=qa,S.toString=za,S.toUpper=Uu,S.trim=Bu,S.trimEnd=Gu,S.trimStart=Hu,S.truncate=ju,S.unescape=Wu,S.uniqueId=fl,S.upperCase=ud,S.upperFirst=ld,S.each=ks,S.eachRight=Os,S.first=Fo,el(S,function(){var e={};return Yi(S,function(t,i){Fl.call(S.prototype,i)||(e[i]=t)}),e}(),{chain:!1}),S.VERSION=J,r(["bind","bindKey","curry","curryRight","partial","partialRight"],function(e){S[e].placeholder=S}),r(["drop","take"],function(e,t){Et.prototype[e]=function(i){var n=this.__filtered__;if(n&&!t)return new Et(this);i=i===Q?1:uc(ja(i),0);var r=this.clone();return n?r.__takeCount__=lc(i,r.__takeCount__):r.__views__.push({size:lc(i,Ie),type:e+(r.__dir__<0?"Right":"")}),r},Et.prototype[e+"Right"]=function(t){return this.reverse()[e](t).reverse()}}),r(["filter","map","takeWhile"],function(e,t){var i=t+1,n=i==we||i==_e;Et.prototype[e]=function(e){var t=this.clone();return t.__iteratees__.push({iteratee:Yr(e,3),type:i}),t.__filtered__=t.__filtered__||n,t}}),r(["head","last"],function(e,t){var i="take"+(t?"Right":"");Et.prototype[e]=function(){return this[i](1).value()[0]}}),r(["initial","tail"],function(e,t){var i="drop"+(t?"":"Right");Et.prototype[e]=function(){return this.__filtered__?new Et(this):this[i](1)}}),Et.prototype.compact=function(){return this.filter(Xu)},Et.prototype.find=function(e){return this.filter(e).head()},Et.prototype.findLast=function(e){return this.reverse().find(e)},Et.prototype.invokeMap=Mn(function(e,t){return"function"==typeof e?new Et(this):this.map(function(i){return on(i,e,t)})}),Et.prototype.reject=function(e){return this.filter(Qs(Yr(e)))},Et.prototype.slice=function(e,t){e=ja(e);var i=this;return i.__filtered__&&(e>0||t<0)?new Et(i):(e<0?i=i.takeRight(-e):e&&(i=i.drop(e)),
t!==Q&&(t=ja(t),i=t<0?i.dropRight(-t):i.take(t-e)),i)},Et.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},Et.prototype.toArray=function(){return this.take(Ie)},Yi(Et.prototype,function(e,t){var i=/^(?:filter|find|map|reject)|While$/.test(t),n=/^(?:head|last)$/.test(t),r=S[n?"take"+("last"==t?"Right":""):t],o=n||/^find/.test(t);r&&(S.prototype[t]=function(){var t=this.__wrapped__,s=n?[1]:arguments,a=t instanceof Et,u=s[0],l=a||Rh(t),c=function(e){var t=r.apply(S,h([e],s));return n&&d?t[0]:t};l&&i&&"function"==typeof u&&1!=u.length&&(a=l=!1);var d=this.__chain__,f=!!this.__actions__.length,p=o&&!d,g=a&&!f;if(!o&&l){t=g?t:new Et(this);var m=e.apply(t,s);return m.__actions__.push({func:ys,args:[c],thisArg:Q}),new K(m,d)}return p&&g?e.apply(this,s):(m=this.thru(c),p?n?m.value()[0]:m.value():m)})}),r(["pop","push","shift","sort","splice","unshift"],function(e){var t=kl[e],i=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",n=/^(?:pop|shift)$/.test(e);S.prototype[e]=function(){var e=arguments;if(n&&!this.__chain__){var r=this.value();return t.apply(Rh(r)?r:[],e)}return this[i](function(i){return t.apply(Rh(i)?i:[],e)})}}),Yi(Et.prototype,function(e,t){var i=S[t];if(i){var n=i.name+"";(_c[n]||(_c[n]=[])).push({name:t,func:i})}}),_c[Ir(Q,oe).name]=[{name:"wrapper",func:Q}],Et.prototype.clone=kt,Et.prototype.reverse=Ot,Et.prototype.value=Lt,S.prototype.at=ch,S.prototype.chain=bs,S.prototype.commit=ws,S.prototype.next=Es,S.prototype.plant=Ts,S.prototype.reverse=Ss,S.prototype.toJSON=S.prototype.valueOf=S.prototype.value=As,S.prototype.first=S.prototype.head,ql&&(S.prototype[ql]=_s),S}var Q,J="4.15.0",ee=200,te="Expected a function",ie="__lodash_hash_undefined__",ne="__lodash_placeholder__",re=1,oe=2,se=4,ae=8,ue=16,le=32,ce=64,he=128,de=256,fe=512,pe=1,ge=2,me=30,ve="...",ye=150,be=16,we=1,Ee=2,_e=3,Te=1/0,Se=9007199254740991,Ae=1.7976931348623157e308,Pe=NaN,Ie=4294967295,xe=Ie-1,Ce=Ie>>>1,Re=[["ary",he],["bind",re],["bindKey",oe],["curry",ae],["curryRight",ue],["flip",fe],["partial",le],["partialRight",ce],["rearg",de]],ke="[object Arguments]",Oe="[object Array]",Le="[object Boolean]",De="[object Date]",Me="[object Error]",Ne="[object Function]",Fe="[object GeneratorFunction]",Ve="[object Map]",Ue="[object Number]",Be="[object Object]",Ge="[object Promise]",He="[object RegExp]",je="[object Set]",We="[object String]",$e="[object Symbol]",Ye="[object WeakMap]",qe="[object WeakSet]",ze="[object ArrayBuffer]",Ke="[object DataView]",Xe="[object Float32Array]",Ze="[object Float64Array]",Qe="[object Int8Array]",Je="[object Int16Array]",et="[object Int32Array]",tt="[object Uint8Array]",it="[object Uint8ClampedArray]",nt="[object Uint16Array]",rt="[object Uint32Array]",ot=/&(?:amp|lt|gt|quot|#39|#96);/g,st=/[&<>"'`]/g,at=RegExp(ot.source),ut=RegExp(st.source),lt=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,ct=/^\w*$/,ht=/^\./,dt=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,ft=/[\\^$.*+?()[\]{}|]/g,pt=RegExp(ft.source),gt=/^\s+|\s+$/g,mt=/^\s+/,vt=/\s+$/,yt=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,bt=/\{\n\/\* \[wrapped with (.+)\] \*/,wt=/,? & /,Et=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,_t=/\\(\\)?/g,Tt=/\w*$/,St=/^0x/i,At=/^[-+]0x[0-9a-f]+$/i,Pt=/^0b[01]+$/i,It=/^\[object .+?Constructor\]$/,xt=/^0o[0-7]+$/i,Ct=/^(?:0|[1-9]\d*)$/,Rt=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,kt="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Ot="["+kt+"]",Lt="[\\u0300-\\u036f\\ufe20-\\ufe23\\u20d0-\\u20f0]",Dt="[a-z\\xdf-\\xf6\\xf8-\\xff]",Mt="[^\\ud800-\\udfff"+kt+"\\d+\\u2700-\\u27bfa-z\\xdf-\\xf6\\xf8-\\xffA-Z\\xc0-\\xd6\\xd8-\\xde]",Nt="\\ud83c[\\udffb-\\udfff]",Ft="(?:\\ud83c[\\udde6-\\uddff]){2}",Vt="[\\ud800-\\udbff][\\udc00-\\udfff]",Ut="[A-Z\\xc0-\\xd6\\xd8-\\xde]",Bt="(?:"+Dt+"|"+Mt+")",Gt="(?:[\\u0300-\\u036f\\ufe20-\\ufe23\\u20d0-\\u20f0]|\\ud83c[\\udffb-\\udfff])?",Ht="(?:\\u200d(?:"+["[^\\ud800-\\udfff]",Ft,Vt].join("|")+")[\\ufe0e\\ufe0f]?"+Gt+")*",jt="[\\ufe0e\\ufe0f]?"+Gt+Ht,Wt="(?:"+["[\\u2700-\\u27bf]",Ft,Vt].join("|")+")"+jt,$t="(?:"+["[^\\ud800-\\udfff]"+Lt+"?",Lt,Ft,Vt,"[\\ud800-\\udfff]"].join("|")+")",Yt=RegExp("[']","g"),qt=RegExp(Lt,"g"),zt=RegExp(Nt+"(?="+Nt+")|"+$t+jt,"g"),Kt=RegExp([Ut+"?"+Dt+"+(?:['](?:d|ll|m|re|s|t|ve))?(?="+[Ot,Ut,"$"].join("|")+")","(?:[A-Z\\xc0-\\xd6\\xd8-\\xde]|[^\\ud800-\\udfff\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000\\d+\\u2700-\\u27bfa-z\\xdf-\\xf6\\xf8-\\xffA-Z\\xc0-\\xd6\\xd8-\\xde])+(?:['](?:D|LL|M|RE|S|T|VE))?(?="+[Ot,Ut+Bt,"$"].join("|")+")",Ut+"?"+Bt+"+(?:['](?:d|ll|m|re|s|t|ve))?",Ut+"+(?:['](?:D|LL|M|RE|S|T|VE))?","\\d+",Wt].join("|"),"g"),Xt=RegExp("[\\u200d\\ud800-\\udfff\\u0300-\\u036f\\ufe20-\\ufe23\\u20d0-\\u20f0\\ufe0e\\ufe0f]"),Zt=/[a-z][A-Z]|[A-Z]{2,}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,Qt=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],Jt={};Jt[Xe]=Jt[Ze]=Jt[Qe]=Jt[Je]=Jt[et]=Jt[tt]=Jt[it]=Jt[nt]=Jt[rt]=!0,Jt[ke]=Jt[Oe]=Jt[ze]=Jt[Le]=Jt[Ke]=Jt[De]=Jt[Me]=Jt[Ne]=Jt[Ve]=Jt[Ue]=Jt[Be]=Jt[He]=Jt[je]=Jt[We]=Jt[Ye]=!1;var ei={};ei[ke]=ei[Oe]=ei[ze]=ei[Ke]=ei[Le]=ei[De]=ei[Xe]=ei[Ze]=ei[Qe]=ei[Je]=ei[et]=ei[Ve]=ei[Ue]=ei[Be]=ei[He]=ei[je]=ei[We]=ei[$e]=ei[tt]=ei[it]=ei[nt]=ei[rt]=!0,ei[Me]=ei[Ne]=ei[Ye]=!1;var ti={"":"A","":"A","":"A","":"A","":"A","":"A","":"a","":"a","":"a","":"a","":"a","":"a","":"C","":"c","":"D","":"d","":"E","":"E","":"E","":"E","":"e","":"e","":"e","":"e","":"I","":"I","":"I","":"I","":"i","":"i","":"i","":"i","":"N","":"n","":"O","":"O","":"O","":"O","":"O","":"O","":"o","":"o","":"o","":"o","":"o","":"o","":"U","":"U","":"U","":"U","":"u","":"u","":"u","":"u","":"Y","":"y","":"y","":"Ae","":"ae","":"Th","":"th","":"ss","":"A","":"A","":"A","":"a","":"a","":"a","":"C","":"C","":"C","":"C","":"c","":"c","":"c","":"c","":"D","":"D","":"d","":"d","":"E","":"E","":"E","":"E","":"E","":"e","":"e","":"e","":"e","":"e","":"G","":"G","":"G","":"G","":"g","":"g","":"g","":"g","":"H","":"H","":"h","":"h","":"I","":"I","":"I","":"I","":"I","":"i","":"i","":"i","":"i","":"i","":"J","":"j","":"K","":"k","":"k","":"L","":"L","":"L","":"L","":"L","":"l","":"l","":"l","":"l","":"l","":"N","":"N","":"N","":"N","":"n","":"n","":"n","":"n","":"O","":"O","":"O","":"o","":"o","":"o","":"R","":"R","":"R","":"r","":"r","":"r","":"S","":"S","":"S","":"S","":"s","":"s","":"s","":"s","":"T","":"T","":"T","":"t","":"t","":"t","":"U","":"U","":"U","":"U","":"U","":"U","":"u","":"u","":"u","":"u","":"u","":"u","":"W","":"w","":"Y","":"y","":"Y","":"Z","":"Z","":"Z","":"z","":"z","":"z","":"IJ","":"ij","":"Oe","":"oe","":"'n","":"ss"},ii={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","`":"&#96;"},ni={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'","&#96;":"`"},ri=parseFloat,oi=parseInt,si="object"==typeof global&&global&&global.Object===Object&&global,ai="object"==typeof self&&self&&self.Object===Object&&self,ui=si||ai||Function("return this")(),li="object"==typeof exports&&exports&&!exports.nodeType&&exports,ci=li&&"object"==typeof module&&module&&!module.nodeType&&module,hi=ci&&ci.exports===li,di=hi&&si.process,fi=function(){try{return di&&di.binding("util")}catch(e){}}(),pi=fi&&fi.isArrayBuffer,gi=fi&&fi.isDate,mi=fi&&fi.isMap,vi=fi&&fi.isRegExp,yi=fi&&fi.isSet,bi=fi&&fi.isTypedArray,wi=T("length"),Ei=S(ti),_i=S(ii),Ti=S(ni),Si=Z();"function"==typeof define&&"object"==typeof define.amd&&define.amd?(ui._=Si,define("lodash",[],function(){return Si})):ci?((ci.exports=Si)._=Si,li._=Si):ui._=Si}.call(this),define("jqueryajaxie9corsfix",["jquery"],function(e){if(e.support.cors||!e.ajaxTransport||!window.XDomainRequest)return e;var t=/^(https?:)?\/\//i,i=/^get|post$/i,n=new RegExp("^(//|"+location.protocol+")","i");return e.ajaxTransport("* text html xml json",function(r,o,s){if(r.crossDomain&&r.async&&i.test(r.type)&&t.test(r.url)&&n.test(r.url)){var a=null;return{send:function(t,i){var n="",s=(o.dataType||"").toLowerCase();a=new XDomainRequest,/^\d+$/.test(o.timeout)&&(a.timeout=o.timeout),a.ontimeout=function(){i(500,"timeout")},a.onload=function(){var t="Content-Length: "+a.responseText.length+"\r\nContent-Type: "+a.contentType,n={code:200,message:"success"},r={text:a.responseText};try{if("html"===s||/text\/html/i.test(a.contentType))r.html=a.responseText;else if("json"===s||"text"!==s&&/\/json/i.test(a.contentType))try{r.json=e.parseJSON(a.responseText)}catch(e){n.code=500,n.message="parseerror"}else if("xml"===s||"text"!==s&&/\/xml/i.test(a.contentType)){var o=new ActiveXObject("Microsoft.XMLDOM");o.async=!1;try{o.loadXML(a.responseText)}catch(e){o=void 0}if(!o||!o.documentElement||o.getElementsByTagName("parsererror").length)throw n.code=500,n.message="parseerror","Invalid XML: "+a.responseText;r.xml=o}}catch(e){throw e}finally{i(n.code,n.message,r,t)}},a.onprogress=function(){},a.onerror=function(){i(500,"error",{text:a.responseText})},o.data&&(n="string"===e.type(o.data)?o.data:e.param(o.data)),a.open(r.type,r.url),a.send(n)},abort:function(){a&&a.abort()}}}}),e}),define("base64",[],function(){!function(){function e(e){this.message=e}var t="undefined"!=typeof exports?exports:this,i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";e.prototype=new Error,e.prototype.name="InvalidCharacterError",t.btoa||(t.btoa=function(t){for(var n,r,o=String(t),s=0,a=i,u="";o.charAt(0|s)||(a="=",s%1);u+=a.charAt(63&n>>8-s%1*8)){if((r=o.charCodeAt(s+=.75))>255)throw new e("'btoa' failed: The string to be encoded contains characters outside of the Latin1 range.");n=n<<8|r}return u}),t.atob||(t.atob=function(t){var n=String(t).replace(/=+$/,"");if(n.length%4==1)throw new e("'atob' failed: The string to be decoded is not correctly encoded.");for(var r,o,s=0,a=0,u="";o=n.charAt(a++);~o&&(r=s%4?64*r+o:o,s++%4)?u+=String.fromCharCode(255&r>>(-2*s&6)):0)o=i.indexOf(o);return u})}()}),define("polyfills",["lodash","jqueryajaxie9corsfix","base64"],function(e,t,i){"use strict";!function(){for(var e=0,t=["ms","moz","webkit","o"],i=0;i<t.length&&!window.requestAnimationFrame;++i)window.requestAnimationFrame=window[t[i]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[i]+"CancelAnimationFrame"]||window[t[i]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t,i){var n=(new Date).getTime(),r=Math.max(0,16-(n-e)),o=window.setTimeout(function(){t(n+r)},r);return e=n+r,o}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)})}(),function(){function e(e,t){return this.slice(e,t)}function t(e,t){arguments.length<2&&(t=0);for(var i=0,n=e.length;i<n;++i,++t)this[t]=255&e[i]}function i(i){var n;if("number"==typeof i){n=new Array(i);for(var r=0;r<i;++r)n[r]=0}else n=i.slice(0);return n.subarray=e,n.buffer=n,n.byteLength=n.length,n.set=t,"object"==typeof i&&i.buffer&&(n.buffer=i.buffer),n}try{new Uint8Array(1);return}catch(e){}window.Uint8Array=i,window.Uint32Array=i,window.Int32Array=i}(),"undefined"==typeof console&&(window.console={log:function(){},warn:function(){},error:function(){},info:function(){},debug:function(){}}),Math.toRad=function(e){return e*(Math.PI/180)},Math.toDeg=function(e){return e*(180/Math.PI)},Math.format=function(e,t){return Math.round(e*Math.pow(10,t))/Math.pow(10,t)},Math.hit=function(e,t,i,n,r,o,s){return s?e>=i-r/2&&e<=i-r/2+r&&t>=n-o/2&&t<=n-o/2+o:e>=i&&e<=i+r&&t>=n&&t<=n+o},Math.boxhit=function(e,t,i,n,r,o,s,a){return(e>=r&&e<=r+s||e+i>=r&&e+i<=r+s)&&(t>=o&&t<=o+a||t+n>=o&&t+n<=o+a)},Math.clamp=function(e,t,i){return e<t?t:e>i?i:e},Math.rotateCoord=function(e,t,i,n,r){var o=e-i,s=t-n;return e=Math.cos(r)*o+Math.sin(r)*s,t=-Math.sin(r)*o+Math.cos(r)*s,e+=i,t+=n,{x:e,y:t}},Math.pointInPoly=function(e,t,i){var n,r,o=!1,s=e.length;for(n=0,r=s-1;n<s;r=n++)e[n].y>i!=e[r].y>i&&t<(e[r].x-e[n].x)*(i-e[n].y)/(e[r].y-e[n].y)+e[n].x&&(o=!o);return o},Object.create||(Object.create=function(e,t){function i(){}if("object"!=typeof e&&"function"!=typeof e)throw new TypeError("Object prototype may only be an Object: "+e);if(null===e)throw new Error("This browser's implementation of Object.create is a shim and doesn't support 'null' as the first argument.");if(void 0!==t)throw new Error("This browser's implementation of Object.create is a shim and doesn't support a second argument.");return i.prototype=e,new i}),!e.omitBy&&e.omit&&(e.omitBy=e.omit)}),define("easing",["jquery"],function(e){!function(e){e.easing.jswing=e.easing.swing,e.extend(e.easing,{def:"easeOutQuad",swing:function(t,i,n,r,o){return e.easing[e.easing.def](t,i,n,r,o)},easeInQuad:function(e,t,i,n,r){return n*(t/=r)*t+i},easeOutQuad:function(e,t,i,n,r){return-n*(t/=r)*(t-2)+i},easeInOutQuad:function(e,t,i,n,r){return(t/=r/2)<1?n/2*t*t+i:-n/2*(--t*(t-2)-1)+i},easeInCubic:function(e,t,i,n,r){return n*(t/=r)*t*t+i},easeOutCubic:function(e,t,i,n,r){return n*((t=t/r-1)*t*t+1)+i},easeInOutCubic:function(e,t,i,n,r){return(t/=r/2)<1?n/2*t*t*t+i:n/2*((t-=2)*t*t+2)+i},easeInQuart:function(e,t,i,n,r){return n*(t/=r)*t*t*t+i},easeOutQuart:function(e,t,i,n,r){return-n*((t=t/r-1)*t*t*t-1)+i},easeInOutQuart:function(e,t,i,n,r){return(t/=r/2)<1?n/2*t*t*t*t+i:-n/2*((t-=2)*t*t*t-2)+i},easeInQuint:function(e,t,i,n,r){return n*(t/=r)*t*t*t*t+i},easeOutQuint:function(e,t,i,n,r){return n*((t=t/r-1)*t*t*t*t+1)+i},easeInOutQuint:function(e,t,i,n,r){return(t/=r/2)<1?n/2*t*t*t*t*t+i:n/2*((t-=2)*t*t*t*t+2)+i},easeInSine:function(e,t,i,n,r){return-n*Math.cos(t/r*(Math.PI/2))+n+i},easeOutSine:function(e,t,i,n,r){return n*Math.sin(t/r*(Math.PI/2))+i},easeInOutSine:function(e,t,i,n,r){return-n/2*(Math.cos(Math.PI*t/r)-1)+i},easeInExpo:function(e,t,i,n,r){return 0==t?i:n*Math.pow(2,10*(t/r-1))+i},easeOutExpo:function(e,t,i,n,r){return t==r?i+n:n*(1-Math.pow(2,-10*t/r))+i},easeInOutExpo:function(e,t,i,n,r){return 0==t?i:t==r?i+n:(t/=r/2)<1?n/2*Math.pow(2,10*(t-1))+i:n/2*(2-Math.pow(2,-10*--t))+i},easeInCirc:function(e,t,i,n,r){return-n*(Math.sqrt(1-(t/=r)*t)-1)+i},easeOutCirc:function(e,t,i,n,r){return n*Math.sqrt(1-(t=t/r-1)*t)+i},easeInOutCirc:function(e,t,i,n,r){return(t/=r/2)<1?-n/2*(Math.sqrt(1-t*t)-1)+i:n/2*(Math.sqrt(1-(t-=2)*t)+1)+i},easeInElastic:function(e,t,i,n,r){var o=1.70158,s=0,a=n;if(0==t)return i;if(1==(t/=r))return i+n;if(s||(s=.3*r),a<Math.abs(n)){a=n;var o=s/4}else var o=s/(2*Math.PI)*Math.asin(n/a);return-a*Math.pow(2,10*(t-=1))*Math.sin((t*r-o)*(2*Math.PI)/s)+i},easeOutElastic:function(e,t,i,n,r){var o=1.70158,s=0,a=n;if(0==t)return i;if(1==(t/=r))return i+n;if(s||(s=.3*r),a<Math.abs(n)){a=n;var o=s/4}else var o=s/(2*Math.PI)*Math.asin(n/a);return a*Math.pow(2,-10*t)*Math.sin((t*r-o)*(2*Math.PI)/s)+n+i},easeInOutElastic:function(e,t,i,n,r){var o=1.70158,s=0,a=n;if(0==t)return i;if(2==(t/=r/2))return i+n;if(s||(s=r*(.3*1.5)),a<Math.abs(n)){a=n;var o=s/4}else var o=s/(2*Math.PI)*Math.asin(n/a);return t<1?a*Math.pow(2,10*(t-=1))*Math.sin((t*r-o)*(2*Math.PI)/s)*-.5+i:a*Math.pow(2,-10*(t-=1))*Math.sin((t*r-o)*(2*Math.PI)/s)*.5+n+i},easeInBack:function(e,t,i,n,r,o){return void 0==o&&(o=1.70158),n*(t/=r)*t*((o+1)*t-o)+i},easeOutBack:function(e,t,i,n,r,o){return void 0==o&&(o=1.70158),n*((t=t/r-1)*t*((o+1)*t+o)+1)+i},easeInOutBack:function(e,t,i,n,r,o){return void 0==o&&(o=1.70158),(t/=r/2)<1?n/2*(t*t*((1+(o*=1.525))*t-o))+i:n/2*((t-=2)*t*((1+(o*=1.525))*t+o)+2)+i},easeInBounce:function(t,i,n,r,o){return r-e.easing.easeOutBounce(t,o-i,0,r,o)+n},easeOutBounce:function(e,t,i,n,r){return(t/=r)<1/2.75?n*(7.5625*t*t)+i:t<2/2.75?n*(7.5625*(t-=1.5/2.75)*t+.75)+i:t<2.5/2.75?n*(7.5625*(t-=2.25/2.75)*t+.9375)+i:n*(7.5625*(t-=2.625/2.75)*t+.984375)+i},easeInOutBounce:function(t,i,n,r,o){return i<o/2?.5*e.easing.easeInBounce(t,2*i,0,r,o)+n:.5*e.easing.easeOutBounce(t,2*i-o,0,r,o)+.5*r+n}})}(e)}),define("browser",[],function(){"use strict";return{isMobile:function(e){return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}(navigator.userAgent||navigator.vendor||window.opera)}}),function(e){if("function"==typeof define&&define.amd)define("cookie",e);else if("object"==typeof exports)module.exports=e();else{var t=window.Cookies,i=window.Cookies=e(window.jQuery);i.noConflict=function(){return window.Cookies=t,i}}}(function(){function e(){for(var e=0,t={};e<arguments.length;e++){var i=arguments[e];for(var n in i)t[n]=i[n]}return t}function t(i){function n(t,r,o){var s;if(arguments.length>1){if(o=e({path:"/"},n.defaults,o),"number"==typeof o.expires){var a=new Date;a.setMilliseconds(a.getMilliseconds()+864e5*o.expires),o.expires=a}try{s=JSON.stringify(r),/^[\{\[]/.test(s)&&(r=s)}catch(e){}return r=encodeURIComponent(String(r)),r=r.replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),t=encodeURIComponent(String(t)),t=t.replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent),t=t.replace(/[\(\)]/g,escape),document.cookie=[t,"=",r,o.expires&&"; expires="+o.expires.toUTCString(),o.path&&"; path="+o.path,o.domain&&"; domain="+o.domain,o.secure?"; secure":""].join("")}t||(s={});for(var u=document.cookie?document.cookie.split("; "):[],l=/(%[0-9A-Z]{2})+/g,c=0;c<u.length;c++){var h=u[c].split("="),d=h[0].replace(l,decodeURIComponent),f=h.slice(1).join("=");'"'===f.charAt(0)&&(f=f.slice(1,-1));try{if(f=i&&i(f,d)||f.replace(l,decodeURIComponent),this.json)try{f=JSON.parse(f)}catch(e){}if(t===d){s=f;break}t||(s[d]=f)}catch(e){}}return s}return n.get=n.set=n,n.getJSON=function(){return n.apply({json:!0},[].slice.call(arguments))},n.defaults={},n.remove=function(t,i){n(t,"",e(i,{expires:-1}))},n.withConverter=t,n}return t()}),define("libs/device/BrowserDetector",["jquery","lodash"],function(e,t){"use strict";var i="Microsoft Edge",n={Mozilla:"mozilla",Webkit:"webkit",Trident:"trident"};return function(){return{browser:function(e){var r,o={name:"unknown",version:"unknown",engine:null,isMsie:function(){return"MSIE"===this.name},isEdge:function(){return i===this.name},msieVersion:function(){return!!this.isMsie()&&Math.floor(this.version)},isWebkit:function(){return n.Webkit===this.engine},isMozilla:function(){return n.Mozilla===this.engine},isTrident:function(){return n.Trident===this.engine}};return(r=e.match(/(PhantomJS)\/([0-9.]*)/))?(o.name=r[1],o.version=r[2],o.engine=n.Webkit):(r=e.match(/(Edge)\/([0-9.]*)/))?(o.name=i,o.version=r[2],o.engine=n.Trident):(r=e.match(/(Firefox)\/([0-9.]*)/))?(o.name=r[1],o.version=r[2],o.engine=n.Mozilla):(r=e.match(/(Chrome|CriOS)\/([0-9.]*)/))?(o.name=r[1],o.version=r[2],o.engine=n.Webkit):/Safari/.test(e)?(r=e.match(/(Version)\/([0-9.]*)/))&&(o.name=(/Mobile/.test(e)?"Mobile ":"")+"Safari",o.version=r[2],o.engine=n.Webkit):(r=e.match(/(Silk)\/([0-9.]*)/))?(o.name=r[1],o.version=r[2],o.engine=n.Webkit):(r=e.match(/(MSIE) ([0-9]+)/))?(o.name=r[1],o.version=r[2],o.engine=n.Trident):(r=e.match(/Trident\/[0-9.]+;.*rv:([0-9.]*)/))&&(o.name="MSIE",o.version=r[1],o.engine=n.Trident),t.isNull(o.engine)&&e.match(/(webkit)[ \/]([\w.]+)/i)&&(o.engine=n.Webkit),o}}}()}),define("device",["jquery","lodash","modernizr","browser","cookie","libs/device/BrowserDetector"],function(e,t,i,n,r,o){"use strict";return function(){var e=function(){return i.touch},s=function(){return window.screen.width*window.screen.height<5e5},a=function(){return window.innerWidth*window.innerHeight<5e5},u=function(){return n.isMobile},l=function(){return!u()},c=function(){return u()&&s()},h=function(){return u()&&!s()},d=function(){return c()?"smartphone":h()?"tablet":l()?"desktop":"other"},f=function(){var e=1;return void 0!==window.devicePixelRatio&&(e=window.devicePixelRatio),e>=2},p=function(){return m().engine},g=function(){return i.canvas&&i.video},m=t.once(function(){return o.browser(navigator.userAgent)}),v=function(){return/(google web preview|google search console|baiduspider|yandexbot|bingbot|googlebot|yahoo! slurp)/i.test(window.navigator.userAgent)},y=function(e){var t,i,n;/Windows/i.test(e)?(t=e.match(/Phone( (OS )?([\d.]+))?/))?(i="Windows Mobile",n=t[3]):(t=e.match(/Windows NT\s([0-9.]+)/))?(i="Windows",n=t[1]):i="Windows":(t=e.match(/(iPad|iPod|iPhone)(.*OS ([\d_]+))?/))?(i="iOS",t[3]&&(n=t[3].replace(/_/g,"."))):(t=e.match(/(Android ?([\d.]+)?)/))?(i="Android",n=t[2]):(t=e.match(/(BlackBerry|PlayBook|BB10)(.*Version\/(\d+\.\d+\.\d+))?/i))?(i="BlackBerry",n=t[3]):(t=e.match(/\(Macintosh(;\D*([\d_.]+)[);])?/))?(i="Mac OS X",t[2]&&(n=t[2].replace(/_/g,"."))):(t=e.match(/Linux\s([0-9._a-z]+)?/))?(i="Linux",n=t[1]):(t=e.match(/CrOS ?(\S+)?/))&&(i="Chrome OS",n=t[1]);var r={};return i&&(r.name=i),n&&(r.version=n),r},b=y(navigator.userAgent),w=function(){return!0===window.navigator.standalone},E=function(){return g()?"html5":"html4"},_=function(){return window.orientation%180==0?"portrait":"landscape"},T=a()?50:200,S=function(){return T},A=t.once(function(){r.set("testcookie",1);var e=r.get("testcookie");return e&&r.remove("testcookie"),e}),P=function(){return t.isNumber(window.devicePixelRatio)?window.devicePixelRatio:1},I=m().isMsie(),x=function(){return m().msieVersion()},C=m().isEdge(),R=m().isWebkit(),k=m().isMozilla(),O=m().isTrident(),L=function(){return"landscape"===_()},D=function(){return"portrait"===_()},M=function(){return"onorientationchange"in window},N=function(){return"Mac OS X"===b.name},F=function(){return"Windows"===b.name},V=function(){return"iOS"===b.name},U=function(){return"Android"===b.name},B=function(){return V()&&m().version.match(/^7\..*/)},G=function(e,t){if(!e)return!1;var i=e.split("."),n=Number(i[0]);return!isNaN(n)&&n<t},H=function(e,t){if(!e)return!1;var i=e.split("."),n=Number(i[0]);return!isNaN(n)&&n>=t},j=function(e,t){if(!e)return!1;var i=e.split("."),n=Number(i[0]),r=Number(i[1]),o=t.split("."),s=Number(o[0]),a=Number(o[1]);return!isNaN(n)&&!isNaN(s)&&(isNaN(r)&&(r=0),isNaN(a)&&(a=0),n!==s?n<s:r<a)},W=function(e){return!!V()&&G(b.version,e)},$=function(e){return!!F()&&j(b.version,e)},Y=function(e){return!!se()&&G(m().version,e)},q=function(e){return!!se()&&H(m().version,e)},z=function(e){return!!ae()&&H(m().version,e)},K=function(e){return!!Z()&&G(m().version,e)},X=function(){return u()&&"Mobile Safari"===m().name},Z=function(){return!u()&&"Safari"===m().name},Q=function(){return"PhantomJS"===m().name},J=function(){return/iPhone/i.test(navigator.userAgent)},ee=function(){return/iPad/i.test(navigator.userAgent)},te=function(){return J()&&!window.navigator.standalone&&X()},ie=function(){return te()&&B()},ne=function(){return ee()&&!window.navigator.standalone&&B()},re=function(){return!1!==x()&&x()<=9},oe=function(){return 11===x()},se=function(){return"Chrome"===m().name},ae=function(){return m().isMozilla()},ue=function(e){if(!ce()&&e<window.screen.width){if(ne())return-20;if(ie())return-65;if(te())return 60}return 0},le=function(e,t){return te()&&e===window.screen.height&&t>=window.screen.width},ce=function(){return top!=window};return{touch:e,mobile:u,desktop:l,smartPhone:c,tablet:h,retina:f,renderingEngine:p,msie:I,edge:C,msieVersion:x,webkit:R,mozilla:k,trident:O,html5:g,isBot:v,browser:m,os:b,parseOS:y,standalone:w,smallWindow:a,deviceType:d,playerType:E,orientation:_,portrait:D,landscape:L,supportsOrientationChange:M,getSlackHeight:ue,getRubberBandLimit:S,cookies:A,pixelRatio:P,isIphoneFullscreenMobileSafari:le,isIframe:ce,isMac:N,isWindows:F,isIos:V,isIosLessThan:W,isBrowserChromeLessThan:Y,isBrowserChromeGreaterThanOrEqualTo:q,isBrowserFirefoxGreaterThanOrEqualTo:z,isDesktopSafariLessThan:K,isWindowsLessThan:$,isAndroid:U,isIphone:J,isIpad:ee,isPhantomJS:Q,isIE9OrEarlier:re,isIE11:oe,isBrowserChrome:se,isBrowserFirefox:ae,isDesktopSafari:Z,isMobileSafari:X,DEVICE_TYPE_SMARTPHONE:"smartphone",DEVICE_TYPE_TABLET:"tablet",DEVICE_TYPE_DESKTOP:"desktop",DEVICE_TYPE_OTHER:"other"}}()}),define("log",["lodash","device"],function(e,t){"use strict";var i=function(){for(var e="",t=0;t<arguments.length;t++)e+=arguments[t]+" ";return e},n={debug:!1,info:!1,warn:!1,error:!1},r=!1,o=!1,s={debug:function(){if(n.debug){var r=i.apply(null,arguments);window.Rollbar&&window.Rollbar.debug.apply(window.Rollbar,arguments),t.msie?e.isFunction(console.log)&&console.log(r):console.debug.apply(console,arguments)}},info:function(){if(n.info){var r=i.apply(null,arguments);window.Rollbar&&window.Rollbar.info.apply(window.Rollbar,arguments),t.msie?e.isFunction(console.info)&&console.info(r):console.info.apply(console,arguments)}},devWarn:function(){return r?s.warn.apply(this,arguments):s.info.apply(this,arguments)},warn:function(){if(n.warn){var r=i.apply(null,arguments);window.Rollbar&&window.Rollbar.warn.apply(window.Rollbar,arguments),t.msie?e.isFunction(console.warn)&&console.warn(r):console.warn.apply(console,arguments)}},error:function(){if(n.error){var r=i.apply(null,arguments);window.Rollbar&&window.Rollbar.error.apply(window.Rollbar,arguments),t.msie?e.isFunction(console.error)&&console.error(r):console.error.apply(console,arguments)}},init:function(t){n=e.defaults(t.modes||{},n),r=t.emitDevWarnings,o=e.reduce(n,function(e,t,i){return e||t},o)},isEnabled:function(t){return e.isUndefined(t)?o:n[t]}};return s.d=s.debug,s.i=s.info,s.w=s.warn,s.e=s.error,s}),define("cssHooksTransform",["log","jquery","lodash","device"],function(e,t,i,n){"use strict";var r="transform",o=r.charAt(0).toUpperCase()+r.slice(1),s="Float32Array"in window,a={transformToMatrix:function(e){var n,r,o,a=e.split(")"),u=[],l=a.length-1,c=s?new Float32Array(6):[],h=s?new Float32Array(6):[],d=s?new Float32Array(6):[1,0,0,1,0,0];c[0]=c[3]=d[0]=d[3]=1,c[1]=c[2]=c[4]=c[5]=0;for(var f=0;f<l;++f){switch(n=a[f].split("("),r=t.trim(n[0]),o=n[1],h[0]=h[3]=1,h[1]=h[2]=h[4]=h[5]=0,r){case"translateX":h[4]=parseInt(o,10);break;case"translateY":h[5]=parseInt(o,10);break;case"translate":o=o.split(","),h[4]=parseInt(o[0],10),h[5]=parseInt(o[1]||0,10);break;case"rotate":o=this.toRadian(o),h[0]=Math.cos(o),h[1]=Math.sin(o),h[2]=-Math.sin(o),h[3]=Math.cos(o);break;case"scaleX":h[0]=+o;break;case"scaleY":h[3]=o;break;case"scale":o=o.split(","),h[0]=o[0],h[3]=o.length>1?o[1]:o[0];break;case"skewX":h[2]=Math.tan(this.toRadian(o));break;case"skewY":h[1]=Math.tan(this.toRadian(o));break;default:continue}u.push(r),d[0]=c[0]*h[0]+c[2]*h[1],d[1]=c[1]*h[0]+c[3]*h[1],d[2]=c[0]*h[2]+c[2]*h[3],d[3]=c[1]*h[2]+c[3]*h[3],d[4]=c[0]*h[4]+c[2]*h[5]+c[4],d[5]=c[1]*h[4]+c[3]*h[5]+c[5],c=[d[0],d[1],d[2],d[3],d[4],d[5]]}return!(!i.isEmpty(e)&&i.isEmpty(u))&&d},buildTransformFunctions:function(e,n){var r,o,s,u={start:[],end:[]};if("none"==e&&(e=""),"none"==n&&(n=""),!e&&!n)return u;e&&(e=e.split(")"),r=e.length),n&&(n=n.split(")"),r=n.length),r-=1;for(var l=0;l<r;++l){e[l]&&(o=e[l].split("(")),n[l]&&(s=n[l].split("("));var c=t.trim(o[0]),h=t.trim(s[0]);a.isUnsupportedTransform(c)||a.isUnsupportedTransform(h)||(u.start=i.union(u.start,this.parseTransformFunction(c,o[1])),u.end=i.union(u.end,this.parseTransformFunction(h,s[1])))}return u},isUnsupportedTransform:function(e){return i.indexOf(["perspective","rotateX","rotateY","rotateZ","rotate3d","scale3d","scaleZ","translateZ","translate3d"],e)>-1},parseTransformFunction:function(e,t){var i=e.indexOf("scale")>-1?1:0,n=e.replace(/e[XY]/,"e"),r=e.indexOf("scale")>-1?"":"px";switch(e){case"translateY":case"scaleY":t=[i,t?parseFloat(t):i];break;case"translateX":case"translate":t?(t=t.split(","),t=[parseFloat(t[0]),parseFloat(t.length>1?t[1]:i)]):t=[i,i];break;case"scaleX":case"scale":if(t){t=t.split(",");var o="scale"==e?t[0]:i;t=[parseFloat(t[0]),parseFloat(t.length>1?t[1]:o)]}else t=[i,i];break;case"skewX":case"skewY":case"rotate":r=~t.indexOf("deg")?"deg":~t.indexOf("grad")?"grad":"rad",t=t?parseFloat(t):0}return[[n,t,r]]},toRadian:function(e){return~e.indexOf("deg")?parseInt(e,10)*(2*Math.PI/360):~e.indexOf("grad")?parseInt(e,10)*(Math.PI/200):parseFloat(e)}};if(n.webkit||n.mozilla){var u=n.webkit?"Webkit":"Moz";t.cssNumber[r]=!0,t.cssHooks[r]={get:function(e){return t.css(e,u+o)},set:function(e,t){e.style[u+o]=t}}}return a}),define("crypto",[],function(){function e(e){for(var i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n="",r=e.length,o=0;o<r;o+=3)for(var s=e.charCodeAt(o)<<16|(o+1<r?e.charCodeAt(o+1)<<8:0)|(o+2<r?e.charCodeAt(o+2):0),a=0;a<4;a++)8*o+6*a>8*e.length?n+=t:n+=i.charAt(s>>>6*(3-a)&63);return n}var t="";return{b64_encode:e}}),define("cssHooksGradients",["log","jquery","lodash","device","crypto"],function(e,t,i,n,r){"use strict";var o="backgroundImage",s=document.createElement("div"),a=s.style,u=/^(.*?)(:?linear-gradient)(\()([0-9]+)deg,([^,]+) ([0-9]+)%,([^,]+) ([0-9]+)%(\))(.*?)$/i,l=/(^|\s)linear-gradient/;if(a.cssText="background-image: linear-gradient(red, blue);",t.support.linearGradient=!!l.test(a.backgroundImage)&&"linear-gradient",s=a=null,!t.support.linearGradient){t.cssNumber[o]=!0;var c=function(e,t,i,r,o,s,a){var u="";return n.webkit?u="-webkit-":n.mozilla&&(u="-moz-"),i=90-parseInt(i,10),u+"linear-gradient("+i+"deg,"+r+" "+o+"%,"+s+" "+a+"%)"};t.cssHooks[o]={set:function(e,t){var n=u.exec(t);if(i.isEmpty(n))e.style[o]=t;else{var r=(n[0],n[4]),s=n[5],a=n[6],l=n[7],h=n[8];e.style[o]=c(0,0,r,s,a,l,h)}}}}}),function(e){var t="object"==typeof self&&self.self==self&&self||"object"==typeof global&&global.global==global&&global;if("function"==typeof define&&define.amd)define("backbone",["lodash","jquery","exports"],function(i,n,r){t.Backbone=e(t,r,i,n)});else if("undefined"!=typeof exports){
var i,n=require("lodash");try{i=require("jquery")}catch(e){}e(t,exports,n,i)}else t.Backbone=e(t,{},t._,t.jQuery||t.Zepto||t.ender||t.$)}(function(e,t,i,n){var r=e.Backbone,o=Array.prototype.slice;t.VERSION="1.2.3",t.$=n,t.noConflict=function(){return e.Backbone=r,this},t.emulateHTTP=!1,t.emulateJSON=!1;var s=function(e,t,n){switch(e){case 1:return function(){return i[t](this[n])};case 2:return function(e){return i[t](this[n],e)};case 3:return function(e,r){return i[t](this[n],u(e,this),r)};case 4:return function(e,r,o){return i[t](this[n],u(e,this),r,o)};default:return function(){var e=o.call(arguments);return e.unshift(this[n]),i[t].apply(i,e)}}},a=function(e,t,n){i.each(t,function(t,r){i[r]&&(e.prototype[r]=s(t,r,n))})},u=function(e,t){return i.isFunction(e)?e:i.isObject(e)&&!t._isModel(e)?l(e):i.isString(e)?function(t){return t.get(e)}:e},l=function(e){var t=i.matches(e);return function(e){return t(e.attributes)}},c=t.Events={},h=/\s+/,d=function(e,t,n,r,o){var s,a=0;if(n&&"object"==typeof n){void 0!==r&&"context"in o&&void 0===o.context&&(o.context=r);for(s=i.keys(n);a<s.length;a++)t=d(e,t,s[a],n[s[a]],o)}else if(n&&h.test(n))for(s=n.split(h);a<s.length;a++)t=e(t,s[a],r,o);else t=e(t,n,r,o);return t};c.on=function(e,t,i){return f(this,e,t,i)};var f=function(e,t,i,n,r){if(e._events=d(p,e._events||{},t,i,{context:n,ctx:e,listening:r}),r){(e._listeners||(e._listeners={}))[r.id]=r}return e};c.listenTo=function(e,t,n){if(!e)return this;var r=e._listenId||(e._listenId=i.uniqueId("l")),o=this._listeningTo||(this._listeningTo={}),s=o[r];if(!s){var a=this._listenId||(this._listenId=i.uniqueId("l"));s=o[r]={obj:e,objId:r,id:a,listeningTo:o,count:0}}return f(e,t,n,this,s),this};var p=function(e,t,i,n){if(i){var r=e[t]||(e[t]=[]),o=n.context,s=n.ctx,a=n.listening;a&&a.count++,r.push({callback:i,context:o,ctx:o||s,listening:a})}return e};c.off=function(e,t,i){return this._events?(this._events=d(g,this._events,e,t,{context:i,listeners:this._listeners}),this):this},c.stopListening=function(e,t,n){var r=this._listeningTo;if(!r)return this;for(var o=e?[e._listenId]:i.keys(r),s=0;s<o.length;s++){var a=r[o[s]];if(!a)break;a.obj.off(t,n,this)}return i.isEmpty(r)&&(this._listeningTo=void 0),this};var g=function(e,t,n,r){if(e){var o,s=0,a=r.context,u=r.listeners;if(t||n||a){for(var l=t?[t]:i.keys(e);s<l.length;s++){t=l[s];var c=e[t];if(!c)break;for(var h=[],d=0;d<c.length;d++){var f=c[d];n&&n!==f.callback&&n!==f.callback._callback||a&&a!==f.context?h.push(f):(o=f.listening)&&0==--o.count&&(delete u[o.id],delete o.listeningTo[o.objId])}h.length?e[t]=h:delete e[t]}return i.size(e)?e:void 0}for(var p=i.keys(u);s<p.length;s++)o=u[p[s]],delete u[o.id],delete o.listeningTo[o.objId]}};c.once=function(e,t,n){var r=d(m,{},e,t,i.bind(this.off,this));return this.on(r,void 0,n)},c.listenToOnce=function(e,t,n){var r=d(m,{},t,n,i.bind(this.stopListening,this,e));return this.listenTo(e,r)};var m=function(e,t,n,r){if(n){var o=e[t]=i.once(function(){r(t,o),n.apply(this,arguments)});o._callback=n}return e};c.trigger=function(e){if(!this._events)return this;for(var t=Math.max(0,arguments.length-1),i=Array(t),n=0;n<t;n++)i[n]=arguments[n+1];return d(v,this._events,e,void 0,i),this};var v=function(e,t,i,n){if(e){var r=e[t],o=e.all;r&&o&&(o=o.slice()),r&&y(r,n),o&&y(o,[t].concat(n))}return e},y=function(e,t){var i,n=-1,r=e.length,o=t[0],s=t[1],a=t[2];switch(t.length){case 0:for(;++n<r;)(i=e[n]).callback.call(i.ctx);return;case 1:for(;++n<r;)(i=e[n]).callback.call(i.ctx,o);return;case 2:for(;++n<r;)(i=e[n]).callback.call(i.ctx,o,s);return;case 3:for(;++n<r;)(i=e[n]).callback.call(i.ctx,o,s,a);return;default:for(;++n<r;)(i=e[n]).callback.apply(i.ctx,t);return}};c.bind=c.on,c.unbind=c.off,i.extend(t,c);var b=t.Model=function(e,t){var n=e||{};t||(t={}),this.cid=i.uniqueId(this.cidPrefix),this.attributes={},t.collection&&(this.collection=t.collection),t.parse&&(n=this.parse(n,t)||{}),n=i.defaults({},n,i.result(this,"defaults")),this.set(n,t),this.changed={},this.initialize.apply(this,arguments)};i.extend(b.prototype,c,{changed:null,validationError:null,idAttribute:"id",cidPrefix:"c",initialize:function(){},toJSON:function(e){return i.clone(this.attributes)},sync:function(){return t.sync.apply(this,arguments)},get:function(e){return this.attributes[e]},escape:function(e){return i.escape(this.get(e))},has:function(e){return null!=this.get(e)},matches:function(e){return!!i.iteratee(e,this)(this.attributes)},set:function(e,t,n){if(null==e)return this;var r;if("object"==typeof e?(r=e,n=t):(r={})[e]=t,n||(n={}),!this._validate(r,n))return!1;var o=n.unset,s=n.silent,a=[],u=this._changing;this._changing=!0,u||(this._previousAttributes=i.clone(this.attributes),this.changed={});var l=this.attributes,c=this.changed,h=this._previousAttributes;for(var d in r)t=r[d],i.isEqual(l[d],t)||a.push(d),i.isEqual(h[d],t)?delete c[d]:c[d]=t,o?delete l[d]:l[d]=t;if(this.id=this.get(this.idAttribute),!s){a.length&&(this._pending=n);for(var f=0;f<a.length;f++)this.trigger("change:"+a[f],this,l[a[f]],n)}if(u)return this;if(!s)for(;this._pending;)n=this._pending,this._pending=!1,this.trigger("change",this,n);return this._pending=!1,this._changing=!1,this},unset:function(e,t){return this.set(e,void 0,i.extend({},t,{unset:!0}))},clear:function(e){var t={};for(var n in this.attributes)t[n]=void 0;return this.set(t,i.extend({},e,{unset:!0}))},hasChanged:function(e){return null==e?!i.isEmpty(this.changed):i.has(this.changed,e)},changedAttributes:function(e){if(!e)return!!this.hasChanged()&&i.clone(this.changed);var t=this._changing?this._previousAttributes:this.attributes,n={};for(var r in e){var o=e[r];i.isEqual(t[r],o)||(n[r]=o)}return!!i.size(n)&&n},previous:function(e){return null!=e&&this._previousAttributes?this._previousAttributes[e]:null},previousAttributes:function(){return i.clone(this._previousAttributes)},fetch:function(e){e=i.extend({parse:!0},e);var t=this,n=e.success;return e.success=function(i){var r=e.parse?t.parse(i,e):i;if(!t.set(r,e))return!1;n&&n.call(e.context,t,i,e),t.trigger("sync",t,i,e)},U(this,e),this.sync("read",this,e)},save:function(e,t,n){var r;null==e||"object"==typeof e?(r=e,n=t):(r={})[e]=t,n=i.extend({validate:!0,parse:!0},n);var o=n.wait;if(r&&!o){if(!this.set(r,n))return!1}else if(!this._validate(r,n))return!1;var s=this,a=n.success,u=this.attributes;n.success=function(e){s.attributes=u;var t=n.parse?s.parse(e,n):e;if(o&&(t=i.extend({},r,t)),t&&!s.set(t,n))return!1;a&&a.call(n.context,s,e,n),s.trigger("sync",s,e,n)},U(this,n),r&&o&&(this.attributes=i.extend({},u,r));var l=this.isNew()?"create":n.patch?"patch":"update";"patch"!==l||n.attrs||(n.attrs=r);var c=this.sync(l,this,n);return this.attributes=u,c},destroy:function(e){e=e?i.clone(e):{};var t=this,n=e.success,r=e.wait,o=function(){t.stopListening(),t.trigger("destroy",t,t.collection,e)};e.success=function(i){r&&o(),n&&n.call(e.context,t,i,e),t.isNew()||t.trigger("sync",t,i,e)};var s=!1;return this.isNew()?i.defer(e.success):(U(this,e),s=this.sync("delete",this,e)),r||o(),s},url:function(){var e=i.result(this,"urlRoot")||i.result(this.collection,"url")||V();if(this.isNew())return e;var t=this.get(this.idAttribute);return e.replace(/[^\/]$/,"$&/")+encodeURIComponent(t)},parse:function(e,t){return e},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(e){return this._validate({},i.defaults({validate:!0},e))},_validate:function(e,t){if(!t.validate||!this.validate)return!0;e=i.extend({},this.attributes,e);var n=this.validationError=this.validate(e,t)||null;return!n||(this.trigger("invalid",this,n,i.extend(t,{validationError:n})),!1)}}),a(b,{keys:1,values:1,pairs:1,invert:1,pick:0,omit:0,chain:1,isEmpty:1},"attributes");var w=t.Collection=function(e,t){t||(t={}),t.model&&(this.model=t.model),void 0!==t.comparator&&(this.comparator=t.comparator),this._reset(),this.initialize.apply(this,arguments),e&&this.reset(e,i.extend({silent:!0},t))},E={add:!0,remove:!0,merge:!0},_={add:!0,remove:!1},T=function(e,t,i){i=Math.min(Math.max(i,0),e.length);for(var n=Array(e.length-i),r=t.length,o=0;o<n.length;o++)n[o]=e[o+i];for(o=0;o<r;o++)e[o+i]=t[o];for(o=0;o<n.length;o++)e[o+r+i]=n[o]};i.extend(w.prototype,c,{model:b,initialize:function(){},toJSON:function(e){return this.map(function(t){return t.toJSON(e)})},sync:function(){return t.sync.apply(this,arguments)},add:function(e,t){return this.set(e,i.extend({merge:!1},t,_))},remove:function(e,t){t=i.extend({},t);var n=!i.isArray(e);e=n?[e]:i.clone(e);var r=this._removeModels(e,t);return!t.silent&&r&&this.trigger("update",this,t),n?r[0]:r},set:function(e,t){if(null!=e){t=i.defaults({},t,E),t.parse&&!this._isModel(e)&&(e=this.parse(e,t));var n=!i.isArray(e);e=n?[e]:e.slice();var r=t.at;null!=r&&(r=+r),r<0&&(r+=this.length+1);for(var o,s=[],a=[],u=[],l={},c=t.add,h=t.merge,d=t.remove,f=!1,p=this.comparator&&null==r&&!1!==t.sort,g=i.isString(this.comparator)?this.comparator:null,m=0;m<e.length;m++){o=e[m];var v=this.get(o);if(v){if(h&&o!==v){var y=this._isModel(o)?o.attributes:o;t.parse&&(y=v.parse(y,t)),v.set(y,t),p&&!f&&(f=v.hasChanged(g))}l[v.cid]||(l[v.cid]=!0,s.push(v)),e[m]=v}else c&&(o=e[m]=this._prepareModel(o,t))&&(a.push(o),this._addReference(o,t),l[o.cid]=!0,s.push(o))}if(d){for(m=0;m<this.length;m++)o=this.models[m],l[o.cid]||u.push(o);u.length&&this._removeModels(u,t)}var b=!1,w=!p&&c&&d;if(s.length&&w?(b=this.length!=s.length||i.some(this.models,function(e,t){return e!==s[t]}),this.models.length=0,T(this.models,s,0),this.length=this.models.length):a.length&&(p&&(f=!0),T(this.models,a,null==r?this.length:r),this.length=this.models.length),f&&this.sort({silent:!0}),!t.silent){for(m=0;m<a.length;m++)null!=r&&(t.index=r+m),o=a[m],o.trigger("add",o,this,t);(f||b)&&this.trigger("sort",this,t),(a.length||u.length)&&this.trigger("update",this,t)}return n?e[0]:e}},reset:function(e,t){t=t?i.clone(t):{};for(var n=0;n<this.models.length;n++)this._removeReference(this.models[n],t);return t.previousModels=this.models,this._reset(),e=this.add(e,i.extend({silent:!0},t)),t.silent||this.trigger("reset",this,t),e},push:function(e,t){return this.add(e,i.extend({at:this.length},t))},pop:function(e){var t=this.at(this.length-1);return this.remove(t,e)},unshift:function(e,t){return this.add(e,i.extend({at:0},t))},shift:function(e){var t=this.at(0);return this.remove(t,e)},slice:function(){return o.apply(this.models,arguments)},get:function(e){if(null!=e){var t=this.modelId(this._isModel(e)?e.attributes:e);return this._byId[e]||this._byId[t]||this._byId[e.cid]}},at:function(e){return e<0&&(e+=this.length),this.models[e]},where:function(e,t){return this[t?"find":"filter"](e)},findWhere:function(e){return this.where(e,!0)},sort:function(e){var t=this.comparator;if(!t)throw new Error("Cannot sort a set without a comparator");e||(e={});var n=t.length;return i.isFunction(t)&&(t=i.bind(t,this)),1===n||i.isString(t)?this.models=this.sortBy(t):this.models.sort(t),e.silent||this.trigger("sort",this,e),this},pluck:function(e){return i.invoke(this.models,"get",e)},fetch:function(e){e=i.extend({parse:!0},e);var t=e.success,n=this;return e.success=function(i){var r=e.reset?"reset":"set";n[r](i,e),t&&t.call(e.context,n,i,e),n.trigger("sync",n,i,e)},U(this,e),this.sync("read",this,e)},create:function(e,t){t=t?i.clone(t):{};var n=t.wait;if(!(e=this._prepareModel(e,t)))return!1;n||this.add(e,t);var r=this,o=t.success;return t.success=function(e,t,i){n&&r.add(e,i),o&&o.call(i.context,e,t,i)},e.save(null,t),e},parse:function(e,t){return e},clone:function(){return new this.constructor(this.models,{model:this.model,comparator:this.comparator})},modelId:function(e){return e[this.model.prototype.idAttribute||"id"]},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(e,t){if(this._isModel(e))return e.collection||(e.collection=this),e;t=t?i.clone(t):{},t.collection=this;var n=new this.model(e,t);return n.validationError?(this.trigger("invalid",this,n.validationError,t),!1):n},_removeModels:function(e,t){for(var i=[],n=0;n<e.length;n++){var r=this.get(e[n]);if(r){var o=this.indexOf(r);this.models.splice(o,1),this.length--,t.silent||(t.index=o,r.trigger("remove",r,this,t)),i.push(r),this._removeReference(r,t)}}return!!i.length&&i},_isModel:function(e){return e instanceof b},_addReference:function(e,t){this._byId[e.cid]=e;var i=this.modelId(e.attributes);null!=i&&(this._byId[i]=e),e.on("all",this._onModelEvent,this)},_removeReference:function(e,t){delete this._byId[e.cid];var i=this.modelId(e.attributes);null!=i&&delete this._byId[i],this===e.collection&&delete e.collection,e.off("all",this._onModelEvent,this)},_onModelEvent:function(e,t,i,n){if("add"!==e&&"remove"!==e||i===this){if("destroy"===e&&this.remove(t,n),"change"===e){var r=this.modelId(t.previousAttributes()),o=this.modelId(t.attributes);r!==o&&(null!=r&&delete this._byId[r],null!=o&&(this._byId[o]=t))}this.trigger.apply(this,arguments)}}}),a(w,{forEach:3,each:3,map:3,collect:3,reduce:4,foldl:4,inject:4,reduceRight:4,foldr:4,find:3,detect:3,filter:3,select:3,reject:3,every:3,all:3,some:3,any:3,include:3,includes:3,contains:3,invoke:0,max:3,min:3,toArray:1,size:1,first:3,head:3,take:3,initial:3,rest:3,tail:3,drop:3,last:3,without:0,difference:0,indexOf:3,shuffle:1,lastIndexOf:3,isEmpty:1,chain:1,sample:3,partition:3,groupBy:3,countBy:3,sortBy:3,indexBy:3},"models");var S=t.View=function(e){this.cid=i.uniqueId("view"),i.extend(this,i.pick(e,P)),this._ensureElement(),this.initialize.apply(this,arguments)},A=/^(\S+)\s*(.*)$/,P=["model","collection","el","id","attributes","className","tagName","events"];i.extend(S.prototype,c,{tagName:"div",$:function(e){return this.$el.find(e)},initialize:function(){},render:function(){return this},remove:function(){return this._removeElement(),this.stopListening(),this},_removeElement:function(){this.$el.remove()},setElement:function(e){return this.undelegateEvents(),this._setElement(e),this.delegateEvents(),this},_setElement:function(e){this.$el=e instanceof t.$?e:t.$(e),this.el=this.$el[0]},delegateEvents:function(e){if(e||(e=i.result(this,"events")),!e)return this;this.undelegateEvents();for(var t in e){var n=e[t];if(i.isFunction(n)||(n=this[n]),n){var r=t.match(A);this.delegate(r[1],r[2],i.bind(n,this))}}return this},delegate:function(e,t,i){return this.$el.on(e+".delegateEvents"+this.cid,t,i),this},undelegateEvents:function(){return this.$el&&this.$el.off(".delegateEvents"+this.cid),this},undelegate:function(e,t,i){return this.$el.off(e+".delegateEvents"+this.cid,t,i),this},_createElement:function(e){return document.createElement(e)},_ensureElement:function(){if(this.el)this.setElement(i.result(this,"el"));else{var e=i.extend({},i.result(this,"attributes"));this.id&&(e.id=i.result(this,"id")),this.className&&(e.class=i.result(this,"className")),this.setElement(this._createElement(i.result(this,"tagName"))),this._setAttributes(e)}},_setAttributes:function(e){this.$el.attr(e)}}),t.sync=function(e,n,r){var o=I[e];i.defaults(r||(r={}),{emulateHTTP:t.emulateHTTP,emulateJSON:t.emulateJSON});var s={type:o,dataType:"json"};if(r.url||(s.url=i.result(n,"url")||V()),null!=r.data||!n||"create"!==e&&"update"!==e&&"patch"!==e||(s.contentType="application/json",s.data=JSON.stringify(r.attrs||n.toJSON(r))),r.emulateJSON&&(s.contentType="application/x-www-form-urlencoded",s.data=s.data?{model:s.data}:{}),r.emulateHTTP&&("PUT"===o||"DELETE"===o||"PATCH"===o)){s.type="POST",r.emulateJSON&&(s.data._method=o);var a=r.beforeSend;r.beforeSend=function(e){if(e.setRequestHeader("X-HTTP-Method-Override",o),a)return a.apply(this,arguments)}}"GET"===s.type||r.emulateJSON||(s.processData=!1);var u=r.error;r.error=function(e,t,i){r.textStatus=t,r.errorThrown=i,u&&u.call(r.context,e,t,i)};var l=r.xhr=t.ajax(i.extend(s,r));return n.trigger("request",n,l,r),l};var I={create:"POST",update:"PUT",patch:"PATCH",delete:"DELETE",read:"GET"};t.ajax=function(){return t.$.ajax.apply(t.$,arguments)};var x=t.Router=function(e){e||(e={}),e.routes&&(this.routes=e.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},C=/\((.*?)\)/g,R=/(\(\?)?:\w+/g,k=/\*\w+/g,O=/[\-{}\[\]+?.,\\\^$|#\s]/g;i.extend(x.prototype,c,{initialize:function(){},route:function(e,n,r){i.isRegExp(e)||(e=this._routeToRegExp(e)),i.isFunction(n)&&(r=n,n=""),r||(r=this[n]);var o=this;return t.history.route(e,function(i){var s=o._extractParameters(e,i);!1!==o.execute(r,s,n)&&(o.trigger.apply(o,["route:"+n].concat(s)),o.trigger("route",n,s),t.history.trigger("route",o,n,s))}),this},execute:function(e,t,i){e&&e.apply(this,t)},navigate:function(e,i){return t.history.navigate(e,i),this},_bindRoutes:function(){if(this.routes){this.routes=i.result(this,"routes");for(var e,t=i.keys(this.routes);null!=(e=t.pop());)this.route(e,this.routes[e])}},_routeToRegExp:function(e){return e=e.replace(O,"\\$&").replace(C,"(?:$1)?").replace(R,function(e,t){return t?e:"([^/?]+)"}).replace(k,"([^?]*?)"),new RegExp("^"+e+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(e,t){var n=e.exec(t).slice(1);return i.map(n,function(e,t){return t===n.length-1?e||null:e?decodeURIComponent(e):null})}});var L=t.History=function(){this.handlers=[],this.checkUrl=i.bind(this.checkUrl,this),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},D=/^[#\/]|\s+$/g,M=/^\/+|\/+$/g,N=/#.*$/;L.started=!1,i.extend(L.prototype,c,{interval:50,atRoot:function(){return this.location.pathname.replace(/[^\/]$/,"$&/")===this.root&&!this.getSearch()},matchRoot:function(){return this.decodeFragment(this.location.pathname).slice(0,this.root.length-1)+"/"===this.root},decodeFragment:function(e){return decodeURI(e.replace(/%25/g,"%2525"))},getSearch:function(){var e=this.location.href.replace(/#.*/,"").match(/\?.+/);return e?e[0]:""},getHash:function(e){var t=(e||this).location.href.match(/#(.*)$/);return t?t[1]:""},getPath:function(){var e=this.decodeFragment(this.location.pathname+this.getSearch()).slice(this.root.length-1);return"/"===e.charAt(0)?e.slice(1):e},getFragment:function(e){return null==e&&(e=this._usePushState||!this._wantsHashChange?this.getPath():this.getHash()),e.replace(D,"")},start:function(e){if(L.started)throw new Error("Backbone.history has already been started");if(L.started=!0,this.options=i.extend({root:"/"},this.options,e),this.root=this.options.root,this._wantsHashChange=!1!==this.options.hashChange,this._hasHashChange="onhashchange"in window&&(void 0===document.documentMode||document.documentMode>7),this._useHashChange=this._wantsHashChange&&this._hasHashChange,this._wantsPushState=!!this.options.pushState,this._hasPushState=!(!this.history||!this.history.pushState),this._usePushState=this._wantsPushState&&this._hasPushState,this.fragment=this.getFragment(),this.root=("/"+this.root+"/").replace(M,"/"),this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot()){var t=this.root.slice(0,-1)||"/";return this.location.replace(t+"#"+this.getPath()),!0}this._hasPushState&&this.atRoot()&&this.navigate(this.getHash(),{replace:!0})}if(!this._hasHashChange&&this._wantsHashChange&&!this._usePushState){this.iframe=document.createElement("iframe"),this.iframe.src="javascript:0",this.iframe.style.display="none",this.iframe.tabIndex=-1;var n=document.body,r=n.insertBefore(this.iframe,n.firstChild).contentWindow;r.document.open(),r.document.close(),r.location.hash="#"+this.fragment}var o=window.addEventListener||function(e,t){return attachEvent("on"+e,t)};if(this._usePushState?o("popstate",this.checkUrl,!1):this._useHashChange&&!this.iframe?o("hashchange",this.checkUrl,!1):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),!this.options.silent)return this.loadUrl()},stop:function(){var e=window.removeEventListener||function(e,t){return detachEvent("on"+e,t)};this._usePushState?e("popstate",this.checkUrl,!1):this._useHashChange&&!this.iframe&&e("hashchange",this.checkUrl,!1),this.iframe&&(document.body.removeChild(this.iframe),this.iframe=null),this._checkUrlInterval&&clearInterval(this._checkUrlInterval),L.started=!1},route:function(e,t){this.handlers.unshift({route:e,callback:t})},checkUrl:function(e){var t=this.getFragment();if(t===this.fragment&&this.iframe&&(t=this.getHash(this.iframe.contentWindow)),t===this.fragment)return!1;this.iframe&&this.navigate(t),this.loadUrl()},loadUrl:function(e){return!!this.matchRoot()&&(e=this.fragment=this.getFragment(e),i.some(this.handlers,function(t){if(t.route.test(e))return t.callback(e),!0}))},navigate:function(e,t){if(!L.started)return!1;t&&!0!==t||(t={trigger:!!t}),e=this.getFragment(e||"");var i=this.root;""!==e&&"?"!==e.charAt(0)||(i=i.slice(0,-1)||"/");var n=i+e;if(e=this.decodeFragment(e.replace(N,"")),this.fragment!==e){if(this.fragment=e,this._usePushState)this.history[t.replace?"replaceState":"pushState"]({},document.title,n);else{if(!this._wantsHashChange)return this.location.assign(n);if(this._updateHash(this.location,e,t.replace),this.iframe&&e!==this.getHash(this.iframe.contentWindow)){var r=this.iframe.contentWindow;t.replace||(r.document.open(),r.document.close()),this._updateHash(r.location,e,t.replace)}}return t.trigger?this.loadUrl(e):void 0}},_updateHash:function(e,t,i){if(i){var n=e.href.replace(/(javascript:|#).*$/,"");e.replace(n+"#"+t)}else e.hash="#"+t}}),t.history=new L;var F=function(e,t){var n,r=this;n=e&&i.has(e,"constructor")?e.constructor:function(){return r.apply(this,arguments)},i.extend(n,r,t);var o=function(){this.constructor=n};return o.prototype=r.prototype,n.prototype=new o,e&&i.extend(n.prototype,e),n.__super__=r.prototype,n};b.extend=w.extend=x.extend=S.extend=L.extend=F;var V=function(){throw new Error('A "url" property or function must be specified')},U=function(e,t){var i=t.error;t.error=function(n){i&&i.call(t.context,e,n,t),e.trigger("error",e,n,t)}};return t}),define("globals",["lodash"],function(e){"use strict";var t=function(){return{absorb:function(i){e.each(i,function(e,i){t[i]=e})},purge:function(e){delete t[e]}}}();return window.cerosContext&&t.absorb(window.cerosContext),t}),define("domReady",[],function(){"use strict";function e(e){var t;for(t=0;t<e.length;t+=1)e[t](l)}function t(){var t=c;u&&t.length&&(c=[],e(t))}function i(){u||(u=!0,s&&clearInterval(s),t())}function n(e){return u?e(l):c.push(e),n}var r,o,s,a="undefined"!=typeof window&&window.document,u=!a,l=a?document:null,c=[];if(a){if(document.addEventListener)document.addEventListener("DOMContentLoaded",i,!1),window.addEventListener("load",i,!1);else if(window.attachEvent){window.attachEvent("onload",i),o=document.createElement("div");try{r=null===window.frameElement}catch(e){}o.doScroll&&r&&window.external&&(s=setInterval(function(){try{o.doScroll(),i()}catch(e){}},30))}"complete"===document.readyState&&i()}return n.version="2.0.1",n.load=function(e,t,i,r){r.isBuild?i(null):n(i)},n}),define("playerApi",["log","lodash","jquery"],function(e,t,i){"use strict";var n={},r=[],o={bindToIframe:function(e){return new c(e)},on:function(i,o){return t.isFunction(o)?("*"===i?(r.push(o),t.each(n,function(e){e.push(o)})):(t.has(n,i)||(n[i]=r.slice()),n[i].push(o)),this):void e.warn("handler is not a function")},unbindAll:function(){n={},r=[]},handleRequest:function(i,r){if(!t.has(n,i.name))return void e.warn("No handler for "+i.name);var o=n[i.name].slice(),s={},a=function(){r(s)},u=function(t){e.warn("Error:",t),s={error:"Unable to process request due to an error"},a()},l=function(){try{var e=o.shift();if(!e)return void a();var n=e(i,s);if(n&&t.isFunction(n.done)&&t.isFunction(n.fail)&&t.isFunction(n.always)){var r=setTimeout(function(){u(new Error("handler timed out"))},1e4);n.done(function(){l()}).fail(function(){a()}).always(function(){clearTimeout(r)})}else!1===n?a():l()}catch(e){u(e)}};l()}},s=function(e){if(t.isUndefined(e.client))throw new Error("No client object given");if(t.isUndefined(e.name))throw new Error("No name given");this.name=e.name,this.client=e.client,this.params=e.params||{}},a=[],u=!1,l=function(){if(!u){if(u=!0,t.isUndefined(window.postMessage))return void e.warn("This browser does not support inter-frame communication");e.debug("listening for iframe messages"),i(window).bind("message",function(i){var n=i.originalEvent.source,r=null;if(t.each(a,function(e){n===e.getWindow()&&(r=e)}),r&&t.isString(i.originalEvent.data)){var u;try{u=JSON.parse(i.originalEvent.data)}catch(t){return void e.warn("Could not parse data: ["+i.originalEvent.data+"]")}if(!u.name)return void e.warn('Data has no "name" property');if(0!==u.name.indexOf("ceros.sdk.player")){var l=u.uuid,c=function(e){var t=JSON.stringify({uuid:l,response:e});n.postMessage(t,"*")},h=new s({name:u.name,params:u.params,client:{type:"iframe",sdkVersion:u.version}});o.handleRequest(h,c)}}})}},c=function(e){a.push(this),this.iframe=e,l()};return c.prototype={getWindow:function(){return this.iframe.contentWindow}},o}),define("urlUtils",["lodash"],function(e){"use strict";var t=/^(https?|ftp):\/\/[^\s\/$.?#].[^\s]*$/i,i={isValidUrl:function(e){return t.test(e)},beginsWithHttpOrHttps:function(e){return/^(http(s?))\:\/\//gi.test(e)},getUrlParams:function(t){var i,n={};if(t=String(t),-1===t.indexOf("?"))return n;var r=t.split("?"),o=r[1];if(e.isEmpty(o))return n;o=o.split("&");for(var s=0;s<o.length;s++)-1===o[s].indexOf("=")?n[decodeURIComponent(o[s])]=void 0:(i=o[s].split("="),n[decodeURIComponent(i[0])]=decodeURIComponent(i[1]));return n},removeEmbedParams:function(e){var t=e.replace(/heightOverride=\d+&?/g,"");return-1!==t.indexOf("?",t.length-1)&&(t=t.substring(0,t.length-1)),t},getBaseUrl:function(e){return e=String(e),-1===e.indexOf("?")?e:e.split("?")[0]},appendQueryParams:function(t,i,n){if(e.isEmpty(i))return t;var r="",o=t.lastIndexOf("#");-1!==o&&(r=t.substr(o),t=t.substr(0,o));var s=this.getUrlParams(t);i=e.extend({},s,i);var a=[];e.each(i,function(t,i){var r=n?i:encodeURIComponent(i);e.isUndefined(t)||(n||(t=encodeURIComponent(t)),r+="="+t),a.push(r)});var u=a.join("&");return this.getBaseUrl(t)+"?"+u+r},appendCacheBustingTimestamp:function(e,t){return e+(-1===e.indexOf("?")?"?":"&")+"_="+t},extractDomain:function(e){var t=e.match(/^https?:\/\/([^\/]+)/);return t?t[1]:""},replaceProtocolIfHttpsRequest:function(e){return"https:"===location.protocol&&(e=i.makeHttps(e)),e},makeHttps:function(e){return e.replace(/^http:/,"https:")},linkifyText:function(e,t){var i=/\b(?:https?|ftp):\/\/[a-z0-9-+&@#\/%?=~_|!:,.;]*[a-z0-9-+&@#\/%=~_|]/gim,n=/(^|[^\/])(www\.[\S]+(\b|$))/gim,r=/[\w.]+@[a-zA-Z_-]+?(?:\.[a-zA-Z]{2,6})+/gim,o=t?' target="_blank"':"";return e.replace(i,'<a href="$&"'+o+">$&</a>").replace(n,'$1<a href="http://$2"'+o+">$2</a>").replace(r,'<a href="mailto:$&"'+o+">$&</a>")},locationIsHtmlFile:function(){return!!window.location.pathname.match(/\.html$/)},makeUrlAbsolute:function(e){if(this.extractDomain(e))return e;if(!window.cerosBaseUrl)return e;var t="/"===e[0],i=window.cerosBaseUrl.lastIndexOf("/")===window.cerosBaseUrl.length-1;return i&&t?window.cerosBaseUrl+e.slice(1):i||t?window.cerosBaseUrl+e:window.cerosBaseUrl+"/"+e},hasQueryParam:function(t,n){var r=i.getUrlParams(t);return e.some(r,function(e,t){if(t.toLowerCase()===n.toLowerCase())return!0})},prependProtocol:function(e,t){var n=t?"https://":"http://";return i.beginsWithHttpOrHttps(e)?e:n+e}};return i}),define("shared/utils/NavigationUtils",["lodash","jquery","log","globals","urlUtils"],function(e,t,i,n,r){"use strict";var o={page_number:"/p/",page_slug:"/page/"};return{buildUri:function(e,t){return r.locationIsHtmlFile()?this.buildHtmlStyleUri(t):this.buildPathStyleUri(e,t)},buildHtmlStyleUri:function(e){var t,i=window.location.search;return 1===e?(i=i.replace(/page=(\d+)&?/,""),t=window.location.pathname+i):t=r.appendQueryParams(window.location.pathname+i,{page:e}),t=t.replace(/[&|\?]$/,"")},buildPathStyleUri:function(e,t){if(!o[e])return i.warn("Mode is not supported"),null;var n=o[e]+t,r=window.location.pathname;return r=r.replace(/\/$/,""),n=r.replace(/\/(p|page)\/[a-z0-9-]*/,"")+n,n+=window.location.search},buildUriForPageNumber:function(e){return this.buildUri("page_number",e)},parsePageFromLocation:function(){var e=null;if(r.locationIsHtmlFile()){var t=window.location.search.match(/page=(\d+)/);return e=1,t&&(e=parseInt(t[1],10)),e}var i=location.pathname.match(/\/p\/(\d+)\/?$/);if(i&&(e=parseInt(i[1],10)),!e&&n.usePageSlugsInNavigation){var o=location.pathname.match(/\/page\/([a-z0-9-]+)\/?$/);o&&(e=o[1])}return e||(e=1),e},getLocationWithoutParamsAndPageNumber:function(){return window.location.href.replace(/\?.*$/,"").replace(/\/(page\/[0-9a-z-]+|p\/\d+)\\?$/,"")}}}),define("libs/font/FontConstants",[],function(){"use strict";return{GOOGLE_API_ID:"Google",BUILTIN_API_ID:"BuiltIn",UPLOADED_API_ID:"Uploaded",DEFAULT_FONT_FAMILY_GUID:"Google|Roboto",DEFAULT_FONT_VARIANT_GUID:"Google|Roboto|400|normal",DEFAULT_FONT_WEIGHT:400,DEFAULT_FONT_STYLE:"normal",FONT_STYLE_ITALIC:"italic",FONT_STYLE_NORMAL:"normal",FONT_STYLE_OBLIQUE:"oblique",EXPERIENCE_FAMILY_GUIDS_KEY:"familyGuids"}}),define("libs/font/FontVariant",["lodash","jquery","libs/font/FontConstants"],function(e,t,i){"use strict";var n=function(e,t){t=t||{},this.name=e,this.fontFamily=t.fontFamily,this.familyName=t.familyName,this.fontWeight=t.fontWeight,this.fontStyle=t.fontStyle,this.guid=t.guid,this.metrics=t.metrics,this.webFontStylesLoaded=!!t.webFontStylesLoaded,this.metricsUrl=t.metricsUrl,this.cssFamilyName=t.cssFamilyName||t.familyName,this.crossAccount=!!t.crossAccount,this.cssUrl=t.cssUrl,this.unitsPerEm=t.unitsPerEm,this.ascent=t.ascent};return n.prototype={getFontFamily:function(){return this.fontFamily},getName:function(){return this.name},getCssFamilyName:function(){return this.cssFamilyName},getFontStyle:function(){return this.fontStyle},getFontWeight:function(){return this.fontWeight},getGuid:function(){return this.guid},isItalic:function(){return this.fontStyle===i.FONT_STYLE_ITALIC},isUploaded:function(){return this.fontFamily.isUploaded()},isBuiltIn:function(){return this.fontFamily.isBuiltIn()},getMetricsUrl:function(){return this.metricsUrl?(new t.Deferred).resolve(this.metricsUrl):t.ajax({url:"/rest/v1/font/font-metrics",dataType:"json",data:{variantGuids:[this.guid]}}).then(e.bind(function(e){return this.metricsUrl=e[0].metricsFileURL,this.metricsUrl},this))},getMetrics:function(){return this.metrics?t.Deferred().resolve(this.metrics):this.metricsLoadingDeferred?this.metricsLoadingDeferred.promise():(this.metricsLoadingDeferred=new t.Deferred,this.getMetricsUrl().then(e.bind(function(i){t.ajax({url:i,dataType:"json",cache:!0}).done(e.bind(function(e){this.metrics=e,this.metricsLoadingDeferred.resolve(e)},this)).fail(e.bind(function(e){this.metricsLoadingDeferred.reject(e)},this))},this)),this.metricsLoadingDeferred.promise())},setWebFontStylesLoaded:function(){this.webFontStylesLoaded=!0}},n}),define("libs/font/FontFamily",["lodash","jquery","libs/font/FontVariant","libs/font/FontConstants"],function(e,t,i,n){"use strict";var r=function(e){e=e||{},this.api=e.api,this.family=e.family,this.guid=e.guid,this.crossAccount=!!e.crossAccount,this.category=e.category,this.version=e.version,this.lastModified=e.lastModified,this.files=e.files,this.variants=[]};return r.prototype={isBuiltIn:function(){return this.api===n.BUILTIN_API_ID},isUploaded:function(){return this.api===n.UPLOADED_API_ID},isCrossAccount:function(){return this.crossAccount},getFamilyName:function(){return this.family},getVariants:function(){return this.variants},addVariant:function(t,n){var r=new i(t,e.extend({},n||{},{fontFamily:this}));return this.updateVariant(r),r},updateVariant:function(t){var i=e.findIndex(this.variants,function(e){return t.guid===e.guid});-1===i?this.variants.push(t):this.variants[i]=t},getVariantsCount:function(){return this.variants.length},getVariantNames:function(){return e.map(this.variants,function(e){return e.getName()})},getCssFamilyName:function(){return this.isUploaded()?this.variants[0].getCssFamilyName():this.getFamilyName()},
getGuid:function(){return this.guid},getVariant:function(t){return e.find(this.variants,function(e){return e.guid===t})},getVariantByName:function(t){return e.find(this.variants,function(e){return e.getName()===t.toString()})},getWebFontStylesLoaded:function(){return e.every(this.variants,"webFontStylesLoaded")},setAllWebFontStylesLoaded:function(){e.each(this.variants,e.bind(function(e){e.setWebFontStylesLoaded()},this))},sortVariantsByName:function(){this.variants=e.sortBy(this.variants,["name"])},findVariantByWeightAndStyle:function(t,i){return e.find(this.variants,function(e){return e.getFontWeight()===t&&e.getFontStyle()===i})},findBestMatchVariant:function(e){var t=this.getVariantByName(e.getName());return t||(t=this.findVariantByWeightAndStyle(e.getFontWeight(),e.getFontStyle())),t||(t=this.findVariantByWeightAndStyle(n.DEFAULT_FONT_WEIGHT,n.DEFAULT_FONT_STYLE)),t||(t=this.variants[0]),t}},r}),define("modules/page/utils/TextUtil",["log","lodash","jquery","device","globals","libs/font/FontConstants","libs/font/FontFamily","libs/font/FontVariant"],function(e,t,i,n,r,o,s,a){"use strict";var u=function(t){var i=r.fontManifest[t];if(i||(i=r.fontManifest[o.DEFAULT_FONT_VARIANT_GUID])&&e.warn("Could not find font in the font manifest. Using default variant.",{variantGuid:t,defaultVariantGuid:o.DEFAULT_FONT_VARIANT_GUID}),i){var n=new s({family:i.familyName,guid:i.familyGuid,crossAccount:i.crossAccount,api:i.api});return new a(i.variantName,{fontFamily:n,familyName:i.familyName,fontWeight:i.fontWeight,fontStyle:i.fontStyle,guid:i.variantGuid,cssFamilyName:i.cssFamilyName,cssUrl:i.cssFileURL,unitsPerEm:i.unitsPerEm,ascent:i.ascent})}throw new Error("Could not find desired font "+t+" or default font "+o.DEFAULT_FONT_VARIANT_GUID+" in the font manifest.")},l=function(i,n,r,o){var s=i.find(".marker");if(0===s.length)return void e.info("could not find img baseline marker!");if(0===s.position().top)return void t.defer(function(){l(i,n,r,o)});var a=s.position().top+s.height(),u=r/n.unitsPerEm,c=Math.round(u*n.ascent-a),h=i.attr("data-baseline");if(t.isUndefined(h)||t.isUndefined(c)||parseInt(h,10)!==c)return i.attr("data-baseline",c),void t.defer(function(){l(i,n,r,o)});o.resolve(c)},c=function(e){return'"'+e.replace('"','\\"')+'"'};return{resolveFont:u,measureFontBaselineOffset:function(e,t,n){var r=new i.Deferred;if(t<=1)return r.resolve(0),r.promise();var o=i('<div><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAMAAAAoyzS7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAAZQTFRF////AAAAVcLTfgAAAAxJREFUeNpiYAAIMAAAAgABT21Z4QAAAABJRU5ErkJggg==" style="position:relative;vertical-align:baseline;" class="marker"/><span>Mq</span></div>').css({width:"auto",height:"auto",lineHeight:n+"px",position:"absolute",top:0,left:0,fontSize:t+"px",fontFamily:c(e.getCssFamilyName()),fontWeight:e.getFontWeight(),fontStyle:e.getFontStyle(),opacity:0}).attr("data-baseline",null);return i("body").append(o),l(o,e,t,r),r.done(function(){o.remove()}),r.promise()},formatFamilyNameForCSS:c}}),define("libs/image/AbstractImageResource",["jquery"],function(e){"use strict";var t=function(t){this.resourceReady=e.Deferred(),this.image=new Image,this.data=this.image,t&&t.useCorsAnonymous&&(this.image.crossOrigin="Anonymous")};return t.prototype={onload:function(){return this.resourceReady.done.apply(this.resourceReady,arguments),this.resourceReady},onerror:function(){return this.resourceReady.fail.apply(this.resourceReady,arguments),this.resourceReady},ready:function(){return"resolved"===this.resourceReady.state()},getPromise:function(){return this.resourceReady.promise()},getImage:function(){return this.image},getWidth:function(){return this.image.width},getHeight:function(){return this.image.height},remove:function(){delete this.image},getSrc:function(){return this.image.src}},t}),define("libs/image/ImageResource",["jquery","lodash","libs/image/AbstractImageResource"],function(e,t,i){"use strict";var n=function(e,n){return i.call(this,n),this.url=e,n&&n.makeCORSCompatible&&this.image.setAttribute("crossOrigin","anonymous"),this.image.onload=t.bind(function(){this.resourceReady.resolve(this)},this),this.image.onerror=t.bind(function(){this.resourceReady.reject()},this),this.image.src=e,this};return n.prototype=Object.create(i.prototype),n.prototype.constructor=n,n}),define("cerosMath",[],function(){"use strict";var e={};return e.Point=function(e,t){this.x=e,this.y=t,this.getX=function(){return this.x},this.getY=function(){return this.y},this.setX=function(e){this.x=e},this.setY=function(e){this.y=e},this.rotate=function(e,t,i){var n=Math.rotateCoord(this.x,this.y,e,t,i);this.setX(n.x),this.setY(n.y)}},e.Point.diff=function(t,i){return new e.Point(t.getX()-i.getX(),t.getY()-i.getY())},e.Point.sum=function(t,i){return new e.Point(t.getX()+i.getX(),t.getY()+i.getY())},e.Point.ORIGIN=new e.Point(0,0),e.calcRotatedLineIntersect=function(e,t,i){return{startPt:this.calcPointOnRect(e-270,t,i),endPt:this.calcPointOnRect(e-90,t,i)}},e.calcPointOnRect=function(t,i,n){var r={x:i/2,y:n/2};(t%=360)<0&&(t+=360);var o,s,a,u=Math.toRad(t),l=Math.tan(u),c=50*l,h=50/l;return Math.abs(c)<=50?(o=i/100*50,s=n/100*c,a=u<=Math.PI/2||u>3*Math.PI/2?{x:o,y:s}:{x:-o,y:-s}):(o=i/100*h,s=n/100*50,a=u<Math.PI?{x:o,y:s}:{x:-o,y:-s}),a.x+=r.x,a.y+=r.y,a.x=Math.round(a.x),a.y=Math.round(a.y),new e.Point(a.x,a.y)},e.scaleBoxToMaxDimension=function(e,t,i){var n=e,r=t;return e>0&&t>0&&(e>t?(n=i,r=Math.round(i/e*t)):(n=Math.round(i/t*e),r=i)),{width:n,height:r}},e.distance=function(e,t){var i=e.x-t.x,n=e.y-t.y;return Math.sqrt(i*i+n*n)},e.lineLength=function(t){return e.distance({x:t.x1,y:t.y1},{x:t.x2,y:t.y2})},e.cubicBezierCurveFirstDerivativeRoots=function(t,i,n,r){var o=[],s=3*(3*i-t-3*n+r),a=6*(t-2*i+n),u=3*(i-t),l=a*a-4*s*u;if(l>=0){var c=(-a+Math.sqrt(l))/(2*s),h=(-a-Math.sqrt(l))/(2*s);c>0&&c<1&&o.push(e.evaluateBezierCurve(t,i,n,r,c)),h>0&&h<1&&o.push(e.evaluateBezierCurve(t,i,n,r,h))}return o},e.evaluateBezierCurve=function(e,t,i,n,r){return e*(1-r)*(1-r)*(1-r)+3*t*r*(1-r)*(1-r)+3*i*r*r*(1-r)+n*r*r*r},e.round=function(e,t){var i=Math.pow(10,t);return Math.round(e*i)/i},e.toNextMultiple=function(e,t){return e>0?Math.ceil(e/t)*t:e<0?Math.floor(e/t)*t:0},window.CerosMath=e,e}),define("VectorImageUtils",["jquery","lodash","cerosMath","device"],function(e,t,i,n){"use strict";var r=["svg","path","rect","circle","ellipse","line","polyline","polygon","text"];return{isVectorBased:function(e){return"image/svg+xml"===e},getImageAspectRatio:function(e){var t=this.getViewportDimensions(e);if(t&&t.height>0&&t.width>0)return t;var i=this.getViewBoxDimensions(e);return i&&i.height>0&&i.width>0?i:null},getViewBoxDimensions:function(e){var t=e.documentElement,i=(t.getAttribute("viewBox")||"").match(/-?[\d\.]+/g);if(i&&4===i.length){var n=parseInt(i[2],10),r=parseInt(i[3],10);if(n>0&&r>0)return{width:n,height:r}}return null},getViewportDimensions:function(e){var t=e.documentElement,i=parseInt(t.getAttribute("width"),10),n=parseInt(t.getAttribute("height"),10);return i>0&&n>0?{width:i,height:n}:null},setViewportDimensions:function(e,t,i){var n=e.documentElement;n.setAttribute("width",t+"px"),n.setAttribute("height",i+"px")},updateSVGColorStyle:function(e,i){t.each(r,t.bind(function(n){var r=e.getElementsByTagName(n);t.each(r,t.bind(function(e){this.canFillStyleBeUpdated(e)&&this.appendStyle(e,"fill",i),this.canStrokeStyleBeUpdated(e)&&this.appendStyle(e,"stroke",i)},this))},this))},canFillStyleBeUpdated:function(e){var t=this.getStyle(e,"fill");return!t||"none"!==t.trim()},canStrokeStyleBeUpdated:function(e){var t=this.getStyle(e,"stroke");return t&&"none"!==t.trim()},getStyle:function(e,t){var i=this.getStyleValue(e,t);return i||(i=e.getAttribute(t)),i},removeIllegalNodes:function(e){this.removeNodesByNodeName(e,"foreignObject")},removeNodesByNodeName:function(e,t){var i=e.getElementsByTagName(t);if(i)for(var n=i.length-1;n>=0;n--){var r=i[n];r.parentNode.removeChild(r)}},findChildNode:function(e,i){return t.find(e.childNodes,function(e){return e.nodeName===i})},appendNewChildNode:function(e,t,i){var n=this.createSVGNode(e,i);return t.appendChild(n,t.firstChild),n},prependNewChildNode:function(e,t,i){var n=this.createSVGNode(e,i);return t.insertBefore(n,t.firstChild),n},addLinearGradient:function(e,n,r){var o=e.documentElement,s=this.findChildNode(o,"defs");s||(s=this.prependNewChildNode(e,o,"defs"));var a=this.appendNewChildNode(e,s,"linearGradient");a.setAttribute("id",n);var u=i.calcRotatedLineIntersect(r.angle,100,100);a.setAttribute("x1",u.startPt.getX()+"%"),a.setAttribute("y1",u.startPt.getY()+"%"),a.setAttribute("x2",u.endPt.getX()+"%"),a.setAttribute("y2",u.endPt.getY()+"%"),t.each(r.stops,t.bind(function(t,i){var n=0;r.stops.length>1&&(n=100*i/(r.stops.length-1));var o=this.appendNewChildNode(e,a,"stop");o.setAttribute("offset",n+"%"),o.setAttribute("stop-color",t.color)},this))},createSVGNode:function(e,t){return e.createElementNS("http://www.w3.org/2000/svg",t)},supportsObjectURLs:function(){return!n.isPhantomJS()},createObjectURL:function(e){if(this.supportsObjectURLs()){var t=this.createBlob(e);return this.getDOMURL().createObjectURL(t)}var i=this.createXmlString(e);return"data:image/svg+xml;base64,"+window.btoa(i)},createBlob:function(e){var t=this.createXmlString(e);return new Blob([t],{type:"image/svg+xml"})},createXmlString:function(e){return(new XMLSerializer).serializeToString(e)},revokeObjectURL:function(e){this.supportsObjectURLs()&&this.getDOMURL().revokeObjectURL(e)},getDOMURL:function(){return window.URL||window.webkitURL||window},isDataURL:function(e){return t.isString(e)&&0===e.indexOf("data:")},isVectorDataURL:function(e){return t.isString(e)&&0===e.indexOf("data:image/svg+xml;base64,")},convertToXMLString:function(e){if(!this.isVectorDataURL(e))throw new Error("Expected data url to start with data:image/svg+xml;base64,");var t=e.substring("data:image/svg+xml;base64,".length);return window.atob(t)},appendStyle:function(e,t,i){var n=e.getAttribute("style"),r=t+":"+i+";";n&&n.length>0?(";"!==n.substr(n.length-1)&&(n+=";"),n+=r):n=r,e.setAttribute("style",n)},getStyleValue:function(e,t){var i=e.getAttribute("style");if(!i||0===i.length)return null;var n=i.split(";");if(!n)return null;for(var r=null,o=n.length-1;o>=0;o--){var s=n[o].split(":");if(s&&2==s.length){if(s[0].trim()===t){r=s[1].trim();break}}}return r},createImageElement:function(i,n){var r=e("<img/>");return n&&r.attr(n),r.on("error",t.bind(function(){this.revokeObjectURL(i)},this)),r.attr("src",i),r}}}),define("ThumbnailVariantUtils",["lodash"],function(e){"use strict";return{VARIANTS:{FULL:"full",HALF:"half",QUARTER:"quarter",TENTH:"tenth"},getThumbnailVariant:function(t,i){var n=null;return e.has(t,i)?n=t[i]:e.has(t,this.VARIANTS.FULL)&&(n=t[this.VARIANTS.FULL]),n},getComponentImageThumbnail:function(t,i){if(!i)return this.getThumbnailVariant(t,this.VARIANTS.FULL);var n=[];e.each(t,function(e){n.push(e)}),n.sort(function(e,t){return e.width<t.width?-1:e.width>t.width?1:0});var r=e.find(n,function(e){return e.width>=i});return e.isObject(r)||(r=this.getThumbnailVariant(t,this.VARIANTS.FULL)),r}}}),define("BasicCache",["lodash"],function(e){"use strict";function t(){this.cache={}}return e.extend(t.prototype,{get:function(t){return e.get(this.cache,t,null)},put:function(e,t){this.cache[e]=t},has:function(t){return e.has(this.cache,t)},purgeAll:function(){this.cache={}}}),t}),define("libs/media/MediaInfoCache",["jquery","lodash","BasicCache"],function(e,t,i){"use strict";var n=new i,r={get:function(e){return n.get(e)},getOriginalWidth:function(e){var i=r.get(e);return t.get(i,["original","width"],null)},getOriginalDimensions:function(e){var i=r.get(e),n=t.get(i,["original","width"],null),o=t.get(i,["original","height"],null);return n&&o?{width:n,height:o}:null},put:function(e,t){n.put(e,t)},putMediaArray:function(e){t.each(t.keyBy(e,"id"),function(e,t){n.put(t,e)})},putImageResource:function(e,t){if(!t.ready())return void window.console.warn("Tried to put image info into cache from an image resource that was not ready");r.putImageInfo(e,t.getSrc(),t.getWidth(),t.getHeight())},putImageInfo:function(e,t,i,r){var o={id:e,url:t,original:{width:i,height:r}};return n.put(e,o),o},purgeAll:function(){n.purgeAll()},has:function(e){return n.has(e)}};return r}),define("libs/media/MediaInfoService",["jquery","lodash","globals","libs/media/MediaInfoCache"],function(e,t,i,n){"use strict";var r=[],o={loadImagesForUri:function(e){return o.loadImagesForRestUri("/rest"+e)},loadImagesForRestUri:function(e){return o.loadMediaForRestUri(e,!0)},loadMediaForUri:function(e,t){return o.loadMediaForRestUri("/rest"+e,t)},loadMediaForRestUri:function(t,i){var o=t+"/media";i&&(o+="?imagesOnly=true");var s=e.ajax({url:o,type:"GET",dataType:"json"}).then(function(e){n.putMediaArray(e)}).fail(function(e,i,n){window.console.warn("Unable to load image info for uri: "+t+" due to error: "+n)});return r.push(s),s},loadImage:function(i){return e.ajax({url:"/rest"+i+"/metadata",type:"GET",dataType:"json"}).then(function(e){if(!t.isObject(e))return void window.console.warn("Unexpected image metadata format");var r=t.get(e,"url",null),o=t.get(e,["meta","width"],null),s=t.get(e,["meta","height"],null);return n.putImageInfo(i,r,o,s)}).fail(function(){window.console.warn("Unable to load info for image: "+i)})},getMediaInfo:function(t){var s=e.Deferred();return n.has(t)||!i.isStudio?(s.resolve(n.get(t)),s.promise()):(e.when.apply(e,r).always(function(){if(n.has(t))return void s.resolve(n.get(t));o.loadImage(t).always(function(){s.resolve(n.get(t))})}),s.promise())},getOriginalWidth:function(e){return o.getMediaInfo(e).then(function(e){return t.get(e,["original","width"],null)})},getOriginalDimensions:function(e){return o.getMediaInfo(e).then(function(e){var i=t.get(e,["original","width"]),n=t.get(e,["original","height"]);return i&&n?{width:i,height:n}:null})}};return o}),define("ImageCroppingUtils",["lodash"],function(e){"use strict";var t=["width","height","x","y"],i={isValidCropObject:function(i){if(!e.isObject(i))return!1;var n=e.keys(i);return 0===e.xor(n,t).length},createCropDimensionsString:function(e){return i.isValidCropObject(e)?[e.width,e.height,"x"+e.x,"y"+e.y].join(","):""},createOriginalDimensionsFromCropDimensions:function(e,t){return{width:Math.clamp(t.width,1,e.width),height:Math.clamp(t.height,1,e.height)}}};return i}),define("libs/image/RasterImageResourceCache",["lodash","BasicCache","ImageCroppingUtils"],function(e,t,i){"use strict";function n(){t.call(this)}return e.extend(n.prototype,t.prototype,{createCacheKey:function(t,n){var r=i.createCropDimensionsString(n);return e.isString(r)&&r.length>0?t+"|"+r:t}}),n}),define("libs/image/VectorImageResource",["jquery","lodash","VectorImageUtils","libs/image/AbstractImageResource"],function(e,t,i,n){"use strict";var r=function(e){n.call(this),e.done(t.bind(function(e){this.initImage(e)},this)).fail(t.bind(function(){this.resourceReady.reject()},this))};return r.prototype=Object.create(n.prototype),r.prototype.constructor=r,t.extend(r.prototype,{initImage:function(e){this.image.onerror=t.bind(function(){i.revokeObjectURL(e),this.resourceReady.reject()},this),this.image.onload=t.bind(function(){this.resourceReady.resolve(this)},this),this.image.src=e}}),r}),define("libs/image/VectorImageResourceFactory",["jquery","lodash","libs/image/VectorImageResource","VectorImageUtils","BasicCache"],function(e,t,i,n,r){"use strict";var o=function(i){this.url=i,this.vectorImageResourceCache=new r,this.objectUrlPromiseCache=new r,this.xmlString=null,this.resourceReady=e.Deferred(),this.loadImageXML(i).done(t.bind(function(e){this.xmlString=e,this.resourceReady.resolve(this)},this)).fail(t.bind(function(){this.resourceReady.reject()},this))};return t.extend(o.prototype,{vectorImageResourceCache:null,objectUrlPromiseCache:null,getPromise:function(){return this.resourceReady.promise()},getOrCreateImageResource:function(e){var t=this.getCacheKey(e);if(this.imageResourceCacheHas(t))return this.getFromImageResourceCache(t);var n=this.createObjectURL(e),r=new i(n);return this.putInImageResourceCache(t,r),r},getImageResource:function(e){var t=this.getCacheKey(e);return this.getFromImageResourceCache(t)},imageResourceCacheHas:function(e){return this.vectorImageResourceCache.has(e)},getFromImageResourceCache:function(e){return this.vectorImageResourceCache.get(e)},putInImageResourceCache:function(e,t){this.vectorImageResourceCache.put(e,t)},objectUrlPromiseCacheHas:function(e){return this.objectUrlPromiseCache.has(e)},getFromObjectUrlPromiseCache:function(e){return this.objectUrlPromiseCache.get(e)},putInObjectUrlPromiseCache:function(e,t){this.objectUrlPromiseCache.put(e,t)},getCacheKey:function(e){if(t.has(e,"gradient")){return"gradient|"+t.get(e,"gradient.angle",null)+"|"+t.get(e,"gradient.stops[0].color",null)+"|"+t.get(e,"gradient.stops[1].color",null)+"|"+t.get(e,"backgroundHasBeenSet",null)}return"solid|"+t.get(e,"color",null)+"|"+t.get(e,"backgroundHasBeenSet",!1)},createObjectURL:function(i){var r=this.getCacheKey(i);if(this.objectUrlPromiseCacheHas(r))return this.getFromObjectUrlPromiseCache(r);var o=e.Deferred();return this.resourceReady.done(t.bind(function(){var e=this.createXMLDoc(i);if(e){var t=n.createObjectURL(e);o.resolve(t)}else o.reject()},this)),this.resourceReady.fail(o.reject),this.putInObjectUrlPromiseCache(r,o),o},createBlob:function(i){var r=e.Deferred();return this.resourceReady.done(t.bind(function(){var e=this.createXMLDoc(i);if(e){var t=n.createBlob(e);r.resolve(t)}else r.reject()},this)),this.resourceReady.fail(r.reject),r},createImageElement:function(e,t){return this.createObjectURL(e).then(function(e){return n.createImageElement(e,t)})},createXMLDoc:function(t){var i;try{i=e.parseXML(this.xmlString)}catch(e){}if(!i||!e.isXMLDoc(i))return null;t&&(t.color?n.updateSVGColorStyle(i,t.color):t.gradient?(n.addLinearGradient(i,"CerosGradient_1234",t.gradient),n.updateSVGColorStyle(i,"url(#CerosGradient_1234)")):t.backgroundHasBeenSet&&n.updateSVGColorStyle(i,"rgba(0,0,0,0)")),n.removeIllegalNodes(i);var r=n.getImageAspectRatio(i);return r&&r.width>0&&r.height>0&&n.setViewportDimensions(i,r.width,r.height),i},loadImageXML:function(t){var i=e.Deferred();if(n.isDataURL(t))if(n.isVectorDataURL(t)){var r=n.convertToXMLString(t);i.resolve(r)}else i.reject();else e.ajax({type:"GET",url:t,dataType:"text",cache:!0,success:function(e){i.resolve(e)},error:function(){i.reject()}});return i},getVectorImageResourceCache:function(){return this.vectorImageResourceCache},getObjectUrlPromiseCache:function(){return this.objectUrlPromiseCache}}),o}),define("libs/image/ImageResourceService",["lodash","jquery","device","globals","VectorImageUtils","ThumbnailVariantUtils","urlUtils","BasicCache","libs/media/MediaInfoCache","libs/media/MediaInfoService","libs/image/ImageResource","libs/image/RasterImageResourceCache","libs/image/VectorImageResourceFactory","ImageCroppingUtils"],function(e,t,i,n,r,o,s,a,u,l,c,h,d,f){"use strict";var p=new h,g=new a,m={getOrCreateRasterImageResource:function(e,i,n){var r=t.Deferred();return l.getOriginalDimensions(e).then(function(t){if(!t)return window.console.warn("No info was found for image: "+e),void r.resolve(null);f.isValidCropObject(n)?t=f.createOriginalDimensionsFromCropDimensions(t,n):n=null;var o=m.getRasterImage(e,n),s=m.isUriForGif(e),a=m.calculateVariantDimensions(t,i,s);o?o.getPromise().then(function(){m.shouldRequestHigherResolution(t.width,o.getWidth(),a)?r.resolve(m.createRasterImageResource(e,a,n)):r.resolve(o)}).fail(r.reject):r.resolve(m.createRasterImageResource(e,a,n))}),r.promise().then(function(e){return e?e.getPromise():null})},getOrCreateRasterImageResourceSync:function(e,t){var i=p.get(e),n=m.isUriForGif(e),r=u.getOriginalDimensions(e);if(!r)return i&&(!i.ready()||i.getWidth()>=t)?i:m.createRasterImageResource(e,t);var o=m.calculateVariantDimensions(r,t,n);return i?i.ready()&&m.shouldRequestHigherResolution(r.width,i.getWidth(),o)?m.createRasterImageResource(e,o):i:m.createRasterImageResource(e,o)},getRasterImage:function(e,t){var i=p.createCacheKey(e,t);return p.get(i)},getOrCreateVectorImageResourceFactory:function(e){var t;if(g.has(e))return g.get(e);var i=m.createImageProxyUri(e);return t=new d(i),g.put(e,t),t},getVectorImageResourceFactory:function(e){return g.get(e)},createRasterImageResource:function(e,t,i){var n=m.createImageResourceUrl(e,t,i),r=new c(n),o=p.createCacheKey(e,i);return p.put(o,r),r},calculateOptimizedGifWidth:function(e,t){return e<=t/8?t/8:e<=t/4?t/4:e<=t/2?t/2:t},calculateOptimizedNonGifWidth:function(e,t){if(e>t)return t;var i=.05*Math.ceil(e/t/.05);return i=Math.max(i,.05),t*i},calculateVariantDimensions:function(e,t,r){if(n.isExported||(r?t=this.calculateOptimizedGifWidth(t,e.width):i.desktop()&&(t=this.calculateOptimizedNonGifWidth(t,e.width))),t>=e.width)return null;var o=Math.round(t),s=this._calculateMinimumValidWidth(e);return Math.max(s,o)},_calculateMinimumValidWidth:function(e){return e.height>=e.width?1:Math.ceil(e.width/e.height)},isUriForGif:function(e){return"gif"===e.substr(-"gif".length)},shouldRequestHigherResolution:function(t,i,n){return e.isNull(n)||n>=t?i<t:(n-i)/i>=.25},primeCachesWithOriginalImageResource:function(e,t){p.put(e,t),u.putImageResource(e,t)},primeCacheWithImageInfo:function(e,t,i,n){u.putImageInfo(e,t,i,n)},primeCacheWithVectorImageResourceFactory:function(e,t){g.put(e,t)},loadImageInfoForPage:function(e){return l.loadImagesForUri(e)},loadImageInfoForDocVersion:function(e){return l.loadImagesForRestUri(e)},createImageUri:function(e,t){return"/v1/account/"+n.accountSlug+"/"+e+"/"+t},createImageResourceUrl:function(e,t,i){return n.isStudio?m.createImageProxyUri(e,t,i):n.isExported?m.createExportUrl(e,t):m.createMediaUrl(e,t,i)},createImageProxyUri:function(t,i,n){t+="/proxy";var r={};return e.isNumber(i)&&(r.width=i),e.isObject(n)&&(r.crop=f.createCropDimensionsString(n)),s.appendQueryParams(t,r,!0)},createMediaUrl:function(t,i,n){var r=u.get(t),o=e.get(r,"url");if(!e.isString(o))return"";var a={imageOpt:1};return e.isNumber(i)&&(a.fit="bounds",a.width=i),e.isObject(n)&&(a.crop=f.createCropDimensionsString(n)),o=s.appendQueryParams(o,a,!0),s.replaceProtocolIfHttpsRequest(o)},createExportUrl:function(t,i){var n=u.get(t),r=e.get(n,"thumbnails");if(!e.isObject(r))return"";var s=o.getComponentImageThumbnail(r,i);return e.get(s,"url","")},getRasterImageResourceCache:function(){return p},getVectorImageResourceFactoryCache:function(){return g}};return m}),define("cssresource",["jquery","lodash"],function(e,t){"use strict";var i=function(i){return this.url=i,this.deferred=e.Deferred(),this.cssLinkResource=e("<link>",{rel:"stylesheet",type:"text/css",href:i}),this.data=this.cssLinkResource,this.cssLinkResource.on("load",t.bind(function(){this.deferred.resolve()},this)),this.cssLinkResource.appendTo("head"),this};return i.prototype={onload:function(){return this.deferred.done.apply(this.deferred,arguments),this.deferred},ready:function(){return"resolved"==this.deferred.state()},remove:function(){delete this.cssLinkResource}},i}),define("shared/utils/ResourceLoader",["log","jquery","lodash","device"],function(e,t,i,n){"use strict";var r={},o=0,s=n.desktop()?2:1,a=!1,u={PENDING:1,LOADING:2,LOADED:3,ERROR:4,CANCELED:5},l=function(){this.queue=[],this.finished=t.Deferred()};l.prototype=i.extend(l.prototype,{push:function(e){this.queue.push(e)},getNextItem:function(){if(0===this.length())return null;var e=this.queue.shift();return 0===this.length()&&(this.finished.resolve(),this.finished=t.Deferred()),e},length:function(){return this.queue.length},flush:function(){this.queue=[],this.finished.resolve(),this.finished=t.Deferred()},onFinish:function(e){this.finished.done(e)}});var c=new l,h=new l,d=function(e){h.onFinish(e)},f=function(n,r,o){var s=u.PENDING,a=new t.Deferred;this.getStatus=function(){return s},this.setStatus=function(e){i.includes(i.values(u),e)&&(s=e)},this.getPromise=function(){return a.promise()},this.load=function(){s=u.LOADING;var l=i.isFunction(r)?r():t.noop();return l.promise?(l.then(function(){s=u.LOADED,a.resolve.apply(this,arguments)},function(){s=u.ERROR,a.reject(),e.devWarn("Resource failed to load",{key:n})}),l.always(function(){i.isFunction(o)&&o()}),this.getPromise()):(a.reject(),e.warn("onLoadBegin must be a function that returns a deferred promise and resolves with necessary resource data",{key:n}),this.getPromise())},this.getKey=function(){return n}};f.prototype.loadNow=function(){return this.getStatus()===u.PENDING&&(h.push(this),w()),this.getPromise()},f.prototype.isLoading=function(){return this.getStatus()===u.LOADING},f.prototype.isLoaded=function(){return this.getStatus()===u.LOADED},f.prototype.isError=function(){return this.getStatus()===u.ERROR},f.prototype.isPending=function(){return this.getStatus()==u.PENDING},f.prototype.isCanceled=function(){return this.getStatus()==u.CANCELED},f.prototype.cancel=function(){this.setStatus(u.CANCELED)};var p=function(e){return r.hasOwnProperty(e)},g=function(t){return i.isNull(t)||i.isUndefined(t)?null:r.hasOwnProperty(t)?r[t].isError()?(e.warn("An error was encountered while trying to load the resource",{key:t}),null):r[t]:(e.warn("No resource exists for the provided key",{key:t}),null)},m=function(){for(h.flush();c.length()>0;){c.getNextItem().status=u.CANCELED}},v=function(e,t,n){if(i.isNull(e)||i.isUndefined(e))return null;if(r.hasOwnProperty(e))r[e].isCanceled()&&(r[e].setStatus(u.PENDING),c.push(r[e]));else{var o=new f(e,t,n);r[e]=o,c.push(o)}return w(),r[e]},y=t.Deferred(),b=function(e){y.done(e)},w=function(){if(!(o>=s&&0===h.length())){var e=T();if(i.isNull(e))return void y.resolve();o++,e.load().always(function(){o--,w()})}},E=function(){a=!0},_=function(){a&&(a=!1,w())},T=function(){var e=null;return h.length()>0&&(e=S(h)),a?e:(i.isNull(e)&&(e=S(c)),e)},S=function(e){for(var t=null;e.length()>0&&(t=e.getNextItem(),!t.isPending());)t=null;return t};return{add:v,get:g,has:p,cancelPending:m,pause:E,resume:_,onPriorityQueueCompletion:d,onAllResourcesLoaded:b,purgeResourceCache:function(){r={}}}}),define("shared/utils/CerosResourceLoader",["log","jquery","lodash","device","globals","modules/page/utils/TextUtil","libs/image/ImageResource","libs/image/ImageResourceService","cssresource","shared/utils/ResourceLoader","VectorImageUtils","libs/image/VectorImageResourceFactory","webfont","ImageCroppingUtils"],function(e,t,i,n,r,o,s,a,u,l,c,h,d,f){"use strict";function p(e,t,i){var n=T(e,t,i),r=function(){return a.getOrCreateRasterImageResource(e,t,i)};return l.add(n,r)}function g(e){var t=function(){return new h(e).getPromise()};return l.add(e,t)}function m(e){if(l.has(e))return l.get(e);var t=function(){return new u(e).deferred.promise()};return l.add(e,t)}function v(e,n,r){if(l.has(n))return l.get(n);i.isArray(e)||(e=[e]),i.isArray(n)||(n=[n]);var o={families:e,urls:n};i.isUndefined(r)||(o.testStrings={},i.isObject(r)?i.each(e,function(e){i.isUndefined(r[e])||(o.testStrings[e]=r[e])}):i.each(e,function(e){o.testStrings[e]=r}));var s=function(){var n=[],r={};return i.each(e,function(e){var i=new t.Deferred;n.push(i),r[e]=i}),d.load({custom:o,async:!0,fontactive:function(e){r[e].resolve()},fontinactive:function(e){r[e].reject()}}),t.when.apply(t,n).promise()};return l.add(n,s)}function y(e){e=e.split(":")[0];var t=r.googleFontUrl+"/"+e+".css";return v(e,t,void 0)}function b(e){if(r.googleFontUrl)return y(e);if(l.has(e))return l.get(e);var i=function(){var i=new t.Deferred;return d.load({google:{families:[e]},async:!0,fontactive:function(){i.resolve()},fontinactive:function(){i.reject()}}),i.promise()};return l.add(e,i)}function w(e){return l.get(e)}function E(e){return l.has(e)}function _(){return l.cancelPending()}function T(e,t,n){i.isNull(t)&&(t="full");var r=e+"|"+t;return f.isValidCropObject(n)&&(r+="|"+f.createCropDimensionsString(n)),r}return{get:w,addRasterImage:p,addVectorImage:g,addCss:m,addGoogleWebFont:b,addCustomWebFont:v,has:E,cancelPending:_,pause:l.pause,resume:l.resume,onPriorityQueueCompletion:l.onPriorityQueueCompletion,onAllResourcesLoaded:l.onAllResourcesLoaded}}),define("shared/utils/ModuleEventManager",["lodash","jquery","log","backbone"],function(e,t,i,n){"use strict";return e.extend({events:{},unregisteredHandlers:{},registerEvents:function(t,i){e.each(t,e.bind(function(t){this.events[t]=i,this.unregisteredHandlers[t]&&(e.each(this.unregisteredHandlers[t],e.bind(function(e){this.on(t,e)},this)),this.unregisteredHandlers[t]=null)},this))}},n.Events)}),define("shared/models/EmbeddedViewportModel",["log","globals","lodash","backbone"],function(e,t,i,n){"use strict";var r=null,o=n.Model.extend({defaults:{top:null,bottom:null,windowWidth:null,windowHeight:null},validPositionProperties:["top","bottom","windowWidth","windowHeight"],setPositionData:function(e){var t=i.pick(e,this.validPositionProperties);this.set(t)},getTop:function(){return this.get("top")},getBottom:function(){return this.get("bottom")},getWindowWidth:function(){return this.get("windowWidth")},getWindowHeight:function(){return this.get("windowHeight")},getVerticalCenterOfVisibleArea:function(e){var t=Math.max(this.getTop(),0);return(Math.min(this.getBottom(),e)-t)/2+t},getEmbedContextDimensions:function(){var e=this.getWindowWidth(),n=this.getWindowHeight();return t.allowAdaptiveLayouts&&!1===i.isNull(e)&&!1===i.isNull(n)?{width:e,height:n}:{width:window.innerWidth,height:window.innerHeight}},isActive:function(){return null!==this.get("top")&&null!==this.get("bottom")}},{getInstance:function(){return r||(r=new o),r}});return o}),define("shared/utils/ScrollProxy",["log","lodash","jquery","backbone","shared/models/EmbeddedViewportModel"],function(e,t,i,n,r){"use strict";var o="ceros-embedded-viewport:",s={PING:"ping",READY:"ready",POSITION:"position",SCROLL_TO:"scroll-to",UPDATE_POSITION:"update-position",GOTO_URL:"goto-url",VARIANT_DETECTION:"variant-detection"},a=t.extend({EVENTS:s},n.Events),u=function(e){r.getInstance().setPositionData(e),a.trigger(s.UPDATE_POSITION,e)},l=function(e){var t=null;try{t=JSON.parse(e.originalEvent.data)}catch(e){}if(t&&t.event&&t.event.substr(0,o.length)===o)switch(t.event.substr(o.length)){case s.PING:d();break;case s.POSITION:u(t)}},c=function(e,i){var n=JSON.stringify(t.extend({event:o+e},i));window.parent.postMessage(n,"*")},h=null,d=function(){c(s.READY,{issueSlug:h})},f=function(e){c(s.VARIANT_DETECTION,{variant:e})};return a=t.extend(a,{init:function(e){h=e,d(),i(window).on("message",l)},announceScrollTo:function(e){c(s.SCROLL_TO,e)},announceGotoUrl:function(e,t){c(s.GOTO_URL,{url:e,urlOpenInNewWindow:t})},announceVariantDetection:function(e){f(e)}})}),function(e,t){"object"==typeof exports&&exports&&"string"!=typeof exports.nodeName?t(exports):"function"==typeof define&&define.amd?define("mustache",["exports"],t):(e.Mustache={},t(e.Mustache))}(this,function(e){function t(e){return"function"==typeof e}function i(e){return g(e)?"array":typeof e}function n(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function r(e,t){return null!=e&&"object"==typeof e&&t in e}function o(e,t){return m.call(e,t)}function s(e){return!o(v,e)}function a(e){return String(e).replace(/[&<>"'`=\/]/g,function(e){return y[e]})}function u(t,i){function r(e){if("string"==typeof e&&(e=e.split(w,2)),!g(e)||2!==e.length)throw new Error("Invalid tags: "+e);o=new RegExp(n(e[0])+"\\s*"),a=new RegExp("\\s*"+n(e[1])),u=new RegExp("\\s*"+n("}"+e[1]))}if(!t)return[];var o,a,u,d=[],f=[],p=[],m=!1,v=!1;r(i||e.tags);for(var y,S,A,P,I,x,C=new h(t);!C.eos();){if(y=C.pos,A=C.scanUntil(o))for(var R=0,k=A.length;R<k;++R)P=A.charAt(R),s(P)?p.push(f.length):v=!0,f.push(["text",P,y,y+1]),y+=1,"\n"===P&&function(){if(m&&!v)for(;p.length;)delete f[p.pop()];else p=[];m=!1,v=!1}();if(!C.scan(o))break;if(m=!0,S=C.scan(T)||"name",C.scan(b),"="===S?(A=C.scanUntil(E),C.scan(E),C.scanUntil(a)):"{"===S?(A=C.scanUntil(u),C.scan(_),C.scanUntil(a),S="&"):A=C.scanUntil(a),
!C.scan(a))throw new Error("Unclosed tag at "+C.pos);if(I=[S,A,y,C.pos],f.push(I),"#"===S||"^"===S)d.push(I);else if("/"===S){if(!(x=d.pop()))throw new Error('Unopened section "'+A+'" at '+y);if(x[1]!==A)throw new Error('Unclosed section "'+x[1]+'" at '+y)}else"name"===S||"{"===S||"&"===S?v=!0:"="===S&&r(A)}if(x=d.pop())throw new Error('Unclosed section "'+x[1]+'" at '+C.pos);return c(l(f))}function l(e){for(var t,i,n=[],r=0,o=e.length;r<o;++r)(t=e[r])&&("text"===t[0]&&i&&"text"===i[0]?(i[1]+=t[1],i[3]=t[3]):(n.push(t),i=t));return n}function c(e){for(var t,i,n=[],r=n,o=[],s=0,a=e.length;s<a;++s)switch(t=e[s],t[0]){case"#":case"^":r.push(t),o.push(t),r=t[4]=[];break;case"/":i=o.pop(),i[5]=t[2],r=o.length>0?o[o.length-1][4]:n;break;default:r.push(t)}return n}function h(e){this.string=e,this.tail=e,this.pos=0}function d(e,t){this.view=e,this.cache={".":this.view},this.parent=t}function f(){this.cache={}}var p=Object.prototype.toString,g=Array.isArray||function(e){return"[object Array]"===p.call(e)},m=RegExp.prototype.test,v=/\S/,y={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"},b=/\s*/,w=/\s+/,E=/\s*=/,_=/\s*\}/,T=/#|\^|\/|>|\{|&|=|!/;h.prototype.eos=function(){return""===this.tail},h.prototype.scan=function(e){var t=this.tail.match(e);if(!t||0!==t.index)return"";var i=t[0];return this.tail=this.tail.substring(i.length),this.pos+=i.length,i},h.prototype.scanUntil=function(e){var t,i=this.tail.search(e);switch(i){case-1:t=this.tail,this.tail="";break;case 0:t="";break;default:t=this.tail.substring(0,i),this.tail=this.tail.substring(i)}return this.pos+=t.length,t},d.prototype.push=function(e){return new d(e,this)},d.prototype.lookup=function(e){var i,n=this.cache;if(n.hasOwnProperty(e))i=n[e];else{for(var o,s,a=this,u=!1;a;){if(e.indexOf(".")>0)for(i=a.view,o=e.split("."),s=0;null!=i&&s<o.length;)s===o.length-1&&(u=r(i,o[s])),i=i[o[s++]];else i=a.view[e],u=r(a.view,e);if(u)break;a=a.parent}n[e]=i}return t(i)&&(i=i.call(this.view)),i},f.prototype.clearCache=function(){this.cache={}},f.prototype.parse=function(e,t){var i=this.cache,n=i[e];return null==n&&(n=i[e]=u(e,t)),n},f.prototype.render=function(e,t,i){var n=this.parse(e),r=t instanceof d?t:new d(t);return this.renderTokens(n,r,i,e)},f.prototype.renderTokens=function(e,t,i,n){for(var r,o,s,a="",u=0,l=e.length;u<l;++u)s=void 0,r=e[u],o=r[0],"#"===o?s=this.renderSection(r,t,i,n):"^"===o?s=this.renderInverted(r,t,i,n):">"===o?s=this.renderPartial(r,t,i,n):"&"===o?s=this.unescapedValue(r,t):"name"===o?s=this.escapedValue(r,t):"text"===o&&(s=this.rawValue(r)),void 0!==s&&(a+=s);return a},f.prototype.renderSection=function(e,i,n,r){function o(e){return s.render(e,i,n)}var s=this,a="",u=i.lookup(e[1]);if(u){if(g(u))for(var l=0,c=u.length;l<c;++l)a+=this.renderTokens(e[4],i.push(u[l]),n,r);else if("object"==typeof u||"string"==typeof u||"number"==typeof u)a+=this.renderTokens(e[4],i.push(u),n,r);else if(t(u)){if("string"!=typeof r)throw new Error("Cannot use higher-order sections without the original template");u=u.call(i.view,r.slice(e[3],e[5]),o),null!=u&&(a+=u)}else a+=this.renderTokens(e[4],i,n,r);return a}},f.prototype.renderInverted=function(e,t,i,n){var r=t.lookup(e[1]);if(!r||g(r)&&0===r.length)return this.renderTokens(e[4],t,i,n)},f.prototype.renderPartial=function(e,i,n){if(n){var r=t(n)?n(e[1]):n[e[1]];return null!=r?this.renderTokens(this.parse(r),i,n,r):void 0}},f.prototype.unescapedValue=function(e,t){var i=t.lookup(e[1]);if(null!=i)return i},f.prototype.escapedValue=function(t,i){var n=i.lookup(t[1]);if(null!=n)return e.escape(n)},f.prototype.rawValue=function(e){return e[1]},e.name="mustache.js",e.version="2.2.1",e.tags=["{{","}}"];var S=new f;e.clearCache=function(){return S.clearCache()},e.parse=function(e,t){return S.parse(e,t)},e.render=function(e,t,n){if("string"!=typeof e)throw new TypeError('Invalid template! Template should be a "string" but "'+i(e)+'" was given as the first argument for mustache#render(template, view, partials)');return S.render(e,t,n)},e.to_html=function(i,n,r,o){var s=e.render(i,n,r);if(!t(o))return s;o(s)},e.escape=a,e.Scanner=h,e.Context=d,e.Writer=f}),define("modules/page/utils/PlayerVariantService",["lodash","backbone","jquery","globals","urlUtils","cerosMath"],function(e,t,i,n,r,o){"use strict";var s,a={tablet:{height:4,width:3},mobile:{height:16,width:9}},u={tablet:{height:1.2,width:1.11},mobile:{height:1.2,width:1.11},desktop:{height:1,width:1}},l={tablet:110,mobile:90,desktop:70},c={tablet:50,mobile:50,desktop:0},h=["desktop","tablet","mobile"];return e.extend({},t.Events,{fullScreenMode:!1,previewerFrameSize:"desktop",setPreviewerFrameSize:function(e){this.previewerFrameSize=e,this.trigger("resizePreviewerFrame",{variant:e})},getPreviewerFrameSize:function(){return this.previewerFrameSize},setDocVersion:function(e){s=e},isDocVersionSet:function(){return!e.isUndefined(s)},doesVariantExist:function(t){return e.includes(e.keys(s.get("overrides")),t)},hasVariants:function(){return n.allowAdaptiveLayouts&&this.getNumberOfExistingVariants()>0},getNumberOfExistingVariants:function(){return e.keys(s.get("overrides")).length},getExistingVariants:function(){return e.keys(s.get("overrides"))},getLayoutSettings:function(){return s.get("layoutSettings")},isViewportWidthDetection:function(){return"viewport-width"===this.getLayoutSettings().layoutPrimarySetting},getExperienceContainerDimensions:function(e){var t=this.fullScreenMode;if(n.previewMode&&n.allowAdaptiveLayouts&&!t){var i=this.getPreviewerFrameSize(),r=e.height()-(l[i]+c[i]),s=Math.max(r/u[i].height,300),h="desktop"===i?e.width():s*(a[i].width/a[i].height);return{width:o.toNextMultiple(h,2),height:o.toNextMultiple(s,2)}}return{width:e.width(),height:e.height()}},getExperienceContainerWidth:function(e){return this.getExperienceContainerDimensions(e).width},getExperienceContainerHeight:function(e){return this.getExperienceContainerDimensions(e).height},getFrameNameFromQueryParam:function(){if(n.previewMode){return r.getUrlParams(window.location.href).layout||"desktop"}},getValidFrameNameOrDesktopFromQueryParams:function(){var e=this.getFrameNameFromQueryParam();return this.queryParamFrameNameIsValid(e)?e:"desktop"},queryParamFrameNameIsValid:function(e){var t=e||this.getFrameNameFromQueryParam();return this.isViewportWidthDetection()?this.doesVariantExist(t):this.isValidVariantName(t)},isValidVariantName:function(t){return e.includes(h,t)},getLeftRightBorderWidth:function(e,t,i){return(i||this.getExperienceContainerDimensions(e).width)*(u[t].width-1)/2},getTopBottomBorderWidth:function(e,t,i){return(i||this.getExperienceContainerDimensions(e).height)*(u[t].height-1)/2},setFullScreenMode:function(e){this.fullScreenMode=e;var t=i(".adaptive-layouts-frame");this.fullScreenMode?(i(".previewer-selection-header").hide(),t.addClass("-full-screen-mode"),t.css({width:i(window).width(),height:i(window).height()}),i(window).trigger("resize")):(i(".previewer-selection-header").show(),t.removeClass("-full-screen-mode"),"desktop"!==this.getValidFrameNameOrDesktopFromQueryParams()&&t.css({"border-style":"solid"}),i(window).trigger("resize"))},VALID_VARIANT_NAMES:h,PREVIEWER_TOP_PADDING_BY_VARIANT:l,PREVIEWER_FRAME_PROPORTION_FACTORS_BY_VARIANT:u})}),define("modules/page/utils/PlayerVariantDetector",["lodash","jquery","backbone","device","globals","log","modules/page/utils/PlayerVariantService","shared/models/EmbeddedViewportModel"],function(e,t,i,n,r,o,s,a){"use strict";function u(){var e=n.deviceType();return"smartphone"===e&&(e="mobile"),e}var l,c=function(){var e=window.innerWidth;return d(e)},h=function(){var e=a.getInstance().getEmbedContextDimensions();return d(e.width)},d=function(e){var t=s.getLayoutSettings();return s.doesVariantExist("mobile")&&e<=t.maxMobileWidthBreakpoint?"mobile":s.doesVariantExist("tablet")&&e<=t.maxTabletWidthBreakpoint?"tablet":"desktop"},f=function(){var e=s.getLayoutSettings(),i=u(),r=i!==n.DEVICE_TYPE_DESKTOP;if(r&&s.setFullScreenMode(!0),"device-type"===e.layoutPrimarySetting){if(r)return p(e,i);var o=s.getPreviewerFrameSize();return m(o)}var a=t(".adaptive-layouts-frame").width();return d(a)},p=function(e,t){return s.doesVariantExist(t)?t:s.doesVariantExist(e.deviceTypeMissingVariantFallback)?e.deviceTypeMissingVariantFallback:"desktop"},g=function(){return m(u())},m=function(e){var t=s.getLayoutSettings();return 0!==s.getNumberOfExistingVariants()&&s.isValidVariantName(e)?"desktop"===e||s.doesVariantExist(e)?e:t.deviceTypeMissingVariantFallback:"desktop"},v=function(){if(!r.allowAdaptiveLayouts)return"desktop";if(!s.isDocVersionSet())throw new Error("Trying to resolve variant before DocVersion set");return 0===s.getNumberOfExistingVariants()?"desktop":r.previewMode?f():"device-type"===s.getLayoutSettings().layoutPrimarySetting?g():r.isEmbedded?h():c()};return e.extend({},i.Events,{getVariant:function(){if(!l)throw new Error("Something wants to know the variant before detection");return l},hasDetectedVariant:function(){return!!l},detect:function(){var e=v();if(e!==l){var t=l;l=e,o.debug("Detected variant "+e+(t?", was "+t:"")),this.trigger("change",l,t)}return l}})}),define("text",["module"],function(e){"use strict";var t,i,n,r,o,s=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],a=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,u=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,l="undefined"!=typeof location&&location.href,c=l&&location.protocol&&location.protocol.replace(/\:/,""),h=l&&location.hostname,d=l&&(location.port||void 0),f={},p=e.config&&e.config()||{};return t={version:"2.0.14",strip:function(e){if(e){e=e.replace(a,"");var t=e.match(u);t&&(e=t[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:p.createXhr||function(){var e,t,i;if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;if("undefined"!=typeof ActiveXObject)for(t=0;t<3;t+=1){i=s[t];try{e=new ActiveXObject(i)}catch(e){}if(e){s=[i];break}}return e},parseName:function(e){var t,i,n,r=!1,o=e.lastIndexOf("."),s=0===e.indexOf("./")||0===e.indexOf("../");return-1!==o&&(!s||o>1)?(t=e.substring(0,o),i=e.substring(o+1)):t=e,n=i||t,o=n.indexOf("!"),-1!==o&&(r="strip"===n.substring(o+1),n=n.substring(0,o),i?i=n:t=n),{moduleName:t,ext:i,strip:r}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,i,n,r){var o,s,a,u=t.xdRegExp.exec(e);return!u||(o=u[2],s=u[3],s=s.split(":"),a=s[1],s=s[0],!(o&&o!==i||s&&s.toLowerCase()!==n.toLowerCase()||(a||s)&&a!==r))},finishLoad:function(e,i,n,r){n=i?t.strip(n):n,p.isBuild&&(f[e]=n),r(n)},load:function(e,i,n,r){if(r&&r.isBuild&&!r.inlineText)return void n();p.isBuild=r&&r.isBuild;var o=t.parseName(e),s=o.moduleName+(o.ext?"."+o.ext:""),a=i.toUrl(s),u=p.useXhr||t.useXhr;if(0===a.indexOf("empty:"))return void n();!l||u(a,c,h,d)?t.get(a,function(i){t.finishLoad(e,o.strip,i,n)},function(e){n.error&&n.error(e)}):i([s],function(e){t.finishLoad(o.moduleName+"."+o.ext,o.strip,e,n)})},write:function(e,i,n,r){if(f.hasOwnProperty(i)){var o=t.jsEscape(f[i]);n.asModule(e+"!"+i,"define(function () { return '"+o+"';});\n")}},writeFile:function(e,i,n,r,o){var s=t.parseName(i),a=s.ext?"."+s.ext:"",u=s.moduleName+a,l=n.toUrl(s.moduleName+a)+".js";t.load(u,n,function(i){var n=function(e){return r(l,e)};n.asModule=function(e,t){return r.asModule(e,l,t)},t.write(e,u,n,o)},o)}},"node"===p.env||!p.env&&"undefined"!=typeof process&&process.versions&&process.versions.node&&!process.versions["node-webkit"]&&!process.versions["atom-shell"]?(i=require.nodeRequire("fs"),t.get=function(e,t,n){try{var r=i.readFileSync(e,"utf8");"\ufeff"===r[0]&&(r=r.substring(1)),t(r)}catch(e){n&&n(e)}}):"xhr"===p.env||!p.env&&t.createXhr()?t.get=function(e,i,n,r){var o,s=t.createXhr();if(s.open("GET",e,!0),r)for(o in r)r.hasOwnProperty(o)&&s.setRequestHeader(o.toLowerCase(),r[o]);p.onXhr&&p.onXhr(s,e),s.onreadystatechange=function(t){var r,o;4===s.readyState&&(r=s.status||0,r>399&&r<600?(o=new Error(e+" HTTP status: "+r),o.xhr=s,n&&n(o)):i(s.responseText),p.onXhrComplete&&p.onXhrComplete(s,e))},s.send(null)}:"rhino"===p.env||!p.env&&"undefined"!=typeof Packages&&"undefined"!=typeof java?t.get=function(e,t){var i,n,r=new java.io.File(e),o=java.lang.System.getProperty("line.separator"),s=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(r),"utf-8")),a="";try{for(i=new java.lang.StringBuffer,n=s.readLine(),n&&n.length()&&65279===n.charAt(0)&&(n=n.substring(1)),null!==n&&i.append(n);null!==(n=s.readLine());)i.append(o),i.append(n);a=String(i.toString())}finally{s.close()}t(a)}:("xpconnect"===p.env||!p.env&&"undefined"!=typeof Components&&Components.classes&&Components.interfaces)&&(n=Components.classes,r=Components.interfaces,Components.utils.import("resource://gre/modules/FileUtils.jsm"),o="@mozilla.org/windows-registry-key;1"in n,t.get=function(e,t){var i,s,a,u={};o&&(e=e.replace(/\//g,"\\")),a=new FileUtils.File(e);try{i=n["@mozilla.org/network/file-input-stream;1"].createInstance(r.nsIFileInputStream),i.init(a,1,0,!1),s=n["@mozilla.org/intl/converter-input-stream;1"].createInstance(r.nsIConverterInputStream),s.init(i,"utf-8",i.available(),r.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),s.readString(i.available(),u),s.close(),i.close(),t(u.value)}catch(e){throw new Error((a&&a.path||"")+": "+e)}}),t}),define("text!applications/html5-player/templates/previewer-selection.html",[],function(){return'<ul class="previewer-options-list {{#allLayoutsExist}}-all-layouts-exist{{/allLayoutsExist}}">\n    <li class="previewer-variant-option desktop-option" data-option="desktop"><div class="desktop-option-icon"></div></li>\n    {{#showTablet}}<li class="previewer-variant-option tablet-option" data-option="tablet"><div class="tablet-option-icon"></div></li>{{/showTablet}}\n    {{#showMobile}}<li class="previewer-variant-option mobile-option" data-option="mobile"><div class="mobile-option-icon"></div></li>{{/showMobile}}\n</ul>'}),define("applications/html5-player/PreviewerSelectionView",["backbone","mustache","lodash","jquery","modules/page/utils/PlayerVariantService","modules/page/utils/PlayerVariantDetector","text!applications/html5-player/templates/previewer-selection.html"],function(e,t,i,n,r,o,s){"use strict";return e.View.extend({events:{"click .previewer-variant-option":"handleOptionClick"},initialize:function(){var e=r.isViewportWidthDetection();this.$el.html(t.render(s,{showTablet:!e||r.doesVariantExist("tablet"),showMobile:!e||r.doesVariantExist("mobile"),allLayoutsExist:!e||2===r.getNumberOfExistingVariants()})),o.on("change",i.bind(this.updateIcons,this)),this.updateIcons()},updateIcons:function(){var e=r.getPreviewerFrameSize();this.$el.find(".previewer-variant-option").removeClass("-selected");var t="."+e+"-option";this.$el.find(t).addClass("-selected")},handleOptionClick:function(e){var t=n(e.currentTarget),i=t.data("option");i!==r.getPreviewerFrameSize()&&(r.setPreviewerFrameSize(i),this.updateIcons())}})}),function(e,t){"use strict";"undefined"!=typeof exports?t(exports):"function"==typeof define&&define.amd?define("utils/Keycodes",["exports"],t):t(e)}(this,function(e){"use strict";return e.Keycodes={NIL:0,ESC:27,SHIFT:16,CTRL:17,LEFT_CMD:91,ALT:18,RETURN:13,ENTER:13,BACKSPACE:8,DELETE:46,SPACE:32,TAB:9,HOME:36,END:35,RIGHT_ARROW:39,LEFT_ARROW:37,UP_ARROW:38,DOWN_ARROW:40,EQUALS_FF:61,EQUALS_WEBKIT:187,MINUS_FF:173,MINUS_WEBKIT:189,ZERO:48,ONE:49,SEMICOLON:186,SEMICOLON_FIREFOX:59,BRACKET_OPEN:219,BRACKET_CLOSE:221,A:65,C:67,D:68,E:69,G:71,H:72,J:74,K:75,L:76,R:82,V:86,X:88,Y:89,Z:90,COMMA:188,PERIOD:190},e.Keycodes}),define("utils/KeyboardUtils",["device","utils/Keycodes"],function(e,t){"use strict";var i={isMetaKeyPressed:function(e){return/Mac OS/.test(navigator.userAgent)?e.metaKey:e.ctrlKey},isAltKeyPressed:function(e){return e.altKey||e.which===t.ALT},isSemicolonKeyPressed:function(i){var n=e.mozilla?t.SEMICOLON_FIREFOX:t.SEMICOLON;return i.which===n},isMacCtrlKeyPressed:function(e){return!!/Mac OS/.test(navigator.userAgent)&&e.ctrlKey},isDeleteKeyPressed:function(e){return e.which===t.DELETE},isBackspaceKeyPressed:function(e){return e.which===t.BACKSPACE},isEscKeyPressed:function(e){return e.which===t.ESC},isEnterKeyPressed:function(e){return e.which===t.ENTER},isArrowKey:function(e){return e==t.RIGHT_ARROW||e==t.LEFT_ARROW||e==t.UP_ARROW||e==t.DOWN_ARROW},isShiftKeyPressed:function(e){return e.shiftKey||e.which===t.SHIFT},isAKeyPressed:function(e){return e.which===t.A},isEKeyPressed:function(e){return e.which===t.E},isGKeyPressed:function(e){return e.which===t.G},isCommandZPressed:function(e){return i.isMetaKeyPressed(e)&&e.which===t.Z},isUndoCombinationPressed:function(e){return i.isCommandZPressed(e)&&!e.shiftKey},isCommandYPressed:function(e){return i.isMetaKeyPressed(e)&&e.which===t.Y},isCommandShiftZPressed:function(e){return i.isCommandZPressed(e)&&e.shiftKey},isRedoCombinationPressed:function(e){return i.isCommandYPressed(e)||i.isCommandShiftZPressed(e)},isHKeyPressed:function(e){return e.which===t.H},isInputNavigation:function(e){return-1!==[t.DELETE,t.BACKSPACE,t.TAB,t.ESCAPE,t.ENTER,t.SHIFT,t.CTRL,t.LEFT_CMD].indexOf(e.which)||-1!==[t.A,t.C,t.R,t.X,t.Z].indexOf(e.which)&&this.isMetaKeyPressed(e)||-1!==[t.HOME,t.END,t.LEFT_ARROW,t.RIGHT_ARROW].indexOf(e.which)},isInteger:function(e){return e.keyCode>=48&&e.keyCode<=57||e.keyCode>=96&&e.keyCode<=105}};return i}),define("applications/html5-player/AdaptiveLayoutsPreviewerFrameView",["jquery","backbone","lodash","globals","text!applications/html5-player/templates/previewer-selection.html","modules/page/utils/PlayerVariantService","modules/page/utils/PlayerVariantDetector","utils/KeyboardUtils","device"],function(e,t,i,n,r,o,s,a,u){"use strict";return t.View.extend({initialize:function(){var t=this;this.frameName=o.getPreviewerFrameSize(),this.$el.addClass("-"+this.frameName),this.styleFrame(),e(window).on("resize",function(){t.styleFrame()}),e(window).on("keyup",function(i){a.isHKeyPressed(i)&&!o.fullScreenMode?(o.setFullScreenMode(!0),e(".previewer-selection-header").hide(),t.$el.addClass("-full-screen-mode"),t.$el.css({width:e(window).width(),height:e(window).height()}),e(window).trigger("resize")):(a.isEscKeyPressed(i)||a.isHKeyPressed(i))&&o.fullScreenMode&&(o.setFullScreenMode(!1),e(".previewer-selection-header").show(),t.$el.removeClass("-full-screen-mode"),e(window).trigger("resize"))}),o.on("resizePreviewerFrame",function(i){t.$el.removeClass("-"+t.frameName),t.frameName=i.variant,t.$el.addClass("-"+t.frameName),t.styleFrame(),s.detect(),e(window).trigger("resize")})},getThemeBackgroundColor:function(){return i.get(n,["themeObj","backgroundColor"],null)},styleFrame:function(){var t=e(window);if(o.fullScreenMode)return void this.$el.css({width:t.width(),height:t.height()});var i=o.getExperienceContainerDimensions(t);if(this.$el.css({width:i.width,height:i.height,backgroundColor:this.getThemeBackgroundColor()}),"desktop"!==this.frameName){var n=o.getTopBottomBorderWidth(e(window),this.frameName,i.height),r=o.getLeftRightBorderWidth(e(window),this.frameName,i.width),s=Math.round(n),a=Math.round(r);this.$el.css({"border-top-width":s,"border-bottom-width":s,"border-left-width":a,"border-right-width":a})}},showFadingHelpMessage:function(){u.mobile()||e(".fit-to-window-help-message").show().delay(3e3).fadeOut(400)}})}),define("ceros",["require","lodash","jquery","backbone"],function(e,t,i,n){"use strict";var r={};return r.Module=function(e){t.extend(this,e),this.status=r.Module.STATUS.PENDING,e.delegate&&this.setDelegate(e.delegate)},t.extend(r.Module.prototype,n.Events,{setDelegate:function(e){if(!t.isObject(e))throw Error("invalid module delegate!");for(var i in e)!this.hasOwnProperty(i)&&e.hasOwnProperty(i)&&t.isFunction(e[i])&&(this[i]=t.bind(e[i],e))},getModule:function(e){return this.application.getModule(e)},setApplication:function(e){this.application=e},getApplication:function(){return this.application},getDependency:function(e){return this.application.getModule(e)},setStatus:function(e){this.status=e},getStatus:function(){return this.status},getDeferredLoadingTimeout:function(){return r.Application.DEFERRED_LOADING_TIMEOUT}}),r.Module.extend=n.View.extend,r.Module.STATUS={PENDING:1,LOADED:2,STARTED:4},r.Application=function(e){this.initCallbacks=new r.Callbacks,this.modules={};var n=this;this.loadedAllModules=(new i.Deferred).progress(function(e){n._loadModule(e),n._allLoaded()&&this.resolve()}),t.extend(this,e)},t.extend(r.Application.prototype,n.Events,{_allLoaded:function(){return t.every(t.values(this.modules),function(e){return e&&e.getStatus()===r.Module.STATUS.LOADED})},_loadModule:function(e){if(t.isUndefined(e)||t.isNull(e))throw Error("invalid module!");this.modules[e.id]=e,e.setApplication(this),e.trigger("load"),e.setStatus(r.Module.STATUS.LOADED),this.addInitializer(function(){e.trigger("start"),e.setStatus(r.Module.STATUS.STARTED)})},use:function(i){t.isString(i)?(this.modules[i]=null,e(["modules/"+i+"/module"],t.bind(function(e){if(!e)throw Error("could not load module: "+i);this.loadedAllModules.notify(e)},this))):this._loadModule(i)},getModule:function(e){return this.modules[e]},addInitializer:function(e){this.initCallbacks.add(e)},start:function(e){var n=t.bind(function(){this.trigger("initialize:before",e),this.initCallbacks.run(e,this),this.trigger("initialize:after",e),this.trigger("start",e)},this);this._allLoaded()?n():i.when(this.loadedAllModules).then(n)}}),r.Application.extend=n.View.extend,r.Application.DEFERRED_LOADING_TIMEOUT=5e3,r.Callbacks=function(){this.deferred=i.Deferred(),this.promise=this.deferred.promise()},t.extend(r.Callbacks.prototype,{add:function(e,t){this.promise.done(function(i,n){t&&(i=t),e.call(i,n)})},run:function(e,t){this.deferred.resolve(t,e)}}),r}),function(e,t){"use strict";"undefined"!=typeof exports?t(exports,require("lodash")):"function"==typeof define&&define.amd?define("color",["exports","lodash"],t):t(e,e._)}(this,function(e,t){"use strict";var i=function(e,i,n,r){var o=parseFloat(r);return(t.isUndefined(r)||t.isNaN(o))&&(o=1),null!==e&&(this.r=parseInt(e,10)),null!==i&&(this.g=parseInt(i,10)),null!==n&&(this.b=parseInt(n,10)),this.a=o,this};return i.prototype={toHex:function(){var e;return null===this.r||null===this.g||null===this.b?"transparent":(e=(this.b|this.g<<8|this.r<<16).toString(16),e="#"+"000000".substr(0,6-e.length)+e,e.toUpperCase())},isTransparent:function(){return!this.a},set:function(e){return t.each(e,t.bind(function(e,t){this[t]=e},this)),this},hsv:function(){var e={h:0,s:0,v:0},t=this.r/255,i=this.g/255,n=this.b/255,r=Math.min(t,Math.min(i,n)),o=Math.max(t,Math.max(i,n));if(r==o)return e.v=r,e;var s=t==r?i-n:n==r?t-i:n-t,a=t==r?3:n==r?1:5;return e.h=60*(a-s/(o-r)),e.s=(o-r)/o,e.v=o,e},rgb:function(){return{r:this.r,g:this.g,b:this.b}},rgba:function(){return{r:this.r,g:this.g,b:this.b,a:this.a}},cmyk:function(){var e={c:0,m:0,y:0,k:0},t=this.r/255,i=this.g/255,n=this.b/255;return e.k=Math.min(1-t,1-i,1-n),e.c=(1-t-e.k)/(1-e.k),e.m=(1-i-e.k)/(1-e.k),e.y=(1-n-e.k)/(1-e.k),isNaN(e.c)&&(e.c=0),isNaN(e.m)&&(e.m=0),isNaN(e.y)&&(e.y=0),e.c=Math.round(100*e.c),e.m=Math.round(100*e.m),e.y=Math.round(100*e.y),e.k=Math.round(100*e.k),e},contrastRatio:function(e){e=i.fromString(e);var t=this.relativeLuminance(),n=e.relativeLuminance();if(t<n){var r=t;t=n,n=r}return(t+.05)/(n+.05)},relativeLuminance:function(){var e=function(e){return e<.03928?e/12.92:Math.pow((e+.055)/1.055,2.4)};return.2126*e(this.r/255)+.7152*e(this.g/255)+.0722*e(this.b/255)},clone:function(){return new i(this.r,this.g,this.b,this.a)},cloneWithAlpha:function(e){var t=this.clone();return t.a=e,t},toString:function(){return null!==this.r&&null!==this.g&&null!==this.b?null!==this.a&&1!==this.a?"rgba("+this.r+", "+this.g+", "+this.b+", "+this.a+")":this.toHex():"transparent"},toValue:function(){return[this.r,this.g,this.b,this.a]}},i.fromHex=function(e){var t,n,r;return"#"===e[0]&&(e=e.substring(1,7)),3===e.length&&(e=e.charAt(0)+e.charAt(0)+e.charAt(1)+e.charAt(1)+e.charAt(2)+e.charAt(2)),r=parseInt(e.substring(0,2),16),n=parseInt(e.substring(2,4),16),t=parseInt(e.substring(4,6),16),new i(r,n,t)},i.fromHSV=function(e,n,r){t.isObject(e)&&(n=e.s,r=e.v,e=e.h);var o,s,a,u,l,c,h,d;if(0===n)return c=h=d=r,new i(255*c,255*h,255*d);switch(e/=60,o=Math.floor(e),s=e-o,a=r*(1-n),u=r*(1-n*s),l=r*(1-n*(1-s)),o){case 0:c=r,h=l,d=a;break;case 1:c=u,h=r,d=a;break;case 2:c=a,h=r,d=l;break;case 3:c=a,h=u,d=r;break;case 4:c=l,h=a,d=r;break;default:c=r,h=a,d=u}return new i(255*c,255*h,255*d)},i.fromCMYK=function(e,n,r,o){t.isObject(e)&&(n=e.m,r=e.y,o=e.k,e=e.c);var s=i.Black();return e/=100,n/=100,r/=100,o/=100,s.r=1-Math.min(1,e*(1-o)+o),s.g=1-Math.min(1,n*(1-o)+o),s.b=1-Math.min(1,r*(1-o)+o),s.r=Math.round(255*s.r),s.g=Math.round(255*s.g),s.b=Math.round(255*s.b),s},i.fromString=function(e){var t,n,r,o,s,a,u;if(e instanceof i)return e;var l=e.match(this.regex);return l?(s=l[1],a=l[2],s?i.fromHex(s):a?(u=a.split(/\s*,\s*/),t=u[0],n=u[1],r=u[2],o=u[3],new i(t,n,r,o)):void 0):null},i.regex=/(?:#([0-9a-f]{3,6})|rgba?\(([^)]+)\))/i,i.buildStops=function(e){return t.map(e,function(e){return i.fromString(e.color)+" "+parseInt(100*e.stop,10)+"%"}).join(",")},i.White=function(e){return new i(255,255,255,e)},i.Black=function(e){return new i(0,0,0,e)},i.Transparent=function(){return new i},i.getMostContrasting=function(e,t,n){return e=i.fromString(e),t=i.fromString(t),n=i.fromString(n),e.contrastRatio(t)>e.contrastRatio(n)?t:n},e.Color=i,window.Color=i,i}),function(e,t,i,n){"use strict";function r(e,t,i){return setTimeout(l(e,i),t)}function o(e,t,i){return!!Array.isArray(e)&&(s(e,i[t],i),!0)}function s(e,t,i){var r;if(e)if(e.forEach)e.forEach(t,i);else if(e.length!==n)for(r=0;r<e.length;)t.call(i,e[r],r,e),r++;else for(r in e)e.hasOwnProperty(r)&&t.call(i,e[r],r,e)}function a(t,i,n){var r="DEPRECATED METHOD: "+i+"\n"+n+" AT \n";return function(){var i=new Error("get-stack-trace"),n=i&&i.stack?i.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",o=e.console&&(e.console.warn||e.console.log);return o&&o.call(e.console,r,n),t.apply(this,arguments)}}function u(e,t,i){var n,r=t.prototype;n=e.prototype=Object.create(r),n.constructor=e,n._super=r,i&&ce(n,i)}function l(e,t){return function(){return e.apply(t,arguments)}}function c(e,t){return typeof e==fe?e.apply(t?t[0]||n:n,t):e}function h(e,t){return e===n?t:e}function d(e,t,i){s(m(t),function(t){e.addEventListener(t,i,!1)})}function f(e,t,i){s(m(t),function(t){e.removeEventListener(t,i,!1)})}function p(e,t){for(;e;){if(e==t)return!0;e=e.parentNode}return!1}function g(e,t){return e.indexOf(t)>-1}function m(e){return e.trim().split(/\s+/g)}function v(e,t,i){if(e.indexOf&&!i)return e.indexOf(t);for(var n=0;n<e.length;){if(i&&e[n][i]==t||!i&&e[n]===t)return n;n++}return-1}function y(e){return Array.prototype.slice.call(e,0)}function b(e,t,i){for(var n=[],r=[],o=0;o<e.length;){var s=t?e[o][t]:e[o];v(r,s)<0&&n.push(e[o]),r[o]=s,o++}return i&&(n=t?n.sort(function(e,i){return e[t]>i[t]}):n.sort()),n}function w(e,t){for(var i,r,o=t[0].toUpperCase()+t.slice(1),s=0;s<he.length;){if(i=he[s],(r=i?i+o:t)in e)return r;s++}return n}function E(){return be++}function _(t){var i=t.ownerDocument||t;return i.defaultView||i.parentWindow||e}function T(e,t){var i=this;this.manager=e,this.callback=t,this.element=e.element,this.target=e.options.inputTarget,this.domHandler=function(t){c(e.options.enable,[e])&&i.handler(t)},this.init()}function S(e){var t=e.options.inputClass;return new(t||(_e?V:Te?G:Ee?j:F))(e,A)}function A(e,t,i){var n=i.pointers.length,r=i.changedPointers.length,o=t&Ae&&n-r==0,s=t&(Ie|xe)&&n-r==0;i.isFirst=!!o,i.isFinal=!!s,o&&(e.session={}),i.eventType=t,P(e,i),e.emit("hammer.input",i),e.recognize(i),e.session.prevInput=i}function P(e,t){var i=e.session,n=t.pointers,r=n.length;i.firstInput||(i.firstInput=C(t)),r>1&&!i.firstMultiple?i.firstMultiple=C(t):1===r&&(i.firstMultiple=!1);var o=i.firstInput,s=i.firstMultiple,a=s?s.center:o.center,u=t.center=R(n);t.timeStamp=me(),t.deltaTime=t.timeStamp-o.timeStamp,t.angle=D(a,u),t.distance=L(a,u),I(i,t),t.offsetDirection=O(t.deltaX,t.deltaY);var l=k(t.deltaTime,t.deltaX,t.deltaY);t.overallVelocityX=l.x,t.overallVelocityY=l.y,t.overallVelocity=ge(l.x)>ge(l.y)?l.x:l.y,t.scale=s?N(s.pointers,n):1,t.rotation=s?M(s.pointers,n):0,t.maxPointers=i.prevInput?t.pointers.length>i.prevInput.maxPointers?t.pointers.length:i.prevInput.maxPointers:t.pointers.length,x(i,t);var c=e.element;p(t.srcEvent.target,c)&&(c=t.srcEvent.target),t.target=c}function I(e,t){var i=t.center,n=e.offsetDelta||{},r=e.prevDelta||{},o=e.prevInput||{};t.eventType!==Ae&&o.eventType!==Ie||(r=e.prevDelta={x:o.deltaX||0,y:o.deltaY||0},n=e.offsetDelta={x:i.x,y:i.y}),t.deltaX=r.x+(i.x-n.x),t.deltaY=r.y+(i.y-n.y)}function x(e,t){var i,r,o,s,a=e.lastInterval||t,u=t.timeStamp-a.timeStamp;if(t.eventType!=xe&&(u>Se||a.velocity===n)){var l=t.deltaX-a.deltaX,c=t.deltaY-a.deltaY,h=k(u,l,c);r=h.x,o=h.y,i=ge(h.x)>ge(h.y)?h.x:h.y,s=O(l,c),e.lastInterval=t}else i=a.velocity,r=a.velocityX,o=a.velocityY,s=a.direction;t.velocity=i,t.velocityX=r,t.velocityY=o,t.direction=s}function C(e){for(var t=[],i=0;i<e.pointers.length;)t[i]={clientX:pe(e.pointers[i].clientX),clientY:pe(e.pointers[i].clientY)},i++;return{timeStamp:me(),pointers:t,center:R(t),deltaX:e.deltaX,deltaY:e.deltaY}}function R(e){var t=e.length;if(1===t)return{x:pe(e[0].clientX),y:pe(e[0].clientY)};for(var i=0,n=0,r=0;r<t;)i+=e[r].clientX,n+=e[r].clientY,r++;return{x:pe(i/t),y:pe(n/t)}}function k(e,t,i){return{x:t/e||0,y:i/e||0}}function O(e,t){return e===t?Ce:ge(e)>=ge(t)?e<0?Re:ke:t<0?Oe:Le}function L(e,t,i){i||(i=Fe);var n=t[i[0]]-e[i[0]],r=t[i[1]]-e[i[1]];return Math.sqrt(n*n+r*r)}function D(e,t,i){i||(i=Fe);var n=t[i[0]]-e[i[0]],r=t[i[1]]-e[i[1]];return 180*Math.atan2(r,n)/Math.PI}function M(e,t){return D(t[1],t[0],Ve)+D(e[1],e[0],Ve)}function N(e,t){return L(t[0],t[1],Ve)/L(e[0],e[1],Ve)}function F(){this.evEl=Be,this.evWin=Ge,this.pressed=!1,T.apply(this,arguments)}function V(){this.evEl=We,this.evWin=$e,T.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}function U(){this.evTarget=qe,this.evWin=ze,this.started=!1,T.apply(this,arguments)}function B(e,t){var i=y(e.touches),n=y(e.changedTouches);return t&(Ie|xe)&&(i=b(i.concat(n),"identifier",!0)),[i,n]}function G(){this.evTarget=Xe,this.targetIds={},T.apply(this,arguments)}function H(e,t){var i=y(e.touches),n=this.targetIds;if(t&(Ae|Pe)&&1===i.length)return n[i[0].identifier]=!0,[i,i];var r,o,s=y(e.changedTouches),a=[],u=this.target;if(o=i.filter(function(e){return p(e.target,u)}),t===Ae)for(r=0;r<o.length;)n[o[r].identifier]=!0,r++;for(r=0;r<s.length;)n[s[r].identifier]&&a.push(s[r]),t&(Ie|xe)&&delete n[s[r].identifier],r++;return a.length?[b(o.concat(a),"identifier",!0),a]:void 0}function j(){T.apply(this,arguments);var e=l(this.handler,this);this.touch=new G(this.manager,e),this.mouse=new F(this.manager,e),this.primaryTouch=null,this.lastTouches=[]}function W(e,t){e&Ae?(this.primaryTouch=t.changedPointers[0].identifier,$.call(this,t)):e&(Ie|xe)&&$.call(this,t)}function $(e){var t=e.changedPointers[0];if(t.identifier===this.primaryTouch){var i={x:t.clientX,y:t.clientY};this.lastTouches.push(i);var n=this.lastTouches,r=function(){var e=n.indexOf(i);e>-1&&n.splice(e,1)};setTimeout(r,Ze)}}function Y(e){for(var t=e.srcEvent.clientX,i=e.srcEvent.clientY,n=0;n<this.lastTouches.length;n++){var r=this.lastTouches[n],o=Math.abs(t-r.x),s=Math.abs(i-r.y);if(o<=Qe&&s<=Qe)return!0}return!1}function q(e,t){this.manager=e,this.set(t)}function z(e){if(g(e,nt))return nt;var t=g(e,rt),i=g(e,ot);return t&&i?nt:t||i?t?rt:ot:g(e,it)?it:tt}function K(e){this.options=ce({},this.defaults,e||{}),this.id=E(),this.manager=null,
this.options.enable=h(this.options.enable,!0),this.state=at,this.simultaneous={},this.requireFail=[]}function X(e){return e&dt?"cancel":e&ct?"end":e&lt?"move":e&ut?"start":""}function Z(e){return e==Le?"down":e==Oe?"up":e==Re?"left":e==ke?"right":""}function Q(e,t){var i=t.manager;return i?i.get(e):e}function J(){K.apply(this,arguments)}function ee(){J.apply(this,arguments),this.pX=null,this.pY=null}function te(){J.apply(this,arguments)}function ie(){K.apply(this,arguments),this._timer=null,this._input=null}function ne(){J.apply(this,arguments)}function re(){J.apply(this,arguments)}function oe(){K.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function se(e,t){return t=t||{},t.recognizers=h(t.recognizers,se.defaults.preset),new ae(e,t)}function ae(e,t){this.options=ce({},se.defaults,t||{}),this.options.inputTarget=this.options.inputTarget||e,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=e,this.input=S(this),this.touchAction=new q(this,this.options.touchAction),ue(this,!0),s(this.options.recognizers,function(e){var t=this.add(new e[0](e[1]));e[2]&&t.recognizeWith(e[2]),e[3]&&t.requireFailure(e[3])},this)}function ue(e,t){var i=e.element;if(i.style){var n;s(e.options.cssProps,function(r,o){n=w(i.style,o),t?(e.oldCssProps[n]=i.style[n],i.style[n]=r):i.style[n]=e.oldCssProps[n]||""}),t||(e.oldCssProps={})}}function le(e,i){var n=t.createEvent("Event");n.initEvent(e,!0,!0),n.gesture=i,i.target.dispatchEvent(n)}var ce,he=["","webkit","Moz","MS","ms","o"],de=t.createElement("div"),fe="function",pe=Math.round,ge=Math.abs,me=Date.now;ce="function"!=typeof Object.assign?function(e){if(e===n||null===e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),i=1;i<arguments.length;i++){var r=arguments[i];if(r!==n&&null!==r)for(var o in r)r.hasOwnProperty(o)&&(t[o]=r[o])}return t}:Object.assign;var ve=a(function(e,t,i){for(var r=Object.keys(t),o=0;o<r.length;)(!i||i&&e[r[o]]===n)&&(e[r[o]]=t[r[o]]),o++;return e},"extend","Use `assign`."),ye=a(function(e,t){return ve(e,t,!0)},"merge","Use `assign`."),be=1,we=/mobile|tablet|ip(ad|hone|od)|android/i,Ee="ontouchstart"in e,_e=w(e,"PointerEvent")!==n,Te=Ee&&we.test(navigator.userAgent),Se=25,Ae=1,Pe=2,Ie=4,xe=8,Ce=1,Re=2,ke=4,Oe=8,Le=16,De=Re|ke,Me=Oe|Le,Ne=De|Me,Fe=["x","y"],Ve=["clientX","clientY"];T.prototype={handler:function(){},init:function(){this.evEl&&d(this.element,this.evEl,this.domHandler),this.evTarget&&d(this.target,this.evTarget,this.domHandler),this.evWin&&d(_(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&f(this.element,this.evEl,this.domHandler),this.evTarget&&f(this.target,this.evTarget,this.domHandler),this.evWin&&f(_(this.element),this.evWin,this.domHandler)}};var Ue={mousedown:Ae,mousemove:Pe,mouseup:Ie},Be="mousedown",Ge="mousemove mouseup";u(F,T,{handler:function(e){var t=Ue[e.type];t&Ae&&0===e.button&&(this.pressed=!0),t&Pe&&1!==e.which&&(t=Ie),this.pressed&&(t&Ie&&(this.pressed=!1),this.callback(this.manager,t,{pointers:[e],changedPointers:[e],pointerType:"mouse",srcEvent:e}))}});var He={pointerdown:Ae,pointermove:Pe,pointerup:Ie,pointercancel:xe,pointerout:xe},je={2:"touch",3:"pen",4:"mouse",5:"kinect"},We="pointerdown",$e="pointermove pointerup pointercancel";e.MSPointerEvent&&!e.PointerEvent&&(We="MSPointerDown",$e="MSPointerMove MSPointerUp MSPointerCancel"),u(V,T,{handler:function(e){var t=this.store,i=!1,n=e.type.toLowerCase().replace("ms",""),r=He[n],o=je[e.pointerType]||e.pointerType,s="touch"==o,a=v(t,e.pointerId,"pointerId");r&Ae&&(0===e.button||s)?a<0&&(t.push(e),a=t.length-1):r&(Ie|xe)&&(i=!0),a<0||(t[a]=e,this.callback(this.manager,r,{pointers:t,changedPointers:[e],pointerType:o,srcEvent:e}),i&&t.splice(a,1))}});var Ye={touchstart:Ae,touchmove:Pe,touchend:Ie,touchcancel:xe},qe="touchstart",ze="touchstart touchmove touchend touchcancel";u(U,T,{handler:function(e){var t=Ye[e.type];if(t===Ae&&(this.started=!0),this.started){var i=B.call(this,e,t);t&(Ie|xe)&&i[0].length-i[1].length==0&&(this.started=!1),this.callback(this.manager,t,{pointers:i[0],changedPointers:i[1],pointerType:"touch",srcEvent:e})}}});var Ke={touchstart:Ae,touchmove:Pe,touchend:Ie,touchcancel:xe},Xe="touchstart touchmove touchend touchcancel";u(G,T,{handler:function(e){var t=Ke[e.type],i=H.call(this,e,t);i&&this.callback(this.manager,t,{pointers:i[0],changedPointers:i[1],pointerType:"touch",srcEvent:e})}});var Ze=2500,Qe=25;u(j,T,{handler:function(e,t,i){var n="touch"==i.pointerType,r="mouse"==i.pointerType;if(!(r&&i.sourceCapabilities&&i.sourceCapabilities.firesTouchEvents)){if(n)W.call(this,t,i);else if(r&&Y.call(this,i))return;this.callback(e,t,i)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var Je=w(de.style,"touchAction"),et=Je!==n,tt="auto",it="manipulation",nt="none",rt="pan-x",ot="pan-y",st=function(){if(!et)return!1;var t={},i=e.CSS&&e.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(n){t[n]=!i||e.CSS.supports("touch-action",n)}),t}();q.prototype={set:function(e){"compute"==e&&(e=this.compute()),et&&this.manager.element.style&&st[e]&&(this.manager.element.style[Je]=e),this.actions=e.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var e=[];return s(this.manager.recognizers,function(t){c(t.options.enable,[t])&&(e=e.concat(t.getTouchAction()))}),z(e.join(" "))},preventDefaults:function(e){var t=e.srcEvent,i=e.offsetDirection;if(this.manager.session.prevented)return void t.preventDefault();var n=this.actions,r=g(n,nt)&&!st[nt],o=g(n,ot)&&!st[ot],s=g(n,rt)&&!st[rt];if(r){var a=1===e.pointers.length,u=e.distance<2,l=e.deltaTime<250;if(a&&u&&l)return}return s&&o?void 0:r||o&&i&De||s&&i&Me?this.preventSrc(t):void 0},preventSrc:function(e){this.manager.session.prevented=!0,e.preventDefault()}};var at=1,ut=2,lt=4,ct=8,ht=ct,dt=16;K.prototype={defaults:{},set:function(e){return ce(this.options,e),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(e){if(o(e,"recognizeWith",this))return this;var t=this.simultaneous;return e=Q(e,this),t[e.id]||(t[e.id]=e,e.recognizeWith(this)),this},dropRecognizeWith:function(e){return o(e,"dropRecognizeWith",this)?this:(e=Q(e,this),delete this.simultaneous[e.id],this)},requireFailure:function(e){if(o(e,"requireFailure",this))return this;var t=this.requireFail;return e=Q(e,this),-1===v(t,e)&&(t.push(e),e.requireFailure(this)),this},dropRequireFailure:function(e){if(o(e,"dropRequireFailure",this))return this;e=Q(e,this);var t=v(this.requireFail,e);return t>-1&&this.requireFail.splice(t,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(e){return!!this.simultaneous[e.id]},emit:function(e){function t(t){i.manager.emit(t,e)}var i=this,n=this.state;n<ct&&t(i.options.event+X(n)),t(i.options.event),e.additionalEvent&&t(e.additionalEvent),n>=ct&&t(i.options.event+X(n))},tryEmit:function(e){if(this.canEmit())return this.emit(e);this.state=32},canEmit:function(){for(var e=0;e<this.requireFail.length;){if(!(this.requireFail[e].state&(32|at)))return!1;e++}return!0},recognize:function(e){var t=ce({},e);if(!c(this.options.enable,[this,t]))return this.reset(),void(this.state=32);this.state&(ht|dt|32)&&(this.state=at),this.state=this.process(t),this.state&(ut|lt|ct|dt)&&this.tryEmit(t)},process:function(e){},getTouchAction:function(){},reset:function(){}},u(J,K,{defaults:{pointers:1},attrTest:function(e){var t=this.options.pointers;return 0===t||e.pointers.length===t},process:function(e){var t=this.state,i=e.eventType,n=t&(ut|lt),r=this.attrTest(e);return n&&(i&xe||!r)?t|dt:n||r?i&Ie?t|ct:t&ut?t|lt:ut:32}}),u(ee,J,{defaults:{event:"pan",threshold:10,pointers:1,direction:Ne},getTouchAction:function(){var e=this.options.direction,t=[];return e&De&&t.push(ot),e&Me&&t.push(rt),t},directionTest:function(e){var t=this.options,i=!0,n=e.distance,r=e.direction,o=e.deltaX,s=e.deltaY;return r&t.direction||(t.direction&De?(r=0===o?Ce:o<0?Re:ke,i=o!=this.pX,n=Math.abs(e.deltaX)):(r=0===s?Ce:s<0?Oe:Le,i=s!=this.pY,n=Math.abs(e.deltaY))),e.direction=r,i&&n>t.threshold&&r&t.direction},attrTest:function(e){return J.prototype.attrTest.call(this,e)&&(this.state&ut||!(this.state&ut)&&this.directionTest(e))},emit:function(e){this.pX=e.deltaX,this.pY=e.deltaY;var t=Z(e.direction);t&&(e.additionalEvent=this.options.event+t),this._super.emit.call(this,e)}}),u(te,J,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[nt]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(Math.abs(e.scale-1)>this.options.threshold||this.state&ut)},emit:function(e){if(1!==e.scale){var t=e.scale<1?"in":"out";e.additionalEvent=this.options.event+t}this._super.emit.call(this,e)}}),u(ie,K,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[tt]},process:function(e){var t=this.options,i=e.pointers.length===t.pointers,n=e.distance<t.threshold,o=e.deltaTime>t.time;if(this._input=e,!n||!i||e.eventType&(Ie|xe)&&!o)this.reset();else if(e.eventType&Ae)this.reset(),this._timer=r(function(){this.state=ht,this.tryEmit()},t.time,this);else if(e.eventType&Ie)return ht;return 32},reset:function(){clearTimeout(this._timer)},emit:function(e){this.state===ht&&(e&&e.eventType&Ie?this.manager.emit(this.options.event+"up",e):(this._input.timeStamp=me(),this.manager.emit(this.options.event,this._input)))}}),u(ne,J,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[nt]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(Math.abs(e.rotation)>this.options.threshold||this.state&ut)}}),u(re,J,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:De|Me,pointers:1},getTouchAction:function(){return ee.prototype.getTouchAction.call(this)},attrTest:function(e){var t,i=this.options.direction;return i&(De|Me)?t=e.overallVelocity:i&De?t=e.overallVelocityX:i&Me&&(t=e.overallVelocityY),this._super.attrTest.call(this,e)&&i&e.offsetDirection&&e.distance>this.options.threshold&&e.maxPointers==this.options.pointers&&ge(t)>this.options.velocity&&e.eventType&Ie},emit:function(e){var t=Z(e.offsetDirection);t&&this.manager.emit(this.options.event+t,e),this.manager.emit(this.options.event,e)}}),u(oe,K,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[it]},process:function(e){var t=this.options,i=e.pointers.length===t.pointers,n=e.distance<t.threshold,o=e.deltaTime<t.time;if(this.reset(),e.eventType&Ae&&0===this.count)return this.failTimeout();if(n&&o&&i){if(e.eventType!=Ie)return this.failTimeout();var s=!this.pTime||e.timeStamp-this.pTime<t.interval,a=!this.pCenter||L(this.pCenter,e.center)<t.posThreshold;this.pTime=e.timeStamp,this.pCenter=e.center,a&&s?this.count+=1:this.count=1,this._input=e;if(0===this.count%t.taps)return this.hasRequireFailures()?(this._timer=r(function(){this.state=ht,this.tryEmit()},t.interval,this),ut):ht}return 32},failTimeout:function(){return this._timer=r(function(){this.state=32},this.options.interval,this),32},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==ht&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),se.VERSION="2.0.8",se.defaults={domEvents:!1,touchAction:"compute",enable:!0,inputTarget:null,inputClass:null,preset:[[ne,{enable:!1}],[te,{enable:!1},["rotate"]],[re,{direction:De}],[ee,{direction:De},["swipe"]],[oe],[oe,{event:"doubletap",taps:2},["tap"]],[ie]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};ae.prototype={set:function(e){return ce(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this},stop:function(e){this.session.stopped=e?2:1},recognize:function(e){var t=this.session;if(!t.stopped){this.touchAction.preventDefaults(e);var i,n=this.recognizers,r=t.curRecognizer;(!r||r&&r.state&ht)&&(r=t.curRecognizer=null);for(var o=0;o<n.length;)i=n[o],2===t.stopped||r&&i!=r&&!i.canRecognizeWith(r)?i.reset():i.recognize(e),!r&&i.state&(ut|lt|ct)&&(r=t.curRecognizer=i),o++}},get:function(e){if(e instanceof K)return e;for(var t=this.recognizers,i=0;i<t.length;i++)if(t[i].options.event==e)return t[i];return null},add:function(e){if(o(e,"add",this))return this;var t=this.get(e.options.event);return t&&this.remove(t),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e},remove:function(e){if(o(e,"remove",this))return this;if(e=this.get(e)){var t=this.recognizers,i=v(t,e);-1!==i&&(t.splice(i,1),this.touchAction.update())}return this},on:function(e,t){if(e!==n&&t!==n){var i=this.handlers;return s(m(e),function(e){i[e]=i[e]||[],i[e].push(t)}),this}},off:function(e,t){if(e!==n){var i=this.handlers;return s(m(e),function(e){t?i[e]&&i[e].splice(v(i[e],t),1):delete i[e]}),this}},emit:function(e,t){this.options.domEvents&&le(e,t);var i=this.handlers[e]&&this.handlers[e].slice();if(i&&i.length){t.type=e,t.preventDefault=function(){t.srcEvent.preventDefault()};for(var n=0;n<i.length;)i[n](t),n++}},destroy:function(){this.element&&ue(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},ce(se,{INPUT_START:Ae,INPUT_MOVE:Pe,INPUT_END:Ie,INPUT_CANCEL:xe,STATE_POSSIBLE:at,STATE_BEGAN:ut,STATE_CHANGED:lt,STATE_ENDED:ct,STATE_RECOGNIZED:ht,STATE_CANCELLED:dt,STATE_FAILED:32,DIRECTION_NONE:Ce,DIRECTION_LEFT:Re,DIRECTION_RIGHT:ke,DIRECTION_UP:Oe,DIRECTION_DOWN:Le,DIRECTION_HORIZONTAL:De,DIRECTION_VERTICAL:Me,DIRECTION_ALL:Ne,Manager:ae,Input:T,TouchAction:q,TouchInput:G,MouseInput:F,PointerEventInput:V,TouchMouseInput:j,SingleTouchInput:U,Recognizer:K,AttrRecognizer:J,Tap:oe,Pan:ee,Swipe:re,Pinch:te,Rotate:ne,Press:ie,on:d,off:f,each:s,merge:ye,extend:ve,assign:ce,inherit:u,bindFn:l,prefixed:w}),(void 0!==e?e:"undefined"!=typeof self?self:{}).Hammer=se,"function"==typeof define&&define.amd?define("hammer",[],function(){return se}):"undefined"!=typeof module&&module.exports?module.exports=se:e.Hammer=se}(window,document),define("shared/views/AbstractView",["log","lodash","jquery","backbone","color","device","hammer"],function(e,t,i,n,r,o,s){"use strict";return n.View.extend({broadcast:t.clone(n.Events),constructor:function(e){this.options=e||{},n.View.apply(this,arguments)},_broadcast:function(e){if(!t.isUndefined(e)){e.preventDefault(),e.stopPropagation();var n=i(e.currentTarget).attr("data-event-name"),r=i(e.currentTarget).attr("data-event-param");t.isString(n)&&this.broadcast.trigger(n,r)}},_triggerEvent:function(e){if(!t.isUndefined(e)){e.preventDefault();var n=i(e.currentTarget).attr("data-event-name"),r=i(e.currentTarget).attr("data-event-param");this.trigger(n,r)}},bindInteraction:function(e,n){var r;r="function"!=typeof n?i.noop:function(e){o.touch()&&(e=e.srcEvent),e.preventDefault(),n(e)},o.touch()&&t.each(e,function(e){e.swipeAction=new s(e),e.swipeAction.on("tap",r)}),o.desktop()&&e.unbind("click").bind("click",r)},unbindInteraction:function(e){o.touch()&&t.each(e,function(e){e.swipeAction.destroy()}),o.desktop()&&e.unbind("click")},onClose:function(){},beforeClose:function(){},close:function(){this.beforeClose(),this.remove(),this.onClose(),this.trigger("close"),this.unbind()},setModel:function(e){this.model=e,this._bindModel()},setCollection:function(e){this.collection=e,this._bindCollection()},_bindModel:function(){this.model&&(this.model.bind("change",this._change,this),this.model.bind("sync",this._sync,this),this.model.bind("destroy",this._destroy,this),this.model.bind("invalid",this._invalid,this),this.render())},_bindCollection:function(){this.collection&&(this.collection.bind("add",this._add,this),this.collection.bind("remove",this._remove,this),this.collection.bind("reset",this._reset,this),this.render())},initialize:function(){this.options.module&&this._setModule(this.options.module),this._bindModel(),this._bindCollection()},insertAfter:function(e){this.$el.insertAfter(e)},insertBefore:function(e){this.$el.insertBefore(e)},appendTo:function(e){this.$el.appendTo(e)},after:function(e){this.$el.after(e)},before:function(e){this.$el.before(e)},show:function(){this.$el.show()},hide:function(){this.$el.hide()},_setModule:function(e){if(t.isUndefined(e)||null===e)throw Error("attempting to set an invalid module!");this.module=e},getModule:function(){return this.module},_change:function(){this.render()},_sync:function(){this.render()},_destroy:function(){this.render()},_invalid:function(){this.render()},_add:function(){this.render()},_remove:function(){this.render()},_reset:function(){this.render()},getEscapedId:function(){return this.id.replace("|","\\|")}})}),define("text!modules/splash-screen/templates/loading.html",[],function(){return'<div class="loading-container">\n    <div class="spinner"></div>\n    {{#showCerosBranding}}\n    <div class="branding-logo"></div>\n    {{/showCerosBranding}}\n    {{#showPreviewLabel}}\n    <div class="notice">REAL-TIME PREVIEW</div>\n    {{/showPreviewLabel}}\n</div>\n'}),define("modules/splash-screen/views/LoadingView",["jquery","lodash","backbone","mustache","shared/models/EmbeddedViewportModel","shared/views/AbstractView","device","color","text!modules/splash-screen/templates/loading.html"],function(e,t,i,n,r,o,s,a,u){"use strict";return o.extend({className:"splash-screen loading",lastAnimationId:null,initialize:function(){o.prototype.initialize.call(this),this.options=t.extend({autoContrastForegroundColor:"#FFFFFF",foregroundColor:"white",backgroundColor:"#161616",previewLabelBackgroundColor:"none",borderRadius:5,revolutionsPerSecond:1.2,fadeOutSpeed:"fast",showCerosBranding:!1,showPreviewLabel:!1},this.options),this.options.degreesPerTick=360/(60*this.options.revolutionsPerSecond)},render:function(){this.$el.empty(),this.$el.html(n.render(u,{showCerosBranding:this.options.showCerosBranding||this.options.showPreviewLabel,showPreviewLabel:this.options.showPreviewLabel})).show(),this.$spinner=this.$el.find(".spinner");var e=this.$el.find(".branding-logo"),t=this.$el.find(".notice");this.options.overlayed&&this.$spinner.addClass("overlayed"),this.$spinner.css({borderRadius:this.options.borderRadius,backgroundColor:this.options.backgroundColor}),this.renderSpinnerCanvas(),e.css({color:this.options.autoContrastForegroundColor}),t.css({backgroundColor:this.options.previewLabelBackgroundColor,color:this.options.foregroundColor}),this.scale(),r.getInstance().on("change",this.repositionForEmbed,this),this.repositionForEmbed()},start:function(){t.isNull(this.lastAnimationId)&&(this.lastAnimationId=requestAnimationFrame(this._draw))},stop:function(){t.isNull(this.lastAnimationId)||(cancelAnimationFrame(this.lastAnimationId),this.lastAnimationId=null)},scale:function(){this.$el.width()<100||this.$el.height()<100?this.$el.find("div.loading-container").addClass("small"):this.$el.find("div.loading-container").removeClass("small")},repositionForEmbed:function(){var t=r.getInstance();if(t.isActive()){var i=Math.max(0,t.getTop()),n=Math.min(e(window).height(),t.getBottom());this.$el.css({top:i+"px",height:n-i+"px"}),this.scale()}},renderSpinnerCanvas:function(){var t=Math.round(64/12),i=e('<canvas width="64" height="64"></canvas>');this.$spinner.append(i);var n=i[0].getContext("2d"),r=0,o=!1,s=this,u=32-t-1;this._draw=function(){var e,i,l=-.5*Math.PI;n.save(),n.fillStyle=s.options.backgroundColor,n.fillRect(0,0,64,64),n.lineWidth=t;var c=a.fromHex(s.options.autoContrastForegroundColor);c.a=.1,n.strokeStyle=c.toString(),n.beginPath(),n.arc(32,32,u,0,2*Math.PI,!0),n.stroke(),0===r&&o?(e=l,i=l+2*Math.PI):(e=o?l+Math.PI/180*r:l,i=o?l:l+Math.PI/180*r),n.strokeStyle=s.options.autoContrastForegroundColor,n.beginPath(),n.arc(32,32,u,e,i,!1),n.stroke(),n.restore(),r+=s.options.degreesPerTick,r>359&&(r=0,o=!o),s.lastAnimationId=requestAnimationFrame(s._draw)}},_remove:function(){this.$el.remove()},destroy:function(){this.stop(),this._remove(),r.getInstance().off("change",this.repositionForEmbed,this)}})}),define("text!modules/splash-screen/templates/previewer-unavailable.html",[],function(){return'<div class="warning-modal unavailable overlay">\n    \x3c!-- This is the overlay that will provide a transparent layer over the\n    experience and prevent any clicks. --\x3e\n </div>\n<div class="warning-modal unavailable modal">\n    <div>\n        <div class="branding-logo"></div>\n        <span class="warning-icon alert-icon"></span>\n        <span class="notice important">Your Ceros subscription expired</span>\n        <span class="notice">Get in touch with our helpful team who will rectify this in no time</span>\n        <button class="submit contact">Get in touch</button>\n    <div>\n</div>\n'}),define("text!modules/splash-screen/templates/player-unavailable.html",[],function(){return'<div class="warning-modal unavailable overlay">\n    \x3c!-- This is the overlay that will provide a transparent layer over the\n    experience and prevent any clicks. --\x3e\n </div>\n<div class="warning-modal modal">\n    <div>\n        <div class="branding-logo"></div>\n        <span class="warning-icon no-entry-icon"></span>\n        <span class="notice important">This experience has been removed by the publisher</span>\n    <div>\n</div>\n'}),define("modules/splash-screen/views/UnavailableView",["jquery","lodash","backbone","urlUtils","shared/views/AbstractView","globals","mustache","text!modules/splash-screen/templates/previewer-unavailable.html","text!modules/splash-screen/templates/player-unavailable.html"],function(e,t,i,n,r,o,s,a,u){"use strict";return r.extend({className:"splash-screen unavailable",events:{"click button.contact":"handleContactClick"},initialize:function(){r.prototype.initialize.call(this),this.render()},render:function(){var e=o.previewMode?a:u;this.$el.html(s.render(e))},handleContactClick:function(e){e.preventDefault();var t=n.appendQueryParams("http://www3.ceros.com/expiredaccount",{account:o.accountSlug});window.open(t)}})}),define("text!modules/splash-screen/templates/warning.html",[],function(){return'<div class="warning-modal embedded-previewer overlay">\n    \x3c!-- This is the overlay that will provide a transparent layer over the\n    experience and prevent any clicks. --\x3e\n</div>\n<div class="warning-modal embedded-previewer modal">\n    <div>\n        {{#showBranding}}<div class="branding-logo"></div>{{/showBranding}}\n        <span class="warning-icon alert-icon"></span>\n        <span class="notice important">{{importantText}}</span>\n        <span class="notice">{{descriptiveText}}</span>\n        <button class="submit dismiss">{{buttonText}}</button>\n    </div>\n</div>\n'}),define("modules/splash-screen/views/AbstractWarningView",["jquery","lodash","backbone","shared/views/AbstractView","mustache","text!modules/splash-screen/templates/warning.html"],function(e,t,i,n,r,o){"use strict";return n.extend({className:"warning",module:null,showBranding:!1,importantText:"",descriptiveText:"",buttonText:"Dismiss",initialize:function(){n.prototype.initialize.call(this),this.module=this.options.module},render:function(){this.$el.html(r.render(o,{showBranding:this.showBranding,importantText:this.importantText,descriptiveText:this.descriptiveText,buttonText:this.buttonText})),this.bindEvents()},bindEvents:function(){this.bindInteraction(this.$el.find("button.dismiss"),t.bind(function(e){e.preventDefault(),this.onDismissHandler()},this))},onDismissHandler:function(){}})}),define("modules/splash-screen/views/EmbeddedPreviewerWarningView",["jquery","lodash","backbone","modules/splash-screen/views/AbstractWarningView"],function(e,t,i,n){"use strict";return n.extend({className:"embedded-previewer-warning",showBranding:!0,importantText:"This is your preview - and not your published experience.",descriptiveText:"Please use the published experience URL to display this content on your website.",onDismissHandler:function(){this.module.trigger(this.module.publishedEvents.EMBED_WARNING_DISMISSED)}})}),define("modules/splash-screen/views/DeletedPageWarningView",["jquery","lodash","backbone","modules/splash-screen/views/AbstractWarningView"],function(e,t,i,n){"use strict";return n.extend({className:"deleted-page-warning",importantText:"This page is no longer available",descriptiveText:"Please try reloading",buttonText:"Reload",onDismissHandler:function(){window.location.reload()}})}),define("modules/splash-screen/module",["lodash","ceros","globals","modules/splash-screen/views/LoadingView","modules/splash-screen/views/UnavailableView","modules/splash-screen/views/EmbeddedPreviewerWarningView","modules/splash-screen/views/DeletedPageWarningView","color"],function(e,t,i,n,r,o,s,a){"use strict";var u=function(e){return a.getMostContrasting(e.backgroundColor,e.menuFgColor,e.menuBgColor).toHex()},l=new t.Module({id:"splashScreen",description:"Loading experience including spinner animation",version:"1.0",publishedEvents:{EMBED_WARNING_DISMISSED:"embed_warning_dismissed"},delegate:{loadingViews:[],showLoading:function(t,r){var o={theme:e.isUndefined(i.themeObj)?{}:i.themeObj},s=e.extend({startImmediately:!0,showCerosBranding:!1,showPreviewLabel:!1,overlayed:!0},o,r),a=u(s.theme),l=s.theme.backgroundColor;s.overlayed&&(a=s.theme.menuFgColor,l=s.theme.menuBgColor);var c=new n({autoContrastForegroundColor:a,foregroundColor:s.theme.menuFgColor,backgroundColor:l,previewLabelBackgroundColor:s.theme.menuBgColor,showCerosBranding:s.showCerosBranding,showPreviewLabel:s.showPreviewLabel,overlayed:s.overlayed});return this.loadingViews.push(c),t.prepend(c.$el),c.render(),s.startImmediately&&c.start(),{destroy:function(){c.destroy()},start:function(){c.start()},stop:function(){c.stop()}}},scale:function(){e.each(this.loadingViews,function(e,t){e.scale()})},showUnavailableScreen:function(e,t){var i=new r;e.append(i.$el)},showEmbeddedPreviewerWarning:function(e){var t=new o({module:l});t.render(),e.append(t.$el)},showDeletedPageWarning:function(e){var t=new s({module:l});t.render(),e.append(t.$el)},hideEmbeddedPreviewerWarning:function(e){e.find(".embedded-previewer-warning").hide()}}});return l}),define("text!modules/chrome/templates/menubar.html",[],function(){return'<div id="chrome-menu">\n    <span class="title"></span>\n    <div class="cart button">\n        <a href="#"><span class="icon">&#xe004;</span></a>\n    </div>\n    <div class="share button">\n        <a href="#" class="share-button"><span class="icon">&#xe000;</span></a>\n        <div class="arrow">\x3c!-- A dynamically rendered HTML5 canvas or VML element is inserted here --\x3e</div>\n    </div>\n\n    <div class="share-menu" style="display:none;">\n        <ul>\n            <li><a href="#" data-share="facebook" title="Share on Facebook"><span class="icon ceros-facebook-icon"></span></a></li>\n            <li><a href="#" data-share="twitter" title="Share on Twitter"><span class="icon ceros-twitter-icon"></span></a></li>\n            <li><a href="#" data-share="linkedin" title="Share on LinkedIn"><span class="icon ceros-linkedin-icon"></span></a></li>\n            <li><a href="#" data-share="pinterest" title="Share on Pinterest"><span class="icon ceros-pinterest-icon"></span></a></li>\n            <li><a href="#" data-share="email" title="Share via Email"><span class="icon ceros-email-icon"></span></a></li>\n        </ul>\n    </div>\n</div>\n'}),define("modules/chrome/views/ChromeView",["jquery","lodash","backbone","color","device","globals","shared/views/AbstractView","shared/utils/CerosResourceLoader","text!modules/chrome/templates/menubar.html"],function(e,t,i,n,r,o,s,a,u){"use strict";return s.extend({id:"chrome",initialize:function(){s.prototype.initialize.call(this),this.autoHideTimer=null,this.render(),this.clickOverlay=e('<div class="click-overlay"></div>'),this.bindInteraction(this.clickOverlay,t.bind(this._hideShareMenu,this)),this.configureInteractions()},configureInteractions:function(){this.bindInteraction(this.title,t.bind(this._clickTitle,this)),this.bindInteraction(this.share,t.bind(this._activateShareMenu,this)),this.bindInteraction(this.shareMenu.find("a"),t.bind(this._sharePage,this)),this.bindInteraction(this.cart,t.bind(this._activateCart,this))},render:function(){this.$el.empty().html(u),e(window).bind("resize",t.bind(this._onResize,this)),this.chromeMenu=this.$el.find("#chrome-menu"),this.title=this.chromeMenu.find(".title"),this.share=this.chromeMenu.find(".share"),this.shareMenu=this.chromeMenu.find(".share-menu"),this.shareMenuArrow=this.chromeMenu.find(".arrow"),this._renderShareMenuArrow(),this.cart=this.chromeMenu.find(".cart"),!1===this.options.showChromeMenu&&this.chromeMenu.hide(),this.setCustomTheming(),this.options.allowCommerceIntegration&&this.options.commerceSettings.shoppingCartUrl||this.cart.remove(),this.chromeMenu.addClass("icon-"+this.chromeMenu.find("div.button").length)},_renderShareMenuArrow:function(){var t=e('<canvas width="39" height="18"></canvas>');this.shareMenuArrow.empty().append(t);var i=t[0].getContext("2d");i.save(),i.clearRect(0,0,39,18),i.fillStyle=this.options.menuBackgroundColor,i.beginPath(),i.moveTo(19.5,0),i.lineTo(39,18),i.lineTo(0,18),i.lineTo(19.5,0),i.fill(),i.restore()},setCustomTheming:function(){this.chromeMenu.css("background-color",this.options.menuBackgroundColor),this.shareMenu.css("background-color",this.options.menuBackgroundColor),this.shareMenu.find("li").css("border-color",this.options.menuBorderColor);var t=this.options.menuForegroundColor;this.$el.find(".title,.label,.icon").css("color",t);var i=this.$el.find("a"),n=this.options.menuHoverOpacity;r.desktop()&&i.hover(function(){e(this).css("opacity",n)},function(){e(this).css("opacity","1.0")}),r.touch()&&i.bind("touchstart",function(){e(this).css("opacity",n)}).bind("touchend",function(){e(this).css("opacity","1.0")})},toggle:function(){this.chromeMenu.fadeToggle({duration:"fast",queue:!1,complete:t.bind(this.setAutoHideTimer,this)})},setAutoHideTimer:function(){this.cancelAutoHide(),this.chromeMenu.is(":visible")&&(this.autoHideTimer=setTimeout(t.bind(function(){"none"===this.shareMenu.css("display")&&this.hide(!0)},this),5e3))},cancelAutoHide:function(){clearTimeout(this.autoHideTimer)},show:function(e){this.cancelAutoHide(),e?this.$el.fadeIn("fast"):this.$el.show()},hide:function(e){this.cancelAutoHide(),e?this.chromeMenu.fadeOut("fast"):this.chromeMenu.hide()},getHeight:function(){return!1===this.options.showChromeMenu?0:r.mobile()?50:42},setTitle:function(e){this.chromeMenu.find(".title").text(e)},_onResize:function(){this._positionShareMenu()},_showShareMenu:function(){this._positionShareMenu(),this.shareMenuArrow.show(),this.shareMenu.slideDown(150,t.bind(function(){this.$el.after(this.clickOverlay),this.clickOverlay.show()},this)),t.defer(t.bind(function(){this.bindInteraction(this.$el,t.bind(this._hideShareMenu,this))},this))},_hideShareMenu:function(){this.shareMenu.slideUp(100,t.bind(function(){this.shareMenuArrow.hide(),this.clickOverlay.detach(),this.unbindInteraction(this.$el)},this)),r.mobile()&&this.setAutoHideTimer()},_positionShareMenu:function(){var t,i=e(window).width(),n=this.chromeMenu.height()+10;t=i<=480?this.share.position().left+this.share.width()/2-this.shareMenu.width()/2:this.share.position().left,this.shareMenu.css({top:n+"px",left:t+"px"})},_clickTitle:function(){this.getModule().trigger(this.getModule().publishedEvents.CHROME_TITLE_CLICK)},_activateCart:function(){this.getModule().trigger(this.getModule().publishedEvents.CHROME_SHOPPING_CART)},_activateShareMenu:function(e){"none"===this.shareMenu.css("display")?(this.getModule().trigger(this.getModule().publishedEvents.CHROME_SHARE),this._showShareMenu()):this._hideShareMenu()},_sharePage:function(t){var i="share-"+e(t.currentTarget).attr("data-share");this.getModule().trigger(this.getModule().publishedEvents.CHROME_SHARE_PAGE,{action:i}),this._hideShareMenu()}})}),
define("modules/chrome/module",["jquery","lodash","ceros","globals","device","color","modules/chrome/views/ChromeView"],function(e,t,i,n,r,o,s){"use strict";var a=new i.Module({id:"chrome",description:"Provides a menu bar user interface for the web player",version:"2.0",chromeView:null,publishedEvents:{CHROME_SHARE:"chrome.share",CHROME_SHARE_PAGE:"chrome.share.page",CHROME_SHOPPING_CART:"chrome.shopping_cart",CHROME_TITLE_CLICK:"chrome.title.click"},delegate:{load:function(e){var i={theme:t.isUndefined(n.themeObj)?{}:n.themeObj};this.options=t.extend({},i,e);var r=this.options.theme.menuFgColor,u=this.options.theme.menuBgColor,l=o.fromHex(r);l.a=.1,this.chromeView=new s({module:a,menuBackgroundColor:u,menuBorderColor:l,menuForegroundColor:r,menuHoverOpacity:this.options.theme.menuHoverOpacity,allowCommerceIntegration:n.allowCommerceIntegration,commerceSettings:n.commerceSettings,showChromeMenu:this.options.theme.menuEnabled})},shouldShow:function(){return!n.isEmbedded&&n.themeObj.menuEnabled},initiallyHidden:function(){return r.mobile()},getHeight:function(){return this.chromeView.getHeight()},el:function(){return this.chromeView.$el},show:function(e){this.chromeView&&this.chromeView.show(e)},hide:function(e){this.chromeView&&this.chromeView.hide(e)},toggle:function(){this.chromeView&&this.chromeView.toggle()},setTitle:function(e){this.chromeView.setTitle(e)}}});return a}),define("text!modules/branding/templates/branding.html",[],function(){return'\n    <a href="#" class="label"></a>'}),define("modules/branding/views/BrandingView",["jquery","lodash","device","globals","shared/views/AbstractView","shared/utils/CerosResourceLoader","text!modules/branding/templates/branding.html"],function(e,t,i,n,r,o,s){"use strict";var a=n.publicAssetsBaseUrl+"PoweredByCeros.svg";return r.extend({id:"ceros-branding",initialize:function(){r.prototype.initialize.call(this),this.render(),this.configureInteractions()},configureInteractions:function(){this.bindInteraction(this.$el,t.bind(this._clickCerosBranding,this))},render:function(){if(this.$el.empty().html(s),e(window).bind("resize",t.bind(this._onResize,this)),this.setCustomTheming(),this.options.showCerosBranding){var i={color:this.options.menuForegroundColor},n={alt:"Powered By Ceros",width:"100%",height:"100%"};o.addVectorImage(a).loadNow().done(t.bind(function(e){e.createImageElement(i,n).done(t.bind(function(e){this.$el.find("a").append(e)},this))},this))}},setCustomTheming:function(){this.$el.css("background-color",this.options.menuBackgroundColor);var t=this.options.menuHoverOpacity,n=this.$el.find("a");i.desktop()&&n.hover(function(){e(this).css("opacity",t)},function(){e(this).css("opacity","1.0")}),i.touch()&&n.bind("touchstart",function(){e(this).css("opacity",t)}).bind("touchend",function(){e(this).css("opacity","1.0")}),this._positionCerosBranding()},_positionCerosBranding:function(){i.isIphoneFullscreenMobileSafari(e(window).width(),e(window).height())?this.$el.css({right:"42px","border-radius":"3px 3px 0 0"}):this.$el.css({right:0,"border-radius":"3px 0 0 0"})},_onResize:function(){this._positionCerosBranding()},_clickCerosBranding:function(){this.getModule().trigger(this.getModule().publishedEvents.BRANDING_CEROS_BRANDING_CLICK)}})}),define("modules/branding/module",["jquery","lodash","ceros","globals","device","color","modules/branding/views/BrandingView"],function(e,t,i,n,r,o,s){"use strict";var a=new i.Module({id:"branding",version:"1.0",brandingView:null,publishedEvents:{BRANDING_CEROS_BRANDING_CLICK:"branding.ceros_branding.click"},delegate:{load:function(e){var t=n.themeObj.menuFgColor,i=n.themeObj.menuBgColor;this.brandingView=new s({module:a,menuBackgroundColor:i,menuForegroundColor:t,menuHoverOpacity:n.themeObj.menuHoverOpacity,showCerosBranding:n.showCerosBranding})},shouldShow:function(){return n.showCerosBranding},el:function(){return this.brandingView.$el},show:function(){this.brandingView&&this.brandingView.show()}}});return a}),define("shared/utils/IconFontMap",[],function(){"use strict";return{PAGES:"&#xe001;",FACEBOOK:"&#xe002;",EMAIL:"&#xe003;",CART:"&#xe004;",LINK:"&#xe005;",TWITTER:"&#xe006;",LEFT_ARROW:"&#xe007;",PINTEREST:"&#xe008;",RIGHT_ARROW:"&#xe009;",SHARE:"&#xe000;"}}),define("modules/flippers/views/FlippersView",["jquery","lodash","backbone","shared/models/EmbeddedViewportModel","shared/views/AbstractView","device","shared/utils/IconFontMap"],function(e,t,i,n,r,o,s){"use strict";return r.extend({id:"flippers",leftArrow:null,rightArrow:null,scaleData:null,smallWindowThreshold:600,options:null,initialize:function(){r.prototype.initialize.call(this),o.desktop()&&e(document).bind("keydown",t.bind(this.keyHandler,this)),this.render(),this.bindInteraction(this.leftArrow,t.bind(this._previousPage,this)),this.bindInteraction(this.rightArrow,t.bind(this._nextPage,this)),this.bindInteraction(this.$el)},onClose:function(){r.prototype.initialize.call(this),this.unbindInteraction(this.leftArrow),this.unbindInteraction(this.rightArrow),this.unbindInteraction(this.$el)},render:function(){this.leftArrow=e("<div>",{class:"prev left",css:{"background-color":this.options.menuBackgroundColor}}),this.leftArrowA=e("<a>",{title:"Previous Page",href:"#",html:s.LEFT_ARROW,css:{color:this.options.menuForegroundColor}}),this.leftArrow.append(this.leftArrowA),this.rightArrow=e("<div>",{class:"next right",css:{"background-color":this.options.menuBackgroundColor}}),this.rightArrowA=e("<a>",{title:"Next Page",href:"#",html:s.RIGHT_ARROW,css:{color:this.options.menuForegroundColor}}),this.rightArrow.append(this.rightArrowA);var t=this.options.menuHoverOpacity;o.touch()&&(this.leftArrowA.bind("touchstart",function(){e(this).css("opacity",t)}).bind("touchend",function(){e(this).css("opacity","1.0")}),this.rightArrowA.bind("touchstart",function(){e(this).css("opacity",t)}).bind("touchend",function(){e(this).css("opacity","1.0")})),o.desktop()&&(this.leftArrowA.hover(function(){e(this).css("opacity",t)},function(){e(this).css("opacity","1.0")}),this.rightArrowA.hover(function(){e(this).css("opacity",t)},function(){e(this).css("opacity","1.0")})),this.disableNext(),this.disablePrevious(),this.$el.append(this.leftArrow),this.$el.append(this.rightArrow),!1===this.options.arrowsEnabled&&this.hide()},scale:function(e){e&&(this.scaleData=e);var t=this.scaleData.height,i=this.scaleData.marginTop,r=this.scaleData.originalWindowWidth;this.scaleData.windowHeight<this.smallWindowThreshold||r<this.smallWindowThreshold?(this.rightArrow.addClass("small"),this.leftArrow.addClass("small")):(this.leftArrow.removeClass("small"),this.rightArrow.removeClass("small"));var o,s=parseFloat(this.rightArrowA.css("height")),a=n.getInstance();o=a.isActive()?a.getVerticalCenterOfVisibleArea(t)-s/2:t/2-s/2+i,o=Math.round(o)+"px",this.leftArrow.css("top",o),this.rightArrow.css("top",o)},isPreviousDisabled:function(){return this.leftArrow.hasClass("disabled")},isNextDisabled:function(){return this.rightArrow.hasClass("disabled")},disablePrevious:function(){this.isPreviousDisabled()||(this.leftArrow.addClass("disabled"),this.leftArrowA.attr("title",""))},disableNext:function(){this.isNextDisabled()||(this.rightArrow.addClass("disabled"),this.rightArrowA.attr("title",""))},enablePrevious:function(){this.isPreviousDisabled()&&(this.leftArrow.removeClass("disabled"),this.leftArrowA.attr("title","Previous Page"))},enableNext:function(){this.isNextDisabled()&&(this.rightArrow.removeClass("disabled"),this.rightArrowA.attr("title","Next Page"))},show:function(){!0===this.options.arrowsEnabled&&this.$el.show()},hide:function(){this.$el.hide()},_nextPage:function(e){e.preventDefault(),this.options.module.trigger(this.options.module.publishedEvents.NEXT_PAGE)},_previousPage:function(e){e.preventDefault(),this.options.module.trigger(this.options.module.publishedEvents.PREVIOUS_PAGE)},keyHandler:function(e){(!e.target||"SELECT"!=e.target.tagName&&"INPUT"!=e.target.tagName&&"TEXTAREA"!=e.target.tagName)&&(e.metaKey||e.ctrlKey||e.altKey||e.shiftKey||this.options.arrowsEnabled&&(39!==e.keyCode||this.isNextDisabled()?37!==e.keyCode||this.isPreviousDisabled()?37!==e.keyCode&&39!==e.keyCode||(e.stopPropagation(),e.preventDefault()):(e.stopPropagation(),e.preventDefault(),this._previousPage(e)):(e.stopPropagation(),e.preventDefault(),this._nextPage(e))))}})}),define("modules/flippers/module",["jquery","lodash","ceros","globals","color","shared/models/EmbeddedViewportModel","modules/flippers/views/FlippersView","shared/utils/ModuleEventManager"],function(e,t,i,n,r,o,s,a){"use strict";var u=new i.Module({id:"flippers",description:"Provides left/right (previous/next) arrows for navigation between pages",version:"1.0",flippersView:null,publishedEvents:{NEXT_PAGE:"flippers.next_page",PREVIOUS_PAGE:"flippers.previous_page"},dependencies:{viewport:"1.0"},delegate:{load:function(e){var i={theme:t.isUndefined(n.themeObj)?{}:n.themeObj};this.options=t.extend({},i,e);var o=this.options.theme.menuFgColor,a=this.options.theme.menuBgColor,l=r.fromHex(o);l.a=.1,this.flippersView=new s({arrowsEnabled:this.options.theme.arrowsEnabled,menuBackgroundColor:a,menuBorderColor:l,menuForegroundColor:o,menuHoverOpacity:this.options.theme.menuHoverOpacity,module:u}),this.registerEvents()},el:function(){if(this.flippersView)return this.flippersView.$el;throw new Error("FlippersView is missing")},show:function(){if(!this.flippersView)throw new Error("FlippersView is missing");this.flippersView.show()},hide:function(){if(!this.flippersView)throw new Error("FlippersView is missing");this.flippersView.hide()},updateScale:function(e){if(!this.flippersView)throw new Error("FlippersView is missing");this.flippersView.scale(e)},determineFlipperState:function(e,t,i){var n=!i||e,r=!i||t;this.updateFlippers(n,r)},updateFlippers:function(e,t){if(!this.flippersView)throw new Error("FlippersView is missing");e?this.flippersView.disablePrevious():this.flippersView.enablePrevious(),t?this.flippersView.disableNext():this.flippersView.enableNext()},registerEvents:function(){o.getInstance().on("change",t.bind(function(){this.flippersView.scale(null)},this))}}});return u}),define("ImageUtils",["device"],function(e){"use strict";return{calculateWidthForDevicePixelRatio:function(t){return t*e.pixelRatio()}}}),define("shared/utils/DelegateUtils",["lodash"],function(e){"use strict";return{mergeDelegates:function(t){for(var i=1;i<arguments.length;i++){var n=arguments[i];if(e.isObject(n))for(var r in n)e.isFunction(n[r])?t[r]=e.bind(n[r],t):t[r]=n[r]}}}}),define("shared/utils/ScrollbarUtils",["lodash"],function(e){"use strict";var t=null;return{getScrollbarWidth:function(){if(!e.isNull(t))return t;var i=document.createElement("div");i.style.visibility="hidden",i.style.width="100px",document.body.appendChild(i);var n=i.offsetWidth;i.style.overflow="scroll";var r=document.createElement("div");r.style.width="100%",i.appendChild(r);var o=r.offsetWidth;return i.parentNode.removeChild(i),t=n-o}}}),define("shared/utils/ScaleContext",["log","jquery","lodash","backbone","globals","shared/utils/ScrollbarUtils","device","modules/page/utils/PlayerVariantService","modules/page/utils/PlayerVariantDetector"],function(e,t,i,n,r,o,s,a,u){"use strict";var l=function(e){this.initialize(e)};return l.prototype={documentVersion:null,marginTopCallback:null,module:null,cachedScale:{},initialize:function(e){this.documentVersion=e.documentVersion,this.marginTopCallback=e.marginTopCallback,this.module=e.module},getCurrentWindowScaleContext:function(){var e=t(window),i=a.getExperienceContainerDimensions(e);return this._calculateScaleInternal(i.width,i.height)},isPreviewFullScreenMode:function(){return r.previewMode&&a.fullScreenMode},_calculateScaleInternal:function(e,n){var o=this.documentVersion.getExperienceWidth(),l=r.heightOverride||this.documentVersion.getExperienceHeight(),c=this.documentVersion.getScaleExperience(),h=t(window),d=a.getExperienceContainerDimensions(h),f=e+"x"+n+"-"+d.width+"x"+d.height+"-"+u.getVariant();if(!i.has(this.cachedScale,f)){var p={width:e,height:n,marginTop:this.marginTopCallback(),windowWidth:e,windowHeight:n,ratio:1,constrainedByHeight:!1,constrainedByWidth:!1,originalWindowWidth:d.width,originalWindowHeight:d.height},g=p.windowHeight+s.getSlackHeight(p.windowHeight)-p.marginTop;p.height=g,c&&(l/o>g/p.windowWidth?(p.constrainedByHeight=!0,p.ratio=p.height/l,p.width=o*p.ratio):(p.constrainedByWidth=!0,p.width=p.windowWidth,p.ratio=p.width/o)),p.adjustedRatio=p.ratio*s.pixelRatio(),this.cachedScale[f]=p}return this.cachedScale[f]},getPageScaleContext:function(e){var t=this.getCurrentWindowScaleContext();if(this.documentVersion.getScaleExperience()){var i=e.getPageHeight(this.documentVersion),n=this.documentVersion.getExperienceWidth(),r=Math.round(t.height/t.ratio),o=i<=r;t.constrainedByWidth&&!o&&(t=this.calculateNewScaleContextWhenConstrainedByWidthAndPageDoesNotFit(t,n,i))}return t},calculateNewScaleContextWhenConstrainedByWidthAndPageDoesNotFit:function(e,t,i){for(var n=o.getScrollbarWidth()*e.ratio,r=n;r>=0;r--){var s=(e.width-n+r)/t;if(!0===i<=Math.round(e.height/s)){n-=r;break}}var a=e.originalWindowWidth-n;return e=this._calculateScaleInternal(a,e.originalWindowHeight)},doBlurryFontFix:function(e){return(s.isBrowserChrome()&&s.desktop()||s.isDesktopSafari())&&e>=.8}},l}),define("modules/viewport/utils/PageLoadPolicy",["lodash"],function(e){"use strict";var t=function(e,t){this.lookBehind=1,this.lookAhead=1,this.isCircular=t,this.pageIndexes=e.sort(function(e,t){return e-t})};return t.prototype={getPageIndexesToLoad:function(t){var i=null,n=!1;e.each(this.pageIndexes,e.bind(function(e,r){return e===t?(i=r,n=!0,!1):e>t?(i=r,!1):void 0},this));var r;n?r=this.pageIndexes:(r=this.pageIndexes.slice(),null===i&&(i=r.length),r.splice(i,0,t));var o,s=[],a=i;for(o=0;o<this.lookBehind;o++){if(-1===--a){if(!this.isCircular)break;a=r.length-1}s.push(r[a])}var u=[];for(a=i,o=0;o<this.lookAhead;o++){if(++a===r.length){if(!this.isCircular)break;a=0}u.push(r[a])}return this.combinePageIndexArrays(r[i],s,u)},combinePageIndexArrays:function(t,i,n){for(var r=[t],o=0;o<n.length||o<i.length;)o<n.length&&r.push(n[o]),o<i.length&&r.push(i[o]),o++;return e.uniq(r)}},t}),define("modules/viewport/utils/GesturesBehavior",["log","jquery","lodash","globals","device","hammer"],function(e,t,i,n,r,o){"use strict";var s={startX:null,startY:null,lastDirection:null,xDistance:0,yDistance:0,gesturesEnabled:!0,swipeDirection:null,originalDirection:null};return{offsetTimeout:null,disableGestures:function(){s.gesturesEnabled=!1},enableGestures:function(){s.gesturesEnabled=!0},configureGestures:function(){var e={};r.isBrowserChrome()&&r.isAndroid()&&(e.inputClass=o.TouchInput),r.isMobileSafari()&&(e.touchAction="pan-x pan-y");var t=new o.Manager(this.$el[0],e);t.add(new o.Press({time:500})),r.isMobileSafari()&&(t.add(new o.Pinch),t.add(new o.Tap),t.get("pinch").set({enable:!0}),t.on("pinch pinchend pinchstart tap",function(e){"tap"===e.type&&2!==e.tapCount||e.preventDefault()})),t.on("press",i.bind(function(e){s.gesturesEnabled&&(e.preventDefault(),this.options.module.trigger(this.options.module.publishedEvents.LONGPRESS))},this)),t.on("hammer.input",i.bind(function(e){var t=e.eventType,r=e.deltaTime;if(s.gesturesEnabled){var a=this.getCurrentPage();if(this.isPageTransitioning())return void e.preventDefault();switch(t){case o.INPUT_START:this.pauseAnimationsOnMove=i.once(i.bind(function(){a.pauseAnimations()},this)),this.clearAutoTransitionDelay();break;case o.INPUT_MOVE:var u=e.deltaX,l=e.deltaY;if(s.xDistance=Math.abs(u),s.yDistance=Math.abs(l),!s.swipeDirection&&(s.xDistance>10||s.yDistance>10))s.xDistance>s.yDistance?s.swipeDirection=o.DIRECTION_HORIZONTAL:s.swipeDirection=o.DIRECTION_VERTICAL;else if(!s.swipeDirection)return;if(s.swipeDirection==o.DIRECTION_HORIZONTAL?s.lastDirection=u>0?o.DIRECTION_RIGHT:o.DIRECTION_LEFT:s.swipeDirection==o.DIRECTION_VERTICAL&&(s.lastDirection=l>0?o.DIRECTION_DOWN:o.DIRECTION_UP),i.isNull(s.originalDirection)||(s.originalDirection=s.lastDirection),s.originalDirection!=s.lastDirection&&(s.changedDirection=!0),s.swipeDirection==o.DIRECTION_HORIZONTAL){if(!n.themeObj.swipeEnabled)return;if(this.getPageCount()<=1&&this.documentVersion.getScaleExperience())return void e.preventDefault();var c=this.getNextPage(),h=this.getPreviousPage();if(!this.isValidHorizontalSwipe())return;if(i.isFunction(this.pauseAnimationsOnMove)&&this.pauseAnimationsOnMove(),n.isEmbedded&&(this._isSwipeRight()&&!h||this._isSwipeLeft()&&!c))return;c&&this._isSwipeLeft()&&(c.makeInTransition(),c.setBackgroundPositionAndScaleTransform(u+this.getPageViewportWidth(),!0)),h&&this._isSwipeRight()&&(h.makeInTransition(),h.setBackgroundPositionAndScaleTransform(u-this.getPageViewportWidth(),!0));var d=this._isSwipeOutOfPageBounds(),f=u;d&&(f=this._getRubberbandHorizontalDistance(),this._isSwipeLeft()&&(f*=-1)),this.getCurrentPage().setBackgroundPositionAndScaleTransform(f,!0),e.preventDefault()}break;case o.INPUT_END:case o.INPUT_CANCEL:if(s.swipeDirection==o.DIRECTION_HORIZONTAL){if(!this.isValidHorizontalSwipe())return;if(this.pauseAnimationsOnMove=null,!n.themeObj.swipeEnabled)return void this.setAutoTransitionDelay();var p=s.xDistance/r;if(!this._isSwipeOutOfPageBounds()&&t==o.INPUT_END&&(this._isDistancePageChangeSwipe(s.xDistance)||this._isVelocityPageChangeSwipe(p))){var g=this.calculateRemainingTransitionTime(s.xDistance,r);this._isSwipeLeft()?this._slideLeft(g):this._isSwipeRight()&&this._slideRight(g)}else this._abortSlide(r)}s.xDistance=0,s.yDistance=0,s.lastDirection=null,s.swipeDirection=null,s.originalDirection=null,s.changedDirection=!1;break;default:e.preventDefault()}}},this))},isValidHorizontalSwipe:function(){if(!this.documentVersion.getScaleExperience()){if(!this._isAtLeft()&&!this._isAtRight())return!1;if(this._isAtLeft()&&!this._isSwipeRight())return!1;if(this._isAtRight()&&!this._isSwipeLeft())return!1}return!0},_getPageTopWithOffset:function(){var e=this.getCurrentPage();return this._isAtTop()?this._getPageTop(e):this._isAtBottom()?this._getPageTop(e)+this.MOBILE_PAGE_SCROLL_HEIGHT_OFFSET:this._getPageTop(e)+this.MOBILE_PAGE_SCROLL_HEIGHT_OFFSET/2},_isAtTop:function(){return this.getCurrentPage().$el.scrollTop()<=0},_isAtBottom:function(){var e=this.getCurrentPage(),t=e.$el.height(),i=e.$pageScroll.height(),n=i-t;return e.$el.scrollTop()>=n},_isAtLeft:function(){return-1*this.getCurrentPage().$pageScroll.offset().left<=0},_isAtRight:function(){var e=this.getCurrentPage(),t=e.$el.width(),i=e.$pageScroll.width(),n=i-t;return-1*e.$pageScroll.offset().left>=n},_isSwipeOutOfPageBounds:function(){return this.isFirstPage()&&this._isSwipeRight()||this.isLastPage()&&this._isSwipeLeft()},_getRubberbandHorizontalDistance:function(){var e=this.getPageViewportWidth();return s.xDistance>=.5*e?.25*e:(e-s.xDistance)/e*s.xDistance},_isSwipeLeft:function(){return s.lastDirection==o.DIRECTION_LEFT},_isSwipeRight:function(){return s.lastDirection==o.DIRECTION_RIGHT},_isSwipeUp:function(){return s.lastDirection==o.DIRECTION_UP},_isSwipeDown:function(){return s.lastDirection==o.DIRECTION_DOWN},_abortSlide:function(e){var t=this.getCurrentPage();if(0!==t.getLeft()){this.isPageTransitionInProgress=!0;var n=this.calculateTransitionTime(s.xDistance,e);t.el().animate({"background-position-x":0},{duration:n,easing:"easeOutCubic",step:i.bind(function(e,i){t.setBackgroundPositionAndScaleTransform(e,!0),this.getNextPage()&&this.getNextPage().setBackgroundPositionAndScaleTransform(e+this.getPageViewportWidth(),!0),this.getPreviousPage()&&this.getPreviousPage().setBackgroundPositionAndScaleTransform(e-this.getPageViewportWidth(),!0)},this),complete:i.bind(function(){this.isPageTransitionInProgress=!1;var e=this.getNextPage();e&&e.makePending();var i=this.getPreviousPage();i&&i.makeViewed(),t.resumeAnimations(),this.setAutoTransitionDelay()},this)})}},_isDistancePageChangeSwipe:function(e){return e>=.2*this.getPageViewportWidth()},_isVelocityPageChangeSwipe:function(e){return e>.6},_slideRight:function(e){return this._slide("right",this.getPreviousPage(),e)},_slideLeft:function(e){return this._slide("left",this.getNextPage(),e)},_slide:function(e,t,i){"left"===e?this.nextPage(i):this.previousPage(i)},calculateTransitionTime:function(e,t){return this._calculateTransitionTimeInternal(e,t,!1)},calculateRemainingTransitionTime:function(e,t){return this._calculateTransitionTimeInternal(e,t,!0)},_calculateTransitionTimeInternal:function(e,t,i){var n=1e3,r=e/t,o=e/this.getPageViewportWidth();i&&(o=1-o),n*=o;var s=n/r;return s>n&&(s=n),s}}}),define("modules/viewport/views/ViewportView",["log","jquery","lodash","backbone","globals","ImageUtils","shared/utils/DelegateUtils","shared/utils/CerosResourceLoader","shared/utils/ScaleContext","shared/utils/ScrollbarUtils","device","shared/views/AbstractView","modules/viewport/utils/PageLoadPolicy","modules/viewport/utils/GesturesBehavior","modules/page/utils/PlayerVariantService"],function(e,t,i,n,r,o,s,a,u,l,c,h,d,f,p){"use strict";var g={NONE:0,LEFT:1,RIGHT:2};return h.extend({id:"viewport",documentVersion:null,module:null,pageJumpFrom:null,currentPage:null,currentPageSlug:null,pageViews:null,leftThresholdA:null,leftThresholdB:null,rightThresholdA:null,rightThresholdB:null,clickShield:null,isPageTransitionInProgress:!1,autoTransitionDelay:null,backgroundImage:null,scaleContext:null,scrollPositionsByPage:{},viewportContainer:null,backgroundContainerEl:null,backgroundImageEl:null,backgroundImageResource:null,backgroundImageInfo:null,MOBILE_PAGE_SCROLL_HEIGHT_OFFSET:2,initialize:function(){this.documentVersion=this.options.documentVersion,this.scaleContext=this.options.scaleContext,this.module=this.options.module,h.prototype.initialize.call(this),t(window).bind("resize",i.bind(this.scale,this)),c.touch()&&(s.mergeDelegates(this,f),this.configureGestures()),this.clickShield=t('<div class="click-shield"></div>'),this.addClickShield(),this.reset(null),r.previewMode&&this.listenForRemoteChanges(),i.each(this.documentVersion.pages,i.bind(function(e){e.on("change:disabled",function(){this.module.trigger(this.module.publishedEvents.PAGE_ENABLED_CHANGE,{slug:this.currentPageSlug,isFirstPage:this.isFirstPage(),isLastPage:this.isLastPage(),isPageReady:this.getCurrentPage().isReady()})},this)},this)),this.backgroundImageInfo=i.get(r,"themeObj.backgroundImage",null)},listenForRemoteChanges:function(){this.documentVersion.on("change:carousel",i.bind(function(){this.getCurrentPage()&&this.currentPageSlug&&(this.module.trigger(this.module.publishedEvents.PAGE_UPDATE,{slug:this.currentPageSlug,isFirstPage:this.isFirstPage(),isLastPage:this.isLastPage(),isPageReady:this.getCurrentPage().isReady()}),this.setAutoTransitionDelay())},this)),this.documentVersion.on(this.documentVersion.MANIFEST_ADD_PAGE,i.bind(function(e,t){var n=this.module.createSinglePageView(e,t);this.pageViews.splice(t,0,n),n.prepare().done(i.bind(function(){n.attach(),this.$el[0].appendChild(n.el()[0]),this.scale(),n.makePending(),this.currentPage=this.documentVersion.getPageNumberBySlug(this.currentPageSlug),this.module.trigger(this.module.publishedEvents.PAGE_UPDATE,{slug:this.currentPageSlug,isFirstPage:this.isFirstPage(),isLastPage:this.isLastPage(),isPageReady:this.getCurrentPage().isReady()})},this))},this)),this.documentVersion.on(this.documentVersion.MANIFEST_REMOVE_PAGE,i.bind(function(e){e+1===this.currentPage?this.module.trigger(this.module.publishedEvents.CURRENT_PAGE_DELETED):(this.pageViews.splice(e,1),this.currentPage=this.documentVersion.getPageNumberBySlug(this.currentPageSlug),this.module.trigger(this.module.publishedEvents.PAGE_UPDATE,{slug:this.currentPageSlug,isFirstPage:this.isFirstPage(),isLastPage:this.isLastPage(),isPageReady:this.getCurrentPage().isReady()}))},this)),this.documentVersion.on(this.documentVersion.MANIFEST_MOVE_PAGE,i.bind(function(e,t){var i=this.pageViews.splice(e,1)[0];this.pageViews.splice(t,0,i),this.currentPage=this.documentVersion.getPageNumberBySlug(this.currentPageSlug),this.module.trigger(this.module.publishedEvents.PAGE_UPDATE,{slug:this.currentPageSlug,isFirstPage:this.isFirstPage(),isLastPage:this.isLastPage(),isPageReady:this.getCurrentPage().isReady()})},this))},getNextPageIndex:function(){var e=!1;if(this.pageViews){e=this.currentPage+1;for(var t=this.pageViews[e-1];t&&t.isDisabled();)e++,t=this.pageViews[e-1];if(!t||t.isDisabled())if(this.documentVersion.isCarousel()){for(e=1;this.pageViews[e-1].isDisabled()&&e<this.currentPage;)e++;e>=this.currentPage&&(e=!1)}else e=!1}return e},getPreviousPageIndex:function(){var e=!1;if(this.pageViews){e=this.currentPage-1;for(var t=this.pageViews[e-1];t&&t.isDisabled();)e--,t=this.pageViews[e-1];if(!t||t.isDisabled())if(this.documentVersion.isCarousel()){for(e=this.pageViews.length;this.pageViews[e-1].isDisabled()&&e>this.currentPage;)e--;e<=this.currentPage&&(e=!1)}else e=!1}return e},isFirstPage:function(){return!1===this.getPreviousPageIndex()},isLastPage:function(){return!1===this.getNextPageIndex()},getCurrentPage:function(){return null!==this.pageViews&&this.pageViews[this.currentPage-1]},getNextPage:function(){var e=!1,t=this.getNextPageIndex();return t&&(e=this.pageViews[t-1]),e},getPreviousPage:function(){var e=!1,t=this.getPreviousPageIndex();return t&&(e=this.pageViews[t-1]),e},getPageCount:function(){return null===this.pageViews?0:this.pageViews.length},getPageViewportWidth:function(){return this.getCurrentPage().getScaleContext().originalWindowWidth},getExperienceWidth:function(){return this.documentVersion.getExperienceWidth()},getExperienceHeight:function(){return this.documentVersion.getExperienceHeight()},reset:function(e,t){if(this.$el.children().not("#ceros-branding").remove(),i.isNull(t)?this.currentPage=1:this.currentPage=t,null!==this.pageViews&&i.each(this.pageViews,function(e){e.close()}),this.pageViews=e,this.viewportContainer=document.createDocumentFragment(),null!==this.pageViews){this._updatePageCss();var n=[];i.each(this.pageViews,function(e){n.unshift(e.el()[0])}),i.each(n,i.bind(function(e){this.viewportContainer.appendChild(e)},this)),this.$el[0].appendChild(this.viewportContainer),this.scale()}},disablePage:function(e){this.pageViews[e-1].disable()},enablePage:function(e){this.pageViews[e-1].enable()},nextPage:function(e){if(null!==this.pageViews&&!this.isPageTransitioning()){var t=this.getNextPageIndex();if(t){var i=this.getCurrentPage(),n=this.getNextPage();this._preTransition(i,n),this.switchPage(t,g.RIGHT,e)}}},previousPage:function(e){if(null!==this.pageViews&&!this.isPageTransitioning()){var t=this.getPreviousPageIndex();if(t){var i=this.getCurrentPage(),n=this.getPreviousPage();this._preTransition(i,n),this.switchPage(t,g.LEFT,e)}}},doTransitionAnimation:function(e,n,r,o){if(r===g.NONE)return(new t.Deferred).resolve().promise();var s=new t.Deferred;this.isPageTransitionInProgress=!0,s.done(i.bind(function(){this.isPageTransitionInProgress=!1},this)),n.makeInTransition();var a=this.getPageViewportWidth()*(r===g.RIGHT?-1:1);return e.pauseAnimations(),e.el().animate({"background-position-x":a},{duration:o,easing:"easeOutCubic",step:i.bind(function(t){e.setBackgroundPositionAndScaleTransform(t,this.isPageTransitionInProgress),n.setBackgroundPositionAndScaleTransform(t-a,this.isPageTransitionInProgress)},this),complete:s.resolve}),s.promise()},_storePageScrollPosition:function(e){this.scrollPositionsByPage[e.getSlug()]=e.getScrollPosition()},_getStoredPageScrollPosition:function(e){return!i.isUndefined(e)&&i.has(this.scrollPositionsByPage,e.getSlug())?this.scrollPositionsByPage[e.getSlug()]:0},_preTransition:function(e,t){var i=e.getScaleContext();this._storePageScrollPosition(e),i.constrainedByHeight&&(this._hidePageScrollbar(e),this._hidePageScrollbar(t))},jumpToPage:function(e){if(null!==this.pageViews){var t=this.pageViews.length;e>=1&&e<=t&&(this.pageViews[e-1].isDisabled()||this.switchPage(e,g.NONE))}},isPageTransitioning:function(){return this.isPageTransitionInProgress},switchPage:function(e,t,n){if(!this.isPageTransitioning()){this.clearAutoTransitionDelay(),t==g.NONE||this.documentVersion.isAutoTransitioning()||this.getCurrentPage().pauseAnimations(),this.getCurrentPage().resetTimedTriggers();this.showPage(e,t,n).done(i.bind(function(){var e=this.getCurrentPage();this.activatePage(e),e.doCustomScaling()},this))}},showPage:function(e,n,r){n=n||g.NONE,r=r||500;var o=null;this.currentPage!==e&&(o=this.pageViews[this.currentPage-1]);var s=e-1;this.currentPage=e,this.currentPageSlug=this.pageViews[s].getSlug(),this.module.trigger(this.module.publishedEvents.PAGE_CHANGING,{slug:this.currentPageSlug,isFirstPage:this.isFirstPage(),isLastPage:this.isLastPage(),isPageReady:this.getCurrentPage().isReady()}),o&&o.reset();var a;if(this.documentVersion.shouldLazyLoad())a=[s];else{a=new d(this.documentVersion.getEnabledPageIndexes(),this.documentVersion.isCarousel()).getPageIndexesToLoad(s)}var u=new t.Deferred;this.attachPages(a,s).always(i.bind(function(){u.resolve()},this));var l=this.doTransitionAnimation(o,this.getCurrentPage(),n,r);return l.done(i.bind(function(){this._updatePageCss(),this._adjustPage()},this)),t.when(u,l)},_adjustPage:function(){var e=this.getCurrentPage();e.setScrollPosition(this._getStoredPageScrollPosition(e)),this._showPageScrollbar(e),this._focusPage(e)},_focusPage:function(e){r.isEmbedded||e&&e.focusScrollContainer()},activatePage:function(e){this.module.trigger(this.module.publishedEvents.PAGE_CHANGE,{slug:this.currentPageSlug,isFirstPage:this.isFirstPage(),isLastPage:this.isLastPage()}),e.activate(),this.setAutoTransitionDelay()},attachPages:function(n,r){var o=new t.Deferred;setTimeout(i.bind(function(){i.each(n,i.bind(function(e){this.pageViews[e].attach()},this)),"pending"===o.state()&&(e.devWarn("Page media took over 10 seconds"),o.reject())},this),1e4),this.module.trigger(this.module.publishedEvents.PAGE_BATCH_LOAD_START);var s=[];return i.each(n,i.bind(function(e){var t=this.pageViews[e],n=t.prepare();n.always(i.bind(t.attach,t)),(i.isUndefined(r)||e===r)&&s.push(n)},this)),t.when.apply(t,s).done(o.resolve),t.when.apply(t,s).fail(o.reject),o.promise()},_updatePageCss:function(){var e;i.each(this.pageViews,i.bind(function(t,i){e=i+1,e<this.currentPage&&!t.isViewed()?t.makeViewed():e!==this.currentPage||t.isTop()?e>this.currentPage&&!t.isPending()&&t.makePending():t.makeTop()},this))},scalePageComponents:function(){i.each(this.pageViews,function(e){e.scale()})},_showPageScrollbar:function(e){!c.isIos()&&this._doesPageFitInViewport(e)?e.$pageContainer.css("overflow-y","hidden"):e.$pageContainer.css("overflow-y","scroll")},_hidePageScrollbar:function(e){e.$pageContainer.css("overflow-y","hidden")},_doesPageFitInViewport:function(e){var t=e.model.getPageHeight(this.documentVersion);if(t<=(r.heightOverride||this.documentVersion.getExperienceHeight()))return!0;var i=e.getScaleContext();return t<=Math.round(i.windowHeight/i.ratio)},scale:function(e){var n,r,o=this.scaleContext.getCurrentWindowScaleContext(),s=this.getExperienceWidth(),a=this.documentVersion.getScaleExperience();t("#main").css({height:o.originalWindowHeight+"px",width:o.originalWindowWidth+"px"}),this.$el.css({height:o.originalWindowHeight+"px",width:o.originalWindowWidth+"px","margin-top":o.marginTop+"px"}),null!==this.pageViews&&i.each(this.pageViews,i.bind(function(e){var t=e.model.getPageHeight(this.documentVersion),i=e.getScaleContext(),u=this._doesPageFitInViewport(e),c=u?0:l.getScrollbarWidth();if(r=this.getPageViewOffsetTop(e,i),n=this.getPageViewOffsetLeft(e,i,c),i.constrainedByWidth&&i.windowWidth<i.originalWindowWidth&&u){var h=i.originalWindowWidth-i.windowWidth,d=h/i.ratio;n+=d/2}var f=a?"hidden":"scroll";e.$pageContainer.css({width:"100%",height:"100%","overflow-y":"scroll","overflow-x":f,position:"relative"}),this._showPageScrollbar(e);var p=0;e.isPending()?p=o.originalWindowWidth:e.isViewed()&&(p=-1*o.originalWindowWidth),a?this.setPageViewScaleTransformCss(e,i):e.$el.css({height:"100%",width:"100%"}),
e.setBackgroundPositionAndScaleTransform(p,this.isPageTransitionInProgress),a?e.$pageScroll.css({height:t+"px",width:s,left:n>=1?n:0,top:r>=1?r:0}):this.setPageScrollUnscaledCss(e,t,s,i),e.$pinnedContainer&&this.setPinnedContainerCss(t,i,n,r,c,s,e)},this));var u=this.getCurrentPage();!1!==u&&(this._focusPage(u),this.module.isFirstPageReadyToShow()&&u.onScrollAndWindowResize()),this.module.trigger(this.module.publishedEvents.SCALE,o)},setPageScrollUnscaledCss:function(e,t,i,n){e.$pageScroll.css({height:t+"px",width:i});var r="";t<=n.height?(r+="translateY(-50%) ",e.$pageScroll.css({top:"50%"})):e.$pageScroll.css({top:""}),i<=n.windowWidth?(r+="translateX(-50%)",e.$pageScroll.css({left:"50%"})):e.$pageScroll.css({left:""}),e.$pageScroll.css({transform:r})},setPinnedContainerCss:function(e,t,n,r,o,s,a){var u={height:e+"px",width:t.width/t.ratio,left:n>=1?n:0,top:r>=1?r:0};o?i.extend(u,{"max-width":s,width:t.originalWindowWidth/t.ratio-o}):i.extend(u,{width:s}),a.$pinnedContainer.css(u)},setPageViewScaleTransformCss:function(e,t){var i,n;c.isIpad()||this.scaleContext.doBlurryFontFix(t.ratio)?(i="zoom",n=t.ratio):(i="transform",n="scale("+t.ratio+","+t.ratio+")"),e.storeScaleTransform(i,n);var r={height:t.height/t.ratio+"px",width:t.originalWindowWidth/t.ratio+"px"};r[i]=n,e.$el.css(r)},addClickShield:function(){this.$el.before(this.clickShield),this.clickShield.show()},removeClickShield:function(){this.clickShield.detach()},setAutoTransitionDelay:function(){this.clearAutoTransitionDelay(),this.documentVersion.isAutoTransitioning()&&(this.autoTransitionDelay=i.delay(i.bind(function(){this.clearAutoTransitionDelay(),this.nextPage()},this),1e3*this.documentVersion.getAutoTransitionDelay()))},clearAutoTransitionDelay:function(){clearTimeout(this.autoTransitionDelay),this.autoTransitionDelay=null},preloadMedia:function(){this.getBackgroundImagePromise()},getBackgroundImagePromise:function(){return this.backgroundImageResource?this.backgroundImageResource.getPromise():i.isNull(this.backgroundImageInfo)?t.Deferred().reject().promise():(this.loadBackgroundImage(),this.backgroundImageResource.getPromise())},loadBackgroundImage:function(){this.backgroundImageResource&&this.backgroundImageResource.cancel();var e=this.calculateBackgroundImageDimensions();this.bgImageWidth=e.width,this.bgImageHeight=e.height;var t=o.calculateWidthForDevicePixelRatio(this.bgImageWidth);return this.backgroundImageResource=a.addRasterImage(this.backgroundImageInfo.id,t),this.backgroundImageResource.loadNow(),this.backgroundImageResource},showBackground:function(e){e&&(this.backgroundContainerEl=t("#backgroundContainer"),this.backgroundImageEl=t("<img>",{width:20,height:20}),this.backgroundContainerEl.empty().append(this.backgroundImageEl),this.backgroundImageEl.load(i.bind(this.scaleBackground,this)).attr("src",e.getSrc()),t(window).on("resize",i.throttle(i.bind(this.resizeBackgroundImage,this),200)),this.backgroundContainerEl.fadeIn())},resizeBackgroundImage:function(){this.loadBackgroundImage().getPromise().then(i.bind(function(e){t(this.backgroundImageEl).attr("src")===e.getSrc()?this.scaleBackground():t(this.backgroundImageEl).attr("src",e.getSrc())},this))},scaleBackground:function(){var e=this.getWindowWidth(),t=this.getWindowHeight();this.backgroundContainerEl.width(e).height(t),this.backgroundImageEl.width(this.bgImageWidth).height(this.bgImageHeight).css({left:"-"+(this.bgImageWidth>e?this.bgImageWidth/2-e/2:0)+"px"})},getWindowWidth:function(){var e=t(window);return p.getExperienceContainerWidth(e)},getWindowHeight:function(){var e=t(window),i=p.getExperienceContainerHeight(e);return i+=c.getSlackHeight(i)},getPageViewOffsetTop:function(e,t){return this.documentVersion.getScaleExperience()&&t.constrainedByHeight?0:Math.max(0,(t.height/t.ratio-e.model.getPageHeight(this.documentVersion))/2)},getPageViewOffsetLeft:function(e,t,i){var n,r=this.documentVersion.getScaleExperience();if(i)n=i;else{n=this._doesPageFitInViewport(e)?0:l.getScrollbarWidth()}return r&&t.constrainedByWidth?0:Math.max(0,(t.windowWidth/t.ratio-this.getExperienceWidth()-n)/2)},calculateBackgroundImageDimensions:function(){var e=this.backgroundImageInfo.original.width,t=this.backgroundImageInfo.original.height,i=this.getWindowWidth()/e,n=this.getWindowHeight()/t,r=i>n?i:n;return{width:Math.round(r*e),height:Math.round(r*t)}}})}),define("socialSharing",["jquery","lodash","urlUtils"],function(e,t,i){"use strict";return{shareOnTwitter:function(e,t){var n={url:e,text:t},r=i.appendQueryParams("http://twitter.com/share",n);window.open(r,"_blank","width=450,height=300")},shareOnLinkedIn:function(e,t){var n={url:e,mini:"true",title:t},r=i.appendQueryParams("http://www.linkedin.com/shareArticle",n);window.open(r,"_blank","width=520,height=570")},shareOnPinterest:function(e,t,n){var r={url:e,media:t};n&&(r.description=n);var o=i.appendQueryParams("http://pinterest.com/pin/create/button/",r);window.open(o,"_blank","width=810,height=530")},shareOnFacebook:function(e,t,n,r){var o={s:100,"p[url]":e};t&&(o["p[images][0]"]=t),n&&(o["p[title]"]=n),r&&(o["p[summary]"]=r);var s=i.appendQueryParams("http://www.facebook.com/sharer.php",o);window.open(s,"_blank","width=450,height=300")},shareViaEmail:function(t,n){var r={subject:n,body:"I thought you might like this. Here's a link to it on the web: "+t},o=document.createElement("a");o.href=i.appendQueryParams("mailto:",r),e("body").append(o),o.click(),e(o).remove()}}}),define("modules/page/views/AbstractPageChildView",["jquery","lodash","backbone","shared/views/AbstractView"],function(e,t,i,n){"use strict";return n.extend({initiallyVisible:!0,mediaHasBeenLoaded:!0,childViews:null,initialize:function(){n.prototype.initialize.call(this),this.parentViews=[],this.visible=this.options.visible,this.initiallyVisible=this.options.visible,this.mediaHasBeenLoaded=this.options.visible},close:function(){},preloadMedia:function(){},preloadMediaNow:function(){},attachMedia:function(){},scaleComponent:function(){},doCustomScaling:function(){},getRatioForCustomScaling:function(){return 1},onAttach:function(){},pauseAnimations:function(){},resumeAnimations:function(){},reset:function(){},getExtents:function(){},getId:function(){return this.id},isInitiallyVisible:function(){return this.initiallyVisible},runAllChildViewExitAnimaions:function(){},areAllParentsVisible:function(){}})}),define("ExtentsUtils",["backbone","lodash"],function(e,t){"use strict";return{getExtentsFromDimensions:function(e,t,i,n,r,o){var s=this.getExtentsPointsFromDimensions(e,t,i,n,r,o);return{x1:Math.round(Math.min(s[0].x,s[1].x,s[2].x,s[3].x)),y1:Math.round(Math.min(s[0].y,s[1].y,s[2].y,s[3].y)),x2:Math.round(Math.max(s[0].x,s[1].x,s[2].x,s[3].x)),y2:Math.round(Math.max(s[0].y,s[1].y,s[2].y,s[3].y))}},getExtentsPointsFromDimensions:function(e,t,i,n,r,o){if(e-=o,t-=o,i+=2*o,n+=2*o,0!==r){var s=e+i/2,a=t+n/2;return[Math.rotateCoord(e,t,s,a,r),Math.rotateCoord(e+i,t,s,a,r),Math.rotateCoord(e+i,t+n,s,a,r),Math.rotateCoord(e,t+n,s,a,r)]}return[new window.CerosMath.Point(e,t),new window.CerosMath.Point(e+i,t),new window.CerosMath.Point(e+i,t+n),new window.CerosMath.Point(e,t+n)]},getSmallestContainingRectangle:function(){var i,n,r,o,s;return t.each(arguments,function(a){s=a instanceof e.Model&&t.isFunction(a.getExtents)?a.getExtents():a,void 0===i?(i=s.x1,n=s.y1,r=s.x2,o=s.y2):(i=Math.min(i,s.x1),n=Math.min(n,s.y1),r=Math.max(r,s.x2),o=Math.max(o,s.y2))}),0===arguments.length&&(i=0,n=0,r=0,o=0),{x1:i,y1:n,x2:r,y2:o}},getSmallestContainingRectangleInPageCoords:function(){var e,i,n,r,o;return t.each(arguments,function(t){o=t.getExtentsInPageCoords(),void 0===e?(e=o.x1,i=o.y1,n=o.x2,r=o.y2):(e=Math.min(e,o.x1),i=Math.min(i,o.y1),n=Math.max(n,o.x2),r=Math.max(r,o.y2))}),0===arguments.length&&(e=0,i=0,n=0,r=0),{x1:e,y1:i,x2:n,y2:r}},createHoverArea:function(e,t,i){var n,r,o,s,a=[],u=i?1:0;return n=e.y1<t.y1?e:t,a.push({x:n.x1,y:n.y1}),a.push({x:n.x2+u,y:n.y1}),s=e.x2>t.x2?e:t,s!==n&&a.push({x:s.x2+u,y:s.y1}),a.push({x:s.x2+u,y:s.y2+u}),r=e.y2>t.y2?e:t,r!==s&&a.push({x:r.x2+u,y:r.y2+u}),a.push({x:r.x1,y:r.y2+u}),o=e.x1<t.x1?e:t,o!==r&&a.push({x:o.x1,y:o.y2+u}),o!==n&&a.push({x:o.x1,y:o.y1}),a}}}),define("modules/page/views/FolderView",["jquery","lodash","backbone","modules/page/views/AbstractPageChildView","ExtentsUtils"],function(e,t,i,n,r){"use strict";return n.extend({initialize:function(){n.prototype.initialize.call(this),this.childViews={}},hide:function(){t.each(this.childViews,function(e){e.hide()})},addContainerId:function(e){t.each(this.childViews,function(t){t.addContainerId(e)})},addParentView:function(e){this.parentViews.push(e),t.each(this.childViews,function(t){t.addParentView(e)})},areAllParentsVisible:function(){return t.every(this.parentViews,function(e){return e.visible})},runAllChildViewExitAnimations:function(i){this.runningExitAnimations=!0,i=i||[],t.each(this.childViews,function(e){e.runAllChildViewExitAnimations(i)});var n=this;return e.when.apply(e,i).done(function(){n.runningExitAnimations=!1}),i},reset:function(){this.runningExitAnimations=!1},getExtents:function(){var e;return this.childViews?t.each(this.childViews,function(t){var i=t.getExtents();e=e?r.getSmallestContainingRectangle(e,i):i}.bind(this)):e={},e}})}),define("sequenceBuilder",["log","jquery","lodash"],function(e,t,i){"use strict";var n="undefined"!=typeof WebKitAnimationEvent?"-webkit-":"undefined"!=typeof AnimationEvent?"":null,r=function(){this.ruleBuffer=[],this.keyframeInc=0,this.keyframeMap={},this.sequenceInc=0,this.sequenceMap={},this.pauseClassCache=[]};i.extend(r.prototype,{reset:function(){this.ruleBuffer=[],this.keyframeInc=0,this.keyframeMap={},this.sequenceInc=0,this.sequenceMap={},this.pauseClassCache=[]},_generateKeyframe:function(e,t,r,o){var s=e+"|"+JSON.stringify(t);if(0!==o&&(s+="|"+r+"|"+o),this.keyframeMap.hasOwnProperty(s))return this.keyframeMap[s];var a="@"+n+"keyframes keyframe"+this.keyframeInc+"{",u=i.sortBy(i.keys(t),function(e){return parseInt(e,10)});if(0===o)i.each(u,function(i){a+=i+"{"+e+":"+t[i]+"}"});else{var l=i.round(o/(o+r)*100,5),c=100-l;a+="0%{"+e+":"+t["0%"]+"}"+l+"%{"+e+":"+t["0%"]+"}",i.each(u,function(i){"0%"!=i&&(a+=Math.round(l+c*(parseInt(i,10)/100))+"%{"+e+":"+t[i]+"}")})}return a+="}",this.ruleBuffer.push(a),this.keyframeMap[s]="keyframe"+this.keyframeInc++,this.keyframeMap[s]},_generatePauseClass:function(e){var t="sequencePause"+e;if(!i.includes(this.pauseClassCache,t)){this.pauseClassCache.push(t);var r=[];i(e).times(function(){r.push("paused")}),this.ruleBuffer.push("."+t+"{"+n+"animation-play-state:"+r.join(",")+" !important;}")}return t},_generateRunClass:function(e,t,r,o){var s="sequenceRun"+this.sequenceInc++;return this.ruleBuffer.push("."+s+"{"+n+"animation-name:"+e.join(",")+";"+n+"animation-duration:"+t.join(",")+";"+n+"animation-timing-function:"+r.join(",")+";"+n+"animation-fill-mode:"+i.map(e,function(){return"both"}).join(",")+";"+n+"animation-play-state:"+i.map(e,function(){return"running"}).join(",")+";"+n+"animation-iteration-count:"+o.join(",")+";}"),s},generate:function(e){var t=i.map(e,function(e){return e.getKey()}).join("&");if(!this.sequenceMap.hasOwnProperty(t)){var r=[],o=[],s=[],a=[],u=this;i.each(e,function(e){var t="transform"==e.property?n+"transform":e.property;r.push(u._generateKeyframe(t,e.frames,e.duration,e.delay)),o.push(e.duration+e.delay+"ms"),s.push(e.easing),a.push(e.iterations)}),this.sequenceMap[t]={runClass:this._generateRunClass(r,o,s,a),pauseClass:this._generatePauseClass(e.length)}}return this.sequenceMap[t]},flush:function(){this.ruleBuffer.length>0&&(t("head").append(t("<style></style>").html(this.ruleBuffer.join("\n"))),this.ruleBuffer=[])}});var o=null;return function(){return null===o&&(o=new r),o}()}),define("shared/utils/AnimationTweenDelegate",["log","jquery","lodash"],function(e,t,i){"use strict";var n={Tween:function(e,t,i,n,r,o){if(this.property=e,this.frames=t,this.duration=i,this.delay=n||0,this.iterations=r,this.easing=o,!this.frames.hasOwnProperty("0%"))throw Error("Tween must define 0% keyframe!");if(!this.frames.hasOwnProperty("100%"))throw Error("Tween must define 100% keyframe!");this._normalize()}};return n.Tween.prototype={_normalize:function(){i.isUndefined(this.iterations)?this.iterations=1:i.isNumber(this.iterations)?(this.iterations=parseInt(this.iterations,10),this.iterations<0&&(this.iterations=0)):this.iterations="infinite"},getKey:function(){for(var e=i.values(this),t=0;t<e.length;t++)"object"==typeof e[t]&&(e[t]=JSON.stringify(e[t]));return e.join("|")}},n}),define("shared/utils/CssUtils",["lodash"],function(e){"use strict";return{concatTransform:function(t,i){return(e.isUndefined(t)||"none"===t)&&(t=""),i=t+" "+i,i.trim()},removeMatrixTransformAndAddNewScaleTransform:function(e,t){return e=e.replace(/matrix\(.*\)/g,""),e=e.replace(/scale\(.*\)/g,""),e=e.replace(/none/g,""),e+=" scale("+t+")",e.trim()}}}),define("shared/utils/WebkitUtils",["shared/utils/CssUtils","device"],function(e,t){"use strict";return{hardwareAccelerateTransform:function(t){return e.concatTransform(t,"translate3d(0,0,0)")},requiresHardwareAccelerateTransform:function(e,i){return t.isDesktopSafari()||t.isIos()&&(e||i)}}}),define("animation",["log","jquery","lodash","backbone","device","sequenceBuilder","shared/utils/DelegateUtils","shared/utils/AnimationTweenDelegate","shared/utils/WebkitUtils","cssHooksTransform"],function(e,t,i,n,r,o,s,a,u){"use strict";var l="undefined"!=typeof WebKitAnimationEvent?"webkitAnimationEnd":"undefined"!=typeof AnimationEvent?"animationend":null,c="undefined"!=typeof WebKitAnimationEvent?"webkitAnimationStart":"undefined"!=typeof AnimationEvent?"animationstart":null,h=function(e){var i=t.extend({$el:null,name:"unknown"},e||{});this.$el=i.$el,this.name=i.name,this.compiled=!1,this.tweens=[],this.eventState={},this.runClass=null,this.pauseClass=null,this.initialState={},this.finalState={},this.loop=!1,this.requiresHardwareAcceleration=i.requiresHardwareAcceleration};return h.EASING={EASE:"ease",EASE_IN:"ease-in",EASE_OUT:"ease-out",EASE_IN_OUT:"ease-in-out",LINEAR:"linear"},h.RUNNING_STATE="running",h.COMPLETE_STATE="complete",h.START_EVENT="start",h.PAUSE_EVENT="pause",h.RESUME_EVENT="resume",h.END_EVENT="end",s.mergeDelegates(h,a),i.extend(h.prototype,n.Events,{add:function(t){return this.compiled?(e.warn("Animation already compiled!"),this):(this.tweens.push(t),this)},compile:function(){if(this.compiled)return this;if(i.isEmpty(this.tweens))return this;var e=o.generate(this.tweens);return this.runClass=e.runClass,this.pauseClass=e.pauseClass,this._buildRestingStates(),this.compiled=!0,this},precompile:function(e){if(i.isUndefined(e)||(this.$el=e),!i.isNull(this.$el)){var t={};i.each(["opacity","left","top","transform"],i.bind(function(e){t[e]=this.$el.css(e)},this)),this.initialState=t}},_buildRestingStates:function(){i.each(this.tweens,i.bind(function(e){this.initialState[e.property]=e.frames["0%"],this.finalState[e.property]=e.frames["100%"]},this)),i.has(this.finalState,"transform")&&this.requiresHardwareAcceleration&&(this.finalState.transform=u.hardwareAccelerateTransform(this.finalState.transform))},resetToInitialState:function(){i.isNull(this.$el)||this.$el.css(this.initialState)},setToFinalState:function(){i.isNull(this.$el)||this.$el.css(this.finalState)},isRunning:function(){return!i.isNull(this.$el)&&this.$el.hasClass(this.runClass)},isPaused:function(){return!i.isNull(this.$el)&&this.$el.hasClass(this.pauseClass)},play:function(e){if(this.compile(),i.isUndefined(e)||(this.$el=e),!i.isNull(this.$el))return o.flush(),this.eventState={},this.$el.bind(l,i.bind(function(e){e.originalEvent.target===this.$el[0]&&(this.eventState[e.originalEvent.animationName]=!1),i.every(i.values(this.eventState),function(e){return!e})&&this.finish()},this)),this.$el.bind(c,i.bind(function(e){e.originalEvent.target===this.$el[0]&&(this.eventState[e.originalEvent.animationName]=!0)},this)),this.$el[0].offsetWidth,"none"===this.$el.css("display")&&this.$el.show(),this.$el.addClass(this.runClass),this.trigger(h.START_EVENT),this},pause:function(){this.compiled&&!i.isNull(this.$el)&&this.isRunning()&&!this.isPaused()&&(this.$el.addClass(this.pauseClass),this.trigger(h.PAUSE_EVENT))},resume:function(){this.compiled&&!i.isNull(this.$el)&&this.isPaused()&&(this.$el.removeClass(this.pauseClass),this.trigger(h.RESUME_EVENT))},finish:function(){this.$el.css(this.finalState),"0"===this.$el.css("opacity")&&this.$el.hide(),this.cleanup(),this.trigger(h.END_EVENT)},cleanup:function(){this.compiled&&!i.isNull(this.$el)&&this.$el.unbind(l).unbind(c).removeClass(this.runClass).removeClass(this.pauseClass)},isInProgress:function(){return this.$el.hasClass(this.runClass)},setLoop:function(e){this.loop=e},isLooping:function(){return this.loop}}),h}),define("animationTypes",["lodash","log","animation","device"],function(e,t,i,n){"use strict";return{compileNewSequence:function(n,r,o){var s=null;if(e.isString(r.type)&&!e.isEmpty(r.type)&&e.isNumber(r.duration)&&r.duration>0){var a={$el:n,name:r.type,requiresHardwareAcceleration:o.get("requiresHardwareAcceleration")};s=new i(a),s.precompile(),!e.isUndefined(r.delay)&&e.isNumber(r.delay)||(r.delay=0),!0===r.loop&&s.setLoop(!0),e.isFunction(this[r.type])?this[r.type](s,r,o):t.warn("Animation type not supported: "+JSON.stringify(r)),s.compile()}return s},getIterations:function(e){var t=e.iterations?e.iterations:1;return!0===e.loop&&(t="infinite"),t},getDuration:function(e){return 1e3*e.duration},getDelay:function(e){return 1e3*e.delay},getEasing:function(e){return e.easing},buildTween:function(e,t,n){return new i.Tween(t,n,this.getDuration(e),this.getDelay(e),this.getIterations(e),this.getEasing(e))},fadeIn:function(e,t,i){e.add(this.buildTween(t,"opacity",{"0%":0,"100%":i.get("opacity")}))},fadeOut:function(e,t,i){e.add(this.buildTween(t,"opacity",{"0%":i.get("opacity"),"100%":0}))},spinSequence:function(e,t,i,n){var r=i.get("rotation"),o=i.getScale();e.add(this.buildTween(t,"transform",{"0%":"rotate("+r+"deg) scale("+o.x+","+o.y+")","100%":"rotate("+(n+r)+"deg) scale("+o.x+","+o.y+")"}))},spinLeft:function(e,t,i){this.spinSequence(e,t,i,-360)},spinRight:function(e,t,i){this.spinSequence(e,t,i,360)},slideInXSequence:function(e,t,i,r){var o=i.get("rotation"),s=i.getScale(),a=i.get("x");n.mobile()?e.add(this.buildTween(t,"left",{"0%":r.x+"px","100%":a+"px"})):e.add(this.buildTween(t,"transform",{"0%":"translateX("+(r.x-a)+"px) rotate("+o+"deg) scale("+s.x+","+s.y+")","100%":"translateX(0px) rotate("+o+"deg) scale("+s.x+","+s.y+")"}))},slideInYSequence:function(e,t,i,r){var o=i.get("rotation"),s=i.getScale(),a=i.get("y");n.mobile()?e.add(this.buildTween(t,"top",{"0%":r.y+"px","100%":a+"px"})):e.add(this.buildTween(t,"transform",{"0%":"translateY("+(r.y-a)+"px) rotate("+o+"deg) scale("+s.x+","+s.y+")","100%":"translateY(0px) rotate("+o+"deg) scale("+s.x+","+s.y+")"}))},slideLeft:function(e,t,i){this.slideLeftIn(e,t,i)},slideLeftIn:function(e,t,i){var n=i.getOffPageRight();this.slideInXSequence(e,t,i,n)},slideRight:function(e,t,i){this.slideRightIn(e,t,i)},slideRightIn:function(e,t,i){var n=i.getOffPageLeft();this.slideInXSequence(e,t,i,n)},slideDown:function(e,t,i){this.slideDownIn(e,t,i)},slideDownIn:function(e,t,i){var n=i.getOffPageTop();this.slideInYSequence(e,t,i,n)},slideUp:function(e,t,i){this.slideUpIn(e,t,i)},slideUpIn:function(e,t,i){var n=i.getOffPageBottom();this.slideInYSequence(e,t,i,n)},slideOutSequence:function(e,t,i,n){var r=i.get("x"),o=i.get("y");e.add(this.buildTween(t,"left",{"0%":r+"px","100%":n.x+"px"})),e.add(this.buildTween(t,"top",{"0%":o+"px","100%":n.y+"px"}))},slideLeftOut:function(e,t,i){var n=i.getOffPageRight();this.slideOutSequence(e,t,i,n)},slideRightOut:function(e,t,i){var n=i.getOffPageLeft();this.slideOutSequence(e,t,i,n)},slideDownOut:function(e,t,i){var n=i.getOffPageBottom();this.slideOutSequence(e,t,i,n)},slideUpOut:function(e,t,i){var n=i.getOffPageTop();this.slideOutSequence(e,t,i,n)},shiftInSequence:function(e,t,i,n){var r=i.get("rotation"),o=i.getScale();n.x*=o.x,n.y*=o.y,e.add(this.buildTween(t,"transform",{"0%":"translate("+n.x+"px,"+n.y+"px) rotate("+r+"deg) scale("+o.x+","+o.y+")","100%":"translate(0,0) rotate("+r+"deg) scale("+o.x+","+o.y+")"}))},shiftLeft:function(e,t,i){var n=i.get("allWidth"),r=i.getRelativeRotatedPoint(n,0);this.shiftInSequence(e,t,i,r)},shiftRight:function(e,t,i){var n=i.get("allWidth"),r=i.getRelativeRotatedPoint(-1*n,0);this.shiftInSequence(e,t,i,r)},shiftDown:function(e,t,i){var n=i.get("allHeight"),r=i.getRelativeRotatedPoint(0,-1*n);this.shiftInSequence(e,t,i,r)},shiftUp:function(e,t,i){var n=i.get("allHeight"),r=i.getRelativeRotatedPoint(0,n);this.shiftInSequence(e,t,i,r)},shiftOutSequence:function(e,t,i,n){var r=i.get("rotation"),o=i.getScale();n.x*=o.x,n.y*=o.y,e.add(this.buildTween(t,"transform",{"0%":"translate(0,0) rotate("+r+"deg) scale("+o.x+","+o.y+")","100%":"translate("+n.x+"px,"+n.y+"px) rotate("+r+"deg) scale("+o.x+","+o.y+")"}))},shiftLeftOut:function(e,t,i){var n=i.get("allWidth"),r=i.getRelativeRotatedPoint(-1*n,0);this.shiftOutSequence(e,t,i,r)},shiftRightOut:function(e,t,i){var n=i.get("allWidth"),r=i.getRelativeRotatedPoint(n,0);this.shiftOutSequence(e,t,i,r)},shiftDownOut:function(e,t,i){var n=i.get("allHeight"),r=i.getRelativeRotatedPoint(0,n);this.shiftOutSequence(e,t,i,r)},shiftUpOut:function(e,t,i){var n=i.get("allHeight"),r=i.getRelativeRotatedPoint(0,-1*n);this.shiftOutSequence(e,t,i,r)},flash:function(e,t,i){var n=i.get("opacity");e.add(this.buildTween(t,"opacity",{"0%":n,"50%":0,"100%":n}))},pulse:function(e,t,i){var n=i.get("rotation"),r=i.getScale();e.add(this.buildTween(t,"transform",{"0%":"rotate("+n+"deg) scale("+r.x+","+r.y+")","50%":"rotate("+n+"deg) scale("+(r.x+.1)+","+(r.y+.1)+")","100%":"rotate("+n+"deg) scale("+r.x+","+r.y+")"}))},bob:function(e,t,i){var n=i.get("rotation"),r=i.getScale(),o=i.getRelativeRotatedPoint(0,-30),s=i.getRelativeRotatedPoint(0,-15);e.add(this.buildTween(t,"transform",{"0%":"translate(0,0) rotate("+n+"deg) scale("+r.x+","+r.y+")","20%":"translate(0,0) rotate("+n+"deg) scale("+r.x+","+r.y+")","40%":"translate("+o.x+"px,"+o.y+"px) rotate("+n+"deg) scale("+r.x+","+r.y+")","50%":"translate(0,0) rotate("+n+"deg) scale("+r.x+","+r.y+")","60%":"translate("+s.x+"px,"+s.y+"px) rotate("+n+"deg) scale("+r.x+","+r.y+")","80%":"translate(0,0) rotate("+n+"deg) scale("+r.x+","+r.y+")","100%":"translate(0,0) rotate("+n+"deg) scale("+r.x+","+r.y+")"}))},tada:function(e,t,i){var n=i.get("rotation"),r=i.getScale();e.add(this.buildTween(t,"transform",{"0%":"rotate("+n+"deg) scale("+r.x+","+r.y+")","10%":"rotate("+(n-3)+"deg) scale("+(r.x-.1)+","+(r.y-.1)+")","20%":"rotate("+(n-3)+"deg) scale("+(r.x-.1)+","+(r.y-.1)+")","30%":"rotate("+(n+3)+"deg) scale("+(r.x+.1)+","+(r.y+.1)+")","40%":"rotate("+(n-3)+"deg) scale("+(r.x+.1)+","+(r.y+.1)+")","50%":"rotate("+(n+3)+"deg) scale("+(r.x+.1)+","+(r.y+.1)+")","60%":"rotate("+(n-3)+"deg) scale("+(r.x+.1)+","+(r.y+.1)+")","70%":"rotate("+(n+3)+"deg) scale("+(r.x+.1)+","+(r.y+.1)+")","80%":"rotate("+(n-3)+"deg) scale("+(r.x+.1)+","+(r.y+.1)+")","90%":"rotate("+(n+3)+"deg) scale("+(r.x+.1)+","+(r.y+.1)+")","100%":"rotate("+n+"deg) scale("+r.x+","+r.y+")"}))},flip:function(e,t,i){var n=i.get("rotation"),r=i.getOffsetRotation(),o=i.getScale(),s=Math.rotateCoord(0,1,0,0,r);e.add(this.buildTween(t,"transform",{"0%":"perspective(400px) translateZ(0) rotate3d("+s.x+","+s.y+",0,0deg) rotateZ("+n+"deg) scale("+o.x+","+o.y+")","40%":"perspective(400px) translateZ(150px) rotate3d("+s.x+","+s.y+",0,170deg) rotateZ("+n+"deg) scale("+o.x+","+o.y+")","50%":"perspective(400px) translateZ(150px) rotate3d("+s.x+","+s.y+",0,190deg) rotateZ("+n+"deg) scale("+o.x+","+o.y+")","80%":"perspective(400px) translateZ(0) rotate3d("+s.x+","+s.y+",0,360deg) rotateZ("+n+"deg) scale("+o.x+","+o.y+")","100%":"perspective(400px) translateZ(0) rotate3d("+s.x+","+s.y+",0,360deg) rotateZ("+n+"deg) scale("+o.x+","+o.y+")"}))},flipInX:function(e,t,i){var n=i.get("rotation"),r=i.getOffsetRotation(),o=i.getScale(),s=i.get("opacity"),a=Math.rotateCoord(1,0,0,0,r);e.add(this.buildTween(t,"transform",{"0%":"perspective(400px) rotate3d("+a.x+","+a.y+",0,90deg) rotateZ("+n+"deg) scale("+o.x+","+o.y+")","40%":"perspective(400px) rotate3d("+a.x+","+a.y+",0,-10deg) rotateZ("+n+"deg) scale("+o.x+","+o.y+")","70%":"perspective(400px) rotate3d("+a.x+","+a.y+",0,10deg) rotateZ("+n+"deg) scale("+o.x+","+o.y+")","100%":"perspective(400px) rotate3d("+a.x+","+a.y+",0,0deg) rotateZ("+n+"deg) scale("+o.x+","+o.y+")"})),e.add(this.buildTween(t,"opacity",{"0%":0,"100%":s}))},flipInY:function(e,t,i){var n=i.get("rotation"),r=i.getOffsetRotation(),o=i.getScale(),s=i.get("opacity"),a=Math.rotateCoord(0,1,0,0,r);e.add(this.buildTween(t,"transform",{"0%":"perspective(400px) rotate3d("+a.x+","+a.y+",0,-90deg) rotateZ("+n+"deg) scale("+o.x+","+o.y+")","40%":"perspective(400px) rotate3d("+a.x+","+a.y+",0,-10deg) rotateZ("+n+"deg) scale("+o.x+","+o.y+")","70%":"perspective(400px) rotate3d("+a.x+","+a.y+",0,10deg) rotateZ("+n+"deg) scale("+o.x+","+o.y+")","100%":"perspective(400px) rotate3d("+a.x+","+a.y+",0,0deg) rotateZ("+n+"deg) scale("+o.x+","+o.y+")"})),e.add(this.buildTween(t,"opacity",{"0%":0,"100%":s}))},flipOutX:function(e,t,i){var n=i.get("rotation"),r=i.getOffsetRotation(),o=i.getScale(),s=i.get("opacity"),a=Math.rotateCoord(1,0,0,0,r);e.add(this.buildTween(t,"transform",{"0%":"perspective(400px) rotate3d("+a.x+","+a.y+",0,0deg) rotateZ("+n+"deg) scale("+o.x+","+o.y+")","100%":"perspective(400px) rotate3d("+a.x+","+a.y+",0,90deg) rotateZ("+n+"deg) scale("+o.x+","+o.y+")"})),e.add(this.buildTween(t,"opacity",{"0%":s,"100%":0}))},flipOutY:function(e,t,i){var n=i.get("rotation"),r=i.getOffsetRotation(),o=i.getScale(),s=i.get("opacity"),a=Math.rotateCoord(0,1,0,0,r);e.add(this.buildTween(t,"transform",{"0%":"perspective(400px) rotate3d("+a.x+","+a.y+",0,0deg) rotateZ("+n+"deg) scale("+o.x+","+o.y+")","100%":"perspective(400px) rotate3d("+a.x+","+a.y+",0,-90deg) rotateZ("+n+"deg) scale("+o.x+","+o.y+")"})),e.add(this.buildTween(t,"opacity",{"0%":s,"100%":0}))},fadeInSequence:function(e,t,i,n){var r=i.get("rotation"),o=i.getScale(),s=i.get("opacity");e.add(this.buildTween(t,"transform",{"0%":"translate("+n.x+"px,"+n.y+"px) rotate("+r+"deg) scale("+o.x+","+o.y+")","100%":"translate(0,0) rotate("+r+"deg) scale("+o.x+","+o.y+")"})),e.add(this.buildTween(t,"opacity",{"0%":0,"100%":s}))},fadeUp:function(e,t,i){this.fadeUpIn(e,t,i)},fadeUpIn:function(e,t,i){var n=i.getRelativeRotatedPoint(0,25);this.fadeInSequence(e,t,i,n)},fadeDown:function(e,t,i){this.fadeDownIn(e,t,i)},fadeDownIn:function(e,t,i){var n=i.getRelativeRotatedPoint(0,-25);this.fadeInSequence(e,t,i,n)},fadeRight:function(e,t,i){this.fadeRightIn(e,t,i)},fadeRightIn:function(e,t,i){var n=i.getRelativeRotatedPoint(-25,0);this.fadeInSequence(e,t,i,n)},fadeLeft:function(e,t,i){this.fadeLeftIn(e,t,i)},fadeLeftIn:function(e,t,i){var n=i.getRelativeRotatedPoint(25,0);this.fadeInSequence(e,t,i,n)},fadeOutSequence:function(e,t,i,n){var r=i.get("rotation"),o=i.getScale(),s=i.get("opacity");e.add(this.buildTween(t,"transform",{"0%":"translate(0,0) rotate("+r+"deg) scale("+o.x+","+o.y+")","100%":"translate("+n.x+"px,"+n.y+"px) rotate("+r+"deg) scale("+o.x+","+o.y+")"})),e.add(this.buildTween(t,"opacity",{"0%":s,"100%":0}))},fadeUpOut:function(e,t,i){var n=i.getRelativeRotatedPoint(0,-25);this.fadeOutSequence(e,t,i,n)},fadeDownOut:function(e,t,i){var n=i.getRelativeRotatedPoint(0,25);this.fadeOutSequence(e,t,i,n)},fadeRightOut:function(e,t,i){var n=i.getRelativeRotatedPoint(25,0);this.fadeOutSequence(e,t,i,n)},fadeLeftOut:function(e,t,i){var n=i.getRelativeRotatedPoint(-25,0);this.fadeOutSequence(e,t,i,n)},bounceInSequence:function(e,t,i,n,r,o){var s=i.get("x"),a=i.get("y"),u=i.get("opacity");e.add(this.buildTween(t,"left",{"0%":n.x+"px","60%":s+r.x+"px","80%":s+o.x+"px","100%":s+"px"})),e.add(this.buildTween(t,"top",{"0%":n.y+"px","60%":a+r.y+"px","80%":a+o.y+"px","100%":a+"px"})),e.add(this.buildTween(t,"opacity",{"0%":0,"60%":u,"100%":u}))},bounceUp:function(e,t,i){this.bounceUpIn(e,t,i)},bounceUpIn:function(e,t,i){var n=i.getOffPageBottom(),r=i.getRelativeRotatedPoint(0,-30),o=i.getRelativeRotatedPoint(0,10);this.bounceInSequence(e,t,i,n,r,o)},bounceDown:function(e,t,i){this.bounceDownIn(e,t,i)},bounceDownIn:function(e,t,i){var n=i.getOffPageTop(),r=i.getRelativeRotatedPoint(0,30),o=i.getRelativeRotatedPoint(0,-10);this.bounceInSequence(e,t,i,n,r,o)},bounceLeft:function(e,t,i){this.bounceLeftIn(e,t,i)},bounceLeftIn:function(e,t,i){var n=i.getOffPageLeft(),r=i.getRelativeRotatedPoint(30,0),o=i.getRelativeRotatedPoint(-10,0);this.bounceInSequence(e,t,i,n,r,o)},bounceRight:function(e,t,i){this.bounceRightIn(e,t,i)},bounceRightIn:function(e,t,i){var n=i.getOffPageRight(),r=i.getRelativeRotatedPoint(-30,0),o=i.getRelativeRotatedPoint(10,0);this.bounceInSequence(e,t,i,n,r,o)},bounceOutSequence:function(e,t,i,n,r,o){var s=i.get("x"),a=i.get("y"),u=i.get("opacity");e.add(this.buildTween(t,"left",{"0%":s+"px","20%":s+r.x+"px","40%":s+o.x+"px","100%":n.x+"px"})),e.add(this.buildTween(t,"top",{"0%":a+"px","20%":a+r.y+"px","40%":a+o.y+"px","100%":n.y+"px"})),e.add(this.buildTween(t,"opacity",{"0%":u,"60%":u,"100%":0}))},bounceUpOut:function(e,t,i){var n=i.getOffPageTop(),r=i.getRelativeRotatedPoint(0,-10),o=i.getRelativeRotatedPoint(0,30);this.bounceOutSequence(e,t,i,n,r,o)},bounceDownOut:function(e,t,i){var n=i.getOffPageBottom(),r=i.getRelativeRotatedPoint(0,10),o=i.getRelativeRotatedPoint(0,-30);this.bounceOutSequence(e,t,i,n,r,o)},bounceLeftOut:function(e,t,i){var n=i.getOffPageLeft(),r=i.getRelativeRotatedPoint(-10,0),o=i.getRelativeRotatedPoint(30,0);this.bounceOutSequence(e,t,i,n,r,o)},bounceRightOut:function(e,t,i){var n=i.getOffPageRight(),r=i.getRelativeRotatedPoint(10,0),o=i.getRelativeRotatedPoint(-30,0);this.bounceOutSequence(e,t,i,n,r,o)},spinFadeInSequence:function(e,t,i,n){var r=i.get("rotation"),o=i.getScale(),s=i.get("opacity");e.add(this.buildTween(t,"transform",{"0%":"rotate("+(r+n)+"deg) scale("+o.x+","+o.y+")","100%":"rotate("+r+"deg) scale("+o.x+","+o.y+")"})),e.add(this.buildTween(t,"opacity",{"0%":0,"100%":s}))},spinRightFade:function(e,t,i){this.spinRightFadeIn(e,t,i)},spinRightFadeIn:function(e,t,i){this.spinFadeInSequence(e,t,i,-90)},spinLeftFade:function(e,t,i){this.spinLeftFadeIn(e,t,i)},spinLeftFadeIn:function(e,t,i){this.spinFadeInSequence(e,t,i,90)},spinFadeOutSequence:function(e,t,i,n){var r=i.get("rotation"),o=i.getScale(),s=i.get("opacity");e.add(this.buildTween(t,"transform",{"0%":"rotate("+r+"deg) scale("+o.x+","+o.y+")","100%":"rotate("+(r+n)+"deg) scale("+o.x+","+o.y+")"})),e.add(this.buildTween(t,"opacity",{"0%":s,"100%":0}))},spinRightFadeOut:function(e,t,i){this.spinFadeOutSequence(e,t,i,90)},spinLeftFadeOut:function(e,t,i){this.spinFadeOutSequence(e,t,i,-90)},lightSpeedInSequence:function(e,t,i,n,r){var o=i.get("rotation"),s=i.getScale(),a=i.get("opacity");e.add(this.buildTween(t,"transform",{"0%":"translate("+n.x+"px,"+n.y+"px) skewX(-30deg) rotate("+o+"deg) scale("+s.x+","+s.y+")","60%":"translate("+r.x+"px,"+r.y+"px) skewX(30deg) rotate("+o+"deg) scale("+s.x+","+s.y+")","80%":"translate(0,0) skewX(-15deg) rotate("+o+"deg) scale("+s.x+","+s.y+")","100%":"translate(0,0) skewX(0deg) rotate("+o+"deg) scale("+s.x+","+s.y+")"})),e.add(this.buildTween(t,"opacity",{"0%":0,"60%":a,"100%":a}))},lightSpeedRight:function(e,t,i){this.lightSpeedRightIn(e,t,i)},lightSpeedRightIn:function(e,t,i){var n=i.getScale(),r=i.get("width")*n.x,o=i.get("pageWidth"),s=i.getRelativeRotatedPoint(o,0),a=i.getRelativeRotatedPoint(-1*Math.round(.6*r),0);this.lightSpeedInSequence(e,t,i,s,a)},lightSpeedLeft:function(e,t,i){this.lightSpeedLeftIn(e,t,i)},lightSpeedLeftIn:function(e,t,i){var n=i.getScale(),r=i.get("width")*n.x,o=i.get("pageWidth"),s=i.getRelativeRotatedPoint(-1*o,0),a=i.getRelativeRotatedPoint(Math.round(.6*r),0);this.lightSpeedInSequence(e,t,i,s,a)},
lightSpeedOutSequence:function(e,t,i,n){var r=i.get("rotation"),o=i.getScale(),s=i.get("opacity");e.add(this.buildTween(t,"transform",{"0%":"translate(0,0) skewX(0deg) rotate("+r+"deg) scale("+o.x+","+o.y+")","60%":"translate("+n.x+"px,"+n.y+"px) skewX(-30deg) rotate("+r+"deg) scale("+o.x+","+o.y+")","100%":"translate("+n.x+"px,"+n.y+"px) skewX(0deg) rotate("+r+"deg) scale("+o.x+","+o.y+")"})),e.add(this.buildTween(t,"opacity",{"0%":s,"60%":0,"100%":0}))},lightSpeedRightOut:function(e,t,i){var n=i.get("pageWidth"),r=i.getRelativeRotatedPoint(n,0);this.lightSpeedOutSequence(e,t,i,r)},lightSpeedLeftOut:function(e,t,i){var n=i.get("pageWidth"),r=i.getRelativeRotatedPoint(-1*n,0);this.lightSpeedOutSequence(e,t,i,r)},rollInSequence:function(e,t,i,n,r){var o=i.get("rotation"),s=i.getScale(),a=i.get("opacity");n.x*=s.x,n.y*=s.y,e.add(this.buildTween(t,"transform",{"0%":"translate("+n.x+"px,"+n.y+"px) rotate("+(o+r)+"deg) scale("+s.x+","+s.y+")","100%":"translate(0,0) rotate("+o+"deg) scale("+s.x+","+s.y+")"})),e.add(this.buildTween(t,"opacity",{"0%":0,"100%":a}))},rollLeft:function(e,t,i){this.rollLeftIn(e,t,i)},rollLeftIn:function(e,t,i){var n=i.get("allWidth"),r=i.getRelativeRotatedPoint(-1*n,0);this.rollInSequence(e,t,i,r,-120)},rollRight:function(e,t,i){this.rollRightIn(e,t,i)},rollRightIn:function(e,t,i){var n=i.get("allWidth"),r=i.getRelativeRotatedPoint(n,0);this.rollInSequence(e,t,i,r,120)},rollOutSequence:function(e,t,i,n,r){var o=i.get("rotation"),s=i.getScale(),a=i.get("opacity");n.x*=s.x,n.y*=s.y,e.add(this.buildTween(t,"transform",{"0%":"translate(0,0) rotate("+o+"deg) scale("+s.x+","+s.y+")","100%":"translate("+n.x+"px,"+n.y+"px) rotate("+(o+r)+"deg) scale("+s.x+","+s.y+")"})),e.add(this.buildTween(t,"opacity",{"0%":a,"100%":0}))},rollLeftOut:function(e,t,i){var n=i.get("allWidth"),r=i.getRelativeRotatedPoint(-1*n,0);this.rollOutSequence(e,t,i,r,-120)},rollRightOut:function(e,t,i){var n=i.get("allWidth"),r=i.getRelativeRotatedPoint(n,0);this.rollOutSequence(e,t,i,r,120)},enlarge:function(e,t,i){var n=i.get("rotation"),r=i.getScale();e.add(this.buildTween(t,"transform",{"0%":"rotate("+n+"deg) scale(0)","100%":"rotate("+n+"deg) scale("+r.x+","+r.y+")"}))},enlargeFadeIn:function(e,t,i){var n=i.get("rotation"),r=i.getScale(),o=i.get("opacity");e.add(this.buildTween(t,"transform",{"0%":"rotate("+n+"deg) scale(0)","100%":"rotate("+n+"deg) scale("+r.x+","+r.y+")"})),e.add(this.buildTween(t,"opacity",{"0%":0,"100%":o}))},shrink:function(e,t,i){var n=i.get("rotation"),r=i.getScale();e.add(this.buildTween(t,"transform",{"0%":"rotate("+n+"deg) scale("+r.x+","+r.y+")","100%":"rotate("+n+"deg) scale(0)"}))},shrinkFadeOut:function(e,t,i){var n=i.get("rotation"),r=i.getScale(),o=i.get("opacity");e.add(this.buildTween(t,"transform",{"0%":"rotate("+n+"deg) scale("+r.x+","+r.y+")","100%":"rotate("+n+"deg) scale(0)"})),e.add(this.buildTween(t,"opacity",{"0%":o,"100%":0}))}}}),define("shared/models/AnimatedObjectModel",["jquery","lodash","backbone"],function(e,t,i){"use strict";return i.Model.extend({getCenter:function(){return{x:this.get("x")+this.get("width")/2,y:this.get("y")+this.get("height")/2}},getScale:function(){return{x:t.isUndefined(this.get("scaleWidth"))?1:this.get("scaleWidth"),y:t.isUndefined(this.get("scaleHeight"))?1:this.get("scaleHeight")}},getOffsetX:function(){if(!this.get("parentSmartgroup"))return 0;var e=this.get("parentSmartgroup").options.scaleWidth;if(1===e)return this.get("parentSmartgroup").options.x;var t=this.get("parentSmartgroup").options.width/2,i=this.get("parentSmartgroup").options.width*e/2,n=t-i;return this.get("parentSmartgroup").options.x+n},getOffsetY:function(){if(!this.get("parentSmartgroup"))return 0;var e=this.get("parentSmartgroup").options.scaleHeight;if(1===e)return this.get("parentSmartgroup").options.y;var t=this.get("parentSmartgroup").options.height/2,i=this.get("parentSmartgroup").options.height*e/2,n=t-i;return this.get("parentSmartgroup").options.y+n},getOffsetRotation:function(){return this.get("parentSmartgroup")?Math.toRad(this.get("parentSmartgroup").options.rotation):0},getRelativeRotatedPoint:function(e,t){var i=this.getOffsetRotation();if(i){var n=this.get("allWidth")/2,r=this.get("allHeight")/2;e+=n,t+=r;var o=Math.rotateCoord(e,t,n,r,i);e=o.x-n,t=o.y-r}return{x:e,y:t}},getRotatedPoint:function(e,t){var i=this.getOffsetRotation();if(i){var n=this.get("allWidth")/2,r=this.get("allHeight")/2,o=this.getCenter();e+=n,t+=r;var s=Math.rotateCoord(e,t,o.x,o.y,i);e=s.x-n,t=s.y-r}return{x:e,y:t}},getRotatedCenter:function(){var e=this.getOffsetRotation(),t=this.get("parentSmartgroup"),i=this.getCenter();if(t&&e>0){var n=t.options.width/2,r=t.options.height/2;return Math.rotateCoord(i.x,i.y,n,r,-1*e)}return{x:i.x,y:i.y}},getOffPageY:function(e){var t=this.get("x"),i=this.get("parentSmartgroup"),n=this.getOffsetRotation();if(i&&n>0){var r=this.getCenter();return e-=this.getRotatedCenter().y-r.y,this.getRotatedPoint(t,e)}return{x:t,y:e}},getOffPageTop:function(){var e=-1*(1+this.getOffsetY());return this.get("parentSmartgroup")&&1!==this.get("parentSmartgroup").options.scaleHeight&&(e/=this.get("parentSmartgroup").options.scaleHeight),e-=this.get("allHeight"),this.getOffPageY(e)},getOffPageBottom:function(){var e=this.get("pageHeight")+1-this.getOffsetY();return this.get("parentSmartgroup")&&1!==this.get("parentSmartgroup").options.scaleHeight&&(e/=this.get("parentSmartgroup").options.scaleHeight),e+=this.get("allHeight")-this.get("height"),this.getOffPageY(e)},getOffPageX:function(e){var t=this.get("y"),i=this.get("parentSmartgroup"),n=this.getOffsetRotation();if(i&&n>0){var r=this.getCenter();return e-=this.getRotatedCenter().x-r.x,this.getRotatedPoint(e,t)}return{x:e,y:t}},getOffPageLeft:function(){var e=-1*(1+this.getOffsetX());return this.get("parentSmartgroup")&&1!==this.get("parentSmartgroup").options.scaleWidth&&(e/=this.get("parentSmartgroup").options.scaleWidth),e-=this.get("allWidth"),this.getOffPageX(e)},getOffPageRight:function(){var e=this.get("pageWidth")+1-this.getOffsetX();return this.get("parentSmartgroup")&&1!==this.get("parentSmartgroup").options.scaleWidth&&(e/=this.get("parentSmartgroup").options.scaleWidth),e+=this.get("allWidth")-this.get("width"),this.getOffPageX(e)}})}),define("modules/page/utils/VisibleBoundaries",["lodash"],function(e){"use strict";function t(t,i,n,r){this.topY=t,this.bottomY=i,e.isNil(n)||e.isNil(r)||(this.hasXBoundaries=!0,this.leftX=n,this.rightX=r)}return t.prototype.getEntryAnimationVisibleBoundaries=function(e,i){var n=this.topY,r=this.bottomY,o=this.leftX,s=this.rightX;return n>0&&(n+=50),r<e&&(r-=50),this.hasXBoundaries&&(o>0&&(o+=50),s<i&&(s-=50)),new t(n,r,o,s)},t}),define("InteractionUtils",["lodash"],function(e){"use strict";return{isInteractionTargetingLayers:function(t){return e.includes(["show-and-stay-visible","hide-and-stay-hidden","show-layers","show-layers-on-hover","hide-layers","toggle-layers"],t.action)},isHoverInteractionShowingLayers:function(t){return"hover"===t.trigger&&e.includes(["show-and-stay-visible","show-layers-on-hover"],t.action)},isShowLayersOnHoverInteraction:function(e){return"show-layers-on-hover"===e.action},isShowLayersInteraction:function(t){return e.includes(["show-layers","show-layers-on-hover"],t.action)},isHideLayersInteraction:function(e){return"hide-layers"===e.action},isTemporaryHoverInteractionShowingOrHidingLayers:function(t){return"hover"===t.trigger&&e.includes(["show-layers-on-hover","hide-layers"],t.action)},shouldCreateHoverArea:function(e){return"show-layers-on-hover"===e.action&&e.createHoverArea}}}),define("rect",["jquery","lodash","cerosMath"],function(e,t,i){"use strict";var n=function(e,t,n,r,o){if(this.topLeft=new i.Point(e,t),this.topRight=new i.Point(n,t),this.bottomRight=new i.Point(n,r),this.bottomLeft=new i.Point(e,r),o){var s=(e+n)/2,a=(t+r)/2;this.topLeft.rotate(s,a,o),this.topRight.rotate(s,a,o),this.bottomRight.rotate(s,a,o),this.bottomLeft.rotate(s,a,o)}};return t.extend(n.prototype,{getEndpoints:function(){return[this.topLeft,this.topRight,this.bottomRight,this.bottomLeft]}}),n}),define("modules/page/views/components/AbstractComponentView",["log","jquery","lodash","device","backbone","color","globals","modules/page/views/AbstractPageChildView","animation","animationTypes","shared/models/AnimatedObjectModel","shared/utils/CerosResourceLoader","shared/utils/CssUtils","shared/utils/WebkitUtils","shared/utils/ModuleEventManager","modules/page/utils/VisibleBoundaries","ExtentsUtils","InteractionUtils","rect","cerosMath","modules/page/utils/PlayerVariantDetector"],function(e,t,i,n,r,o,s,a,u,l,c,h,d,f,p,g,m,v,y,b,w){"use strict";return a.extend({COMMERCE_ACTIONS:["product","shopping-cart"],LIGHTBOX_ACTION:"lightbox",className:"component",timedTriggersCreatedAtLeastOnce:!1,initialize:function(){a.prototype.initialize.call(this),this.$el.addClass("page-object"),this.$el.addClass(this.type),this.$el.css({position:"absolute"}),this.options.rotation||(this.options.rotation=0),this.timedTriggerTimeouts=[],this._activatedEntryAnimations=!1,this.runningExitAnimations=!1,this.wasInsideVisibleBoundaries=!1,this.timedTriggersActivated=!1,this.exitAnimationPromise=null,this.validInteractions={},this.options.unfixedX=this.options.x,this.options.unfixedY=this.options.y,this.options.absoluteX=this.options.x,this.options.absoluteY=this.options.y,this.$window=t(window)},getOpacity:function(){return this.options.opacity},addParentView:function(e){this.parentViews.push(e),e.options.rotation&&(delete this.options.allWidth,delete this.options.allHeight,this._configureAllWidthAllHeight(),this._applyAnimations()),this.configureAbsoluteCoordinates()},hasParents:function(){return this.parentViews.length>0},configureAbsoluteCoordinates:function(){var e=new b.Point(this.options.x+this.options.width/2,this.options.y+this.options.height/2),t=this.parentViews;i.each(t,function(t){if(t.options.rotation){var i=t.options.width/2,n=t.options.height/2;e.rotate(i,n,-Math.toRad(t.options.rotation))}e.x+=t.options.x||0,e.y+=t.options.y||0}),this.options.absoluteX=e.x-this.options.allWidth/2,this.options.absoluteY=e.y-this.options.allHeight/2},areAllParentsVisible:function(){var e=i.every(this.parentViews,function(e){return e.visible});return this.options.parentSmartgroup?e&&this.options.parentSmartgroup.visible:e},areAllParentsInitiallyVisible:function(){var e=i.every(this.parentViews,function(e){return e.initiallyVisible});return this.options.parentSmartgroup?e&&this.options.parentSmartgroup.initiallyVisible:e},areAnyParentsNotVisible:function(){var e=i.some(this.parentViews,function(e){return!e.visible});return this.options.parentSmartgroup?e||!this.options.parentSmartgroup.visible:e},idBelongsToParent:function(e){return i.some(this.parentViews,function(t){return t.id===e})},addContainerId:function(e){var t=this.$el.attr("data-container-id")?this.$el.attr("data-container-id")+",":"";this.$el.attr("data-container-id",t+e)},onClose:function(){},_configureAllWidthAllHeight:function(){if(i.isUndefined(this.options.allWidth)&&i.isUndefined(this.options.allHeight)){var e=this.options.rotation?this.options.rotation:0;this.options.parentSmartgroup&&this.options.parentSmartgroup.options.rotation&&(e+=this.options.parentSmartgroup.options.rotation,e%=360),this.hasParents()&&(e+=i.reduce(this.parentViews,function(e,t){return e+(t.options.rotation||0)},0));var t,n;if(e>180&&(e=360-e),e>90&&(e=180-e),0!==(e=Math.toRad(e))){t=Math.cos(e),n=Math.sin(e);var r=m.getExtentsFromDimensions(this.options.x,this.options.y,this.options.width,this.options.height,e,this.options.border.width?this.options.border.width:0);this.options.allWidth=r.x2-r.x1,this.options.allHeight=r.y2-r.y1}else this.options.allWidth=this.options.width,this.options.allHeight=this.options.height;this._configureAllWidthAllHeightForShadow(),this._configureAllWidthAllHeightForBorder(e,n,t)}},_configureAllWidthAllHeightForShadow:function(){i.isEmpty(this.options.shadow)||""===this.options.shadow||(this.options.allWidth+=i.isNumber(this.options.shadow.x)?Math.abs(this.options.shadow.x):0,this.options.allHeight+=i.isNumber(this.options.shadow.y)?Math.abs(this.options.shadow.y):0,this.options.allWidth+=i.isNumber(this.options.shadow.blur)?Math.abs(this.options.shadow.blur):0,this.options.allHeight+=i.isNumber(this.options.shadow.blur)?Math.abs(this.options.shadow.blur):0,this.options.shadow.blur>Math.abs(this.options.shadow.x)&&(this.options.allWidth+=this.options.shadow.blur-Math.abs(this.options.shadow.x)),this.options.shadow.blur>Math.abs(this.options.shadow.y)&&(this.options.allHeight+=this.options.shadow.blur-Math.abs(this.options.shadow.y)))},_configureAllWidthAllHeightForBorder:function(e,t,n){!i.isEmpty(this.options.border)&&""!==this.options.border&&i.isNumber(this.options.border.width)&&(0!==e?(this.options.allWidth+=2*(this.options.border.width*n+this.options.border.width*t),this.options.allHeight+=2*(this.options.border.width*n+this.options.border.width*t)):(this.options.allWidth+=2*this.options.border.width,this.options.allHeight+=2*this.options.border.width))},render:function(){return this.$el.css("transform",""),this.updateFixedPosition(),this._configureAllWidthAllHeight(),this.configureAbsoluteCoordinates(),this._applyPosition(this.options.x,this.options.y,this.options.border),this._applyRotation(this.options.rotation,this.options.width,this.options.height),this._applyDimensions(this.options.width,this.options.height),this._applyOpacity(this.getOpacity()),this._applyVisibility(this.options.visible),this._configureInteractions(),f.requiresHardwareAccelerateTransform(this.options.fixedPosition,"text"===this.type)&&this.$el.css("transform",f.hardwareAccelerateTransform(this.$el.css("transform"))),this.doCustomScaling(),this._applyAnimations(),this._applyBorder(this.options.border),this._applyBackground(this.options.background),this._applyShadow(this.options.shadow,this.options.rotation,this.options.border,this.options.background),this},scaleComponent:function(){this.updateFixedPosition()},updateFixedPosition:function(){if(this.options.fixedPosition&&!n.desktop()){var e=this.options.pageView.$pageScroll,t=parseFloat(e.css("left")),i=parseFloat(e.css("top"));this.options.x=this.options.unfixedX+t,this.options.y=this.options.unfixedY+i,this._applyPosition(this.options.x,this.options.y,this.options.border)}},onAttach:function(){},attachMedia:function(){return(new t.Deferred).resolve().promise()},applyChanges:function(e){s.allowAdaptiveLayouts&&(e=i.extend(e,e.overrides[w.getVariant()])),this.options=i.extend(this.options,e),this.render(),this.attachMedia(),this.rerunActivationAndEntryAnimations()},getApplyPositionTarget:function(){return this.$el},_applyPosition:function(e,t,n){var r=this.getApplyPositionTarget();!i.isEmpty(n)&&i.isNumber(n.width)&&(e-=n.width,t-=n.width),r.css("left",e+"px"),r.css("top",t+"px")},getApplyDimensionsTarget:function(){return this.$el},_applyDimensions:function(e,t){var i=this.getApplyDimensionsTarget();i.css("width",e+"px"),i.css("height",t+"px")},setDimensionsAsAttributes:function(e,t,i){e.attr("width",t),e.attr("height",i)},getApplyOpacityTarget:function(){return this.$el},_applyOpacity:function(e){this.options.parentSmartgroup&&this.options.parentSmartgroup.getOpacity()<1&&(e*=this.options.parentSmartgroup.getOpacity());var t=this.getApplyOpacityTarget();e<1?t.css("opacity",e):t.css("opacity","initial"),0===e&&t.css({"background-color":"white"})},getApplyVisibilityTarget:function(){return this.$el},_applyVisibility:function(e){this.getApplyVisibilityTarget().css("display",e?"block":"none")},_applyRotation:function(e,t,i){if(e&&0!==e){var n="rotate("+e+"deg)";this.$el.css("transform",d.concatTransform(this.$el.css("transform"),n))}},getApplyBorderTarget:function(){return this.$el},_applyBorder:function(e){var t=this.getApplyBorderTarget();if(i.isEmpty(e))t.css("border","none");else if(e.width?(t.css("borderWidth",e.width+"px"),e.color&&""!==e.color&&t.css("borderColor",e.color),e.style&&""!==e.style&&e.style.match(/(solid|dashed|dotted)/)?t.css("borderStyle",e.style):t.css("borderStyle","solid")):t.css("borderWidth","0"),e.radius){var n=(e.radius+"").split(",");if(1==n.length)t.css("borderRadius",parseInt(n[0],10)+"px",10);else{var r=parseInt(n[0],10),o=parseInt(n[1],10),s=parseInt(n[2],10),a=parseInt(n[3],10);t.css("borderRadius",r+"px "+o+"px "+s+"px "+a+"px")}}else t.css("borderRadius","")},entryAnimationsActivated:function(){return this._activatedEntryAnimations},isEntryAnimationConfiguredToReplayOnScroll:function(){return this.options.animationsReplayOnScroll},setWasInsideVisibleBoundaries:function(e){this.wasInsideVisibleBoundaries=e},getWasInsideVisibleBoundaries:function(){return this.wasInsideVisibleBoundaries},isAnyPartOfComponentWithinBoundaries:function(e,t){t=t||this.getComponentBoundaries();var i=t.componentTop<e.bottomY&&t.componentBottom>=e.topY;return e.hasXBoundaries&&(i=i&&t.componentLeft<e.rightX&&t.componentRight>=e.leftX),i},isAnyPartOfComponentWithinEntryAnimationBoundaries:function(e,t){return this.isAnyPartOfComponentWithinBoundaries(e.getEntryAnimationVisibleBoundaries(this.options.pageHeight,this.options.pageWidth),t)},isOutsideOfPage:function(){var e=new g(0,this.options.pageHeight,0,this.options.pageWidth);return!1===this.isAnyPartOfComponentWithinBoundaries(e)},getComponentBoundaries:function(){var e=this.options.absoluteX,t=this.options.absoluteY,i=this.options.allHeight,n=this.options.allWidth,r=this.options.parentSmartgroup;if(r){e*=r.options.scaleWidth,e+=r.options.originalX,t*=r.options.scaleHeight,t+=r.options.originalY;var o=Math.toRad(r.options.rotation);if(o){var s=r.options.x+r.options.width/2,a=r.options.y+r.options.height/2,u=Math.rotateCoord(e,t,s,a,-o);e=u.x,t=u.y}i*=r.options.scaleHeight}return{componentTop:t,componentLeft:e,componentBottom:t+i,componentRight:e+n}},_hasInteraction:function(e){var t=this.options.interactions;return!(!i.isArray(t)||0===t.length)&&this.getValidInteractionsByTrigger(e).length>0},hasClickInteraction:function(){return this._hasInteraction(this.getModule().INTERACTION_TRIGGERS.CLICK)},hasHoverInteraction:function(){return n.desktop()&&this._hasInteraction(this.getModule().INTERACTION_TRIGGERS.HOVER)},getResettableHoverInteractions:function(){if(this.hasHoverInteraction()){var e=this.getValidInteractionsByTrigger(this.getModule().INTERACTION_TRIGGERS.HOVER);return i.filter(e,function(e){return e.resetWhenScrolledOffscreen})}return null},hasResettableHoverInteractions:function(){var e=this.getResettableHoverInteractions();return e&&e.length>0},getValidInteractionsByTrigger:function(e){if(!this.validInteractions[e]||s.previewMode){var t=this.options.interactions,n=this;t=i.filter(t,function(t){return!!n._isValidInteraction(t)&&(i.isUndefined(e)||t.trigger===e)}),t.sort(function(e,t){var i=-1!==["page-goto","page-next","page-prev"].indexOf(e.action),n=-1!==["page-goto","page-next","page-prev"].indexOf(t.action),r="page-enable-disable"==e.action,o="page-enable-disable"==t.action;return r&&n?-1:o&&i?1:0}),this.validInteractions[e]=t}return this.validInteractions[e]},_isValidInteraction:function(e){if(-1!==i.indexOf(this.COMMERCE_ACTIONS,e.action)&&!this.options.allowCommerceIntegration)return!1;if(e.action===this.LIGHTBOX_ACTION&&!this.options.allowLightboxes)return!1;if("url"===e.action&&!e.url)return!1;if("product"===e.action&&!e.productPanelId)return!1;if(v.isInteractionTargetingLayers(e)&&!e.layerTargets)return!1;if("page-goto"===e.action&&!e.pageTarget)return!1;if("scroll-to"===e.action)switch(e.scrollTargetType){case"top":case"bottom":return!0;case"scranchor":return e.scrollTargetScranchor&&!i.isEmpty(e.scrollTargetScranchor);default:return!1}if("page-enable-disable"===e.action)return!i.isEmpty(e.pageTargets);var t=i.values(e);return!i.some(t,function(e){if(i.isNull(e))return!0;if(i.isArray(e)){if(0===e.length)return!0}else if(""===e)return!0;return!1})},unbindInteractions:function(){this.$el.unbind("click"),this.$el.unbind("mouseover"),this.$el.unbind("mouseout")},assignCursor:function(){this.hasClickInteraction()||this.options.showHoverCursor?this.$el.css("cursor","pointer"):this.$el.css("cursor","inherit")},styleForTouchDevices:function(){n.touch()&&n.trident&&this.$el.css("touch-action","manipulation")},bindClickInteraction:function(){this.hasClickInteraction()?this.$el.bind("click",i.bind(this._handleClickInteraction,this)):this.$el.bind("click",i.bind(this.handleClickWithoutInteraction,this))},bindMouseoverInteraction:function(){this.hasHoverInteraction()&&this.$el.bind("mouseover",i.bind(this._handleMouseOverInteraction,this))},_configureInteractions:function(){this.unbindInteractions(),this.assignCursor(),this.styleForTouchDevices(),this.bindClickInteraction(),this.bindMouseoverInteraction()},createTimedTriggers:function(){var e=this.getModule(),t=this;if(this.canCreateTimedTriggers()){var n=i.groupBy(t.getValidInteractionsByTrigger(e.INTERACTION_TRIGGERS.VIEW),function(e){return e.delay});i.forOwn(n,function(n,r){var o=i.filter(n,function(e){return!t.timedTriggersCreatedAtLeastOnce||e.repeat});if(o.length>0){var s=setTimeout(function(){i.each(o,function(i){t.simulateClick(!0,i),p.trigger(e.publishedEvents.TIMED_INTERACTION,t.addComponentAndClickDataToEvent(i))})},1e3*r);t.timedTriggerTimeouts.push(s)}}),this.timedTriggersCreatedAtLeastOnce=!0,this.timedTriggersActivated=!0}},canCreateTimedTriggers:function(){if(this.timedTriggersActivated)return!1;if(!this.visible)return!1;var e=this.getModule();return!!this._hasInteraction(e.INTERACTION_TRIGGERS.VIEW)&&this.areAllParentsVisible()},simulateClick:function(e,i){var n={clientX:-1,clientY:-1,preventDefault:t.noop};this._handleClickInteraction(n,e,i)},_handleClickInteraction:function(e,t,n){var r=this.getModule(),o=!1;e.preventDefault();var s=[];if(t){if(!n)return;s=[n]}else s=this.getValidInteractionsByTrigger(r.INTERACTION_TRIGGERS.CLICK);i.each(s,i.bind(function(t){this._triggerClickAction(e,t)&&(o=!0)},this));var a=this.addComponentAndClickDataToEvent({},e);p.trigger(r.publishedEvents.PAGE_COMPONENT_CLICKED,a),o&&(e.handledByComponent=!0,t||r.trigger(r.publishedEvents.PAGE_COMPONENT_INTERACTION,a))},handleClickWithoutInteraction:function(e){var t=this.getModule(),i=this.addComponentAndClickDataToEvent({},e);p.trigger(t.publishedEvents.PAGE_COMPONENT_CLICKED,i)},_triggerClickAction:function(e,n){var r=this.getModule();n=t.extend(!0,{},n),n=this.addComponentAndClickDataToEvent(n,e);var o=!0;switch(n.action){case"scroll-to":p.trigger(r.publishedEvents.PAGE_ACTION_SCROLL_TO,n);break;case"page-prev":p.trigger(r.publishedEvents.PAGE_ACTION_GO_TO_PREV_PAGE,n);break;case"page-next":p.trigger(r.publishedEvents.PAGE_ACTION_GO_TO_NEXT_PAGE,n);break;case"page-goto":i.isString(n.pageTarget)&&(n.pageTarget=parseInt(n.pageTarget.replace(/#/,""),10)),p.trigger(r.publishedEvents.PAGE_ACTION_GO_TO_PAGE,n);break;case"page-enable-disable":p.trigger(r.publishedEvents.PAGE_ACTION_ENABLE_DISABLE_PAGES,n);break;case"url":n.domain=t("<a>",{href:n.url}).hostname,r.trigger(r.publishedEvents.PAGE_ACTION_GO_TO_URL,n);break;case"lightbox":r.trigger(r.publishedEvents.PAGE_ACTION_OPEN_LIGHTBOX,n);break;case"product":r.trigger(r.publishedEvents.PAGE_ACTION_OPEN_PRODUCT_PANEL,n);break;case"shopping-cart":r.trigger(r.publishedEvents.PAGE_ACTION_OPEN_SHOPPING_CART,n);break;case"show-layers":case"show-layers-on-hover":this.options.pageView.invokeShowAction(n.layerTargets),p.trigger(r.publishedEvents.PAGE_ACTION_LAYER_VISIBILITY,n);break;case"show-only":this.options.pageView.invokeShowOnlyAction(n.layerTargets),p.trigger(r.publishedEvents.PAGE_ACTION_LAYER_VISIBILITY,n);break;case"hide-only":this.options.pageView.invokeHideOnlyAction(n.layerTargets),p.trigger(r.publishedEvents.PAGE_ACTION_LAYER_VISIBILITY,n);break;case"cycle-next":this.options.pageView.invokeCycleNextAction(n.layerTargets),p.trigger(r.publishedEvents.PAGE_ACTION_LAYER_VISIBILITY,n);break;case"cycle-previous":this.options.pageView.invokeCyclePreviousAction(n.layerTargets),p.trigger(r.publishedEvents.PAGE_ACTION_LAYER_VISIBILITY,n);break;case"hide-layers":this.options.pageView.invokeHideAction(n.layerTargets),p.trigger(r.publishedEvents.PAGE_ACTION_LAYER_VISIBILITY,n);break;case"toggle-layers":this.options.pageView.invokeToggleAction(n.layerTargets),p.trigger(r.publishedEvents.PAGE_ACTION_LAYER_VISIBILITY,n);break;case"show-fullscreen":this.showFullScreen();break;case"share-email":case"share-facebook":case"share-twitter":case"share-pinterest":case"share-linkedin":p.trigger(r.publishedEvents.PAGE_ACTION_SHARE_PAGE,n);break;default:o=!1}return o},showFullScreen:function(){var e=document.body;e.requestFullscreen?e.requestFullscreen():e.msRequestFullscreen?e.msRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen&&e.webkitRequestFullscreen()},addComponentAndClickDataToEvent:function(e,i){return t.extend(e,{clickX:i?i.clientX:-1,clickY:i?i.clientY:-1,componentSlug:this.id,componentName:this.options.title,componentType:this.options.type,pageSlug:this.options.pageView.model.get("slug")})},_handleMouseOverInteraction:function(){var e=this.getValidInteractionsByTrigger(this.getModule().INTERACTION_TRIGGERS.HOVER),t=this;e.length>0&&(this.options.pageView.deactivateNonParentHovers(this),i.each(e,function(e){t._triggerMouseOverAction(e)}))},_triggerMouseOverAction:function(e){var t=e.layerTargets,n=v.isHoverInteractionShowingLayers(e);t=i.filter(t,i.bind(function(e){var t=this.options.pageView.findChildView(e),i=this.options.pageView.isChildVisible(t);return n?!i:i},this)),n?this.options.pageView.invokeShowAction(t):this.options.pageView.invokeHideAction(t),v.isTemporaryHoverInteractionShowingOrHidingLayers(e)&&this.options.pageView.addActiveHoverAndBindMouseEvents(this,e)},triggerMouseOutAction:function(e){v.isShowLayersOnHoverInteraction(e)?this.options.pageView.invokeHideAction(e.layerTargets):v.isHideLayersInteraction(e)&&this.options.pageView.invokeShowAction(e.layerTargets)},getApplyAnimationsTarget:function(){return this.$el},getAnimatedObjectModelData:function(){return{x:this.options.x,y:this.options.y,allWidth:this.options.allWidth,allHeight:this.options.allHeight,width:this.options.width,height:this.options.height,rotation:this.options.rotation,opacity:this.getOpacity(),scaleWidth:this.options.scaleWidth,scaleHeight:this.options.scaleHeight,pageWidth:this.options.pageWidth,pageHeight:this.options.pageHeight,parentSmartgroup:this.options.parentSmartgroup,requiresHardwareAcceleration:f.requiresHardwareAccelerateTransform(this.options.fixedPosition,"text"===this.type)}},_applyAnimations:function(){var e=this.getAnimatedObjectModelData();this.animatedObjectModel=new c(e);var t=this.getApplyAnimationsTarget();this.cleanupAnimations(),this.entryAnimations=this.buildAnimationPhases(t,this.options.animations,this.options.animationsRepeatAll,this.animatedObjectModel),this.exitAnimations=this.buildAnimationPhases(t,this.options.exitAnimations,!1,this.animatedObjectModel),this.resetToInitialState()},buildAnimationPhases:function(e,t,n,r){var o=[];if(t&&t.length>0)for(var s=function(e){e.play()},a=0;a<t.length;a++){n&&(t[a].loop=!1);var c=l.compileNewSequence(e,t[a],r);if(i.isNull(c))break;if(o.push(c),o[o.length-2]&&o[o.length-2].on(u.END_EVENT,i.bind(function(){var e=this;i.defer(s,e)},c)),!0===t[a].loop)break}return o},reset:function(){this.resetAnimations()},resetAnimations:function(){this.cleanupAnimations(),this.resetToInitialState(),this.runningExitAnimations=!1,this._activatedEntryAnimations=!1},resetTimers:function(){i.each(this.timedTriggerTimeouts,function(e){window.clearTimeout(e)}),this.timedTriggersActivated=!1},whenLeavingVisibleBoundaries:function(){var e=this.entryAnimationsActivated()&&this.isEntryAnimationConfiguredToReplayOnScroll(),t=this.getModule(),n=!i.isEmpty(this.getValidInteractionsByTrigger(t.INTERACTION_TRIGGERS.VIEW)),r=n&&this.initiallyVisible&&this.areAllParentsInitiallyVisible();this.isOutsideOfPage()||(e&&(this.resetAnimations(),this.exitAnimationPromise&&(this.exitAnimationPromise.resolve(),this.exitAnimationPromise=null),this.visible&&"none"===this.$el.css("display")&&this.$el.show()),r&&this.resetTimers())},onActivationStart:function(){},onActivationEnd:function(){},onExitStart:function(){},onExitEnd:function(){},activateAndRunEntryAnimations:function(){if(this.onActivationStart(),this.hasEntryAnimation()&&!this.entryAnimationsActivated()){this._activatedEntryAnimations=!0;var e=this;this.runEntryAnimations().done(function(){e.onActivationEnd()})}else this.onActivationEnd()},rerunActivationAndEntryAnimations:function(){if(this.onActivationStart(),this.hasEntryAnimation()){this._activatedEntryAnimations=!0;var e=this;this.runEntryAnimations().done(function(){e.onActivationEnd()})}else this.onActivationEnd()},runEntryAnimations:function(){var e=this.getModule();if(!this.runningExitAnimations){i.each(this.entryAnimations,function(e){e.cleanup()}),this.entryAnimations[0].resetToInitialState();var n=this,r=new t.Deferred,o=function(){i.last(n.entryAnimations).off(u.END_EVENT,o),n.options.animationsRepeatAll?i.defer(i.bind(n.runEntryAnimations,n)):(r.resolve(),p.trigger(e.publishedEvents.PAGE_COMPONENT_ANIMATION_END,n.id))};return i.last(this.entryAnimations).on(u.END_EVENT,o),this.entryAnimations[0].play(),this.entryAnimations.length>0&&p.trigger(e.publishedEvents.PAGE_COMPONENT_ANIMATION_START,this.id),r.promise()}return(new t.Deferred).resolve().promise()},runAllChildViewExitAnimations:function(e){if(e=e||[],!this.runningExitAnimations&&this.visible&&this.areAllParentsVisible()){var t=this;this.runningExitAnimations=!0,this.onExitStart();var n=this.runExitAnimations().then(function(){t.runningExitAnimations=!1,t.onExitEnd()});e.push(n),this.childViews&&i.each(this.childViews,function(t){t.runAllChildViewExitAnimations(e)})}return e},runExitAnimations:function(){var e=this.getModule();this.entryAnimations&&i.each(this.entryAnimations,function(e){e.cleanup()});var n=new t.Deferred;if(this.exitAnimationPromise=n,i.isEmpty(this.exitAnimations)||"none"===this.$el.css("display"))p.trigger(e.publishedEvents.PAGE_COMPONENT_ANIMATION_END,this.id),n.resolve();else{var r=this,o=function(){p.trigger(e.publishedEvents.PAGE_COMPONENT_ANIMATION_END,r.id),n.resolve(),i.last(r.exitAnimations).off(u.END_EVENT,o)};i.last(this.exitAnimations).on(u.END_EVENT,o),i.each(this.exitAnimations,function(e){e.cleanup()}),this.exitAnimations[0].resetToInitialState(),this.exitAnimations[0].play(),this.exitAnimations.length>0&&p.trigger(e.publishedEvents.PAGE_COMPONENT_ANIMATION_START,this.id)}return n.promise()},cleanupAnimations:function(){this.entryAnimations&&i.each(this.entryAnimations,function(e){e.cleanup()}),this.exitAnimations&&i.each(this.exitAnimations,function(e){e.cleanup()})},hasEntryAnimation:function(){return this.entryAnimations&&i.size(this.entryAnimations)>0},doTriggerOnScroll:function(){return this.hasEntryAnimation()||this._hasInteraction(this.getModule().INTERACTION_TRIGGERS.VIEW)||"html"===this.type},resetToInitialState:function(){i.isEmpty(this.entryAnimations)?i.isEmpty(this.exitAnimations)||i.first(this.exitAnimations).resetToInitialState():i.first(this.entryAnimations).resetToInitialState()},pauseAnimations:function(){this.entryAnimations&&i.each(this.entryAnimations,function(e){e.pause()}),this.exitAnimations&&i.each(this.exitAnimations,function(e){e.pause()})},resumeAnimations:function(){this.entryAnimations&&i.each(this.entryAnimations,function(e){e.resume()}),this.exitAnimations&&i.each(this.exitAnimations,function(e){e.resume()})},hasShadow:function(e){return!i.isEmpty(e)&&(e.x>0||e.x<0||e.y>0||e.y<0||e.blur>0)},getApplyShadowTarget:function(){return this.$el},_applyShadow:function(e,t){var n=this.getApplyShadowTarget();if(this.hasShadow(e)){var r={x:i.isNumber(e.x)?e.x:0,y:i.isNumber(e.y)?e.y:0};t&&0!==t&&this._rotateShadowCoordinates(r,t);var o="";o+=Math.round(r.x)+"px",o+=" "+Math.round(r.y)+"px",o+=e.blur?" "+e.blur+"px":" 0",o+=e.spread?" "+e.spread+"px":" 0",
o+=" "+e.color,n.css("boxShadow",o)}else n.css("boxShadow","none")},_rotateShadowCoordinates:function(e,t){t=Math.toRad(t);var i=e.x*Math.cos(t)+e.y*Math.sin(t),n=-1*e.x*Math.sin(t)+e.y*Math.cos(t);e.x=i,e.y=n},getApplyBackgroundTarget:function(){return this.$el},_applyBackground:function(e){var t=this.getApplyBackgroundTarget();if(!e)return t.css("backgroundColor","transparent"),void t.css("backgroundImage","none");e.color?t.css("backgroundColor",e.color):t.css("backgroundColor","transparent"),e.gradient?t.css("backgroundImage","linear-gradient("+parseInt(e.gradient.angle,10)+"deg,"+o.buildStops(e.gradient.stops)+")"):t.css("backgroundImage","none")},getExtentsDimensionData:function(){return{x:this.options.x,y:this.options.y,width:this.options.width,height:this.options.height,rotation:-Math.toRad(this.options.rotation),borderWidth:this.options.border.width?this.options.border.width:0}},getExtents:function(){var e=this.getExtentsDimensionData(),t=m.getExtentsPointsFromDimensions(e.x,e.y,e.width,e.height,e.rotation,e.borderWidth),i=this.transformPointToPageCoordinateSpace(t[0]),n=this.transformPointToPageCoordinateSpace(t[1]),r=this.transformPointToPageCoordinateSpace(t[2]),o=this.transformPointToPageCoordinateSpace(t[3]);return{x1:Math.round(Math.min(i.x,n.x,r.x,o.x)),y1:Math.round(Math.min(i.y,n.y,r.y,o.y)),x2:Math.round(Math.max(i.x,n.x,r.x,o.x)),y2:Math.round(Math.max(i.y,n.y,r.y,o.y))}},getHoverArea:function(){var e=this.getExtentsDimensionData(),t=m.getExtentsPointsFromDimensions(e.x,e.y,e.width,e.height,e.rotation,e.borderWidth);return[this.transformPointToPageCoordinateSpace(t[0]),this.transformPointToPageCoordinateSpace(t[1]),this.transformPointToPageCoordinateSpace(t[2]),this.transformPointToPageCoordinateSpace(t[3])]},transformPointToPageCoordinateSpace:function(e){var t=new b.Point(e.x,e.y),n=this.parentViews;if(i.each(n,function(e){if(e.options.rotation){var i=e.options.width/2,n=e.options.height/2;t.rotate(i,n,-Math.toRad(e.options.rotation))}t.x+=e.options.x||0,t.y+=e.options.y||0}),this.options.parentSmartgroup){var r=this.options.parentSmartgroup.options.x,o=this.options.parentSmartgroup.options.y,s=this.options.parentSmartgroup.options.width/2,a=this.options.parentSmartgroup.options.height/2,u=-Math.toRad(this.options.parentSmartgroup.options.rotation);0!==u&&t.rotate(s,a,u),t.x+=r,t.y+=o}return t}})}),define("text!modules/page/templates/media-loading.html",[],function(){return'<div class="media-loading__media-type-icon {{#isImage}}-image{{/isImage}}{{^isImage}}-video{{/isImage}}"></div>\n<div class="media-loading__spinner"><div class="loader-spinner"></div></div>\n'}),define("modules/page/views/components/MediaComponentLoadingView",["log","jquery","lodash","backbone","mustache","device","shared/views/AbstractView","text!modules/page/templates/media-loading.html"],function(e,t,i,n,r,o,s,a){"use strict";return s.extend({tag:"div",className:"media-loading",initialize:function(e){this.isImage=e.isImage,this.parentHeight=e.height,this.render()},render:function(){this.$el.html(r.render(a,{isImage:this.isImage})),this.setIconSize(),this.setSpinnerSize()},setIconSize:function(){var e=Math.floor(.2*this.parentHeight);this.$el.find(".media-loading__media-type-icon").css("font-size",e+"px")},setSpinnerSize:function(){var e=Math.floor(.08*this.parentHeight);this.$el.find(".media-loading__spinner").css({height:e+"px",width:e+"px"})}})}),define("modules/page/models/video/AbstractVideo",[],function(){"use strict";return{on:function(e,t){throw new Error("on() must be defined by child class")},getPosition:function(){throw new Error("getPosition() must be defined by child class")},getLength:function(){throw new Error("getLength() must be defined by child class")},isPlaying:function(){throw new Error("isPlaying() must be defined by child class")},getCurrentSource:function(){throw new Error("getCurrentSource() must be defined by child class")}}}),define("modules/page/models/video/HTMLVideo",["lodash","modules/page/models/video/AbstractVideo"],function(e,t){"use strict";var i=function(e){this.$videoElement=e};return e.extend(i.prototype,t,{on:function(e,t){this.$videoElement.on(e,t)},getPosition:function(){return this.$videoElement[0].currentTime},getLength:function(){return this.$videoElement[0].duration},isPlaying:function(){return!1===this.$videoElement[0].ended&&!1===this.$videoElement[0].paused&&this.$videoElement[0].currentTime>0},getCurrentSource:function(){return this.$videoElement[0].currentSrc}}),i}),define("modules/page/utils/VideoTracker",["jquery","log","lodash","backbone"],function(e,t,i,n){"use strict";var r=function(e,t){this.video=e,this.loadedMetaData=!1,this.playedVideoBeforeMetaDataLoaded=!1,this.sentInitialPlayEvent=!1,this.progressPercents=[],this.isPlaying=!1,this.isTransitioningToPaused=!1,this.videoLength=t||!1,this.enabled=!0,this.currentPosition=0,this.lastPosition=0,this.progressStartPosition=0,this.isWindowVisible="hidden"!==document.visibilityState,this.addEventListeners()};return r.prototype=i.extend({},n.Events,{EVENTS:{PLAY:"play",PROGRESS_TIME:"progress_time",PROGRESS_PERCENT:"progress_percent"},enableTracking:function(){this.enabled||(this.enabled=!0,this.isWindowVisible&&this.restartProgressTracking())},disableTracking:function(){this.enabled&&(this.isWindowVisible&&this.triggerProgressEvent(this.lastPosition),this.enabled=!1)},addEventListeners:function(){document.addEventListener("visibilitychange",i.bind(function(){"hidden"===document.visibilityState?(this.isWindowVisible=!1,this.enabled&&this.triggerProgressEvent(this.lastPosition)):"visible"===document.visibilityState&&(this.isWindowVisible=!0,this.enabled&&this.restartProgressTracking())},this));var e=this;i.each("loadedmetadata,timeupdate".split(","),function(t){e.video.on(t,function(){switch(e.currentPosition=e.video.getPosition(),e.videoLength&&(e.currentPosition=Math.min(e.currentPosition,e.videoLength)),e.isTransitioningToPaused=e.isPlaying&&!e.video.isPlaying(),e.isPlaying=e.video.isPlaying(),t){case"loadedmetadata":e.handleLoadedMetadataEvent();break;case"timeupdate":e.handleTimeUpdateEvent();break;default:throw new Error("Missing handler function for video event: "+t)}e.lastPosition=e.currentPosition})})},handleLoadedMetadataEvent:function(){this.loadedMetaData=!0,this.videoLength||!this.video.getLength()||this.video.getLength()===1/0||isNaN(this.video.getLength())||(this.videoLength=this.video.getLength()),this.playedVideoBeforeMetaDataLoaded&&(this.triggerPlayEvent(),this.sentInitialPlayEvent=!0)},sendInitialPlayEvent:function(){this.sentInitialPlayEvent||this.playedVideoBeforeMetaDataLoaded||(this.loadedMetaData?(this.triggerPlayEvent(),this.sentInitialPlayEvent=!0):this.playedVideoBeforeMetaDataLoaded=!0)},triggerPlayEvent:function(){this.triggerEvent(this.EVENTS.PLAY,{videoPosition:this.sanitizeVideoPosition(this.currentPosition)})},handleTimeUpdateEvent:function(){this.isPlaying&&this.sendInitialPlayEvent(),this.enabled&&this.isWindowVisible&&(this.currentPosition<this.lastPosition||Math.abs(this.currentPosition-this.lastPosition)>1?this.triggerProgressEvent(this.lastPosition):(this.isTransitioningToPaused||this.currentPosition-this.progressStartPosition>=10)&&this.triggerProgressEvent(),(this.isPlaying||this.isTransitioningToPaused)&&this.trackProgressPercent())},trackProgressPercent:function(){var e=this.videoLength?Math.floor(this.videoLength):this.videoLength;if(e&&100!==this.progressPercents.length){var t=Math.round(this.currentPosition/e*100);t=Math.max(1,Math.min(100,t));var i=1;e<100&&(i=Math.ceil(100/e));for(var n=0;n<i&&(this.addProgressPercentViewed(t),!(--t<=0));n++);}},addProgressPercentViewed:function(e){if(!i.includes(this.progressPercents,e)){this.progressPercents.push(e);var t=this.progressPercents.length;this.triggerEvent(this.EVENTS.PROGRESS_PERCENT,{progressPercent:t})}},triggerProgressEvent:function(e){e=e||this.currentPosition;var t=e-this.progressStartPosition;t>.1&&this.triggerEvent(this.EVENTS.PROGRESS_TIME,{videoPosition:this.sanitizeVideoPosition(this.progressStartPosition),videoPlayTime:this.round(t)}),this.restartProgressTracking()},triggerEvent:function(e,t){this.videoLength&&(t.videoLength=this.round(this.videoLength)),this.trigger(e,t)},restartProgressTracking:function(){this.progressStartPosition=this.currentPosition},round:function(e){return Math.round(100*e)/100},sanitizeVideoPosition:function(e){var t=this.round(e);return t<0&&(t=0),t}}),r}),define("modules/page/views/components/video/AbstractVideoComponentView",["lodash","jquery","log","globals","device","color","modules/page/views/components/AbstractComponentView","modules/page/views/components/MediaComponentLoadingView","modules/page/models/video/HTMLVideo","modules/page/utils/VideoTracker","shared/utils/CerosResourceLoader","urlUtils"],function(e,t,i,n,r,o,s,a,u,l,c,h){"use strict";var d=n.mediaDomainMap?e.invert(n.mediaDomainMap):null,f=[10,20,30,40,50,60,70,80,90,100];return s.extend({type:"video",tagName:"div",className:null,EVENTS:{VIDEO_READY:"video_ready"},isVideoReady:!1,playedOnce:!1,videoSlug:null,$vid:null,videoHandle:null,videoTracker:null,tapToPlay:!0,muted:!1,isAutoPaused:!1,isManuallyPaused:!1,isPinned:void 0,initialize:function(){s.prototype.initialize.apply(this),this.areMediaPropertiesSet()&&(this.videoSlug=this.options.video&&this.options.video.substr(this.options.video.lastIndexOf("/")+1),this.isVideoReady=!1,this.posterLoader=this.options.posterLoader,e.isUndefined(this.options.tapToPlay)||(this.tapToPlay=this.options.tapToPlay),e.isUndefined(this.options.muted)||(this.muted=this.options.muted),this._initializeDom(),n.previewMode&&(this.mediaLoadingScreen=new a({height:this.options.height,isImage:!1}),this.$el.append(this.mediaLoadingScreen.$el)),this.posterLoader&&(this.posterLoader.onImageLoaded(this.attachMedia,this),n.previewMode&&this.posterLoader.onImageLoaded(this.hideMediaLoadingScreen,this)))},hideMediaLoadingScreen:function(){this.mediaLoadingScreen.close()},onActivationStart:function(){this.videoTracker&&this.videoTracker.enableTracking()},areMediaPropertiesSet:function(){return this.options.video&&this.options.poster},attachMedia:function(){var i=new t.Deferred;if(this.areMediaPropertiesSet()){var n=this.getPosterFrameResource();n?n.loadNow().done(e.bind(function(e){this.$poster.attr("src",e.getSrc()),i.resolve()},this)):i.resolve()}else i.resolve();return i},getPosterFrameResource:function(){var e=null;return this.posterLoader&&((e=this.posterLoader.getCurrentResource())||i.warn("Poster image should have been added to resource loader during preload")),e},_hidePoster:function(){this.$poster&&this.$poster.hide()},_showPoster:function(){this.$poster&&this.$poster.show()},_isPosterShowing:function(){return this.$poster&&"none"!==this.$poster.css("display")},doTriggerOnScroll:function(){return!0},_getPosterFrameSrc:function(){return this.posterLoader?this.posterLoader.getCurrentUrl():""},_initializeDom:function(){this.$poster=t("<img>",{width:this.options.width,height:this.options.height,position:"absolute",top:0,left:0}),this.$el.append(this.$poster)},onActivationEnd:function(){this.canAutoplay()&&!this.isManuallyPaused?this.play():this._isPosterShowing()&&this._loadVideo()},onExitStart:function(){this._hideVideoAndShowPoster(),this.autoPause(),this._rewindEndedAutoplayingVideo()},_getVideoFormats:function(){throw new Error("Device-specific implementation")},getResolvedVideoUrlForFormat:function(t){var n,r=this.options.videoMedia;if(!e.isUndefined(r)&&!e.isNull(r)){var o=r.encodings;if(!o[t])return null;n=o[t],n=h.makeUrlAbsolute(n),n=h.replaceProtocolIfHttpsRequest(n),d&&(n=this.switchAmazonDomainInUrl(n))}return e.isUndefined(n)&&(i.warn("Resolved video not found!",n),n=this.options.video+"/redirect/"+t),n},switchAmazonDomainInUrl:function(t){var i=t.match(/https?:\/\/(([a-z0-9-]*)\.[^\/]*)/i);if(i){var n=i[1],r=i[2];e.has(d,r)&&(t=t.replace(n,d[r]))}return t},_setVideoSources:function(){var i=this._getVideoFormats();e.each(i,e.bind(function(e){var i=this.getResolvedVideoUrlForFormat(e.format);if(i){var n="video/"+e.type;"hls-playlist"!==e.format&&"dash-playlist"!==e.format||(n="application/"+e.type),this.$vid.append(t("<source>",{src:i,type:n}))}},this))},_isLoopForever:function(){return!0===this.options.videoAutoPlay&&!0===this.options.videoLoop},_isShowControls:function(){return!1===this.options.videoAutoPlay||e.isUndefined(this.options.videoHideControls)||!1===this.options.videoHideControls},_hideVideo:function(){this.$vid&&this.$vid.hide()},_showVideo:function(){this.$vid&&this.$vid.show()},_hideVideoAndShowPoster:function(){this.videoHandle&&!this.videoHandle.currentTime&&(this._showPoster(),this.isVideoReady&&this._hideVideo())},_hidePosterAndShowVideo:function(){this.isVideoReady&&this._showVideo(),this._hidePoster()},_isPlaying:function(){return this.videoHandle&&!1===this.videoHandle.ended&&!1===this.videoHandle.paused&&this.videoHandle.currentTime>0},_isEnded:function(){return this.isVideoReady&&this.videoHandle.ended},_setCurrentTime:function(e){this.isVideoReady&&(this.videoHandle.currentTime=e)},reset:function(){s.prototype.reset.apply(this),this.pauseAnyVideoAndRewindAutoPlayingVideo()},whenLeavingVisibleBoundaries:function(){e.isUndefined(this.isPinned)&&(this.isPinned=this.options.fixedPosition||!(!this.options.parentSmartGroup||!this.options.parentSmartGroup.fixedPosition),!this.isPinned&&this.parentViews&&e.each(this.parentViews,e.bind(function(e){if(e.options.fixedPosition)return this.isPinned=!0,!1},this))),this.isPinned||(s.prototype.whenLeavingVisibleBoundaries.apply(this),this.disableVideoTrackingAndAutoPlayingVideo())},disableVideoTrackingAndAutoPlayingVideo:function(){this.disableVideoTracking(),this.options.videoAutoPlay&&this.pauseAnyVideoAndRewindAutoPlayingVideo()},disableVideoTracking:function(){this.videoTracker&&this.videoTracker.disableTracking()},pauseAnyVideoAndRewindAutoPlayingVideo:function(){this.autoPause(),this._rewindEndedAutoplayingVideo()},_rewindEndedAutoplayingVideo:function(){this.options.videoAutoPlay&&this._isEnded()&&this._setCurrentTime(0)},loadAndShowVideo:function(){this.isVideoReady?this._hidePosterAndShowVideo():this._loadVideo()},play:function(){this.loadAndShowVideo(),this.videoTracker&&this.videoTracker.enableTracking(),this.isVideoReady?this.videoHandle.play():this.on(this.EVENTS.VIDEO_READY,e.bind(function(){this.videoHandle.play()},this))},autoPause:function(){this.isVideoReady&&!this.isPaused()&&(this.videoTracker&&this.videoTracker.disableTracking(),this.isAutoPaused=!0,this.videoHandle.pause())},getElementWidth:function(){return this.options.width},getElementHeight:function(){return this.options.height},buildVideoElement:function(){var e={id:this.id,width:this.getElementWidth(),height:this.getElementHeight(),poster:this._getPosterFrameSrc(),preload:"auto","webkit-playsinline":!0,playsinline:!0,type:"application/x-mpegURL"};this.muted&&(e.muted=!0),this._isLoopForever()&&(e.loop=!0),this.$vid=t("<video>",e),this.$vid.prop("controls",this._isShowControls()),this.$vid.prop("controlsList","nodownload"),this.$vid.css("display","none"),this.videoHandle=this.$vid[0],this.videoHandle.muted=this.muted,this.videoHandle.autoplay=this.canAutoplay(),r.isDesktopSafari()||r.isMobileSafari()?this.$vid.css("object-fit","cover"):this.$vid.css("object-fit","fill"),this.$poster.after(this.$vid)},_loadVideo:function(){if(!this.$vid){this.buildVideoElement();var t=new u(this.$vid),i=e.get(this.options,"videoMedia.duration");this.videoTracker=new l(t,i),this._configureVideoEvents(t),this.configurePlatformSpecificEvents(),this.doPlatformSpecificSetup(),this.bindVideoElementPauseAndPlayForManualPauseDetection()}},manuallyPause:function(){this.isVideoReady&&!this.isPaused()&&(this.videoTracker&&this.videoTracker.disableTracking(),this.isAutoPaused=!1,this.videoHandle.pause())},isPaused:function(){return this.$vid[0].paused},_configureVideoEvents:function(t){t.on("play",e.bind(function(){this.playedOnce=!0,i.debug("Currently playing from src "+t.getCurrentSource())},this)),this.videoTracker.on(this.videoTracker.EVENTS.PLAY,e.bind(function(e){this.triggerEvent(this.getModule().publishedEvents.PAGE_VIDEO_PLAY,e)},this)),this.options.videoLoop||(this.videoTracker.on(this.videoTracker.EVENTS.PROGRESS_TIME,e.bind(function(e){this.triggerEvent(this.getModule().publishedEvents.PAGE_VIDEO_PROGRESS_TIME,e)},this)),this.videoTracker.on(this.videoTracker.EVENTS.PROGRESS_PERCENT,e.bind(function(t){e.includes(f,t.progressPercent)&&this.triggerEvent(this.getModule().publishedEvents.PAGE_VIDEO_PROGRESS_PERCENT,t)},this)))},bindVideoElementPauseAndPlayForManualPauseDetection:function(){this.$vid.bind("pause",e.bind(function(e){this.onVideoPause()},this)),this.$vid.bind("play",e.bind(function(e){this.onVideoPlay()},this))},onVideoPause:function(){this.isManuallyPaused=!this.isAutoPaused},onVideoPlay:function(){this.isManuallyPaused=!1,this.isAutoPaused=!1},triggerEvent:function(t,i){var n=e.extend({componentSlug:this.options.id,videoSlug:this.videoSlug,pageSlug:this.options.pageView.model.get("slug")},i);this.getModule().trigger(t,n)},canAutoplay:function(){return!!this.options.videoAutoPlay&&(!this.tapToPlay||this.playedOnce)},_applyRotation:function(e,t,i){},_applyBackground:function(e){},_applyBorder:function(e){},_configureAction:function(){}})}),define("modules/page/views/SmartgroupView",["jquery","lodash","globals","backbone","modules/page/views/components/AbstractComponentView","device","shared/utils/CssUtils","ExtentsUtils"],function(e,t,i,n,r,o,s,a){"use strict";return r.extend({initialize:function(){r.prototype.initialize.call(this),this.childViews={},this.setSizeFromExtents()},setSizeFromExtents:function(){function e(i){if("folder"===i.type)t.each(i.items,function(t){e(t)});else{var r=i,o=a.getExtentsFromDimensions(r.x,r.y,r.width,r.height,Math.toRad(r.rotation),r.border.width?r.border.width:0);n.push(o)}}i.previewMode&&(this.options=t.clone(this.options)),this.options.scaleWidth=this.options.width/100,this.options.scaleHeight=this.options.height/100;var n=[];t.each(this.options.layers,function(t){e(t)});var r=a.getSmallestContainingRectangle.apply(a,n);this.options.width=r.x2-r.x1,this.options.height=r.y2-r.y1;var o=this.options.width/2,s=this.options.height/2,u=this.options.width/2*this.options.scaleWidth,l=this.options.height/2*this.options.scaleHeight;this.options.originalX=this.options.x,this.options.originalY=this.options.y,this.options.x=this.options.x-(o-u),this.options.y=this.options.y-(s-l),this.options.fixedPosition&&(this.options.unfixedX=this.options.x,this.options.unfixedY=this.options.y)},_applyDimensions:function(e,t){var i="scale("+this.options.scaleWidth+","+this.options.scaleHeight+")";this.$el.css("transform",s.concatTransform(this.$el.css("transform"),i));var n=this.options.width/2+"px "+this.options.height/2+"px";this.$el.css("transform-origin",n),this.$el.css("-moz-transform-origin",n),this.$el.css("-webkit-transform-origin",n),this.$el.css("-ms-transform-origin",n)}})}),define("modules/page/views/components/SquareShapeComponentView",["jquery","lodash","backbone","modules/page/views/components/AbstractComponentView"],function(e,t,i,n){"use strict";return n.extend({type:"shape",tagName:"div",render:function(){return n.prototype.render.call(this),!t.isEmpty(this.options.background)||!t.isEmpty(this.options.border)&&0!==this.options.border.width||t.isEmpty(this.options.action)||this.$el.css({"background-color":"white",opacity:0}),this},hasShadow:function(e){return!t.isEmpty(this.options.background)&&n.prototype.hasShadow.call(this,e)}})}),define("modules/page/utils/SVGUtil",["log","lodash"],function(e,t){"use strict";return function(){var i=function(e){e=e.replace(/(\s+)/g,";").split(";");var i="M";return t.each(e,function(e,t){e.length>0&&(i+=(0===t?"":"L")+e)}),i+="z"},n=function(e){var i=e.replace(/([MmZzLlHhVvCcSsQqTtAa])\s/g,"$1").replace(/\s-/g,"-").replace(/\s/g,",").match(/([MmZzLlHhVvCcSsQqTtAa](-?\d+[\.\s]?\d*,?)*)/g),n=[];return t.each(i,function(e,r){var o=e.substr(1).replace(/-/g,",-").replace(/(^,)/,"").split(",");t.each(o,function(e,t){o[t]=parseFloat(e)}),n.push({op:i[r].substr(0,1),coords:o})}),n},r=function(i,r){"string"==typeof r&&(r=n(r)),i.beginPath();var o,s,a,u,l,c,h=0,d=0,f=null,p=null;t.each(r,function(t,n){var r=t.coords;switch(t.op){case"m":h+=r[0],d+=r[1],i.moveTo(h,d);break;case"M":f=h=r[0],p=d=r[1],i.moveTo(h,d);break;case"c":o=h+r[0],s=d+r[1],a=h+r[2],u=d+r[3],h+=r[4],d+=r[5],l=2*h-a,c=2*d-u,i.bezierCurveTo(o,s,a,u,h,d);break;case"C":o=r[0],s=r[1],a=r[2],u=r[3],h=r[4],d=r[5],l=2*h-a,c=2*d-u,i.bezierCurveTo(o,s,a,u,h,d);break;case"s":a=h+r[0],u=d+r[1],h+=r[2],d+=r[3],i.bezierCurveTo(l,c,a,u,h,d),l=2*h-a,c=2*d-u;break;case"q":o=h+r[0],s=d+r[1],h+=r[2],d+=r[3],l=2*h-o,c=2*d-s,i.quadraticCurveTo(o,s,h,d);break;case"t":h+=r[0],d+=r[1],i.quadraticCurveTo(l,c,h,d),l=2*h-l,c=2*d-c;break;case"l":h+=r[0],d+=r[1],i.lineTo(h,d);break;case"L":h=r[0],d=r[1],i.lineTo(h,d);break;case"h":h+=r[0],i.lineTo(h,d);break;case"H":h=r[0],i.lineTo(h,d);break;case"v":d+=r[0],i.lineTo(h,d);break;case"V":d=r[0],i.lineTo(h,d);break;case"z":case"Z":i.lineTo(f,p);break;default:e.warn("UNKNOWN SVG OP: "+t.op)}})},o=function(e,t,i,n){t&&null!==t&&(r(e,t),n&&e.stroke(),i&&e.fill())};return{pointsToPath:i,parse:n,render:o,stroke:function(e,t){o(e,t,!1,!0)},fill:function(e,t){o(e,t,!0,!1)},trace:r}}()}),define("text!modules/page/templates/shapes.svg",[],function(){return'<?xml version="1.0" encoding="utf-8"?>\n\x3c!-- Generator: Adobe Illustrator 16.0.0, SVG Export Plug-In . SVG Version: 6.00 Build 0)  --\x3e\n<svg version="1.2" baseProfile="tiny" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px"\n\t y="0px" width="1000px" height="1000px" viewBox="0 0 1000 1000" xml:space="preserve">\n<g id="single-arrow" display="none">\n\t<path display="inline" fill-rule="evenodd" fill="none" stroke="#000000" stroke-miterlimit="10" d="M0,346.2l696.6,0V0L1000,500\n\t\tl-303.4,500V653.9L0,653.9V346.2z"/>\n</g>\n<g id="double-arrow" display="none">\n\t<path display="inline" fill-rule="evenodd" fill="none" stroke="#000000" stroke-miterlimit="10" d="M232.8,653.9V1000L0,500\n\t\tL232.8,0v346.1l534.5,0V0L1000,500l-232.8,500V653.9L232.8,653.9z"/>\n</g>\n<g id="rounded-square" display="none">\n\t<path display="inline" fill-rule="evenodd" fill="none" stroke="#000000" stroke-miterlimit="10" d="M1000,883.3\n\t\tc0,64.2-52.5,116.7-116.7,116.7H116.7C52.5,1000,0,947.5,0,883.3V116.7C0,52.5,52.5,0,116.7,0h766.7C947.5,0,1000,52.5,1000,116.7\n\t\tV883.3z"/>\n</g>\n<g id="triangle" display="none">\n\t<path display="inline" fill-rule="evenodd" fill="none" stroke="#000000" stroke-miterlimit="10" d="M500,0L0,1000h1000L500,0"/>\n</g>\n<g id="right-triangle" display="none">\n\t<polygon display="inline" fill-rule="evenodd" fill="none" stroke="#000000" stroke-miterlimit="10" points="0.1,1000.5\n\t\t1000.5,1000.5 1000.5,0.1 \t"/>\n</g>\n<g id="single-arrow-fat" display="none">\n\t<path display="inline" fill-rule="evenodd" fill="none" stroke="#000000" stroke-miterlimit="10" d="M454.5,0L1000,500l-545.5,500\n\t\tV700H0V300h454.5V0z"/>\n</g>\n<g id="double-arrow-fat" display="none">\n\t<path display="inline" fill-rule="evenodd" fill="none" stroke="#000000" stroke-miterlimit="10" d="M517,680.3L517,680.3l-252,0\n\t\tV1000L0,500L265,0v319.6h218v0h252V0l265,500l-265,500V680.3H517z"/>\n</g>\n<g id="round-bubble" display="none">\n\t<path display="inline" fill-rule="evenodd" fill="none" stroke="#000000" stroke-miterlimit="10" d="M650.3,786.5\n\t\tC516.5,972.5,288.8,1000,288.8,1000c75.1-73.8,98.5-146,100.4-204.9C166.4,754.5,0,594.2,0,402.5C0,180.2,223.9,0,500,0\n\t\ts500,180.2,500,402.5C1000,582.6,853,735.1,650.3,786.5z"/>\n</g>\n<g id="square-bubble" display="none">\n\t<path display="inline" fill-rule="evenodd" fill="none" stroke="#000000" stroke-miterlimit="10" d="M796.5,800H648.4l-302.2,200\n\t\tl54.9-200H203.5C91.1,800,0,705.2,0,588.3V211.7C0,94.8,91.1,0,203.5,0h592.9C908.9,0,1000,94.8,1000,211.7v376.7\n\t\tC1000,705.2,908.9,800,796.5,800z"/>\n</g>\n<g id="star" display="none">\n\t<path display="inline" fill-rule="evenodd" fill="none" stroke="#000000" stroke-miterlimit="10" d="M500,0l154.5,329.2L1000,382\n\t\tL750,638.2l59,361.8L500,829.2L191,1000l59-361.8L0,382l345.5-52.8L500,0z"/>\n</g>\n<g id="star2" display="none">\n\t<path display="inline" fill-rule="evenodd" fill="none" stroke="#000000" stroke-miterlimit="10" d="M500.3,0l-98.1,410.7L0,382.3\n\t\tl339.8,225.2L191,999.6l308.1-270.4L808.7,1000L659,607.7l341-225.5l-402.3,28.2L500.3,0z"/>\n</g>\n<g id="pentagon" display="none">\n\t<path display="inline" fill="none" stroke="#000000" stroke-miterlimit="10" d="M1000,382l-191,618H191L0,382L500,0L1000,382z"/>\n</g>\n<g id="circle" display="none">\n\t<circle display="inline" fill="none" stroke="#000000" stroke-miterlimit="10" cx="500" cy="500" r="500"/>\n</g>\n<g id="square" display="none">\n\t<rect x="0" y="0" display="inline" fill="none" stroke="#000000" stroke-miterlimit="10" width="1000" height="1000"/>\n</g>\n</svg>\n'}),define("modules/page/utils/ShapeLibrary",["jquery","lodash","modules/page/utils/SVGUtil","libs/image/ImageResource","text!modules/page/templates/shapes.svg"],function(e,t,i,n,r){"use strict";var o=function(){this.shapes=e(r),this.scale={x:parseInt(this.shapes.filter(":first").attr("width"),10),y:parseInt(this.shapes.filter(":first").attr("height"),10)},this.paths={},this.shapes.find("g").each(t.bind(function(t,n){n=e(n);var r=n.attr("id"),o=n.children(),s=this.getScale().x,a=this.getScale().y;this.paths[r]=null;var u;o.length>0&&(o.is("path")?(u=i.parse(o.attr("d")),this.paths[r]=function(e){i.trace(e,u)}):o.is("polygon")?(u=i.pointsToPath(o.attr("points")),this.paths[r]=function(e){i.trace(e,u)}):o.is("circle")?this.paths[r]=function(e){var t=s>a?a/2:s/2;e.translate(s/2,a/2),e.scale(s>a?s/a:1,a>s?a/s:1),e.arc(0,0,t,0,Math.toRad(360),!0)}:o.is("rect")&&(this.paths[r]=function(e){e.rect(0,0,s,a)}))},this))};return t.extend(o.prototype,{getScale:function(){return this.scale},getPathFunc:function(e){return this.paths[e]},getAllShapes:function(){return t.keys(this.paths)},hasShape:function(e){return t.has(this.paths,e)},getImageResource:function(i,r,o,s,a){var u=e('<canvas width="'+r+'" height="'+o+'"></canvas>'),l=u[0].getContext("2d");l.save(),l.clearRect(0,0,r,o),t.isUndefined(s)||(l.fillStyle=s),t.isUndefined(a)||(l.strokeStyle=a);var c=this.getPathFunc(i);null!==c&&(l.scale(r/this.getScale().x,o/this.getScale().y),l.beginPath(),c(l),t.isUndefined(s)||l.fill(),t.isUndefined(a)||l.stroke()),l.restore();var h=new n(u[0].toDataURL());return u.remove(),h}}),new o}),define("modules/page/views/components/ShapeComponentView",["log","jquery","lodash","backbone","modules/page/views/components/AbstractComponentView","modules/page/utils/ShapeLibrary","device","cerosMath"],function(e,t,i,n,r,o,s,a){"use strict";return r.extend({type:"shape",tagName:"canvas",render:function(){if(!i.isFunction(this.el.getContext))return this;this.scale=o.getScale(),this.startX=0,this.startY=0;var e=this.options.shadow,t=this.options.rotation,n=this.options.border,a=this.options.background,u=this.options.width,l=this.options.height;if("square"==this.options.shape)throw Error("This component view cannot be used for square!");if(!i.isEmpty(e)&&!i.isEmpty(a)&&""!==e){if(t&&0!==t){var c=i.isNumber(e.x)?e.x:0,h=i.isNumber(e.y)?e.y:0;t=Math.toRad(t),e.x=c*Math.cos(t)+h*Math.sin(t),e.y=-1*c*Math.sin(t)+h*Math.cos(t)}e.blur=i.isNumber(e.blur)?Math.abs(e.blur):0,e.x=i.isNumber(e.x)?e.x:0,e.y=i.isNumber(e.y)?e.y:0,e.x<0&&(this.options.x-=Math.abs(e.x)+e.blur,this.startX+=Math.abs(e.x)+e.blur),e.y<0&&(this.options.y-=Math.abs(e.y)+e.blur,this.startY+=Math.abs(e.y)+e.blur),u+=Math.abs(e.x)+e.blur,l+=Math.abs(e.y)+e.blur,e.blur>Math.abs(e.x)&&(u+=e.blur-Math.abs(e.x),this.options.x-=e.blur-Math.abs(e.x),this.startX+=e.blur-Math.abs(e.x)),e.blur>Math.abs(e.y)&&(l+=e.blur-Math.abs(e.y),this.options.y-=e.blur-Math.abs(e.y),this.startY+=e.blur-Math.abs(e.y))}!i.isEmpty(n)&&""!==n&&i.isNumber(n.width)&&(u+=2*n.width*this._sizeFactorForPointyShapes()+this._offsetForPointyShapes(n),l+=2*n.width*this._sizeFactorForPointyShapes()+this._offsetForPointyShapes(n),this.options.x-=n.width+this._offsetForPointyShapes(n),this.options.y-=n.width+this._offsetForPointyShapes(n),this.startX+=n.width+this._offsetForPointyShapes(n),this.startY+=n.width+this._offsetForPointyShapes(n)),this.options.allWidth=u,this.options.allHeight=l,r.prototype.render.call(this),!i.isEmpty(a)||!i.isEmpty(n)&&0!==n.width||i.isEmpty(this.options.action)||this.$el.css({"background-color":"white",opacity:0}),this._applyDimensions(u,l),this.el.width=u*(s.retina()?2:1),this.el.height=l*(s.retina()?2:1);var d=this.el.getContext("2d");return d.translate(this.startX,this.startY),s.retina()&&d.scale(2,2),i.isEmpty(n)||""===n||(d.lineWidth=1==n.width?1.0001:n.width,d.strokeStyle=n.color),i.isEmpty(e)||i.isEmpty(a)||""===e||(d.shadowOffsetX=e.x,d.shadowOffsetY=e.y,d.shadowColor=e.color,d.shadowBlur=e.blur),this.renderBackground(d,n,a,e),this},_applyShadow:function(){},_applyBorder:function(){},_applyBackground:function(){},_sizeFactorForPointyShapes:function(){return"star2"==this.options.shape||"double-arrow"==this.options.shape?2:1},_offsetForPointyShapes:function(e){return"star2"==this.options.shape||"double-arrow"==this.options.shape||"single-arrow"==this.options.shape?e.width:0},renderBackground:function(t,n,r,s){t.save(),(i.isUndefined(this.options.pathData)||i.isNull(this.options.pathData)||""===this.options.pathData)&&(this.path=o.getPathFunc(this.options.shape)),"square"==this.options.shape||(null!==this.path?(t.save(),t.scale(this.options.width/this.scale.x,this.options.height/this.scale.y),t.beginPath(),this.path(t),t.closePath(),t.restore()):e.error("Unsupported shape")),s&&(n&&n.width>0&&t.stroke(),r&&(r.gradient||r.color)&&(t.fillStyle=r.color?r.color:"rgba(0,0,0,1)",t.fill())),t.shadowOffsetX=t.shadowOffsetY=0,t.shadowColor=t.shadowBlur=null,t.save(),t.clip(),r&&r.gradient?this._renderGradient(t,r.gradient):r&&r.color&&(t.fillStyle=r.color,t.fill()),t.restore(),n&&n.width>0&&t.stroke(),t.restore()},_applyPosition:function(e,t,i){var n=this.getApplyPositionTarget();"square"==this.options.shape?r.prototype._applyPosition.call(this,e,t,i):(n.css("left",e+"px"),n.css("top",t+"px"))},_renderGradient:function(e,t){var n=a.calcRotatedLineIntersect(t.angle,this.options.width,this.options.height),r=n.startPt,o=n.endPt,s=e.createLinearGradient(Math.round(r.getX()),Math.round(r.getY()),Math.round(o.getX()),Math.round(o.getY()));i.each(t.stops,i.bind(function(e){s.addColorStop(e.stop,e.color)},this)),e.fillStyle=s,e.fill()}})}),define("modules/page/views/components/HtmlComponentView",["jquery","lodash","backbone","globals","modules/page/views/components/AbstractComponentView"],function(e,t,i,n,r){"use strict";return r.extend({type:"html",tagName:"div",onActivationStart:function(){if(this.previousCustomHtml!==this.options.customHtml)if(this.previousCustomHtml=this.options.customHtml,-1!==this.options.customHtml.indexOf("http:")&&"https:"===location.protocol)if(n.previewMode){this.$el.html("<p style='background-color:white'>Can't load an insecure resource on a secure page. Please publish your experience or change the embed code to use https.</p>")}else this.$el.empty();else this.$el.empty().html(e.parseHTML(this.options.customHtml,document,!0))},_applyBorder:function(){},_applyBackground:function(){},_applyShadow:function(){},_applyOpacity:function(){}})}),define("hubspotFormUtils",["lodash","jquery"],function(e,t){"use strict";return{renderForm:function(i){i.onFormReady=i.onFormReady||e.noop,i.onFormSubmit=i.onFormSubmit||e.noop;var n=null;i.onTimeout&&(n=setTimeout(i.onTimeout,1e4)),this.removeStyleTagForDomId(i.domId),window.hbspt.forms.create({portalId:i.portalId,formId:i.formId,css:i.css,target:"#"+i.domId,onFormReady:function(e,r){n&&clearTimeout(n);var o=t("head style").last()
;-1!==o.text().indexOf(i.css)&&o.attr("data-hubspot-form",i.domId),i.onFormReady(e,r)},onFormSubmit:i.onFormSubmit})},removeStyleTagForDomId:function(e){t("style[data-hubspot-form="+e+"]").remove()}}}),define("modules/page/views/components/AbstractFormComponentView",["lodash","jquery","device","shared/utils/NavigationUtils","modules/page/views/components/AbstractComponentView"],function(e,t,i,n,r){"use strict";return r.extend({type:"form-component",tagName:"div",onAttach:function(){this.renderForm()},applyChanges:function(e){r.prototype.applyChanges.call(this,e),this.renderForm()},getContainerDivId:function(){return"form-component-"+this.options.id.replace("|","_")},getContainerClassName:function(){return"form-component-"+(this.options.originalObjectId||this.options.id)},renderForm:function(){throw new Error("renderForm not implemented.")},handleSubmit:function(e){throw new Error("handleSubmit not implemented.")},_isValidInteraction:function(e){return-1===["show-fullscreen","share-email","share-facebook","share-twitter","share-pinterest","share-linkedin"].indexOf(e.action)&&("url"!==e.action||!e.opensInNewWindow)&&r.prototype._isValidInteraction.call(this,e)},triggerSubmitInteractions:function(t,i){var n=this.getModule(),r=this.getValidInteractionsByTrigger(n.INTERACTION_TRIGGERS.SUBMIT);n.trigger(n.publishedEvents.PAGE_COMPONENT_FORM_SUBMITTED,this.addComponentAndClickDataToEvent({formOrigin:t,formOriginAccountId:i,formOriginFormId:this.options.formId,formOriginFormName:this.options.formName,interactionTriggered:!e.isEmpty(r)})),e.isEmpty(r)||e.each(r,e.bind(function(t){"url"===t.action||"page-goto"===t.action||"page-next"===t.action||"page-prev"===t.action||"scroll-to"===t.action?e.defer(e.bind(function(){this._triggerClickAction(null,t)},this)):this._triggerClickAction(null,t)},this))},_applyBorder:function(){},_applyBackground:function(){},_applyShadow:function(){},_applyOpacity:function(){}})}),define("modules/page/views/components/HubspotFormComponentView",["lodash","jquery","device","hubspotFormUtils","shared/utils/NavigationUtils","modules/page/views/components/AbstractFormComponentView"],function(e,t,i,n,r,o){"use strict";return o.extend({type:"hubspot-form",tagName:"div",getContainerDivId:function(){return"hubspot-"+this.options.id.replace("|","_")},getContainerClassName:function(){return"hubspot-"+(this.options.originalObjectId||this.options.id)},renderForm:function(){this.$el.empty();var i=t('<div id="'+this.getContainerDivId()+'"></div>');i.addClass(this.getContainerClassName()),this.$el.append(i),n.renderForm({portalId:this.options.hubId,formId:this.options.formId,css:this.options.css,domId:this.getContainerDivId(),onFormSubmit:e.bind(this.handleSubmit,this)})},handleSubmit:function(e){this.doIframeHack(e),this.triggerSubmitInteractions("hubspot",this.options.hubId)},scaleComponent:function(){var e=this.options.pageView.getScaleContext().ratio,t=this.$("#"+this.getContainerDivId());this.options.pageView.scaleContext.doBlurryFontFix(e)?t.css({zoom:1/e,transform:"scale("+e+")","transform-origin":"0 0",width:100/e+"%","-moz-transform-origin":"0 0","-webkit-transform-origin":"0 0","-ms-transform-origin":"0 0"}):t.css({zoom:"initial",transform:"initial","transform-origin":"initial",width:"initial","-moz-transform-origin":"initial","-webkit-transform-origin":"initial","-ms-transform-origin":"initial"}),o.prototype.scaleComponent.call(this)},doIframeHack:function(n){if(i.isIos()||i.edge||i.isDesktopSafari()||i.msie){var o=!1,s=null,a=t(n).find("input[name=hs_context]").val();if(!e.isEmpty(a))try{var u=JSON.parse(a),l=r.getLocationWithoutParamsAndPageNumber();u.redirectUrl&&0===u.redirectUrl.indexOf(l)&&(s=u.redirectUrl),o=e.isEmpty(u.redirectUrl)||Boolean(s)}catch(e){}if(o){t("#hubspot-submit").remove();var c=t("<iframe></iframe>");c.attr("id","hubspot-submit"),c.attr("name","hubspot-submit"),c.css({position:"absolute",left:"99999px"}),t(document.body).append(c),t(n).attr("target","hubspot-submit"),s&&this.doThankYouMessageHack(n,s)}}},doThankYouMessageHack:function(i,r){var o=window.location.href,s=r+"&submissionGuid=1";window.history.replaceState({},"",s),e.defer(e.bind(function(){t(i).remove(),n.renderForm({portalId:this.options.hubId,formId:this.options.formId,css:this.options.css,domId:this.getContainerDivId(),onFormReady:function(){window.history.replaceState({},"",o)}})},this))}})}),function(e){function t(e,t){return function(i){return a(e.call(this,i),t)}}function i(){}function n(e){o(this,e)}function r(e){var t=e.years||e.year||e.y||0,i=e.months||e.month||e.M||0,n=e.weeks||e.week||e.w||0,r=e.days||e.day||e.d||0,o=e.hours||e.hour||e.h||0,s=e.minutes||e.minute||e.m||0,a=e.seconds||e.second||e.s||0,u=e.milliseconds||e.millisecond||e.ms||0;this._input=e,this._milliseconds=u+1e3*a+6e4*s+36e5*o,this._days=r+7*n,this._months=i+12*t,this._data={},this._bubble()}function o(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e}function s(e){return e<0?Math.ceil(e):Math.floor(e)}function a(e,t){for(var i=e+"";i.length<t;)i="0"+i;return i}function u(e,t,i,n){var r,o,s=t._milliseconds,a=t._days,u=t._months;s&&e._d.setTime(+e._d+s*i),(a||u)&&(r=e.minute(),o=e.hour()),a&&e.date(e.date()+a*i),u&&e.month(e.month()+u*i),s&&!n&&k.updateOffset(e),(a||u)&&(e.minute(r),e.hour(o))}function l(e){return"[object Array]"===Object.prototype.toString.call(e)}function c(e,t){var i,n=Math.min(e.length,t.length),r=Math.abs(e.length-t.length),o=0;for(i=0;i<n;i++)~~e[i]!=~~t[i]&&o++;return o+r}function h(e){return e?ee[e]||e.toLowerCase().replace(/(.)s$/,"$1"):e}function d(e,t){return t.abbr=e,D[e]||(D[e]=new i),D[e].set(t),D[e]}function f(e){if(!e)return k.fn._lang;if(!D[e]&&M)try{require("./lang/"+e)}catch(e){return k.fn._lang}return D[e]}function p(e){return e.match(/\[.*\]/)?e.replace(/^\[|\]$/g,""):e.replace(/\\/g,"")}function g(e){var t,i,n=e.match(V);for(t=0,i=n.length;t<i;t++)re[n[t]]?n[t]=re[n[t]]:n[t]=p(n[t]);return function(r){var o="";for(t=0;t<i;t++)o+=n[t]instanceof Function?n[t].call(r,e):n[t];return o}}function m(e,t){function i(t){return e.lang().longDateFormat(t)||t}for(var n=5;n--&&U.test(t);)t=t.replace(U,i);return te[t]||(te[t]=g(t)),te[t](e)}function v(e,t){switch(e){case"DDDD":return H;case"YYYY":return j;case"YYYYY":return W;case"S":case"SS":case"SSS":case"DDD":return G;case"MMM":case"MMMM":case"dd":case"ddd":case"dddd":return $;case"a":case"A":return f(t._l)._meridiemParse;case"X":return z;case"Z":case"ZZ":return Y;case"T":return q;case"MM":case"DD":case"YY":case"HH":case"hh":case"mm":case"ss":case"M":case"D":case"d":case"H":case"h":case"m":case"s":return B;default:return new RegExp(e.replace("\\",""))}}function y(e){var t=(Y.exec(e)||[])[0],i=(t+"").match(Z)||["-",0,0],n=60*i[1]+~~i[2];return"+"===i[0]?-n:n}function b(e,t,i){var n,r=i._a;switch(e){case"M":case"MM":r[1]=null==t?0:~~t-1;break;case"MMM":case"MMMM":n=f(i._l).monthsParse(t),null!=n?r[1]=n:i._isValid=!1;break;case"D":case"DD":case"DDD":case"DDDD":null!=t&&(r[2]=~~t);break;case"YY":r[0]=~~t+(~~t>68?1900:2e3);break;case"YYYY":case"YYYYY":r[0]=~~t;break;case"a":case"A":i._isPm=f(i._l).isPM(t);break;case"H":case"HH":case"h":case"hh":r[3]=~~t;break;case"m":case"mm":r[4]=~~t;break;case"s":case"ss":r[5]=~~t;break;case"S":case"SS":case"SSS":r[6]=~~(1e3*("0."+t));break;case"X":i._d=new Date(1e3*parseFloat(t));break;case"Z":case"ZZ":i._useUTC=!0,i._tzm=y(t)}null==t&&(i._isValid=!1)}function w(e){var t,i,n=[];if(!e._d){for(t=0;t<7;t++)e._a[t]=n[t]=null==e._a[t]?2===t?1:0:e._a[t];n[3]+=~~((e._tzm||0)/60),n[4]+=~~((e._tzm||0)%60),i=new Date(0),e._useUTC?(i.setUTCFullYear(n[0],n[1],n[2]),i.setUTCHours(n[3],n[4],n[5],n[6])):(i.setFullYear(n[0],n[1],n[2]),i.setHours(n[3],n[4],n[5],n[6])),e._d=i}}function E(e){var t,i,n=e._f.match(V),r=e._i;for(e._a=[],t=0;t<n.length;t++)i=(v(n[t],e).exec(r)||[])[0],i&&(r=r.slice(r.indexOf(i)+i.length)),re[n[t]]&&b(n[t],i,e);r&&(e._il=r),e._isPm&&e._a[3]<12&&(e._a[3]+=12),!1===e._isPm&&12===e._a[3]&&(e._a[3]=0),w(e)}function _(e){var t,i,r,s,a,u=99;for(s=0;s<e._f.length;s++)t=o({},e),t._f=e._f[s],E(t),i=new n(t),a=c(t._a,i.toArray()),i._il&&(a+=i._il.length),a<u&&(u=a,r=i);o(e,r)}function T(e){var t,i=e._i,n=K.exec(i);if(n){for(e._f="YYYY-MM-DD"+(n[2]||" "),t=0;t<4;t++)if(X[t][1].exec(i)){e._f+=X[t][0];break}Y.exec(i)&&(e._f+=" Z"),E(e)}else e._d=new Date(i)}function S(t){var i=t._i,n=N.exec(i);i===e?t._d=new Date:n?t._d=new Date(+n[1]):"string"==typeof i?T(t):l(i)?(t._a=i.slice(0),w(t)):t._d=i instanceof Date?new Date(+i):new Date(i)}function A(e,t,i,n,r){return r.relativeTime(t||1,!!i,e,n)}function P(e,t,i){var n=L(Math.abs(e)/1e3),r=L(n/60),o=L(r/60),s=L(o/24),a=L(s/365),u=n<45&&["s",n]||1===r&&["m"]||r<45&&["mm",r]||1===o&&["h"]||o<22&&["hh",o]||1===s&&["d"]||s<=25&&["dd",s]||s<=45&&["M"]||s<345&&["MM",L(s/30)]||1===a&&["y"]||["yy",a];return u[2]=t,u[3]=e>0,u[4]=i,A.apply({},u)}function I(e,t,i){var n,r=i-t,o=i-e.day();return o>r&&(o-=7),o<r-7&&(o+=7),n=k(e).add("d",o),{week:Math.ceil(n.dayOfYear()/7),year:n.year()}}function x(e){var t=e._i,i=e._f;return null===t||""===t?null:("string"==typeof t&&(e._i=t=f().preparse(t)),k.isMoment(t)?(e=o({},t),e._d=new Date(+t._d)):i?l(i)?_(e):E(e):S(e),new n(e))}function C(e,t){k.fn[e]=k.fn[e+"s"]=function(e){var i=this._isUTC?"UTC":"";return null!=e?(this._d["set"+i+t](e),k.updateOffset(this),this):this._d["get"+i+t]()}}function R(e,t){k.duration.fn["as"+e]=function(){return+this/t}}for(var k,O,L=Math.round,D={},M="undefined"!=typeof module&&module.exports,N=/^\/?Date\((\-?\d+)/i,F=/(\-)?(\d*)?\.?(\d+)\:(\d+)\:(\d+)\.?(\d{3})?/,V=/(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|mm?|ss?|SS?S?|X|zz?|ZZ?|.)/g,U=/(\[[^\[]*\])|(\\)?(LT|LL?L?L?|l{1,4})/g,B=/\d\d?/,G=/\d{1,3}/,H=/\d{3}/,j=/\d{1,4}/,W=/[+\-]?\d{1,6}/,$=/[0-9]*['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+|[\u0600-\u06FF\/]+(\s*?[\u0600-\u06FF]+){1,2}/i,Y=/Z|[\+\-]\d\d:?\d\d/i,q=/T/i,z=/[\+\-]?\d+(\.\d{1,3})?/,K=/^\s*\d{4}-\d\d-\d\d((T| )(\d\d(:\d\d(:\d\d(\.\d\d?\d?)?)?)?)?([\+\-]\d\d:?\d\d)?)?/,X=[["HH:mm:ss.S",/(T| )\d\d:\d\d:\d\d\.\d{1,3}/],["HH:mm:ss",/(T| )\d\d:\d\d:\d\d/],["HH:mm",/(T| )\d\d:\d\d/],["HH",/(T| )\d\d/]],Z=/([\+\-]|\d\d)/gi,Q="Date|Hours|Minutes|Seconds|Milliseconds".split("|"),J={Milliseconds:1,Seconds:1e3,Minutes:6e4,Hours:36e5,Days:864e5,Months:2592e6,Years:31536e6},ee={ms:"millisecond",s:"second",m:"minute",h:"hour",d:"day",w:"week",M:"month",y:"year"},te={},ie="DDD w W M D d".split(" "),ne="M D H h m s w W".split(" "),re={M:function(){return this.month()+1},MMM:function(e){return this.lang().monthsShort(this,e)},MMMM:function(e){return this.lang().months(this,e)},D:function(){return this.date()},DDD:function(){return this.dayOfYear()},d:function(){return this.day()},dd:function(e){return this.lang().weekdaysMin(this,e)},ddd:function(e){return this.lang().weekdaysShort(this,e)},dddd:function(e){return this.lang().weekdays(this,e)},w:function(){return this.week()},W:function(){return this.isoWeek()},YY:function(){return a(this.year()%100,2)},YYYY:function(){return a(this.year(),4)},YYYYY:function(){return a(this.year(),5)},gg:function(){return a(this.weekYear()%100,2)},gggg:function(){return this.weekYear()},ggggg:function(){return a(this.weekYear(),5)},GG:function(){return a(this.isoWeekYear()%100,2)},GGGG:function(){return this.isoWeekYear()},GGGGG:function(){return a(this.isoWeekYear(),5)},e:function(){return this.weekday()},E:function(){return this.isoWeekday()},a:function(){return this.lang().meridiem(this.hours(),this.minutes(),!0)},A:function(){return this.lang().meridiem(this.hours(),this.minutes(),!1)},H:function(){return this.hours()},h:function(){return this.hours()%12||12},m:function(){return this.minutes()},s:function(){return this.seconds()},S:function(){return~~(this.milliseconds()/100)},SS:function(){return a(~~(this.milliseconds()/10),2)},SSS:function(){return a(this.milliseconds(),3)},Z:function(){var e=-this.zone(),t="+";return e<0&&(e=-e,t="-"),t+a(~~(e/60),2)+":"+a(~~e%60,2)},ZZ:function(){var e=-this.zone(),t="+";return e<0&&(e=-e,t="-"),t+a(~~(10*e/6),4)},z:function(){return this.zoneAbbr()},zz:function(){return this.zoneName()},X:function(){return this.unix()}};ie.length;)O=ie.pop(),re[O+"o"]=function(e,t){return function(i){return this.lang().ordinal(e.call(this,i),t)}}(re[O],O);for(;ne.length;)O=ne.pop(),re[O+O]=t(re[O],2);for(re.DDDD=t(re.DDD,3),i.prototype={set:function(e){var t,i;for(i in e)t=e[i],"function"==typeof t?this[i]=t:this["_"+i]=t},_months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),months:function(e){return this._months[e.month()]},_monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),monthsShort:function(e){return this._monthsShort[e.month()]},monthsParse:function(e){var t,i,n;for(this._monthsParse||(this._monthsParse=[]),t=0;t<12;t++)if(this._monthsParse[t]||(i=k([2e3,t]),n="^"+this.months(i,"")+"|^"+this.monthsShort(i,""),this._monthsParse[t]=new RegExp(n.replace(".",""),"i")),this._monthsParse[t].test(e))return t},_weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdays:function(e){return this._weekdays[e.day()]},_weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysShort:function(e){return this._weekdaysShort[e.day()]},_weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),weekdaysMin:function(e){return this._weekdaysMin[e.day()]},weekdaysParse:function(e){var t,i,n;for(this._weekdaysParse||(this._weekdaysParse=[]),t=0;t<7;t++)if(this._weekdaysParse[t]||(i=k([2e3,1]).day(t),n="^"+this.weekdays(i,"")+"|^"+this.weekdaysShort(i,"")+"|^"+this.weekdaysMin(i,""),this._weekdaysParse[t]=new RegExp(n.replace(".",""),"i")),this._weekdaysParse[t].test(e))return t},_longDateFormat:{LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D YYYY",LLL:"MMMM D YYYY LT",LLLL:"dddd, MMMM D YYYY LT"},longDateFormat:function(e){var t=this._longDateFormat[e];return!t&&this._longDateFormat[e.toUpperCase()]&&(t=this._longDateFormat[e.toUpperCase()].replace(/MMMM|MM|DD|dddd/g,function(e){return e.slice(1)}),this._longDateFormat[e]=t),t},isPM:function(e){return"p"===(e+"").toLowerCase()[0]},_meridiemParse:/[ap]\.?m?\.?/i,meridiem:function(e,t,i){return e>11?i?"pm":"PM":i?"am":"AM"},_calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},calendar:function(e,t){var i=this._calendar[e];return"function"==typeof i?i.apply(t):i},_relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},relativeTime:function(e,t,i,n){var r=this._relativeTime[i];return"function"==typeof r?r(e,t,i,n):r.replace(/%d/i,e)},pastFuture:function(e,t){var i=this._relativeTime[e>0?"future":"past"];return"function"==typeof i?i(t):i.replace(/%s/i,t)},ordinal:function(e){return this._ordinal.replace("%d",e)},_ordinal:"%d",preparse:function(e){return e},postformat:function(e){return e},week:function(e){return I(e,this._week.dow,this._week.doy).week},_week:{dow:0,doy:6}},k=function(e,t,i){return x({_i:e,_f:t,_l:i,_isUTC:!1})},k.utc=function(e,t,i){return x({_useUTC:!0,_isUTC:!0,_l:i,_i:e,_f:t})},k.unix=function(e){return k(1e3*e)},k.duration=function(e,t){var i,n,o=k.isDuration(e),s="number"==typeof e,a=o?e._input:s?{}:e,u=F.exec(e);return s?t?a[t]=e:a.milliseconds=e:u&&(i="-"===u[1]?-1:1,a={y:0,d:~~u[2]*i,h:~~u[3]*i,m:~~u[4]*i,s:~~u[5]*i,ms:~~u[6]*i}),n=new r(a),o&&e.hasOwnProperty("_lang")&&(n._lang=e._lang),n},k.version="2.1.0",k.defaultFormat="YYYY-MM-DDTHH:mm:ssZ",k.updateOffset=function(){},k.lang=function(e,t){if(!e)return k.fn._lang._abbr;t?d(e,t):D[e]||f(e),k.duration.fn._lang=k.fn._lang=f(e)},k.langData=function(e){return e&&e._lang&&e._lang._abbr&&(e=e._lang._abbr),f(e)},k.isMoment=function(e){return e instanceof n},k.isDuration=function(e){return e instanceof r},k.fn=n.prototype={clone:function(){return k(this)},valueOf:function(){return+this._d+6e4*(this._offset||0)},unix:function(){return Math.floor(+this/1e3)},toString:function(){return this.format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")},toDate:function(){return this._offset?new Date(+this):this._d},toISOString:function(){return m(k(this).utc(),"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]")},toArray:function(){var e=this;return[e.year(),e.month(),e.date(),e.hours(),e.minutes(),e.seconds(),e.milliseconds()]},isValid:function(){return null==this._isValid&&(this._a?this._isValid=!c(this._a,(this._isUTC?k.utc(this._a):k(this._a)).toArray()):this._isValid=!isNaN(this._d.getTime())),!!this._isValid},utc:function(){return this.zone(0)},local:function(){return this.zone(0),this._isUTC=!1,this},format:function(e){var t=m(this,e||k.defaultFormat);return this.lang().postformat(t)},add:function(e,t){var i;return i="string"==typeof e?k.duration(+t,e):k.duration(e,t),u(this,i,1),this},subtract:function(e,t){var i;return i="string"==typeof e?k.duration(+t,e):k.duration(e,t),u(this,i,-1),this},diff:function(e,t,i){var n,r,o=this._isUTC?k(e).zone(this._offset||0):k(e).local(),a=6e4*(this.zone()-o.zone());return t=h(t),"year"===t||"month"===t?(n=432e5*(this.daysInMonth()+o.daysInMonth()),r=12*(this.year()-o.year())+(this.month()-o.month()),r+=(this-k(this).startOf("month")-(o-k(o).startOf("month")))/n,r-=6e4*(this.zone()-k(this).startOf("month").zone()-(o.zone()-k(o).startOf("month").zone()))/n,"year"===t&&(r/=12)):(n=this-o,r="second"===t?n/1e3:"minute"===t?n/6e4:"hour"===t?n/36e5:"day"===t?(n-a)/864e5:"week"===t?(n-a)/6048e5:n),i?r:s(r)},from:function(e,t){return k.duration(this.diff(e)).lang(this.lang()._abbr).humanize(!t)},fromNow:function(e){return this.from(k(),e)},calendar:function(){var e=this.diff(k().startOf("day"),"days",!0),t=e<-6?"sameElse":e<-1?"lastWeek":e<0?"lastDay":e<1?"sameDay":e<2?"nextDay":e<7?"nextWeek":"sameElse";return this.format(this.lang().calendar(t,this))},isLeapYear:function(){var e=this.year();return e%4==0&&e%100!=0||e%400==0},isDST:function(){return this.zone()<this.clone().month(0).zone()||this.zone()<this.clone().month(5).zone()},day:function(e){var t=this._isUTC?this._d.getUTCDay():this._d.getDay();return null!=e?"string"==typeof e&&"number"!=typeof(e=this.lang().weekdaysParse(e))?this:this.add({d:e-t}):t},month:function(e){var t,i=this._isUTC?"UTC":"";return null!=e?"string"==typeof e&&"number"!=typeof(e=this.lang().monthsParse(e))?this:(t=this.date(),this.date(1),this._d["set"+i+"Month"](e),this.date(Math.min(t,this.daysInMonth())),k.updateOffset(this),this):this._d["get"+i+"Month"]()},startOf:function(e){switch(e=h(e)){case"year":this.month(0);case"month":this.date(1);case"week":case"day":this.hours(0);case"hour":this.minutes(0);case"minute":this.seconds(0);case"second":this.milliseconds(0)}return"week"===e&&this.weekday(0),this},endOf:function(e){return this.startOf(e).add(e,1).subtract("ms",1)},isAfter:function(e,t){return t=void 0!==t?t:"millisecond",+this.clone().startOf(t)>+k(e).startOf(t)},isBefore:function(e,t){return t=void 0!==t?t:"millisecond",+this.clone().startOf(t)<+k(e).startOf(t)},isSame:function(e,t){return t=void 0!==t?t:"millisecond",+this.clone().startOf(t)==+k(e).startOf(t)},min:function(e){return e=k.apply(null,arguments),e<this?this:e},max:function(e){return e=k.apply(null,arguments),e>this?this:e},zone:function(e){var t=this._offset||0;return null==e?this._isUTC?t:this._d.getTimezoneOffset():("string"==typeof e&&(e=y(e)),Math.abs(e)<16&&(e*=60),this._offset=e,this._isUTC=!0,t!==e&&u(this,k.duration(t-e,"m"),1,!0),this)},zoneAbbr:function(){return this._isUTC?"UTC":""},zoneName:function(){return this._isUTC?"Coordinated Universal Time":""},daysInMonth:function(){return k.utc([this.year(),this.month()+1,0]).date()},dayOfYear:function(e){var t=L((k(this).startOf("day")-k(this).startOf("year"))/864e5)+1;return null==e?t:this.add("d",e-t)},weekYear:function(e){var t=I(this,this.lang()._week.dow,this.lang()._week.doy).year;return null==e?t:this.add("y",e-t)},isoWeekYear:function(e){var t=I(this,1,4).year;return null==e?t:this.add("y",e-t)},week:function(e){var t=this.lang().week(this);return null==e?t:this.add("d",7*(e-t))},isoWeek:function(e){var t=I(this,1,4).week;return null==e?t:this.add("d",7*(e-t))},weekday:function(e){var t=(this._d.getDay()+7-this.lang()._week.dow)%7;return null==e?t:this.add("d",e-t)},isoWeekday:function(e){return null==e?this.day()||7:this.day(this.day()%7?e:e-7)},lang:function(t){return t===e?this._lang:(this._lang=f(t),this)}},O=0;O<Q.length;O++)C(Q[O].toLowerCase().replace(/s$/,""),Q[O]);C("year","FullYear"),k.fn.days=k.fn.day,k.fn.months=k.fn.month,k.fn.weeks=k.fn.week,k.fn.isoWeeks=k.fn.isoWeek,k.fn.toJSON=k.fn.toISOString,k.duration.fn=r.prototype={_bubble:function(){var e,t,i,n,r=this._milliseconds,o=this._days,a=this._months,u=this._data;u.milliseconds=r%1e3,e=s(r/1e3),u.seconds=e%60,t=s(e/60),u.minutes=t%60,i=s(t/60),u.hours=i%24,o+=s(i/24),u.days=o%30,a+=s(o/30),u.months=a%12,n=s(a/12),u.years=n},weeks:function(){return s(this.days()/7)},valueOf:function(){return this._milliseconds+864e5*this._days+this._months%12*2592e6+31536e6*~~(this._months/12)},humanize:function(e){var t=+this,i=P(t,!e,this.lang());return e&&(i=this.lang().pastFuture(t,i)),this.lang().postformat(i)},add:function(e,t){var i=k.duration(e,t);return this._milliseconds+=i._milliseconds,this._days+=i._days,this._months+=i._months,this._bubble(),this},subtract:function(e,t){var i=k.duration(e,t);return this._milliseconds-=i._milliseconds,this._days-=i._days,this._months-=i._months,this._bubble(),this},get:function(e){return e=h(e),this[e.toLowerCase()+"s"]()},as:function(e){return e=h(e),this["as"+e.charAt(0).toUpperCase()+e.slice(1)+"s"]()},lang:k.fn.lang};for(O in J)J.hasOwnProperty(O)&&(R(O,J[O]),function(e){k.duration.fn[e]=function(){return this._data[e]}}(O.toLowerCase()));R("Weeks",6048e5),k.duration.fn.asMonths=function(){return(+this-31536e6*this.years())/2592e6+12*this.years()},k.lang("en",{ordinal:function(e){var t=e%10;return e+(1==~~(e%100/10)?"th":1===t?"st":2===t?"nd":3===t?"rd":"th")}}),M&&(module.exports=k),"undefined"==typeof ender&&(this.moment=k),"function"==typeof define&&define.amd&&define("moment",[],function(){return k})}.call(this),define("utils/TimerUtils",["jquery","moment"],function(e,t){"use strict";return{waitFor:function(i,n,r){var o=new e.Deferred,s=t(),a=function(){i()?o.resolve():t()-s>r?o.reject():setTimeout(a,n)};return a(),o.promise()}}}),define("marketoFormUtils",["lodash","jquery","utils/TimerUtils"],function(e,t,i){"use strict";return{renderForm:function(t){var i=this;t.onFormReady=t.onFormReady||e.noop,t.onFormSubmit=t.onFormSubmit||e.noop;var n=null;t.onTimeout&&(n=setTimeout(t.onTimeout,1e4)),window.MktoForms2.loadForm(t.marketoInstanceUrl,t.munchkinId,t.formId,function(e){e.render(t.renderingElement),n&&clearTimeout(n),e.getFormElem().find(".cf_widgetLoader").length>0?i.waitForSocialSignonRender(e).done(function(){e.onSuccess(t.onFormSubmit),t.onFormReady(e)}).fail(function(){t.onTimeout&&t.onTimeout()}):(e.onSuccess(t.onFormSubmit),t.onFormReady(e))})},waitForSocialSignonRender:function(n){var r=new t.Deferred,o=e.bind(function(){return t.trim(n.getFormElem().find(".cf_widget_socialsignon").html())},this);return i.waitFor(o,125,1e4).done(function(){r.resolve()}).fail(function(){r.reject()}),r.promise()}}}),define("modules/page/views/components/MarketoFormComponentView",["lodash","jquery","device","marketoFormUtils","shared/utils/NavigationUtils","modules/page/views/components/AbstractFormComponentView"],function(e,t,i,n,r,o){"use strict";return o.extend({type:"marketo-form",tagName:"div",getContainerDivId:function(){return"marketo-"+this.options.id.replace("|","_")},getContainerClassName:function(){return"marketo-"+(this.options.originalObjectId||this.options.id)},renderForm:function(){this.$el.empty();var i=t('<form id="'+this.getContainerDivId()+'"></form>');i.addClass(this.getContainerClassName()),this.$el.append(i),n.renderForm({munchkinId:this.options.munchkinId,formId:this.options.formId,marketoInstanceUrl:this.options.marketoInstanceUrl,domId:this.getContainerDivId(),renderingElement:i,onFormSubmit:e.bind(this.handleSubmit,this),onFormReady:e.bind(this.handleReady,this),onTimeout:function(){window.Rollbar&&window.Rollbar.error("Marketo form failed to load. (Timeout error.)",{munchkinId:this.options.munchkinId,formId:this.options.formId,marketoInstanceUrl:this.options.marketoInstanceUrl})}})},handleReady:function(e){},handleSubmit:function(t,i){return this.triggerSubmitInteractions("marketo",this.options.munchkinId),e.defer(e.bind(this.renderForm,this)),!1}})}),define("modules/page/views/components/HotspotComponentView",["jquery","lodash","backbone","modules/page/views/components/AbstractComponentView"],function(e,t,i,n){"use strict";return n.extend({type:"hotspot",tagName:"div",render:function(){return n.prototype.render.call(this),this.$el.css({"background-color":"white",opacity:0}),this},getOpacity:function(){return 0},_applyBorder:function(){},_applyBackground:function(){},_applyShadow:function(){},_applyOpacity:function(){}})}),define("text!modules/page/templates/hotspot-path.html",[],function(){return'<map name="{{mapName}}">\n    <area shape="poly" coords="{{path}}" />\n</map>\n{{! Setting the src attribute to nothing lets the area map work in Firefox }}\n<img style="width: 100%; height: 100%" usemap="#{{mapName}}" src="#" />'}),define("modules/page/views/components/HotspotPathComponentView",["jquery","lodash","backbone","mustache","cerosMath","modules/page/views/components/AbstractComponentView","text!modules/page/templates/hotspot-path.html"],function(e,t,i,n,r,o,s){"use strict";return o.extend({type:"hotspot-path",tagName:"div",render:function(){var e=this.generateCurveCoords();return this.$el.empty().html(n.render(s,{path:e.join(","),mapName:this.id+"-hotspot-map"})),o.prototype.render.call(this),this.$el.css({"background-color":"white",opacity:0}),this},generateCurveCoords:function(){var e=[],t=this.options.path,i=t[0];e.push(i.x),e.push(i.y);for(var n=1;n<t.length;n++)e=e.concat(this.calculateCoordsForSegment(t[n-1],t[n]));return e=e.concat(this.calculateCoordsForSegment(t[t.length-1],t[0]))},calculateCoordsForSegment:function(e,t){if(this.hasControlPoints(e)||this.hasControlPoints(t)){for(var i=this.getControlPoints(e),n=this.getControlPoints(t),o=[],s=0;s<=1;)o.push(r.evaluateBezierCurve(e.x,i.cx2,n.cx1,t.x,s)),o.push(r.evaluateBezierCurve(e.y,i.cy2,n.cy1,t.y,s)),s=Math.round(1e3*(s+.01))/1e3;return o}return[t.x,t.y]},hasControlPoints:function(e){return!(t.isUndefined(e.cx1)||t.isUndefined(e.cy1)||t.isUndefined(e.cx2)||t.isUndefined(e.cy2))},getControlPoints:function(e){return this.hasControlPoints(e)?{cx1:e.cx1,cy1:e.cy1,cx2:e.cx2,cy2:e.cy2}:{cx1:e.x,cy1:e.y,cx2:e.x,cy2:e.y}},_handleClickInteraction:function(t,i,n){e(t.currentTarget).is(".hotspot-path")&&!e(t.target).is("area")||o.prototype._handleClickInteraction.call(this,t,i,n)},bindMouseoverInteraction:function(){this.hasHoverInteraction()&&this.$("area").bind("mouseover",t.bind(this._handleMouseOverInteraction,this))},assignCursor:function(){this.hasClickInteraction()||this.options.showHoverCursor?this.$("area").css("cursor","pointer"):this.$("area").css("cursor","inherit")},getOpacity:function(){return 0},_applyBorder:function(){},_applyBackground:function(){},_applyShadow:function(){},_applyOpacity:function(){},_applyRotation:function(){},generateApproximatePathForCurvedPath:function(){for(var e=[],t=0;t<this.options.path.length;t++){var i=this.options.path[t],n=this.options.path[t+1]?this.options.path[t+1]:this.options.path[0],o=this.hasControlPoints(i),s=this.hasControlPoints(n);if(o||s)for(var a=this.getControlPoints(i),u=this.getControlPoints(n),l=0;l<1;l+=.05)e.push({x:Math.round(r.evaluateBezierCurve(i.x,a.cx2,u.cx1,n.x,l))+this.options.x,y:Math.round(r.evaluateBezierCurve(i.y,a.cy2,u.cy1,n.y,l))+this.options.y});else e.push({x:i.x+this.options.x,y:i.y+this.options.y})}return e},getHoverArea:function(){if(!this.options.path||0===this.options.path.length)return null;var e;return e=t.some(this.options.path,this.hasControlPoints)?this.generateApproximatePathForCurvedPath():t.map(this.options.path,t.bind(function(e){return{x:e.x+this.options.x,y:e.y+this.options.y}},this)),t.map(e,t.bind(function(e){return this.transformPointToPageCoordinateSpace(e)},this))}})}),define("modules/page/views/components/ImageComponentView",["log","jquery","lodash","backbone","device","globals","modules/page/views/components/AbstractComponentView","modules/page/views/components/MediaComponentLoadingView","shared/utils/CerosResourceLoader","shared/utils/CssUtils","shared/utils/WebkitUtils"],function(e,t,i,n,r,o,s,a,u,l,c){"use strict";return s.extend({type:"image",tagName:"div",image:null,srcOverride:null,dimensionsOverride:!1,initialize:function(){this.$imgEl=null,this.imageReadyPromises={},s.prototype.initialize.call(this),this.imageLoader=this.options.imageLoader,o.previewMode&&(this.mediaLoadingScreen=new a({height:this.options.height,isImage:!0}),this.$el.append(this.mediaLoadingScreen.$el))},render:function(){return i.isNull(this.$imgEl)&&(this.$imgEl=t("<img/>"),this.$imgEl.css("display","block"),this.hasShadow(this.options.shadow)?r.isIos()&&this.options.shadow.blur&&this.$imgEl.css("transform",l.concatTransform(this.$imgEl.css("transform"),"translateZ(0)")):(r.isDesktopSafari()&&this.$imgEl.css("transform",c.hardwareAccelerateTransform(this.$el.css("transform"))),r.isIos()&&this.options.fixedPosition&&this.$imgEl.css("transform",c.hardwareAccelerateTransform(this.$el.css("transform")))),this.$el.append(this.$imgEl)),this.dimensionsOverride||this.setDimensionsAsAttributes(this.$imgEl,this.options.width,this.options.height),s.prototype.render.call(this),this.imageLoader&&(this.imageLoader.onLowResImageLoaded(this.attachMedia,this),this.imageLoader.onImageLoaded(this.attachMedia,this),o.previewMode&&(this.imageLoader.onLowResImageLoaded(this.hideMediaLoadingScreen,this),this.imageLoader.onImageLoaded(this.hideMediaLoadingScreen,this))),this},hideMediaLoadingScreen:function(){this.mediaLoadingScreen.close()},_applyShadow:function(e,t){var n=this.getApplyShadowTarget();if(this.hasShadow(e)&&!r.isIE11()){var o={x:i.isNumber(e.x)?e.x:0,y:i.isNumber(e.y)?e.y:0};t&&0!==t&&this._rotateShadowCoordinates(o,t);var a="drop-shadow(";a+=Math.round(o.x)+"px",a+=" "+Math.round(o.y)+"px";var u=r.webkit?4:2;a+=e.blur?" "+Math.round(e.blur/u)+"px":" 0",a+=" "+e.color,a+=")",n.css("-webkit-filter",a),n.css("filter",a);var l="progid:DXImageTransform.Microsoft.Dropshadow(OffX=";l+=Math.round(o.x)+", OffY=",l+=Math.round(o.y)+", Color='",l+=e.color+"')",n.css("filter",l)}else s.prototype._applyShadow.call(this)},getApplyBorderTarget:function(){return this.$imgEl},getApplyShadowTarget:function(){return this.$imgEl},attachMedia:function(){if(this.srcOverride)return this.attachImageSrc(this.srcOverride);if(!this.imageLoader)return this.attachImageSrc("");var n=this.imageLoader.getCurrentResource();return n?n.loadNow().then(i.bind(function(e){return this.attachImageSrc(e.getSrc())},this)):(e.warn("Image should have been added to resource loader during preload"),t.Deferred().resolve(null).promise())},attachImageSrc:function(e){var n=this.imageReadyPromises[e];return n?(this.$imgEl.attr("src",e),n.promise()):(n=this.imageReadyPromises[e]=t.Deferred(),this.$imgEl.on("load",i.bind(function(){this.addAltText(this.$imgEl),n.resolve()},this)),this.$imgEl.on("error",i.bind(function(){this.addAltText(this.$imgEl)},this)),this.$imgEl.attr("src",e),n.promise())},_applyBackground:function(e){},addAltText:function(e){this.options.altText&&e.attr("alt",this.options.altText)}})}),define("modules/page/views/components/VectorImageComponentView",["log","jquery","lodash","modules/page/views/components/ImageComponentView","VectorImageUtils"],function(e,t,i,n,r){"use strict";return n.extend({initialize:function(){
n.prototype.initialize.call(this),this.loadImage=i.once(this.loadImage,this),this.vectorImageReady=new t.Deferred},attachMedia:function(){if(this.imageLoader){var t=this.imageLoader.getCurrentResource();i.isNull(t)?e.warn("Image should have been added to resource loader during preload"):t.loadNow().done(i.bind(function(e){this.loadImage(e,this.vectorImageReady,this.$imgEl,this.options.background)},this)).fail(i.bind(function(){this.vectorImageReady.reject()},this))}return this.vectorImageReady.promise()},loadImage:function(e,t,n,r){r.backgroundHasBeenSet=this.options.backgroundHasBeenSet,e.createObjectURL(r).done(i.bind(function(e){n.on("load",t.resolve),n.on("error",t.reject),n.attr("src",e)},this)).fail(t.reject)}})}),define("modules/page/views/components/LineComponentView",["jquery","lodash","backbone","modules/page/views/components/AbstractComponentView"],function(e,t,i,n){"use strict";return n.extend({type:"line",tagName:"canvas",render:function(){if(!t.isFunction(this.el.getContext))return this;var e=this.options.shadow,i=0,r=0,o=0,s=0;this.options.x1=this.options.x,this.options.y1=this.options.y,this.options.x=this.options.x1<this.options.x2?this.options.x1:this.options.x2,this.options.y=this.options.y1<this.options.y2?this.options.y1:this.options.y2,this.options.width=Math.abs(this.options.x2-this.options.x1),this.options.height=Math.abs(this.options.y2-this.options.y1),i=this.options.x1-this.options.x,r=this.options.y1-this.options.y,o=this.options.x2-this.options.x,s=this.options.y2-this.options.y,this.options.width<this.options.lineWidth&&(this.options.width+=this.options.lineWidth),this.options.height<this.options.lineWidth&&(this.options.height+=this.options.lineWidth);var a=Math.ceil(this.options.lineWidth/2);e&&this.hasShadow(e)&&(a+=e.blur?e.blur:0,e.x=t.isNumber(e.x)?e.x:0,e.y=t.isNumber(e.y)?e.y:0,e.x<0&&(this.options.x-=Math.abs(e.x),i+=Math.abs(e.x),o+=Math.abs(e.x)),this.options.width+=Math.abs(e.x),e.y<0&&(this.options.y-=Math.abs(e.y),r+=Math.abs(e.y),s+=Math.abs(e.y)),this.options.height+=Math.abs(e.y)),this.options.width+=2*a,this.options.height+=2*a,this.options.x-=a,this.options.y-=a,i+=a,r+=a,o+=a,s+=a,n.prototype.render.call(this),this.setDimensionsAsAttributes(this.$el,this.options.width,this.options.height);var u=this.el.getContext("2d");return u.lineWidth=this.options.lineWidth,u.strokeStyle=this.options.color,e&&this.hasShadow(e)&&(u.shadowOffsetX=e.x,u.shadowOffsetY=e.y,u.shadowColor=e.color,u.shadowBlur=e.blur),u.beginPath(),1===this.options.lineWidth&&u.translate(.5,.5),u.moveTo(i,r),u.lineTo(o,s),u.closePath(),u.stroke(),this},_applyBackground:function(){},_applyRotation:function(){},_applyShadow:function(){}})}),define("modules/page/utils/TextSpanUtil",["log","lodash","jquery"],function(e,t,i){"use strict";var n=function(e,t,n){var r=[],o=0;if(n&&n.length>0){for(var s=0;s<n.length;s++){var a=n[s];a.index>o&&r.push({underline:t.underline,letterSpacing:t.letterSpacing,index:o,length:a.index-o}),o=a.index+a.length,r.push(i.extend(!0,{underline:t.underline,letterSpacing:t.letterSpacing},a))}return o<e.length&&r.push({underline:t.underline,letterSpacing:t.letterSpacing,index:o,length:e.length-o}),r}return[{underline:t.underline,letterSpacing:t.letterSpacing,index:0,length:e.length}]},r=function(e,t){for(var i=0;i<t.length;i++)if(e>=t[i].index&&e<t[i].index+t[i].length)return i;return-1};return{padTextSpans:n,findTextSpanForCharIndex:function(e,t){var i=r(e,t);return-1!=i?t[i]:void 0},findTextSpansForLine:function(e,n,o){var s=[],a=r(e,o),u=r(e+n-1,o);if(-1!==a&&-1!==u){s=i.extend(!0,[],o.slice(a,u+1));var l=t.first(s),c=t.last(s);e>l.index&&(l.length-=e-l.index,l.index=e),e+n<c.index+c.length&&(c.length=e+n-c.index)}return s}}}),function(e,t){"use strict";"undefined"!=typeof exports?t(exports,require("../underscore/underscore")._):"function"==typeof define&&define.amd?define("libs/typesetter/GlyphMetrics",["exports","lodash"],t):t(e,e._)}(this,function(e,t){"use strict";return e.GlyphMetrics={EMPTY_METRICS:"[]",encode:function(e){if(t.isEmpty(e.glyphMetrics))return this.EMPTY_METRICS;var i="",n=null;return t.each(e.glyphMetrics,function(e){var t=parseFloat(e.x.toFixed(2)),r=parseFloat(e.y.toFixed(2));i+=t+",",r!=n&&(i+=r),i+=",",n=r}),","==i.charAt(i.length-1)&&(i=i.substr(0,i.length-1)),"["+i+"]"},decode:function(e,i){var n,r,o,s=JSON.parse(e.replace(/,,/g,",null,").replace(/,]/,",null]")),a=[],u=null,l=s.length/2;for(n=0;n<l;n++){var c=s[2*n],h=s[2*n+1];o={x:c,y:null===h?u:h,ch:i[n]},t.isNumber(h)&&(o.sol=!0),(t.isNumber(s[2*(n+1)+1])||n===l-1)&&(o.eol=!0),a.push(o),null!==h&&(u=h)}var d,f=[];for(n=0;n<a.length;n++)o=a[n],o.sol&&(d=[]),d.push(o),o.eol&&f.push(d);for(n=0;n<f.length;n++){for(r=f[n].length-1;r>0&&(" "===f[n][r].ch||"\n"===f[n][r].ch);)delete f[n][r].eol,r--;f[n][r].eol=!0}return{totalCharacters:a.length,totalLines:f.length,lines:f}}},e.GlyphMetrics}),define("libs/font/FontUtil",["lodash","jquery","libs/font/FontConstants"],function(e,t,i){"use strict";return{loadMetrics:function(e){return t.ajax({url:"/rest/v1/font/font-metrics",dataType:"json",data:{variantGuids:e}})},buildGoogleVariantDisplayName:function(e,t){var i={100:"Thin",200:"Extra-Light",300:"Light",400:"Normal",500:"Medium",600:"Semi-Bold",700:"Bold",800:"Extra-Bold",900:"Ultra-Bold"}[e];return"normal"!==t&&(i+=" "+t),i},parseGoogleVariantName:function(e){var t,i;if("regular"===(e=e.toLowerCase()))t=400,i="normal";else if("italic"===e)t=400,i="italic";else if("oblique"===e)t=400,i="oblique";else{var n=/(\d+)(italic|regular|oblique)?/i,r=e.match(n);if(!r||3!==r.length)throw"Could not parse google variant: "+e;t=parseInt(r[1],10),i=r[2]&&"regular"!==r[2]?r[2]:"normal"}return{fontWeight:t,fontStyle:i,variantName:this.buildGoogleVariantDisplayName(t,i)}},buildGoogleVariantName:function(e,t){var i=null;return 400===e?i="italic"===t?"italic":"oblique"===t?"oblique":"regular":(i=""+e,"italic"===t?i+="Italic":"oblique"===t&&(i+="Oblique")),i},getFontAPI:function(t){return e.startsWith(t,i.GOOGLE_API_ID)?i.GOOGLE_API_ID:e.startsWith(t,i.UPLOADED_API_ID)?i.UPLOADED_API_ID:e.startsWith(t,i.BUILTIN_API_ID)?i.BUILTIN_API_ID:void 0}}}),define("modules/page/models/media-loaders/ComponentFontLoader",["lodash","backbone","log","shared/utils/CerosResourceLoader","modules/page/utils/TextUtil","libs/font/FontVariant","libs/font/FontFamily","libs/font/FontUtil"],function(e,t,i,n,r,o,s,a){"use strict";var u=function(t){this.variants=[this.getVariant(t.defaultSpan)],e.each(t.textSpans,e.bind(function(i){var n=e.extend({},t.defaultSpan,i),r=this.getVariant(n);this.variants.push(r)},this)),this.variants=e.uniq(this.variants),this.resources=null};return e.extend(u.prototype,t.Events,{getVariant:function(e){return r.resolveFont(e.variantGuid)},getAllVariants:function(){return this.variants},load:function(){null===this.resources&&(this.resources={},e.each(this.variants,e.bind(function(t){if(t.isBuiltIn())this.trigger("variant-loaded",t);else if(t.isUploaded()){var i=n.addCustomWebFont(t.getCssFamilyName(),t.cssUrl,void 0);i.getPromise().done(e.bind(function(){this.trigger("variant-loaded",t)},this)),i.getPromise().fail(e.bind(function(){this.trigger("variant-failed",t)},this)),this.resources[t.guid]=i}else{var r=t.getFontFamily().getFamilyName()+":"+a.buildGoogleVariantName(t.getFontWeight(),t.getFontStyle()),o=n.addGoogleWebFont(r);o.getPromise().done(e.bind(function(){this.trigger("variant-loaded",t)},this)),o.getPromise().fail(e.bind(function(){this.trigger("variant-failed",t)},this)),this.resources[t.guid]=o}},this)))},loadNow:function(){this.load(),e.each(this.resources,function(e){e.loadNow()})},onVariantLoaded:function(t,i){e.each(this.getAllLoadedVariants(),function(e){t.call(i,e)}),this.on("variant-loaded",t,i)},onLoadFail:function(e,t){this.hasFailedVariant()&&e.call(t),this.on("variant-failed",e,t)},getAllLoadedVariants:function(){return null===this.resources?(i.warn("Variants were never loaded"),[]):e.filter(this.variants,e.bind(function(t){return!!t.isBuiltIn()||e.has(this.resources,t.guid)&&"resolved"===this.resources[t.guid].getPromise().state()},this))},hasFailedVariant:function(){return null===this.resources?(i.warn("Variants were never loaded"),!1):e.some(this.variants,e.bind(function(t){return!t.isBuiltIn()&&(e.has(this.resources,t.guid)&&"rejected"===this.resources[t.guid].getPromise().state())},this))}}),u}),define("libs/utils/LetterSpacingUtils",[],function(){"use strict";var e={MIN_LETTER_SPACING_VALUE:-9999,MAX_LETTER_SPACING_VALUE:99999,unitsToEms:function(e){return e/1e3},unitsToCss:function(t){return e.unitsToEms(t)+"em"},unitsToPixels:function(t,i){return e.unitsToEms(t)*i}};return e}),define("modules/page/views/components/TextComponentView",["log","jquery","lodash","backbone","device","globals","modules/page/views/components/AbstractComponentView","modules/page/utils/TextUtil","modules/page/utils/TextSpanUtil","libs/typesetter/GlyphMetrics","shared/utils/CerosResourceLoader","libs/font/FontVariant","libs/font/FontFamily","libs/font/FontUtil","modules/page/models/media-loaders/ComponentFontLoader","libs/utils/LetterSpacingUtils"],function(e,t,i,n,r,o,s,a,u,l,c,h,d,f,p,g){"use strict";var m={},v={},y=function(e,t){return e.getCssFamilyName()+":"+t},b=function(e,n){var r=y(e,n);if(i.has(v,r))return v[r].promise();var o=new t.Deferred;return v[r]=o,a.measureFontBaselineOffset(e,n,n).then(o.resolve,o.reject),o.then(function(e){m[r]=e})};return s.extend({type:"text",tagName:"div",textSpans:null,textContent:null,textUpdatedViaSdk:!1,initialize:function(){s.prototype.initialize.call(this),this.fontLoader=this.options.fontLoader,this.defaultVariant=this._getVariant(this.options.defaultSpan),this.forceLineMode=this.options.forceLineMode,this.isRerendering=!1},render:function(){return s.prototype.render.call(this),r.webkit&&this.$el.css("-webkit-filter","blur(0px)"),this._applyDimensions(this.options.width,this.options.height),this.setDefaultTextStyle(),this.prepareTextContentAndSpans(),this.allFontsReady=new t.Deferred,this.variantsMeasured=0,this.fontLoader.onVariantLoaded(this.measureBaselineOffsetAndRenderText,this),this.fontLoader.onLoadFail(this.allFontsReady.reject,this.allFontsReady),this},prepareTextContentAndSpans:function(){this.textContent=this._applyTextTransform(this.options.textContent),this.textSpans=u.padTextSpans(this.textContent,this.options.defaultSpan,this.options.textSpans)},setTextFromSDK:function(e){e=e||"",this.textUpdatedViaSdk=!0,this.options.textContent=e;var t,i;this.textSpans&&this.textSpans.length>0&&(this.textSpans[0].fontColor&&(t=this.textSpans[0].fontColor),this.textSpans[0].variantGuid&&(i=this.textSpans[0].variantGuid)),this.options.textSpans=[],this.prepareTextContentAndSpans(),this.textSpans&&this.textSpans.length>0&&(t&&(this.textSpans[0].fontColor=t),i&&(this.textSpans[0].variantGuid=i)),"resolved"===this.allFontsReady.state()&&this._layoutContent(),this.$el.css("columns","unset")},measureBaselineOffsetAndRenderText:function(e){b(e,this.options.defaultSpan.fontSize).done(i.bind(function(){++this.variantsMeasured===this.fontLoader.getAllVariants().length&&this.allFontsReady.resolve()},this))},_getPadding:function(){return{left:i.isNumber(this.options.paddingLeft)?this.options.paddingLeft:0,right:i.isNumber(this.options.paddingRight)?this.options.paddingRight:0,top:i.isNumber(this.options.paddingTop)?this.options.paddingTop:0,bottom:i.isNumber(this.options.paddingBottom)?this.options.paddingBottom:0}},_getColumnWidth:function(){var e=this._getPadding();return(this.options.width-e.left-e.right-(this.options.columns-1)*this.options.columnGap)/this.options.columns},_getVariant:function(e){return a.resolveFont(e.variantGuid)},_getDefaultBaselineOffset:function(){var e=0,t=this._getVariant(this.options.defaultSpan),n=y(t,this.options.defaultSpan.fontSize);return t&&i.has(m,n)&&(e=m[n]),e},_layoutContent:function(){var t=this._getDefaultBaselineOffset();this.defaultVariant=this._getVariant(this.options.defaultSpan);var n=this.options.glyphMetrics===l.EMPTY_METRICS&&""!==this.textContent;if(!i.isString(this.options.glyphMetrics)||n)return o.previewMode||this.textUpdatedViaSdk||e.warn("no glyph metrics! using paragraph layout..."),void this._layoutParagraphs(null,t);this.$el.css("lineHeight",this.options.defaultSpan.fontSize+"px"),!0===this.options.showOverflow?this.$el.css("overflow","visible"):this.$el.css("overflow","hidden"),this.$el.empty();var r=l.decode(this.options.glyphMetrics,this.textContent);this.textUpdatedViaSdk&&!this._useParagraphLayout(r)&&(t-=(this.options.leading-this.options.defaultSpan.fontSize)/2),this.textUpdatedViaSdk||this._useParagraphLayout(r)?this._layoutParagraphs(null,t):this._useCharacterLayout(r)?this._layoutGlyphs(r,t):this._layoutLines(r,t)},_useParagraphLayout:function(e){return e.totalLines>=250},_useCharacterLayout:function(e){return!this.forceLineMode&&e.totalCharacters<=250},_applyTextTransform:function(e){switch(this.options.textTransform){case"uppercase":return e.toUpperCase();case"lowercase":return e.toLowerCase();case"capitalize":return e.replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()})}return e},_applyStyle:function(e,t){var n=i.pick(e,["position","top","left"]),r=i.extend({},this.options.defaultSpan,t),o=this._getVariant(r);t.fontColor&&(n.color=t.fontColor),o.getFontWeight()!==this.defaultVariant.getFontWeight()&&(n["font-weight"]=o.getFontWeight()),o.getFontStyle()!==this.defaultVariant.getFontStyle()&&(n["font-style"]=o.getFontStyle()),o.getCssFamilyName()!==this.defaultVariant.getCssFamilyName()&&(n["font-family"]=o.getCssFamilyName()),t.underline&&(n["text-decoration"]="underline"),t.letterSpacing&&(n["letter-spacing"]=g.unitsToCss(t.letterSpacing));var s="<span";return i.isEmpty(n)||(s+=' style="',i.each(n,function(e,t){s+=t+":"+e+";"}),s+='"'),s+=">"+e.content+"</span>"},_getNumSpaces:function(e){return i.reduce(e,function(e,t){return e+(" "===t.ch||"\n"===t.ch?1:0)},0)},_layoutGlyphsChars:function(e,t,n,r){for(var o=[],s=0;s<e.length;s++){var a=t+s,l=e[s];if("\n"!==l.ch&&!i.isUndefined(l.ch)){var c=u.findTextSpanForCharIndex(a,this.textSpans),h=" "===l.ch?"&nbsp;":l.ch,d=a===c.index+c.length-1,f=s<e.length-1&&i.isUndefined(e[s+1].ch);!c.underline||d||l.eol||f||(h+="&nbsp"),o.push(this._applyStyle({content:h,top:l.y+n+r.top+"px",left:l.x+r.left+"px"},c))}}return o},_layoutGlyphs:function(e,t){for(var n=this._getPadding(),r=0,o=[],s=0;s<e.lines.length;s++){var a=e.lines[s],u=r;if(r+=a.length,0!==a.length&&(1!==a.length||!i.isUndefined(a[0].ch))){this._getNumSpaces(a)!=a.length&&(o=o.concat(this._layoutGlyphsChars(a,u,t,n)))}}this.$el.append(o.join(""))},_applyTextSpans:function(e,t){return i.map(e,i.bind(function(e){var i=this.textContent.substr(e.index,e.length);i=this._escapeHtmlSpecialCharacters(i);var n={content:i,position:"relative"};return t&&(n.left=t),this._applyStyle(n,e)},this)).join("")},_escapeHtmlSpecialCharacters:function(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/\s/g,"&nbsp;")},_kernLongLines:function(){var e=String.fromCharCode(160),n=this._getColumnWidth();this.$("span.text-line").each(i.bind(function(r,o){o=t(o);var s=o.width();if(s>n){var a=s-n,l=t(o).find("span"),c=i.reduce(l,function(e,i){return e+t(i).text()},""),h=c.trim().split(e),d=a/(h.length-1),f=-1*Math.ceil(a),p=parseInt(t(o).attr("index"),10);o.empty();for(var g,m=c.lastIndexOf(e);m>0;){g=c.lastIndexOf(e,m-1);var v=u.findTextSpansForLine(p+g+1,m-g,this.textSpans),y=g<0?"0px":f+"px",b=this._applyTextSpans(v,y);o.prepend(b),f+=d,m=g}}},this))},_layoutLines:function(e,t){var n=this._getPadding();this.chIndex=0;for(var r=['<div style="width:110%;position:relative">'],o=0;o<e.lines.length;o++){var s=e.lines[o];if(0!==s.length){for(var a="",l=!1,c=this.chIndex,h=0,d=0;d<s.length;d++)i.isUndefined(s[d].ch)||(a+=s[d].ch,l="\n"===s[d].ch,h++);if(a.trim().length>0){var f=u.findTextSpansForLine(c,h,this.textSpans),p=this._applyTextSpans(f),g=s[0].y+t+n.top+"px",m=s[0].x+n.left+"px";r.push('<span class="text-line" index="'+c+'" style="top:'+g+";left:"+m+'">'+p+"</span>")}l&&r.push("<br/>"),this.chIndex+=h}}r.push("</div>"),this.$el.append(r.join("")),this._onReflow(this.$("span:first"),i.bind(function(){this._kernLongLines()},this))},_layoutParagraphs:function(e,t){this.options.textTransform&&this.$el.css("textTransform",this.options.textTransform),this.$el.empty(),i.each(this.textSpans,i.bind(function(e){for(var n=this.textContent.substr(e.index,e.length),r=n.split("\n"),o=[],s=0;s<r.length;s++){var a=i.escape(r[s]);o.push(this._applyStyle({content:a,position:"relative",top:t+"px"},e))}this.$el.append(o.join("<br />"))},this)),this.options.justify&&this.options.justify.match(/(left|right|center|justify)/)&&this.$el.css("textAlign",this.options.justify),this.options.columns&&(this.$el.css("columnCount",this.options.columns),this.$el.css("columnWidth","auto"),this.$el.css("columnFill","auto"),this.options.columnGap?this.$el.css("columnGap",this.options.columnGap+"px"):this.$el.css("columnGap","0px")),this.$el.css("lineHeight",this.options.leading+"px"),this.$el.css("padding",0),i.each(["Top","Right","Bottom","Left"],i.bind(function(e){this.options["padding"+e]&&(this.$el.css("padding"+e,parseInt(this.options["padding"+e],10)+"px"),"Top"!=e&&"Bottom"!=e||(this.options.height-=parseInt(this.options["padding"+e],10)),"Left"!=e&&"Right"!=e||(this.options.width-=parseInt(this.options["padding"+e],10)))},this)),this._applyDimensions(this.options.width,this.options.height)},_onReflow:function(e,t){if(!i.isEmpty(e)){var n=function(){e.width()>0?t():setTimeout(n,1)};setTimeout(n,1)}},applyChanges:function(e){this.fontLoader=new p(e),this.fontLoader.load(),s.prototype.applyChanges.call(this,e)},attachMedia:function(){return this.fontLoader.loadNow(),this.allFontsReady.always(i.bind(this._applyDefaultFont,this)),this.allFontsReady.always(i.bind(this._layoutContent,this)),this.allFontsReady.promise()},_applyDefaultFont:function(){var e=this._getVariant(this.options.defaultSpan).getCssFamilyName(),t=a.formatFamilyNameForCSS(e);this.$el.css("fontFamily",t)},setDefaultTextStyle:function(){var e=this.options.defaultSpan,t=this._getVariant(e);this.$el.css("fontSize",e.fontSize+"px"),this.$el.css("textTransform","none"),this.$el.css("color",e.fontColor),this.$el.css("fontWeight",t.getFontWeight()),this.$el.css("fontStyle",t.getFontStyle())},scaleComponent:function(){this.rerenderByTogglingVisibility()},rerenderByTogglingVisibility:i.debounce(function(){if(!this.isRerendering){this.isRerendering=!0;var e=this.$el.css("display");this.$el.css("display","none"),i.delay(i.bind(function(){this.$el.css("display",e),this.isRerendering=!1},this),1)}},100)})}),function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("hlsjs",[],t):"object"==typeof exports?exports.Hls=t():e.Hls=t()}("undefined"!=typeof self?self:this,function(){return function(e){function t(n){if(i[n])return i[n].exports;var r=i[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var i={};return t.m=e,t.c=i,t.d=function(e,i,n){t.o(e,i)||Object.defineProperty(e,i,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var i=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(i,"a",i),i},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="/dist/",t(t.s=27)}([function(e,t,i){"use strict";function n(){}function r(e,t){return t="["+e+"] > "+t}function o(e){var t=self.console[e];return t?function(){for(var i=arguments.length,n=Array(i),o=0;o<i;o++)n[o]=arguments[o];n[0]&&(n[0]=r(e,n[0])),t.apply(self.console,n)}:n}function s(e){for(var t=arguments.length,i=Array(t>1?t-1:0),n=1;n<t;n++)i[n-1]=arguments[n];i.forEach(function(t){l[t]=e[t]?e[t].bind(e):o(t)})}i.d(t,"a",function(){return c}),i.d(t,"b",function(){return h});var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u={trace:n,debug:n,log:n,warn:n,info:n,error:n},l=u,c=function(e){if(!0===e||"object"===(void 0===e?"undefined":a(e))){s(e,"debug","log","info","warn","error");try{l.log()}catch(e){l=u}}else l=u},h=l},function(e,t,i){"use strict";var n={MEDIA_ATTACHING:"hlsMediaAttaching",MEDIA_ATTACHED:"hlsMediaAttached",MEDIA_DETACHING:"hlsMediaDetaching",MEDIA_DETACHED:"hlsMediaDetached",BUFFER_RESET:"hlsBufferReset",BUFFER_CODECS:"hlsBufferCodecs",BUFFER_CREATED:"hlsBufferCreated",BUFFER_APPENDING:"hlsBufferAppending",BUFFER_APPENDED:"hlsBufferAppended",BUFFER_EOS:"hlsBufferEos",BUFFER_FLUSHING:"hlsBufferFlushing",BUFFER_FLUSHED:"hlsBufferFlushed",MANIFEST_LOADING:"hlsManifestLoading",MANIFEST_LOADED:"hlsManifestLoaded",MANIFEST_PARSED:"hlsManifestParsed",LEVEL_SWITCHING:"hlsLevelSwitching",LEVEL_SWITCHED:"hlsLevelSwitched",LEVEL_LOADING:"hlsLevelLoading",LEVEL_LOADED:"hlsLevelLoaded",LEVEL_UPDATED:"hlsLevelUpdated",LEVEL_PTS_UPDATED:"hlsLevelPtsUpdated",AUDIO_TRACKS_UPDATED:"hlsAudioTracksUpdated",AUDIO_TRACK_SWITCHING:"hlsAudioTrackSwitching",AUDIO_TRACK_SWITCHED:"hlsAudioTrackSwitched",AUDIO_TRACK_LOADING:"hlsAudioTrackLoading",AUDIO_TRACK_LOADED:"hlsAudioTrackLoaded",SUBTITLE_TRACKS_UPDATED:"hlsSubtitleTracksUpdated",SUBTITLE_TRACK_SWITCH:"hlsSubtitleTrackSwitch",SUBTITLE_TRACK_LOADING:"hlsSubtitleTrackLoading",SUBTITLE_TRACK_LOADED:"hlsSubtitleTrackLoaded",SUBTITLE_FRAG_PROCESSED:"hlsSubtitleFragProcessed",INIT_PTS_FOUND:"hlsInitPtsFound",FRAG_LOADING:"hlsFragLoading",FRAG_LOAD_PROGRESS:"hlsFragLoadProgress",FRAG_LOAD_EMERGENCY_ABORTED:"hlsFragLoadEmergencyAborted",FRAG_LOADED:"hlsFragLoaded",FRAG_DECRYPTED:"hlsFragDecrypted",FRAG_PARSING_INIT_SEGMENT:"hlsFragParsingInitSegment",FRAG_PARSING_USERDATA:"hlsFragParsingUserdata",FRAG_PARSING_METADATA:"hlsFragParsingMetadata",FRAG_PARSING_DATA:"hlsFragParsingData",FRAG_PARSED:"hlsFragParsed",FRAG_BUFFERED:"hlsFragBuffered",FRAG_CHANGED:"hlsFragChanged",FPS_DROP:"hlsFpsDrop",FPS_DROP_LEVEL_CAPPING:"hlsFpsDropLevelCapping",ERROR:"hlsError",DESTROYING:"hlsDestroying",KEY_LOADING:"hlsKeyLoading",KEY_LOADED:"hlsKeyLoaded",STREAM_STATE_TRANSITION:"hlsStreamStateTransition"};t.a=n},function(e,t,i){"use strict";i.d(t,"b",function(){return n}),i.d(t,"a",function(){return r});var n={NETWORK_ERROR:"networkError",MEDIA_ERROR:"mediaError",KEY_SYSTEM_ERROR:"keySystemError",MUX_ERROR:"muxError",OTHER_ERROR:"otherError"},r={KEY_SYSTEM_NO_KEYS:"keySystemNoKeys",KEY_SYSTEM_NO_ACCESS:"keySystemNoAccess",KEY_SYSTEM_NO_SESSION:"keySystemNoSession",KEY_SYSTEM_LICENSE_REQUEST_FAILED:"keySystemLicenseRequestFailed",MANIFEST_LOAD_ERROR:"manifestLoadError",MANIFEST_LOAD_TIMEOUT:"manifestLoadTimeOut",MANIFEST_PARSING_ERROR:"manifestParsingError",MANIFEST_INCOMPATIBLE_CODECS_ERROR:"manifestIncompatibleCodecsError",LEVEL_LOAD_ERROR:"levelLoadError",LEVEL_LOAD_TIMEOUT:"levelLoadTimeOut",LEVEL_SWITCH_ERROR:"levelSwitchError",AUDIO_TRACK_LOAD_ERROR:"audioTrackLoadError",AUDIO_TRACK_LOAD_TIMEOUT:"audioTrackLoadTimeOut",FRAG_LOAD_ERROR:"fragLoadError",FRAG_LOAD_TIMEOUT:"fragLoadTimeOut",FRAG_DECRYPT_ERROR:"fragDecryptError",FRAG_PARSING_ERROR:"fragParsingError",REMUX_ALLOC_ERROR:"remuxAllocError",KEY_LOAD_ERROR:"keyLoadError",KEY_LOAD_TIMEOUT:"keyLoadTimeOut",BUFFER_ADD_CODEC_ERROR:"bufferAddCodecError",BUFFER_APPEND_ERROR:"bufferAppendError",BUFFER_APPENDING_ERROR:"bufferAppendingError",BUFFER_STALLED_ERROR:"bufferStalledError",BUFFER_FULL_ERROR:"bufferFullError",BUFFER_SEEK_OVER_HOLE:"bufferSeekOverHole",BUFFER_NUDGE_ON_STALL:"bufferNudgeOnStall",INTERNAL_EXCEPTION:"internalException"}},function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=i(0),o=i(2),s=i(1),a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u=new Set(["hlsEventGeneric","hlsHandlerDestroying","hlsHandlerDestroyed"]),l=function(){function e(t){n(this,e),this.hls=t,this.onEvent=this.onEvent.bind(this);for(var i=arguments.length,r=Array(i>1?i-1:0),o=1;o<i;o++)r[o-1]=arguments[o];this.handledEvents=r,this.useGenericHandler=!0,this.registerListeners()}return e.prototype.destroy=function(){this.onHandlerDestroying(),this.unregisterListeners(),this.onHandlerDestroyed()},e.prototype.onHandlerDestroying=function(){},e.prototype.onHandlerDestroyed=function(){},e.prototype.isEventHandler=function(){return"object"===a(this.handledEvents)&&this.handledEvents.length&&"function"==typeof this.onEvent},e.prototype.registerListeners=function(){this.isEventHandler()&&this.handledEvents.forEach(function(e){if(u.has(e))throw new Error("Forbidden event-name: "+e);this.hls.on(e,this.onEvent)},this)},e.prototype.unregisterListeners=function(){this.isEventHandler()&&this.handledEvents.forEach(function(e){this.hls.off(e,this.onEvent)},this)},e.prototype.onEvent=function(e,t){this.onEventGeneric(e,t)},e.prototype.onEventGeneric=function(e,t){var i=function(e,t){var i="on"+e.replace("hls","");if("function"!=typeof this[i])throw new Error("Event "+e+" has no generic handler in this "+this.constructor.name+" class (tried "+i+")");return this[i].bind(this,t)};try{i.call(this,e,t).call()}catch(t){r.b.error("An internal error happened while handling event "+e+'. Error message: "'+t.message+'". Here is a stacktrace:',t),this.hls.trigger(s.a.ERROR,{type:o.b.OTHER_ERROR,details:o.a.INTERNAL_EXCEPTION,fatal:!1,event:e,err:t})}},e}();t.a=l},function(e,t,i){!function(t){var i=/^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/\;?#]*)?(.*?)??(;.*?)?(\?.*?)?(#.*?)?$/,n=/^([^\/;?#]*)(.*)$/,r=/(?:\/|^)\.(?=\/)/g,o=/(?:\/|^)\.\.\/(?!\.\.\/).*?(?=\/)/g,s={buildAbsoluteURL:function(e,t,i){if(i=i||{},e=e.trim(),!(t=t.trim())){if(!i.alwaysNormalize)return e;var r=s.parseURL(e);if(!r)throw new Error("Error trying to parse base URL.");return r.path=s.normalizePath(r.path),s.buildURLFromParts(r)}var o=s.parseURL(t);if(!o)throw new Error("Error trying to parse relative URL.");if(o.scheme)return i.alwaysNormalize?(o.path=s.normalizePath(o.path),s.buildURLFromParts(o)):t;var a=s.parseURL(e);if(!a)throw new Error("Error trying to parse base URL.");if(!a.netLoc&&a.path&&"/"!==a.path[0]){var u=n.exec(a.path);a.netLoc=u[1],a.path=u[2]}a.netLoc&&!a.path&&(a.path="/");var l={scheme:a.scheme,netLoc:o.netLoc,path:null,params:o.params,query:o.query,fragment:o.fragment};if(!o.netLoc&&(l.netLoc=a.netLoc,"/"!==o.path[0]))if(o.path){var c=a.path,h=c.substring(0,c.lastIndexOf("/")+1)+o.path;l.path=s.normalizePath(h)}else l.path=a.path,o.params||(l.params=a.params,o.query||(l.query=a.query));return null===l.path&&(l.path=i.alwaysNormalize?s.normalizePath(o.path):o.path),s.buildURLFromParts(l)},parseURL:function(e){var t=i.exec(e);return t?{scheme:t[1]||"",netLoc:t[2]||"",path:t[3]||"",params:t[4]||"",query:t[5]||"",fragment:t[6]||""}:null},normalizePath:function(e){for(e=e.split("").reverse().join("").replace(r,"");e.length!==(e=e.replace(o,"")).length;);return e.split("").reverse().join("")},buildURLFromParts:function(e){return e.scheme+e.netLoc+e.path+e.params+e.query+e.fragment}};e.exports=s}()},function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}i.d(t,"b",function(){return o});var r=function(){function e(){n(this,e)}return e.isHeader=function(e,t){return t+10<=e.length&&73===e[t]&&68===e[t+1]&&51===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128},e.isFooter=function(e,t){return t+10<=e.length&&51===e[t]&&68===e[t+1]&&73===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128},e.getID3Data=function(t,i){for(var n=i,r=0;e.isHeader(t,i);)r+=10,r+=e._readSize(t,i+6),e.isFooter(t,i+10)&&(r+=10),i+=r;if(r>0)return t.subarray(n,n+r)},e._readSize=function(e,t){var i=0;return i=(127&e[t])<<21,i|=(127&e[t+1])<<14,i|=(127&e[t+2])<<7,i|=127&e[t+3]},e.getTimeStamp=function(t){for(var i=e.getID3Frames(t),n=0;n<i.length;n++){var r=i[n];if(e.isTimeStampFrame(r))return e._readTimeStamp(r)}},e.isTimeStampFrame=function(e){return e&&"PRIV"===e.key&&"com.apple.streaming.transportStreamTimestamp"===e.info},e._getFrameData=function(t){var i=String.fromCharCode(t[0],t[1],t[2],t[3]),n=e._readSize(t,4);return{type:i,size:n,data:t.subarray(10,10+n)}},e.getID3Frames=function(t){for(var i=0,n=[];e.isHeader(t,i);){var r=e._readSize(t,i+6);i+=10;for(var o=i+r;i+8<o;){var s=e._getFrameData(t.subarray(i)),a=e._decodeFrame(s);a&&n.push(a),i+=s.size+10}e.isFooter(t,i)&&(i+=10)}return n},e._decodeFrame=function(t){return"PRIV"===t.type?e._decodePrivFrame(t):"T"===t.type[0]?e._decodeTextFrame(t):"W"===t.type[0]?e._decodeURLFrame(t):void 0},e._readTimeStamp=function(e){if(8===e.data.byteLength){var t=new Uint8Array(e.data),i=1&t[3],n=(t[4]<<23)+(t[5]<<15)+(t[6]<<7)+t[7];return n/=45,i&&(n+=47721858.84),Math.round(n)}},e._decodePrivFrame=function(t){if(!(t.size<2)){var i=e._utf8ArrayToStr(t.data,!0),n=new Uint8Array(t.data.subarray(i.length+1));return{key:t.type,info:i,data:n.buffer}}},e._decodeTextFrame=function(t){if(!(t.size<2)){if("TXXX"===t.type){var i=1,n=e._utf8ArrayToStr(t.data.subarray(i));i+=n.length+1;var r=e._utf8ArrayToStr(t.data.subarray(i));return{key:t.type,info:n,data:r}}var o=e._utf8ArrayToStr(t.data.subarray(1));return{key:t.type,data:o}}},e._decodeURLFrame=function(t){if("WXXX"===t.type){if(t.size<2)return;var i=1,n=e._utf8ArrayToStr(t.data.subarray(i));i+=n.length+1;var r=e._utf8ArrayToStr(t.data.subarray(i));return{key:t.type,info:n,data:r}}var o=e._utf8ArrayToStr(t.data);return{key:t.type,data:o}},e._utf8ArrayToStr=function(e){for(var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=e.length,n=void 0,r=void 0,o=void 0,s="",a=0;a<i;){if(0===(n=e[a++])&&t)return s;if(0!==n&&3!==n)switch(n>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:s+=String.fromCharCode(n);break;case 12:case 13:r=e[a++],s+=String.fromCharCode((31&n)<<6|63&r);break;case 14:r=e[a++],o=e[a++],s+=String.fromCharCode((15&n)<<12|(63&r)<<6|(63&o)<<0)}}return s},e}(),o=r._utf8ArrayToStr;t.a=r},function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=i(4),o=i.n(r),s=i(16),a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),u=function(){function e(){var t;n(this,e),this._url=null,this._byteRange=null,this._decryptdata=null,this.tagList=[],this._elementaryStreams=(t={},t[e.ElementaryStreamTypes.AUDIO]=!1,t[e.ElementaryStreamTypes.VIDEO]=!1,t)}return e.prototype.addElementaryStream=function(e){this._elementaryStreams[e]=!0},e.prototype.hasElementaryStream=function(e){return!0===this._elementaryStreams[e]},e.prototype.createInitializationVector=function(e){for(var t=new Uint8Array(16),i=12;i<16;i++)t[i]=e>>8*(15-i)&255;return t},e.prototype.fragmentDecryptdataFromLevelkey=function(e,t){var i=e;return e&&e.method&&e.uri&&!e.iv&&(i=new s.a,i.method=e.method,i.baseuri=e.baseuri,i.reluri=e.reluri,i.iv=this.createInitializationVector(t)),i},a(e,[{key:"url",get:function(){return!this._url&&this.relurl&&(this._url=o.a.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url},set:function(e){this._url=e}},{key:"programDateTime",get:function(){return!this._programDateTime&&this.rawProgramDateTime&&(this._programDateTime=new Date(Date.parse(this.rawProgramDateTime))),this._programDateTime}},{key:"byteRange",get:function(){if(!this._byteRange&&!this.rawByteRange)return[];if(this._byteRange)return this._byteRange;var e=[];if(this.rawByteRange){var t=this.rawByteRange.split("@",2);if(1===t.length){var i=this.lastByteRangeEndOffset;e[0]=i||0
}else e[0]=parseInt(t[1]);e[1]=parseInt(t[0])+e[0],this._byteRange=e}return e}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"decryptdata",get:function(){return this._decryptdata||(this._decryptdata=this.fragmentDecryptdataFromLevelkey(this.levelkey,this.sn)),this._decryptdata}}],[{key:"ElementaryStreamTypes",get:function(){return{AUDIO:"audio",VIDEO:"video"}}}]),e}();t.a=u},function(e,t,i){"use strict";var n={search:function(e,t){for(var i=0,n=e.length-1,r=null,o=null;i<=n;){r=(i+n)/2|0,o=e[r];var s=t(o);if(s>0)i=r+1;else{if(!(s<0))return o;n=r-1}}return null}};t.a=n},function(e,t,i){"use strict";var n={isBuffered:function(e,t){try{if(e)for(var i=e.buffered,n=0;n<i.length;n++)if(t>=i.start(n)&&t<=i.end(n))return!0}catch(e){}return!1},bufferInfo:function(e,t,i){try{if(e){var n=e.buffered,r=[],o=void 0;for(o=0;o<n.length;o++)r.push({start:n.start(o),end:n.end(o)});return this.bufferedInfo(r,t,i)}}catch(e){}return{len:0,start:t,end:t,nextStart:void 0}},bufferedInfo:function(e,t,i){var n=[],r=void 0,o=void 0,s=void 0,a=void 0,u=void 0;for(e.sort(function(e,t){return e.start-t.start||t.end-e.end}),u=0;u<e.length;u++){var l=n.length;if(l){var c=n[l-1].end;e[u].start-c<i?e[u].end>c&&(n[l-1].end=e[u].end):n.push(e[u])}else n.push(e[u])}for(u=0,r=0,o=s=t;u<n.length;u++){var h=n[u].start,d=n[u].end;if(t+i>=h&&t<d)o=h,s=d,r=s-t;else if(t+i<h){a=h;break}}return{len:r,start:o,end:s,nextStart:a}}};t.a=n},function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=i(33),o=i(34),s=i(35),a=i(2),u=i(0),l=function(){function e(t,i){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=r.removePKCS7Padding,s=void 0===o||o;if(n(this,e),this.logEnabled=!0,this.observer=t,this.config=i,this.removePKCS7Padding=s,s)try{var a=crypto||self.crypto;this.subtle=a.subtle||a.webkitSubtle}catch(e){}this.disableWebCrypto=!this.subtle}return e.prototype.isSync=function(){return this.disableWebCrypto&&this.config.enableSoftwareAES},e.prototype.decrypt=function(e,t,i,n){var a=this;if(this.disableWebCrypto&&this.config.enableSoftwareAES){this.logEnabled&&(u.b.log("JS AES decrypt"),this.logEnabled=!1);var l=this.decryptor;l||(this.decryptor=l=new s.a),l.expandKey(t),n(l.decrypt(e,0,i,this.removePKCS7Padding))}else{this.logEnabled&&(u.b.log("WebCrypto AES decrypt"),this.logEnabled=!1);var c=this.subtle;this.key!==t&&(this.key=t,this.fastAesKey=new o.a(c,t)),this.fastAesKey.expandKey().then(function(o){new r.a(c,i).decrypt(e,o).catch(function(r){a.onWebCryptoError(r,e,t,i,n)}).then(function(e){n(e)})}).catch(function(r){a.onWebCryptoError(r,e,t,i,n)})}},e.prototype.onWebCryptoError=function(e,t,i,n,r){this.config.enableSoftwareAES?(u.b.log("WebCrypto Error, disable WebCrypto API"),this.disableWebCrypto=!0,this.logEnabled=!0,this.decrypt(t,i,n,r)):(u.b.error("decrypting error : "+e.message),this.observer.trigger(Event.ERROR,{type:a.b.MEDIA_ERROR,details:a.a.FRAG_DECRYPT_ERROR,fatal:!0,reason:e.message}))},e.prototype.destroy=function(){var e=this.decryptor;e&&(e.destroy(),this.decryptor=void 0)},e}();t.a=l},function(e,t){function i(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function n(e){return"function"==typeof e}function r(e){return"number"==typeof e}function o(e){return"object"==typeof e&&null!==e}function s(e){return void 0===e}e.exports=i,i.EventEmitter=i,i.prototype._events=void 0,i.prototype._maxListeners=void 0,i.defaultMaxListeners=10,i.prototype.setMaxListeners=function(e){if(!r(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},i.prototype.emit=function(e){var t,i,r,a,u,l;if(this._events||(this._events={}),"error"===e&&(!this._events.error||o(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var c=new Error('Uncaught, unspecified "error" event. ('+t+")");throw c.context=t,c}if(i=this._events[e],s(i))return!1;if(n(i))switch(arguments.length){case 1:i.call(this);break;case 2:i.call(this,arguments[1]);break;case 3:i.call(this,arguments[1],arguments[2]);break;default:a=Array.prototype.slice.call(arguments,1),i.apply(this,a)}else if(o(i))for(a=Array.prototype.slice.call(arguments,1),l=i.slice(),r=l.length,u=0;u<r;u++)l[u].apply(this,a);return!0},i.prototype.addListener=function(e,t){var r;if(!n(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,n(t.listener)?t.listener:t),this._events[e]?o(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,o(this._events[e])&&!this._events[e].warned&&(r=s(this._maxListeners)?i.defaultMaxListeners:this._maxListeners)&&r>0&&this._events[e].length>r&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},i.prototype.on=i.prototype.addListener,i.prototype.once=function(e,t){function i(){this.removeListener(e,i),r||(r=!0,t.apply(this,arguments))}if(!n(t))throw TypeError("listener must be a function");var r=!1;return i.listener=t,this.on(e,i),this},i.prototype.removeListener=function(e,t){var i,r,s,a;if(!n(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(i=this._events[e],s=i.length,r=-1,i===t||n(i.listener)&&i.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(o(i)){for(a=s;a-- >0;)if(i[a]===t||i[a].listener&&i[a].listener===t){r=a;break}if(r<0)return this;1===i.length?(i.length=0,delete this._events[e]):i.splice(r,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},i.prototype.removeAllListeners=function(e){var t,i;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(i=this._events[e],n(i))this.removeListener(e,i);else if(i)for(;i.length;)this.removeListener(e,i[i.length-1]);return delete this._events[e],this},i.prototype.listeners=function(e){return this._events&&this._events[e]?n(this._events[e])?[this._events[e]]:this._events[e].slice():[]},i.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(n(t))return 1;if(t)return t.length}return 0},i.listenerCount=function(e,t){return e.listenerCount(t)}},function(e,t,i){"use strict";function n(){if("undefined"!=typeof window)return window.MediaSource||window.WebKitMediaSource}t.a=n},function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}i.d(t,"a",function(){return u}),i.d(t,"b",function(){return l});var s=i(3),a=i(1),u={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"},l=function(e){function t(i){n(this,t);var o=r(this,e.call(this,i,a.a.BUFFER_APPENDED,a.a.FRAG_BUFFERED,a.a.FRAG_LOADED));return o.bufferPadding=.2,o.fragments=Object.create(null),o.timeRanges=Object.create(null),o.config=i.config,o}return o(t,e),t.prototype.destroy=function(){this.fragments=null,this.timeRanges=null,this.config=null,s.a.prototype.destroy.call(this),e.prototype.destroy.call(this)},t.prototype.getBufferedFrag=function(e,t){var i=this.fragments,n=Object.keys(i).filter(function(n){var r=i[n];if(r.body.type!==t)return!1;if(!r.buffered)return!1;var o=r.body;return o.startPTS<=e&&e<=o.endPTS});if(0===n.length)return null;var r=n.pop();return i[r].body},t.prototype.detectEvictedFragments=function(e,t){var i=this,n=void 0,r=void 0;Object.keys(this.fragments).forEach(function(o){var s=i.fragments[o];if(!0===s.buffered){var a=s.range[e];if(a){n=a.time;for(var u=0;u<n.length;u++)if(r=n[u],!1===i.isTimeBuffered(r.startPTS,r.endPTS,t)){i.removeFragment(s.body);break}}}})},t.prototype.detectPartialFragments=function(e){var t=this,i=this.getFragmentKey(e),n=this.fragments[i];n&&(n.buffered=!0,Object.keys(this.timeRanges).forEach(function(i){if(!0===e.hasElementaryStream(i)){var r=t.timeRanges[i];n.range[i]=t.getBufferedTimes(e.startPTS,e.endPTS,r)}}))},t.prototype.getBufferedTimes=function(e,t,i){for(var n=[],r=void 0,o=void 0,s=!1,a=0;a<i.length;a++){if(r=i.start(a)-this.bufferPadding,o=i.end(a)+this.bufferPadding,e>=r&&t<=o){n.push({startPTS:Math.max(e,i.start(a)),endPTS:Math.min(t,i.end(a))});break}if(e<o&&t>r)n.push({startPTS:Math.max(e,i.start(a)),endPTS:Math.min(t,i.end(a))}),s=!0;else if(t<=r)break}return{time:n,partial:s}},t.prototype.getFragmentKey=function(e){return e.type+"_"+e.level+"_"+e.sn},t.prototype.getPartialFragment=function(e){var t=this,i=void 0,n=void 0,r=void 0,o=null,s=0;return Object.keys(this.fragments).forEach(function(a){var u=t.fragments[a];t.isPartial(u)&&(n=u.body.startPTS-t.bufferPadding,r=u.body.endPTS+t.bufferPadding,e>=n&&e<=r&&(i=Math.min(e-n,r-e),s<=i&&(o=u.body,s=i)))}),o},t.prototype.getState=function(e){var t=this.getFragmentKey(e),i=this.fragments[t],n=u.NOT_LOADED;return void 0!==i&&(n=i.buffered?!0===this.isPartial(i)?u.PARTIAL:u.OK:u.APPENDING),n},t.prototype.isPartial=function(e){return!0===e.buffered&&(void 0!==e.range.video&&!0===e.range.video.partial||void 0!==e.range.audio&&!0===e.range.audio.partial)},t.prototype.isTimeBuffered=function(e,t,i){for(var n=void 0,r=void 0,o=0;o<i.length;o++){if(n=i.start(o)-this.bufferPadding,r=i.end(o)+this.bufferPadding,e>=n&&t<=r)return!0;if(t<=n)return!1}return!1},t.prototype.onFragLoaded=function(e){var t=e.frag;if(!isNaN(t.sn)){var i=this.getFragmentKey(t),n={body:t,range:Object.create(null),buffered:!1};this.fragments[i]=n}},t.prototype.onBufferAppended=function(e){var t=this;this.timeRanges=e.timeRanges,Object.keys(this.timeRanges).forEach(function(e){var i=t.timeRanges[e];t.detectEvictedFragments(e,i)})},t.prototype.onFragBuffered=function(e){this.detectPartialFragments(e.frag)},t.prototype.hasFragment=function(e){var t=this.getFragmentKey(e);return void 0!==this.fragments[t]},t.prototype.removeFragment=function(e){var t=this.getFragmentKey(e);delete this.fragments[t]},t.prototype.removeAllFragments=function(){this.fragments=Object.create(null)},t}(s.a)},function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=i(3),a=function(e){function t(i){n(this,t);for(var o=arguments.length,s=Array(o>1?o-1:0),a=1;a<o;a++)s[a-1]=arguments[a];var u=r(this,e.call.apply(e,[this,i].concat(s)));return u._tickInterval=null,u._tickCallCount=0,u}return o(t,e),t.prototype.destroy=function(){this.clearInterval(),e.prototype.destroy.call(this)},t.prototype.hasInterval=function(){return null!==this._tickInterval},t.prototype.setInterval=function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e){return!this._tickInterval&&(this._tickInterval=setInterval(this.tick.bind(this,!1),e),!0)}),t.prototype.clearInterval=function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(){return!!this._tickInterval&&(clearInterval(this._tickInterval),this._tickInterval=null,!0)}),t.prototype.tick=function(){1==++this._tickCallCount&&(this.doTick(),this._tickCallCount>1&&setTimeout(this.tick.bind(this),0),this._tickCallCount=0)},t.prototype.doTick=function(){throw new Error("TaskLoop is abstract and `doLoop` must be implemented")},t}(s.a);t.a=a},function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=i(1),a=i(3),u=i(2),l=i(0),c=i(15),h=i(28),d=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),f={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},p={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"},g=function(e){function t(i){n(this,t);var o=r(this,e.call(this,i,s.a.MANIFEST_LOADING,s.a.LEVEL_LOADING,s.a.AUDIO_TRACK_LOADING,s.a.SUBTITLE_TRACK_LOADING));return o.loaders={},o}return o(t,e),t.canHaveQualityLevels=function(e){return e!==f.AUDIO_TRACK&&e!==f.SUBTITLE_TRACK},t.mapContextToLevelType=function(e){switch(e.type){case f.AUDIO_TRACK:return p.AUDIO;case f.SUBTITLE_TRACK:return p.SUBTITLE;default:return p.MAIN}},t.getResponseUrl=function(e,t){var i=e.url;return void 0!==i&&0!==i.indexOf("data:")||(i=t.url),i},t.prototype.createInternalLoader=function(e){var t=this.hls.config,i=t.pLoader,n=t.loader,r=i||n,o=new r(t);return e.loader=o,this.loaders[e.type]=o,o},t.prototype.getInternalLoader=function(e){return this.loaders[e.type]},t.prototype.resetInternalLoader=function(e){this.loaders[e]&&delete this.loaders[e]},t.prototype.destroyInternalLoaders=function(){for(var e in this.loaders){var t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}},t.prototype.destroy=function(){this.destroyInternalLoaders(),e.prototype.destroy.call(this)},t.prototype.onManifestLoading=function(e){this.load(e.url,{type:f.MANIFEST})},t.prototype.onLevelLoading=function(e){this.load(e.url,{type:f.LEVEL,level:e.level,id:e.id})},t.prototype.onAudioTrackLoading=function(e){this.load(e.url,{type:f.AUDIO_TRACK,id:e.id})},t.prototype.onSubtitleTrackLoading=function(e){this.load(e.url,{type:f.SUBTITLE_TRACK,id:e.id})},t.prototype.load=function(e,t){var i=this.hls.config,n=this.getInternalLoader(t);if(n){var r=n.context;if(r&&r.url===e)return l.b.trace("playlist request ongoing"),!1;l.b.warn("aborting previous loader for type: "+t.type),n.abort()}var o=void 0,s=void 0,a=void 0,u=void 0;switch(t.type){case f.MANIFEST:o=i.manifestLoadingMaxRetry,s=i.manifestLoadingTimeOut,a=i.manifestLoadingRetryDelay,u=i.manifestLoadingMaxRetryTimeout;break;case f.LEVEL:o=0,s=i.levelLoadingTimeOut;break;default:o=i.levelLoadingMaxRetry,s=i.levelLoadingTimeOut,a=i.levelLoadingRetryDelay,u=i.levelLoadingMaxRetryTimeout,l.b.log("Playlist loader for "+t.type+" "+(t.level||t.id))}n=this.createInternalLoader(t),t.url=e,t.responseType=t.responseType||"";var c=void 0,h=void 0;return c={timeout:s,maxRetry:o,retryDelay:a,maxRetryDelay:u},h={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)},n.load(t,c,h),!0},t.prototype.loadsuccess=function(e,t,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(i.isSidxRequest)return this._handleSidxRequest(e,i),void this._handlePlaylistLoaded(e,t,i,n);this.resetInternalLoader(i.type);var r=e.data;if(t.tload=performance.now(),0!==r.indexOf("#EXTM3U"))return void this._handleManifestParsingError(e,i,"no EXTM3U delimiter",n);r.indexOf("#EXTINF:")>0||r.indexOf("#EXT-X-TARGETDURATION:")>0?this._handleTrackOrLevelPlaylist(e,t,i,n):this._handleMasterPlaylist(e,t,i,n)},t.prototype.loaderror=function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this._handleNetworkError(t,i)},t.prototype.loadtimeout=function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this._handleNetworkError(t,i,!0)},t.prototype._handleMasterPlaylist=function(e,i,n,r){var o=this.hls,a=e.data,u=t.getResponseUrl(e,n),c=h.a.parseMasterPlaylist(a,u);if(!c.length)return void this._handleManifestParsingError(e,n,"no level found in manifest",r);var d=c.map(function(e){return{id:e.attrs.AUDIO,codec:e.audioCodec}}),f=h.a.parseMasterPlaylistMedia(a,u,"AUDIO",d),p=h.a.parseMasterPlaylistMedia(a,u,"SUBTITLES");if(f.length){var g=!1;f.forEach(function(e){e.url||(g=!0)}),!1===g&&c[0].audioCodec&&!c[0].attrs.AUDIO&&(l.b.log("audio codec signaled in quality level, but no embedded audio track signaled, create one"),f.unshift({type:"main",name:"main"}))}o.trigger(s.a.MANIFEST_LOADED,{levels:c,audioTracks:f,subtitles:p,url:u,stats:i,networkDetails:r})},t.prototype._handleTrackOrLevelPlaylist=function(e,i,n,r){var o=this.hls,a=n.id,u=n.level,l=n.type,c=t.getResponseUrl(e,n),d=isNaN(u)?isNaN(a)?0:a:u,p=t.mapContextToLevelType(n),g=h.a.parseLevelPlaylist(e.data,c,d,p);if(g.tload=i.tload,l===f.MANIFEST){var m={url:c,details:g};o.trigger(s.a.MANIFEST_LOADED,{levels:[m],audioTracks:[],url:c,stats:i,networkDetails:r})}if(i.tparsed=performance.now(),g.needSidxRanges){var v=g.initSegment.url;return void this.load(v,{isSidxRequest:!0,type:l,level:u,levelDetails:g,id:a,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer"})}n.levelDetails=g,this._handlePlaylistLoaded(e,i,n,r)},t.prototype._handleSidxRequest=function(e,t){var i=c.a.parseSegmentIndex(new Uint8Array(e.data));i.references.forEach(function(e,i){var n=e.info,r=t.levelDetails.fragments[i];0===r.byteRange.length&&(r.rawByteRange=String(1+n.end-n.start)+"@"+String(n.start))}),t.levelDetails.initSegment.rawByteRange=String(i.moovEndOffset)+"@0"},t.prototype._handleManifestParsingError=function(e,t,i,n){this.hls.trigger(s.a.ERROR,{type:u.b.NETWORK_ERROR,details:u.a.MANIFEST_PARSING_ERROR,fatal:!0,url:e.url,reason:i,networkDetails:n})},t.prototype._handleNetworkError=function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=void 0,r=void 0,o=this.getInternalLoader(e);switch(e.type){case f.MANIFEST:n=i?u.a.MANIFEST_LOAD_TIMEOUT:u.a.MANIFEST_LOAD_ERROR,r=!0;break;case f.LEVEL:n=i?u.a.LEVEL_LOAD_TIMEOUT:u.a.LEVEL_LOAD_ERROR,r=!1;break;case f.AUDIO_TRACK:n=i?u.a.AUDIO_TRACK_LOAD_TIMEOUT:u.a.AUDIO_TRACK_LOAD_ERROR,r=!1;break;default:r=!1}o&&(o.abort(),this.resetInternalLoader(e.type)),this.hls.trigger(s.a.ERROR,{type:u.b.NETWORK_ERROR,details:n,fatal:r,url:o.url,loader:o,context:e,networkDetails:t})},t.prototype._handlePlaylistLoaded=function(e,i,n,r){var o=n.type,a=n.level,u=n.id,l=n.levelDetails;if(!l.targetduration)return void this._handleManifestParsingError(e,n,"invalid target duration",r);if(t.canHaveQualityLevels(n.type))this.hls.trigger(s.a.LEVEL_LOADED,{details:l,level:a||0,id:u||0,stats:i,networkDetails:r});else switch(o){case f.AUDIO_TRACK:this.hls.trigger(s.a.AUDIO_TRACK_LOADED,{details:l,id:u,stats:i,networkDetails:r});break;case f.SUBTITLE_TRACK:this.hls.trigger(s.a.SUBTITLE_TRACK_LOADED,{details:l,id:u,stats:i,networkDetails:r})}},d(t,null,[{key:"ContextType",get:function(){return f}},{key:"LevelType",get:function(){return p}}]),t}(a.a);t.a=g},function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=i(0),o=i(1),s=Math.pow(2,32)-1,a=function(){function e(t,i){n(this,e),this.observer=t,this.remuxer=i}return e.prototype.resetTimeStamp=function(e){this.initPTS=e},e.prototype.resetInitSegment=function(t,i,n,r){if(t&&t.byteLength){var s=this.initData=e.parseInitSegment(t);null==i&&(i="mp4a.40.5"),null==n&&(n="avc1.42e01e");var a={};s.audio&&s.video?a.audiovideo={container:"video/mp4",codec:i+","+n,initSegment:r?t:null}:(s.audio&&(a.audio={container:"audio/mp4",codec:i,initSegment:r?t:null}),s.video&&(a.video={container:"video/mp4",codec:n,initSegment:r?t:null})),this.observer.trigger(o.a.FRAG_PARSING_INIT_SEGMENT,{tracks:a})}else i&&(this.audioCodec=i),n&&(this.videoCodec=n)},e.probe=function(t){return e.findBox({data:t,start:0,end:Math.min(t.length,16384)},["moof"]).length>0},e.bin2str=function(e){return String.fromCharCode.apply(null,e)},e.readUint16=function(e,t){e.data&&(t+=e.start,e=e.data);var i=e[t]<<8|e[t+1];return i<0?65536+i:i},e.readUint32=function(e,t){e.data&&(t+=e.start,e=e.data);var i=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3];return i<0?4294967296+i:i},e.writeUint32=function(e,t,i){e.data&&(t+=e.start,e=e.data),e[t]=i>>24,e[t+1]=i>>16&255,e[t+2]=i>>8&255,e[t+3]=255&i},e.findBox=function(t,i){var n=[],r=void 0,o=void 0,s=void 0,a=void 0,u=void 0,l=void 0,c=void 0;if(t.data?(l=t.start,a=t.end,t=t.data):(l=0,a=t.byteLength),!i.length)return null;for(r=l;r<a;)o=e.readUint32(t,r),s=e.bin2str(t.subarray(r+4,r+8)),c=o>1?r+o:a,s===i[0]&&(1===i.length?n.push({data:t,start:r+8,end:c}):(u=e.findBox({data:t,start:r+8,end:c},i.slice(1)),u.length&&(n=n.concat(u)))),r=c;return n},e.parseSegmentIndex=function(t){var i=e.findBox(t,["moov"])[0],n=i?i.end:null,r=0,o=e.findBox(t,["sidx"]),s=void 0;if(!o||!o[0])return null;s=[],o=o[0];var a=o.data[0];r=0===a?8:16;var u=e.readUint32(o,r);r+=4,r+=0===a?8:16,r+=2;var l=o.end+0,c=e.readUint16(o,r);r+=2;for(var h=0;h<c;h++){var d=r,f=e.readUint32(o,d);d+=4;var p=2147483647&f;if(1==(2147483648&f)>>>31)return void console.warn("SIDX has hierarchical references (not supported)");var g=e.readUint32(o,d);d+=4,s.push({referenceSize:p,subsegmentDuration:g,info:{duration:g/u,start:l,end:l+p-1}}),l+=p,d+=4,r=d}return{earliestPresentationTime:0,timescale:u,version:a,referencesCount:c,references:s,moovEndOffset:n}},e.parseInitSegment=function(t){var i=[];return e.findBox(t,["moov","trak"]).forEach(function(t){var n=e.findBox(t,["tkhd"])[0];if(n){var o=n.data[n.start],s=0===o?12:20,a=e.readUint32(n,s),u=e.findBox(t,["mdia","mdhd"])[0];if(u){o=u.data[u.start],s=0===o?12:20;var l=e.readUint32(u,s),c=e.findBox(t,["mdia","hdlr"])[0];if(c){var h=e.bin2str(c.data.subarray(c.start+8,c.start+12)),d={soun:"audio",vide:"video"}[h];if(d){var f=e.findBox(t,["mdia","minf","stbl","stsd"]);if(f.length){f=f[0];var p=e.bin2str(f.data.subarray(f.start+12,f.start+16));r.b.log("MP4Demuxer:"+d+":"+p+" found")}i[a]={timescale:l,type:d},i[d]={timescale:l,id:a}}}}}}),i},e.getStartDTS=function(t,i){var n=void 0,r=void 0,o=void 0;return n=e.findBox(i,["moof","traf"]),r=[].concat.apply([],n.map(function(i){return e.findBox(i,["tfhd"]).map(function(n){var r=void 0,o=void 0;return r=e.readUint32(n,4),o=t[r].timescale||9e4,e.findBox(i,["tfdt"]).map(function(t){var i=void 0,n=void 0;return i=t.data[t.start],n=e.readUint32(t,4),1===i&&(n*=Math.pow(2,32),n+=e.readUint32(t,8)),n})[0]/o})})),o=Math.min.apply(null,r),isFinite(o)?o:0},e.offsetStartDTS=function(t,i,n){e.findBox(i,["moof","traf"]).map(function(i){return e.findBox(i,["tfhd"]).map(function(r){var o=e.readUint32(r,4),a=t[o].timescale||9e4;e.findBox(i,["tfdt"]).map(function(t){var i=t.data[t.start],r=e.readUint32(t,4);if(0===i)e.writeUint32(t,4,r-n*a);else{r*=Math.pow(2,32),r+=e.readUint32(t,8),r-=n*a,r=Math.max(r,0);var o=Math.floor(r/(s+1)),u=Math.floor(r%(s+1));e.writeUint32(t,4,o),e.writeUint32(t,8,u)}})})})},e.prototype.append=function(t,i,n,r){var s=this.initData;s||(this.resetInitSegment(t,this.audioCodec,this.videoCodec,!1),s=this.initData);var a=void 0,u=this.initPTS;if(void 0===u){var l=e.getStartDTS(s,t);this.initPTS=u=l-i,this.observer.trigger(o.a.INIT_PTS_FOUND,{initPTS:u})}e.offsetStartDTS(s,t,u),a=e.getStartDTS(s,t),this.remuxer.remux(s.audio,s.video,null,null,a,n,r,t)},e.prototype.destroy=function(){},e}();t.a=a},function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=i(4),o=i.n(r),s=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),a=function(){function e(){n(this,e),this.method=null,this.key=null,this.iv=null,this._uri=null}return s(e,[{key:"uri",get:function(){return!this._uri&&this.reluri&&(this._uri=o.a.buildAbsoluteURL(this.baseuri,this.reluri,{alwaysNormalize:!0})),this._uri}}]),e}();t.a=a},function(e,t,i){"use strict";function n(e,t){var i=o[t];return!!i&&!0===i[e.slice(0,4)]}function r(e,t){return MediaSource.isTypeSupported((t||"video")+'/mp4;codecs="'+e+'"')}i.d(t,"b",function(){return n}),i.d(t,"a",function(){return r});var o={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,drac:!0,dvav:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0}}},function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=i(1),o=i(19),s=i(0),a=i(2),u=i(10),l=i.n(u),c=i(45),h=i.n(c),d=i(11),f=Object(d.a)(),p=function(){function e(t,i){n(this,e),this.hls=t,this.id=i;var u=this.observer=new l.a,c=t.config;u.trigger=function(e){for(var t=arguments.length,i=Array(t>1?t-1:0),n=1;n<t;n++)i[n-1]=arguments[n];u.emit.apply(u,[e,e].concat(i))},u.off=function(e){for(var t=arguments.length,i=Array(t>1?t-1:0),n=1;n<t;n++)i[n-1]=arguments[n];u.removeListener.apply(u,[e].concat(i))};var d=function(e,i){i=i||{},i.frag=this.frag,i.id=this.id,t.trigger(e,i)}.bind(this);u.on(r.a.FRAG_DECRYPTED,d),u.on(r.a.FRAG_PARSING_INIT_SEGMENT,d),u.on(r.a.FRAG_PARSING_DATA,d),u.on(r.a.FRAG_PARSED,d),u.on(r.a.ERROR,d),u.on(r.a.FRAG_PARSING_METADATA,d),u.on(r.a.FRAG_PARSING_USERDATA,d),u.on(r.a.INIT_PTS_FOUND,d);var p={mp4:f.isTypeSupported("video/mp4"),mpeg:f.isTypeSupported("audio/mpeg"),mp3:f.isTypeSupported('audio/mp4; codecs="mp3"')},g=navigator.vendor;if(c.enableWorker&&"undefined"!=typeof Worker){s.b.log("demuxing in webworker");var m=void 0;try{m=this.w=h()(46),this.onwmsg=this.onWorkerMessage.bind(this),m.addEventListener("message",this.onwmsg),m.onerror=function(e){t.trigger(r.a.ERROR,{type:a.b.OTHER_ERROR,details:a.a.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",err:{message:e.message+" ("+e.filename+":"+e.lineno+")"}})},m.postMessage({cmd:"init",typeSupported:p,vendor:g,id:i,config:JSON.stringify(c)})}catch(e){s.b.error("error while initializing DemuxerWorker, fallback on DemuxerInline"),m&&URL.revokeObjectURL(m.objectURL),this.demuxer=new o.a(u,p,c,g),this.w=void 0}}else this.demuxer=new o.a(u,p,c,g)}return e.prototype.destroy=function(){var e=this.w;if(e)e.removeEventListener("message",this.onwmsg),e.terminate(),this.w=null;else{var t=this.demuxer;t&&(t.destroy(),this.demuxer=null)}var i=this.observer;i&&(i.removeAllListeners(),this.observer=null)},e.prototype.push=function(e,t,i,n,r,o,a,u){var l=this.w,c=isNaN(r.startDTS)?r.start:r.startDTS,h=r.decryptdata,d=this.frag,f=!(d&&r.cc===d.cc),p=!(d&&r.level===d.level),g=d&&r.sn===d.sn+1,m=!p&&g;if(f&&s.b.log(this.id+":discontinuity detected"),p&&s.b.log(this.id+":switch detected"),this.frag=r,l)l.postMessage({cmd:"demux",data:e,decryptdata:h,initSegment:t,audioCodec:i,videoCodec:n,timeOffset:c,discontinuity:f,trackSwitch:p,contiguous:m,duration:o,accurateTimeOffset:a,defaultInitPTS:u},e instanceof ArrayBuffer?[e]:[]);else{var v=this.demuxer;v&&v.push(e,h,t,i,n,c,f,p,m,o,a,u)}},e.prototype.onWorkerMessage=function(e){var t=e.data,i=this.hls;switch(t.event){case"init":URL.revokeObjectURL(this.w.objectURL);break;case r.a.FRAG_PARSING_DATA:t.data.data1=new Uint8Array(t.data1),t.data2&&(t.data.data2=new Uint8Array(t.data2));default:t.data=t.data||{},t.data.frag=this.frag,t.data.id=this.id,i.trigger(t.event,t.data)}},e}();t.a=p},function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=i(1),o=i(2),s=i(9),a=i(36),u=i(15),l=i(37),c=i(40),h=i(41),d=i(44),f=function(){function e(t,i,r,o){n(this,e),this.observer=t,this.typeSupported=i,this.config=r,this.vendor=o}return e.prototype.destroy=function(){var e=this.demuxer;e&&e.destroy()},e.prototype.push=function(e,t,i,n,o,a,u,l,c,h,d,f){if(e.byteLength>0&&null!=t&&null!=t.key&&"AES-128"===t.method){var p=this.decrypter;null==p&&(p=this.decrypter=new s.a(this.observer,this.config));var g=this,m=void 0;try{m=performance.now()}catch(e){m=Date.now()}p.decrypt(e,t.key.buffer,t.iv.buffer,function(e){var s=void 0;try{s=performance.now()}catch(e){s=Date.now()}g.observer.trigger(r.a.FRAG_DECRYPTED,{stats:{tstart:m,tdecrypt:s}}),g.pushDecrypted(new Uint8Array(e),t,new Uint8Array(i),n,o,a,u,l,c,h,d,f)})}else this.pushDecrypted(new Uint8Array(e),t,new Uint8Array(i),n,o,a,u,l,c,h,d,f)},e.prototype.pushDecrypted=function(e,t,i,n,s,f,p,g,m,v,y,b){var w=this.demuxer;if(!w||(p||g)&&!this.probe(e)){for(var E=this.observer,_=this.typeSupported,T=this.config,S=[{demux:l.a,remux:h.a},{demux:u.a,remux:d.a},{demux:a.a,remux:h.a},{demux:c.a,remux:h.a}],A=0,P=S.length;A<P;A++){var I=S[A],x=I.demux.probe;if(x(e)){var C=this.remuxer=new I.remux(E,T,_,this.vendor);w=new I.demux(E,C,T,_),this.probe=x;break}}if(!w)return void E.trigger(r.a.ERROR,{type:o.b.MEDIA_ERROR,details:o.a.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"});this.demuxer=w}var R=this.remuxer;(p||g)&&(w.resetInitSegment(i,n,s,v),R.resetInitSegment()),p&&(w.resetTimeStamp(b),R.resetTimeStamp(b)),"function"==typeof w.setDecryptData&&w.setDecryptData(t),w.append(e,f,m,y)},e}();t.a=f},function(e,t,i){"use strict";function n(e,t,i,n){var r=void 0,o=void 0,s=void 0,a=void 0,u=void 0,l=navigator.userAgent.toLowerCase(),c=n,h=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];return r=1+((192&t[i+2])>>>6),(o=(60&t[i+2])>>>2)>h.length-1?void e.trigger(Event.ERROR,{type:p.b.MEDIA_ERROR,details:p.a.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+o}):(a=(1&t[i+2])<<2,a|=(192&t[i+3])>>>6,f.b.log("manifest codec:"+n+",ADTS data:type:"+r+",sampleingIndex:"+o+"["+h[o]+"Hz],channelConfig:"+a),/firefox/i.test(l)?o>=6?(r=5,u=new Array(4),s=o-3):(r=2,u=new Array(2),s=o):-1!==l.indexOf("android")?(r=2,u=new Array(2),s=o):(r=5,u=new Array(4),n&&(-1!==n.indexOf("mp4a.40.29")||-1!==n.indexOf("mp4a.40.5"))||!n&&o>=6?s=o-3:((n&&-1!==n.indexOf("mp4a.40.2")&&(o>=6&&1===a||/vivaldi/i.test(l))||!n&&1===a)&&(r=2,u=new Array(2)),s=o)),u[0]=r<<3,u[0]|=(14&o)>>1,u[1]|=(1&o)<<7,u[1]|=a<<3,5===r&&(u[1]|=(14&s)>>1,u[2]=(1&s)<<7,u[2]|=8,u[3]=0),{config:u,samplerate:h[o],channelCount:a,codec:"mp4a.40."+r,manifestCodec:c})}function r(e,t){return 255===e[t]&&240==(246&e[t+1])}function o(e,t){return 1&e[t+1]?7:9}function s(e,t){return(3&e[t+3])<<11|e[t+4]<<3|(224&e[t+5])>>>5}function a(e,t){return!!(t+1<e.length&&r(e,t))}function u(e,t){if(t+1<e.length&&r(e,t)){var i=o(e,t),n=i;t+5<e.length&&(n=s(e,t));var a=t+n;if(a===e.length||a+1<e.length&&r(e,a))return!0}return!1}function l(e,t,i,r,o){if(!e.samplerate){var s=n(t,i,r,o);e.config=s.config,e.samplerate=s.samplerate,
e.channelCount=s.channelCount,e.codec=s.codec,e.manifestCodec=s.manifestCodec,f.b.log("parsed codec:"+e.codec+",rate:"+s.samplerate+",nb channel:"+s.channelCount)}}function c(e){return 9216e4/e}function h(e,t,i,n,r){var a=void 0,u=void 0,l=void 0,c=e.length;if(a=o(e,t),u=s(e,t),(u-=a)>0&&t+a+u<=c)return l=i+n*r,{headerLength:a,frameLength:u,stamp:l}}function d(e,t,i,n,r){var o=c(e.samplerate),s=h(t,i,n,r,o);if(s){var a=s.stamp,u=s.headerLength,l=s.frameLength,d={unit:t.subarray(i+u,i+u+l),pts:a,dts:a};return e.samples.push(d),e.len+=l,{sample:d,length:l+u}}}t.d=a,t.e=u,t.c=l,t.b=c,t.a=d;var f=i(0),p=i(2)},function(e,t,i){"use strict";var n={BitratesMap:[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],SamplingRateMap:[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],SamplesCoefficients:[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],BytesInSlot:[0,1,1,4],appendFrame:function(e,t,i,n,r){if(!(i+24>t.length)){var o=this.parseHeader(t,i);if(o&&i+o.frameLength<=t.length){var s=9e4*o.samplesPerFrame/o.sampleRate,a=n+r*s,u={unit:t.subarray(i,i+o.frameLength),pts:a,dts:a};return e.config=[],e.channelCount=o.channelCount,e.samplerate=o.sampleRate,e.samples.push(u),e.len+=o.frameLength,{sample:u,length:o.frameLength}}}},parseHeader:function(e,t){var i=e[t+1]>>3&3,r=e[t+1]>>1&3,o=e[t+2]>>4&15,s=e[t+2]>>2&3,a=e[t+2]>>1&1;if(1!==i&&0!==o&&15!==o&&3!==s){var u=3===i?3-r:3===r?3:4,l=1e3*n.BitratesMap[14*u+o-1],c=3===i?0:2===i?1:2,h=n.SamplingRateMap[3*c+s],d=e[t+3]>>6==3?1:2,f=n.SamplesCoefficients[i][r],p=n.BytesInSlot[r],g=8*f*p;return{sampleRate:h,channelCount:d,frameLength:parseInt(f*l/h+a,10)*p,samplesPerFrame:g}}},isHeaderPattern:function(e,t){return 255===e[t]&&224==(224&e[t+1])&&0!=(6&e[t+1])},isHeader:function(e,t){return!!(t+1<e.length&&this.isHeaderPattern(e,t))},probe:function(e,t){if(t+1<e.length&&this.isHeaderPattern(e,t)){var i=this.parseHeader(e,t),n=4;i&&i.frameLength&&(n=i.frameLength);var r=t+n;if(r===e.length||r+1<e.length&&this.isHeaderPattern(e,r))return!0}return!1}};t.a=n},function(e,t,i){"use strict";function n(e,t,i){var n=e[t],r=e[i],o=r.startPTS;isNaN(o)?r.start=i>t?n.start+n.duration:Math.max(n.start-r.duration,0):i>t?(n.duration=o-n.start,n.duration<0&&s.b.warn("negative duration computed for frag "+n.sn+",level "+n.level+", there should be some duration drift between playlist and fragment!")):(r.duration=n.start-o,r.duration<0&&s.b.warn("negative duration computed for frag "+r.sn+",level "+r.level+", there should be some duration drift between playlist and fragment!"))}function r(e,t,i,r,o,s){var a=i;if(!isNaN(t.startPTS)){var u=Math.abs(t.startPTS-i);isNaN(t.deltaPTS)?t.deltaPTS=u:t.deltaPTS=Math.max(u,t.deltaPTS),a=Math.max(i,t.startPTS),i=Math.min(i,t.startPTS),r=Math.max(r,t.endPTS),o=Math.min(o,t.startDTS),s=Math.max(s,t.endDTS)}var l=i-t.start;t.start=t.startPTS=i,t.maxStartPTS=a,t.endPTS=r,t.startDTS=o,t.endDTS=s,t.duration=r-i;var c=t.sn;if(!e||c<e.startSN||c>e.endSN)return 0;var h=void 0,d=void 0,f=void 0;for(h=c-e.startSN,d=e.fragments,d[h]=t,f=h;f>0;f--)n(d,f,f-1);for(f=h;f<d.length-1;f++)n(d,f,f+1);return e.PTSKnown=!0,l}function o(e,t){var i=Math.max(e.startSN,t.startSN)-t.startSN,n=Math.min(e.endSN,t.endSN)-t.startSN,o=t.startSN-e.startSN,a=e.fragments,u=t.fragments,l=0,c=void 0;if(t.initSegment&&e.initSegment&&(t.initSegment=e.initSegment),n<i)return void(t.PTSKnown=!1);for(var h=i;h<=n;h++){var d=a[o+h],f=u[h];f&&d&&(l=d.cc-f.cc,isNaN(d.startPTS)||(f.start=f.startPTS=d.startPTS,f.endPTS=d.endPTS,f.duration=d.duration,f.backtracked=d.backtracked,f.dropped=d.dropped,c=f))}if(l)for(s.b.log("discontinuity sliding from playlist, take drift into account"),h=0;h<u.length;h++)u[h].cc+=l;if(c)r(t,c,c.startPTS,c.endPTS,c.startDTS,c.endDTS);else if(o>=0&&o<a.length){var p=a[o].start;for(h=0;h<u.length;h++)u[h].start+=p}t.PTSKnown=e.PTSKnown}t.b=r,t.a=o;var s=i(0)},function(e,t,i){"use strict";var n={toString:function(e){for(var t="",i=e.length,n=0;n<i;n++)t+="["+e.start(n).toFixed(3)+","+e.end(n).toFixed(3)+"]";return t}};t.a=n},function(e,t,i){"use strict";function n(e,t){for(var i=null,n=0;n<e.length;n+=1){var r=e[n];if(r&&r.cc===t){i=r;break}}return i}function r(e,t){return l.a.search(e,function(e){return e.cc<t?1:e.cc>t?-1:0})}function o(e,t,i){var n=!1;return t&&t.details&&i&&(i.endCC>i.startCC||e&&e.cc<i.startCC)&&(n=!0),n}function s(e,t){var i=e.fragments,r=t.fragments;if(!r.length||!i.length)return void c.b.log("No fragments to align");var o=n(i,r[0].cc);return!o||o&&!o.startPTS?void c.b.log("No frag in previous level to align on"):o}function a(e,t){t.fragments.forEach(function(t){if(t){var i=t.start+e;t.start=t.startPTS=i,t.endPTS=i+t.duration}}),t.PTSKnown=!0}function u(e,t,i){if(o(e,t,i)){var n=s(t.details,i);n&&(c.b.log("Adjusting PTS using last level due to CC increase within current level"),a(n.start,i))}if(!1===i.PTSKnown&&t&&t.details&&t.details.fragments&&t.details.fragments.length){var r=t.details.programDateTime,u=i.programDateTime,l=(u-r)/1e3+t.details.fragments[0].start;isNaN(l)||(c.b.log("adjusting PTS using programDateTime delta, sliding:"+l.toFixed(3)),a(l,i))}}t.b=r,t.a=u;var l=i(7),c=i(0)},function(e,t,i){"use strict";function n(e,t){var i=null;try{i=new window.Event("addtrack")}catch(e){i=document.createEvent("Event"),i.initEvent("addtrack",!1,!1)}i.track=e,t.dispatchEvent(i)}function r(e){if(e&&e.cues)for(;e.cues.length>0;)e.removeCue(e.cues[0])}t.b=n,t.a=r},function(e,t,i){"use strict";function n(){this.window=window,this.state="INITIAL",this.buffer="",this.decoder=new c,this.regionList=[]}function r(e){function t(e,t,i,n){return 3600*(0|e)+60*(0|t)+(0|i)+(0|n)/1e3}var i=e.match(/^(\d+):(\d{2})(:\d{2})?\.(\d{3})/);return i?i[3]?t(i[1],i[2],i[3].replace(":",""),i[4]):i[1]>59?t(i[1],i[2],0,i[4]):t(0,i[1],i[2],i[4]):null}function o(){this.values=Object.create(null)}function s(e,t,i,n){var r=n?e.split(n):[e];for(var o in r)if("string"==typeof r[o]){var s=r[o].split(i);if(2===s.length){var a=s[0],u=s[1];t(a,u)}}}function a(e,t,i){function n(){var t=r(e);if(null===t)throw new Error("Malformed timestamp: "+u);return e=e.replace(/^[^\sa-zA-Z-]+/,""),t}function a(){e=e.replace(/^\s+/,"")}var u=e;if(a(),t.startTime=n(),a(),"--\x3e"!==e.substr(0,3))throw new Error("Malformed time stamp (time stamps must be separated by '--\x3e'): "+u);e=e.substr(3),a(),t.endTime=n(),a(),function(e,t){var n=new o;s(e,function(e,t){switch(e){case"region":for(var r=i.length-1;r>=0;r--)if(i[r].id===t){n.set(e,i[r].region);break}break;case"vertical":n.alt(e,t,["rl","lr"]);break;case"line":var o=t.split(","),s=o[0];n.integer(e,s),n.percent(e,s)&&n.set("snapToLines",!1),n.alt(e,s,["auto"]),2===o.length&&n.alt("lineAlign",o[1],["start",d,"end"]);break;case"position":o=t.split(","),n.percent(e,o[0]),2===o.length&&n.alt("positionAlign",o[1],["start",d,"end","line-left","line-right","auto"]);break;case"size":n.percent(e,t);break;case"align":n.alt(e,t,["start",d,"end","left","right"])}},/:/,/\s/),t.region=n.get("region",null),t.vertical=n.get("vertical","");var r=n.get("line","auto");"auto"===r&&-1===h.line&&(r=-1),t.line=r,t.lineAlign=n.get("lineAlign","start"),t.snapToLines=n.get("snapToLines",!0),t.size=n.get("size",100),t.align=n.get("align",d);var a=n.get("position","auto");"auto"===a&&50===h.position&&(a="start"===t.align||"left"===t.align?0:"end"===t.align||"right"===t.align?100:50),t.position=a}(e,t)}function u(e){return e.replace(/<br(?: \/)?>/gi,"\n")}i.d(t,"b",function(){return u});var l=i(61),c=function(){return{decode:function(e){if(!e)return"";if("string"!=typeof e)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}};o.prototype={set:function(e,t){this.get(e)||""===t||(this.values[e]=t)},get:function(e,t,i){return i?this.has(e)?this.values[e]:t[i]:this.has(e)?this.values[e]:t},has:function(e){return e in this.values},alt:function(e,t,i){for(var n=0;n<i.length;++n)if(t===i[n]){this.set(e,t);break}},integer:function(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))},percent:function(e,t){return!!(t.match(/^([\d]{1,3})(\.[\d]*)?%$/)&&(t=parseFloat(t))>=0&&t<=100)&&(this.set(e,t),!0)}};var h=new l.a(0,0,0),d="middle"===h.align?"middle":"center";n.prototype={parse:function(e){function t(){var e=i.buffer,t=0;for(e=u(e);t<e.length&&"\r"!==e[t]&&"\n"!==e[t];)++t;var n=e.substr(0,t);return"\r"===e[t]&&++t,"\n"===e[t]&&++t,i.buffer=e.substr(t),n}var i=this;e&&(i.buffer+=i.decoder.decode(e,{stream:!0}));try{var n=void 0;if("INITIAL"===i.state){if(!/\r\n|\n/.test(i.buffer))return this;n=t();var r=n.match(/^()?WEBVTT([ \t].*)?$/);if(!r||!r[0])throw new Error("Malformed WebVTT signature.");i.state="HEADER"}for(var o=!1;i.buffer;){if(!/\r\n|\n/.test(i.buffer))return this;switch(o?o=!1:n=t(),i.state){case"HEADER":/:/.test(n)?function(e){s(e,function(e,t){switch(e){case"Region":console.log("parse region",t)}},/:/)}(n):n||(i.state="ID");continue;case"NOTE":n||(i.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(n)){i.state="NOTE";break}if(!n)continue;if(i.cue=new l.a(0,0,""),i.state="CUE",-1===n.indexOf("--\x3e")){i.cue.id=n;continue}case"CUE":try{a(n,i.cue,i.regionList)}catch(e){i.cue=null,i.state="BADCUE";continue}i.state="CUETEXT";continue;case"CUETEXT":var c=-1!==n.indexOf("--\x3e");if(!n||c&&(o=!0)){i.oncue&&i.oncue(i.cue),i.cue=null,i.state="ID";continue}i.cue.text&&(i.cue.text+="\n"),i.cue.text+=n;continue;case"BADCUE":n||(i.state="ID");continue}}}catch(e){"CUETEXT"===i.state&&i.cue&&i.oncue&&i.oncue(i.cue),i.cue=null,i.state="INITIAL"===i.state?"BADWEBVTT":"BADCUE"}return this},flush:function(){var e=this;try{if(e.buffer+=e.decoder.decode(),(e.cue||"HEADER"===e.state)&&(e.buffer+="\n\n",e.parse()),"INITIAL"===e.state)throw new Error("Malformed WebVTT signature.")}catch(e){throw e}return e.onflush&&e.onflush(),this}},t.a=n},function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=i(4),o=i.n(r),s=i(2),a=i(14),u=i(30),l=i(31),c=i(32),h=i(47),d=i(48),f=i(49),p=i(0),g=i(50),m=i(12),v=i(1),y=i(10),b=i.n(y),w=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();i(70);var E=function(){function e(){var t=this,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};n(this,e);var r=e.DefaultConfig;if((i.liveSyncDurationCount||i.liveMaxLatencyDurationCount)&&(i.liveSyncDuration||i.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");for(var o in r)o in i||(i[o]=r[o]);if(void 0!==i.liveMaxLatencyDurationCount&&i.liveMaxLatencyDurationCount<=i.liveSyncDurationCount)throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be gt "liveSyncDurationCount"');if(void 0!==i.liveMaxLatencyDuration&&(i.liveMaxLatencyDuration<=i.liveSyncDuration||void 0===i.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be gt "liveSyncDuration"');Object(p.a)(i.debug),this.config=i,this._autoLevelCapping=-1;var s=this.observer=new b.a;s.trigger=function(e){for(var t=arguments.length,i=Array(t>1?t-1:0),n=1;n<t;n++)i[n-1]=arguments[n];s.emit.apply(s,[e,e].concat(i))},s.off=function(e){for(var t=arguments.length,i=Array(t>1?t-1:0),n=1;n<t;n++)i[n-1]=arguments[n];s.removeListener.apply(s,[e].concat(i))},this.on=s.on.bind(s),this.off=s.off.bind(s),this.trigger=s.trigger.bind(s);var f=this.abrController=new i.abrController(this),g=new i.bufferController(this),v=new i.capLevelController(this),y=new i.fpsController(this),w=new a.a(this),E=new u.a(this),_=new l.a(this),T=new d.a(this),S=this.levelController=new h.a(this),A=new m.b(this),P=this.streamController=new c.a(this,A),I=[S,P],x=i.audioStreamController;x&&I.push(new x(this,A)),this.networkControllers=I;var C=[w,E,_,f,g,v,y,T,A];if(x=i.audioTrackController){var R=new x(this);this.audioTrackController=R,C.push(R)}if(x=i.subtitleTrackController){var k=new x(this);this.subtitleTrackController=k,C.push(k)}if(x=i.emeController){var O=new x(this);this.emeController=O,C.push(O)}[i.subtitleStreamController,i.timelineController].forEach(function(e){e&&C.push(new e(t))}),this.coreComponents=C}return e.isSupported=function(){return Object(f.a)()},w(e,null,[{key:"version",get:function(){return"0.9.1"}},{key:"Events",get:function(){return v.a}},{key:"ErrorTypes",get:function(){return s.b}},{key:"ErrorDetails",get:function(){return s.a}},{key:"DefaultConfig",get:function(){return e.defaultConfig?e.defaultConfig:g.a},set:function(t){e.defaultConfig=t}}]),e.prototype.destroy=function(){p.b.log("destroy"),this.trigger(v.a.DESTROYING),this.detachMedia(),this.coreComponents.concat(this.networkControllers).forEach(function(e){e.destroy()}),this.url=null,this.observer.removeAllListeners(),this._autoLevelCapping=-1},e.prototype.attachMedia=function(e){p.b.log("attachMedia"),this.media=e,this.trigger(v.a.MEDIA_ATTACHING,{media:e})},e.prototype.detachMedia=function(){p.b.log("detachMedia"),this.trigger(v.a.MEDIA_DETACHING),this.media=null},e.prototype.loadSource=function(e){e=o.a.buildAbsoluteURL(window.location.href,e,{alwaysNormalize:!0}),p.b.log("loadSource:"+e),this.url=e,this.trigger(v.a.MANIFEST_LOADING,{url:e})},e.prototype.startLoad=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;p.b.log("startLoad("+e+")"),this.networkControllers.forEach(function(t){t.startLoad(e)})},e.prototype.stopLoad=function(){p.b.log("stopLoad"),this.networkControllers.forEach(function(e){e.stopLoad()})},e.prototype.swapAudioCodec=function(){p.b.log("swapAudioCodec"),this.streamController.swapAudioCodec()},e.prototype.recoverMediaError=function(){p.b.log("recoverMediaError");var e=this.media;this.detachMedia(),this.attachMedia(e)},w(e,[{key:"levels",get:function(){return this.levelController.levels}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(e){p.b.log("set currentLevel:"+e),this.loadLevel=e,this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(e){p.b.log("set nextLevel:"+e),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(e){p.b.log("set loadLevel:"+e),this.levelController.manualLevel=e}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(e){this.levelController.nextLoadLevel=e}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(e){p.b.log("set firstLevel:"+e),this.levelController.firstLevel=e}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(e){p.b.log("set startLevel:"+e);var t=this;-1!==e&&(e=Math.max(e,t.minAutoLevel)),t.levelController.startLevel=e}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(e){p.b.log("set autoLevelCapping:"+e),this._autoLevelCapping=e}},{key:"autoLevelEnabled",get:function(){return-1===this.levelController.manualLevel}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){for(var e=this,t=e.levels,i=e.config.minAutoBitrate,n=t?t.length:0,r=0;r<n;r++)if((t[r].realBitrate?Math.max(t[r].realBitrate,t[r].bitrate):t[r].bitrate)>i)return r;return 0}},{key:"maxAutoLevel",get:function(){var e=this,t=e.levels,i=e.autoLevelCapping;return-1===i&&t&&t.length?t.length-1:i}},{key:"nextAutoLevel",get:function(){var e=this;return Math.min(Math.max(e.abrController.nextAutoLevel,e.minAutoLevel),e.maxAutoLevel)},set:function(e){var t=this;t.abrController.nextAutoLevel=Math.max(t.minAutoLevel,e)}},{key:"audioTracks",get:function(){var e=this.audioTrackController;return e?e.audioTracks:[]}},{key:"audioTrack",get:function(){var e=this.audioTrackController;return e?e.audioTrack:-1},set:function(e){var t=this.audioTrackController;t&&(t.audioTrack=e)}},{key:"liveSyncPosition",get:function(){return this.streamController.liveSyncPosition}},{key:"subtitleTracks",get:function(){var e=this.subtitleTrackController;return e?e.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var e=this.subtitleTrackController;return e?e.subtitleTrack:-1},set:function(e){var t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}},{key:"subtitleDisplay",get:function(){var e=this.subtitleTrackController;return!!e&&e.subtitleDisplay},set:function(e){var t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}}]),e}();t.default=E},function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=i(4),o=i.n(r),s=i(6),a=i(16),u=i(29),l=i(0),c=i(17),h=/#EXT-X-STREAM-INF:([^\n\r]*)[\r\n]+([^\r\n]+)/g,d=/#EXT-X-MEDIA:(.*)/g,f=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/|(?!#)(\S+)/.source,/|#EXT-X-BYTERANGE:*(.+)/.source,/|#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/|#.*/.source].join(""),"g"),p=/(?:(?:#(EXTM3U))|(?:#EXT-X-(PLAYLIST-TYPE):(.+))|(?:#EXT-X-(MEDIA-SEQUENCE): *(\d+))|(?:#EXT-X-(TARGETDURATION): *(\d+))|(?:#EXT-X-(KEY):(.+))|(?:#EXT-X-(START):(.+))|(?:#EXT-X-(ENDLIST))|(?:#EXT-X-(DISCONTINUITY-SEQ)UENCE:(\d+))|(?:#EXT-X-(DIS)CONTINUITY))|(?:#EXT-X-(VERSION):(\d+))|(?:#EXT-X-(MAP):(.+))|(?:(#)(.*):(.*))|(?:(#)(.*))(?:.*)\r?\n?/,g=function(){function e(){n(this,e)}return e.findGroup=function(e,t){if(!e)return null;for(var i=null,n=0;n<e.length;n++){var r=e[n];r.id===t&&(i=r)}return i},e.convertAVC1ToAVCOTI=function(e){var t=void 0,i=e.split(".");return i.length>2?(t=i.shift()+".",t+=parseInt(i.shift()).toString(16),t+=("000"+parseInt(i.shift()).toString(16)).substr(-4)):t=e,t},e.resolve=function(e,t){return o.a.buildAbsoluteURL(t,e,{alwaysNormalize:!0})},e.parseMasterPlaylist=function(t,i){var n=[],r=void 0;for(h.lastIndex=0;null!=(r=h.exec(t));){var o={},s=o.attrs=new u.a(r[1]);o.url=e.resolve(r[2],i);var a=s.decimalResolution("RESOLUTION");a&&(o.width=a.width,o.height=a.height),o.bitrate=s.decimalInteger("AVERAGE-BANDWIDTH")||s.decimalInteger("BANDWIDTH"),o.name=s.NAME,function(e,t){["video","audio"].forEach(function(i){var n=e.filter(function(e){return Object(c.b)(e,i)});if(n.length){var r=n.filter(function(e){return 0===e.lastIndexOf("avc1",0)||0===e.lastIndexOf("mp4a",0)});t[i+"Codec"]=r.length>0?r[0]:n[0],e=e.filter(function(e){return-1===n.indexOf(e)})}}),t.unknownCodecs=e}([].concat((s.CODECS||"").split(/[ ,]+/)),o),o.videoCodec&&-1!==o.videoCodec.indexOf("avc1")&&(o.videoCodec=e.convertAVC1ToAVCOTI(o.videoCodec)),n.push(o)}return n},e.parseMasterPlaylistMedia=function(t,i,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],o=void 0,s=[],a=0;for(d.lastIndex=0;null!==(o=d.exec(t));){var l={},c=new u.a(o[1]);if(c.TYPE===n){if(l.groupId=c["GROUP-ID"],l.name=c.NAME,l.type=n,l.default="YES"===c.DEFAULT,l.autoselect="YES"===c.AUTOSELECT,l.forced="YES"===c.FORCED,c.URI&&(l.url=e.resolve(c.URI,i)),l.lang=c.LANGUAGE,l.name||(l.name=l.lang),r.length){var h=e.findGroup(r,l.groupId);l.audioCodec=h?h.codec:r[0].codec}l.id=a++,s.push(l)}}return s},e.parseLevelPlaylist=function(e,t,i,n){var r=0,o=0,c={type:null,version:null,url:t,fragments:[],live:!0,startSN:0},h=new a.a,d=0,g=null,m=new s.a,v=void 0,y=void 0;for(f.lastIndex=0;null!==(v=f.exec(e));){var b=v[1];if(b){m.duration=parseFloat(b);var w=(" "+v[2]).slice(1);m.title=w||null,m.tagList.push(w?["INF",b,w]:["INF",b])}else if(v[3]){if(!isNaN(m.duration)){var E=r++;m.type=n,m.start=o,m.levelkey=h,m.sn=E,m.level=i,m.cc=d,m.baseurl=t,m.relurl=(" "+v[3]).slice(1),c.programDateTime&&(g?m.rawProgramDateTime?m.pdt=Date.parse(m.rawProgramDateTime):m.pdt=g.pdt+1e3*g.duration:m.pdt=Date.parse(c.programDateTime),m.endPdt=m.pdt+1e3*m.duration),c.fragments.push(m),g=m,o+=m.duration,m=new s.a}}else if(v[4]){if(m.rawByteRange=(" "+v[4]).slice(1),g){var _=g.byteRangeEndOffset;_&&(m.lastByteRangeEndOffset=_)}}else if(v[5])m.rawProgramDateTime=(" "+v[5]).slice(1),m.tagList.push(["PROGRAM-DATE-TIME",m.rawProgramDateTime]),void 0===c.programDateTime&&(c.programDateTime=new Date(new Date(Date.parse(v[5]))-1e3*o));else{for(v=v[0].match(p),y=1;y<v.length&&void 0===v[y];y++);var T=(" "+v[y+1]).slice(1),S=(" "+v[y+2]).slice(1);switch(v[y]){case"#":m.tagList.push(S?[T,S]:[T]);break;case"PLAYLIST-TYPE":c.type=T.toUpperCase();break;case"MEDIA-SEQUENCE":r=c.startSN=parseInt(T);break;case"TARGETDURATION":c.targetduration=parseFloat(T);break;case"VERSION":c.version=parseInt(T);break;case"EXTM3U":break;case"ENDLIST":c.live=!1;break;case"DIS":d++,m.tagList.push(["DIS"]);break;case"DISCONTINUITY-SEQ":d=parseInt(T);break;case"KEY":var A=T,P=new u.a(A),I=P.enumeratedString("METHOD"),x=P.URI,C=P.hexadecimalInteger("IV");I&&(h=new a.a,x&&["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(I)>=0&&(h.method=I,h.baseuri=t,h.reluri=x,h.key=null,h.iv=C));break;case"START":var R=T,k=new u.a(R),O=k.decimalFloatingPoint("TIME-OFFSET");isNaN(O)||(c.startTimeOffset=O);break;case"MAP":var L=new u.a(T);m.relurl=L.URI,m.rawByteRange=L.BYTERANGE,m.baseurl=t,m.level=i,m.type=n,m.sn="initSegment",c.initSegment=m,m=new s.a;break;default:l.b.warn("line parsed but not handled: "+v)}}}return m=g,m&&!m.relurl&&(c.fragments.pop(),o-=m.duration),c.totalduration=o,c.averagetargetduration=o/c.fragments.length,c.endSN=r-1,c.startCC=c.fragments[0]?c.fragments[0].cc:0,c.endCC=d,!c.initSegment&&c.fragments.length&&c.fragments.every(function(e){return e.relurl.endsWith(".mp4")})&&(l.b.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),m=new s.a,m.relurl=c.fragments[0].relurl,m.baseurl=t,m.level=i,m.type=n,m.sn="initSegment",c.initSegment=m,c.needSidxRanges=!0),c},e}();t.a=g},function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=/^(\d+)x(\d+)$/,o=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,s=function(){function e(t){n(this,e),"string"==typeof t&&(t=e.parseAttrList(t));for(var i in t)t.hasOwnProperty(i)&&(this[i]=t[i])}return e.prototype.decimalInteger=function(e){var t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t},e.prototype.hexadecimalInteger=function(e){if(this[e]){var t=(this[e]||"0x").slice(2);t=(1&t.length?"0":"")+t;for(var i=new Uint8Array(t.length/2),n=0;n<t.length/2;n++)i[n]=parseInt(t.slice(2*n,2*n+2),16);return i}return null},e.prototype.hexadecimalIntegerAsNumber=function(e){var t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t},e.prototype.decimalFloatingPoint=function(e){return parseFloat(this[e])},e.prototype.enumeratedString=function(e){return this[e]},e.prototype.decimalResolution=function(e){var t=r.exec(this[e]);if(null!==t)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}},e.parseAttrList=function(e){var t=void 0,i={};for(o.lastIndex=0;null!==(t=o.exec(e));){var n=t[2];0===n.indexOf('"')&&n.lastIndexOf('"')===n.length-1&&(n=n.slice(1,-1)),i[t[1]]=n}return i},e}();t.a=s},function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=i(1),a=i(3),u=i(2),l=i(0),c=function(e){function t(i){n(this,t);var o=r(this,e.call(this,i,s.a.FRAG_LOADING));return o.loaders={},o}return o(t,e),t.prototype.destroy=function(){var t=this.loaders;for(var i in t){var n=t[i];n&&n.destroy()}this.loaders={},e.prototype.destroy.call(this)},t.prototype.onFragLoading=function(e){var t=e.frag,i=t.type,n=this.loaders,r=this.hls.config,o=r.fLoader,s=r.loader;t.loaded=0;var a=n[i];a&&(l.b.warn("abort previous fragment loader for type: "+i),a.abort()),a=n[i]=t.loader=r.fLoader?new o(r):new s(r);var u=void 0,c=void 0,h=void 0;u={url:t.url,frag:t,responseType:"arraybuffer",progressData:!1};var d=t.byteRangeStartOffset,f=t.byteRangeEndOffset;isNaN(d)||isNaN(f)||(u.rangeStart=d,u.rangeEnd=f),c={timeout:r.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:r.fragLoadingMaxRetryTimeout},h={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this),onProgress:this.loadprogress.bind(this)},a.load(u,c,h)},t.prototype.loadsuccess=function(e,t,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=e.data,o=i.frag;o.loader=void 0,this.loaders[o.type]=void 0,this.hls.trigger(s.a.FRAG_LOADED,{payload:r,frag:o,stats:t,networkDetails:n})},t.prototype.loaderror=function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=t.loader;n&&n.abort(),this.loaders[t.type]=void 0,this.hls.trigger(s.a.ERROR,{type:u.b.NETWORK_ERROR,details:u.a.FRAG_LOAD_ERROR,fatal:!1,frag:t.frag,response:e,networkDetails:i})},t.prototype.loadtimeout=function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=t.loader;n&&n.abort(),this.loaders[t.type]=void 0,this.hls.trigger(s.a.ERROR,{type:u.b.NETWORK_ERROR,details:u.a.FRAG_LOAD_TIMEOUT,fatal:!1,frag:t.frag,networkDetails:i})},t.prototype.loadprogress=function(e,t,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=t.frag;r.loaded=e.loaded,this.hls.trigger(s.a.FRAG_LOAD_PROGRESS,{frag:r,stats:e,networkDetails:n})},t}(a.a);t.a=c},function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=i(1),a=i(3),u=i(2),l=i(0),c=function(e){function t(i){n(this,t);var o=r(this,e.call(this,i,s.a.KEY_LOADING));return o.loaders={},o.decryptkey=null,o.decrypturl=null,o}return o(t,e),t.prototype.destroy=function(){for(var e in this.loaders){var t=this.loaders[e];t&&t.destroy()}this.loaders={},a.a.prototype.destroy.call(this)},t.prototype.onKeyLoading=function(e){var t=e.frag,i=t.type,n=this.loaders[i],r=t.decryptdata,o=r.uri;if(o!==this.decrypturl||null===this.decryptkey){var a=this.hls.config;n&&(l.b.warn("abort previous key loader for type:"+i),n.abort()),t.loader=this.loaders[i]=new a.loader(a),this.decrypturl=o,this.decryptkey=null;var u=void 0,c=void 0,h=void 0;u={url:o,frag:t,responseType:"arraybuffer"},c={timeout:a.fragLoadingTimeOut,maxRetry:a.fragLoadingMaxRetry,retryDelay:a.fragLoadingRetryDelay,maxRetryDelay:a.fragLoadingMaxRetryTimeout},h={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)},t.loader.load(u,c,h)}else this.decryptkey&&(r.key=this.decryptkey,this.hls.trigger(s.a.KEY_LOADED,{frag:t}))},t.prototype.loadsuccess=function(e,t,i){var n=i.frag;this.decryptkey=n.decryptdata.key=new Uint8Array(e.data),n.loader=void 0,this.loaders[n.type]=void 0,this.hls.trigger(s.a.KEY_LOADED,{frag:n})},t.prototype.loaderror=function(e,t){var i=t.frag,n=i.loader;n&&n.abort(),this.loaders[t.type]=void 0,this.hls.trigger(s.a.ERROR,{type:u.b.NETWORK_ERROR,details:u.a.KEY_LOAD_ERROR,fatal:!1,frag:i,response:e})},t.prototype.loadtimeout=function(e,t){var i=t.frag,n=i.loader;n&&n.abort(),this.loaders[t.type]=void 0,this.hls.trigger(s.a.ERROR,{type:u.b.NETWORK_ERROR,details:u.a.KEY_LOAD_TIMEOUT,fatal:!1,frag:i})},t}(a.a);t.a=c},function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=i(7),a=i(8),u=i(18),l=i(1),c=i(12),h=i(6),d=i(14),f=i(22),p=i(23),g=i(2),m=i(0),v=i(24),y=i(13),b=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),w={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_LEVEL:"WAITING_LEVEL",PARSING:"PARSING",PARSED:"PARSED",BUFFER_FLUSHING:"BUFFER_FLUSHING",ENDED:"ENDED",ERROR:"ERROR"},E=function(e){function t(i,o){n(this,t);var s=r(this,e.call(this,i,l.a.MEDIA_ATTACHED,l.a.MEDIA_DETACHING,l.a.MANIFEST_LOADING,l.a.MANIFEST_PARSED,l.a.LEVEL_LOADED,l.a.KEY_LOADED,l.a.FRAG_LOADED,l.a.FRAG_LOAD_EMERGENCY_ABORTED,l.a.FRAG_PARSING_INIT_SEGMENT,l.a.FRAG_PARSING_DATA,l.a.FRAG_PARSED,l.a.ERROR,l.a.AUDIO_TRACK_SWITCHING,l.a.AUDIO_TRACK_SWITCHED,l.a.BUFFER_CREATED,l.a.BUFFER_APPENDED,l.a.BUFFER_FLUSHED));return s.fragmentTracker=o,s.config=i.config,s.audioCodecSwap=!1,s._state=w.STOPPED,s}return o(t,e),t.prototype.onHandlerDestroying=function(){this.stopLoad()},t.prototype.onHandlerDestroyed=function(){this.state=w.STOPPED,this.fragmentTracker=null},t.prototype.startLoad=function(e){if(this.levels){var t=this.lastCurrentTime,i=this.hls;if(this.stopLoad(),this.setInterval(100),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var n=i.startLevel;-1===n&&(n=0,this.bitrateTest=!0),this.level=i.nextLoadLevel=n,this.loadedmetadata=!1}t>0&&-1===e&&(m.b.log("override startPosition with lastCurrentTime @"+t.toFixed(3)),e=t),this.state=w.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}else this.forceStartLoad=!0,this.state=w.STOPPED},t.prototype.stopLoad=function(){var e=this.fragCurrent;e&&(e.loader&&e.loader.abort(),this.fragmentTracker.removeFragment(e),this.fragCurrent=null),this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.clearInterval(),this.state=w.STOPPED,this.forceStartLoad=!1},t.prototype.doTick=function(){switch(this.state){case w.BUFFER_FLUSHING:this.fragLoadError=0;break;case w.IDLE:this._doTickIdle();break;case w.WAITING_LEVEL:var e=this.levels[this.level];e&&e.details&&(this.state=w.IDLE);break;case w.FRAG_LOADING_WAITING_RETRY:var t=performance.now(),i=this.retryDate;(!i||t>=i||this.media&&this.media.seeking)&&(m.b.log("mediaController: retryDate reached, switch back to IDLE state"),this.state=w.IDLE);break;case w.ERROR:case w.STOPPED:case w.FRAG_LOADING:case w.PARSING:case w.PARSED:case w.ENDED:}this._checkBuffer(),this._checkFragmentChanged()},t.prototype._doTickIdle=function(){var e=this.hls,t=e.config,i=this.media;if(void 0!==this.levelLastLoaded&&(i||!this.startFragRequested&&t.startFragPrefetch)){var n=void 0;n=this.loadedmetadata?i.currentTime:this.nextLoadPosition;var r=e.nextLoadLevel,o=this.levels[r];if(o){var s=o.bitrate,u=void 0;u=s?Math.max(8*t.maxBufferSize/s,t.maxBufferLength):t.maxBufferLength,
u=Math.min(u,t.maxMaxBufferLength);var c=a.a.bufferInfo(this.mediaBuffer?this.mediaBuffer:i,n,t.maxBufferHole),h=c.len;if(!(h>=u)){m.b.trace("buffer length of "+h.toFixed(3)+" is below max of "+u.toFixed(3)+". checking for more payload ..."),this.level=e.nextLoadLevel=r;var d=o.details;if(void 0===d||!0===d.live&&this.levelLastLoaded!==r)return void(this.state=w.WAITING_LEVEL);var f=this.fragPrevious;if(!d.live&&f&&!f.backtracked&&f.sn===d.endSN&&!c.nextStart&&Math.min(i.duration,f.start+f.duration)-Math.max(c.end,f.start)<=Math.max(.2,f.duration)){var p={};return this.altAudio&&(p.type="video"),this.hls.trigger(l.a.BUFFER_EOS,p),void(this.state=w.ENDED)}this._fetchPayloadOrEos(n,c,d)}}}},t.prototype._fetchPayloadOrEos=function(e,t,i){var n=this.fragPrevious,r=this.level,o=i.fragments,s=o.length;if(0!==s){var a=o[0].start,u=o[s-1].start+o[s-1].duration,l=t.end,c=void 0;if(i.initSegment&&!i.initSegment.data)c=i.initSegment;else if(i.live){var h=this.config.initialLiveManifestSize;if(s<h)return void m.b.warn("Can not start playback of a level, reason: not enough fragments "+s+" < "+h);if(null===(c=this._ensureFragmentAtLivePoint(i,l,a,u,n,o,s)))return}else l<a&&(c=o[0]);c||(c=this._findFragment(a,n,s,o,l,u,i)),c&&this._loadFragmentOrKey(c,r,i,e,l)}},t.prototype._ensureFragmentAtLivePoint=function(e,t,i,n,r,o,a){var u=this.hls.config,l=this.media,c=void 0,h=void 0!==u.liveMaxLatencyDuration?u.liveMaxLatencyDuration:u.liveMaxLatencyDurationCount*e.targetduration;if(t<Math.max(i-u.maxFragLookUpTolerance,n-h)){var d=this.liveSyncPosition=this.computeLivePosition(i,e);m.b.log("buffer end: "+t.toFixed(3)+" is located too far from the end of live sliding playlist, reset currentTime to : "+d.toFixed(3)),t=d,l&&l.readyState&&l.duration>d&&(l.currentTime=d),this.nextLoadPosition=d}if(e.PTSKnown&&t>n&&l&&l.readyState)return null;if(this.startFragRequested&&!e.PTSKnown){if(r)if(e.programDateTime)c=this._findFragmentByPDT(o,r.endPdt+1);else{var f=r.sn+1;if(f>=e.startSN&&f<=e.endSN){var p=o[f-e.startSN];r.cc===p.cc&&(c=p,m.b.log("live playlist, switching playlist, load frag with next SN: "+c.sn))}c||(c=s.a.search(o,function(e){return r.cc-e.cc}))&&m.b.log("live playlist, switching playlist, load frag with same CC: "+c.sn)}c||(c=o[Math.min(a-1,Math.round(a/2))],m.b.log("live playlist, switching playlist, unknown, load middle frag : "+c.sn))}return c},t.prototype._findFragmentByPDT=function(e,t){if(!e||void 0===t)return null;if(t<e[0].pdt)return null;if(t>=e[e.length-1].endPdt)return null;for(var i=0;i<e.length;++i){var n=e[i];if(t<n.endPdt)return n}return null},t.prototype._findFragmentBySN=function(e,t,i,n){var r=this.hls.config,o=void 0,a=r.maxFragLookUpTolerance,u=e?t[e.sn-t[0].sn+1]:void 0,l=function(e){var t=Math.min(a,e.duration+(e.deltaPTS?e.deltaPTS:0));return e.start+e.duration-t<=i?1:e.start-t>i&&e.start?-1:0};return i<n&&(i>n-a&&(a=0),o=u&&!l(u)?u:s.a.search(t,l)),o},t.prototype._findFragment=function(e,t,i,n,r,o,s){var a=this.hls.config,u=void 0,l=void 0;if(l=r<o?s.programDateTime?this._findFragmentByPDT(n,1e3*r+(s.programDateTime?Date.parse(s.programDateTime):0)-1e3*e):this._findFragmentBySN(t,n,r,o):n[i-1]){u=l;var c=u.sn-s.startSN,h=t&&u.level===t.level,d=n[c-1],f=n[c+1];if(t&&u.sn===t.sn)if(h&&!u.backtracked)if(u.sn<s.endSN){var p=t.deltaPTS;p&&p>a.maxBufferHole&&t.dropped&&c?(u=d,m.b.warn("SN just loaded, with large PTS gap between audio and video, maybe frag is not starting with a keyframe ? load previous one to try to overcome this")):(u=f,m.b.log("SN just loaded, load next one: "+u.sn))}else u=null;else u.backtracked&&(f&&f.backtracked?(m.b.warn("Already backtracked from fragment "+f.sn+", will not backtrack to fragment "+u.sn+". Loading fragment "+f.sn),u=f):(m.b.warn("Loaded fragment with dropped frames, backtracking 1 segment to find a keyframe"),u.dropped=0,d?(u=d,u.backtracked=!0):c&&(u=null)))}return u},t.prototype._loadFragmentOrKey=function(e,t,i,n,r){if(e.decryptdata&&null!=e.decryptdata.uri&&null==e.decryptdata.key)m.b.log("Loading key for "+e.sn+" of ["+i.startSN+" ,"+i.endSN+"],level "+t),this.state=w.KEY_LOADING,this.hls.trigger(l.a.KEY_LOADING,{frag:e});else{m.b.log("Loading "+e.sn+" of ["+i.startSN+" ,"+i.endSN+"],level "+t+", currentTime:"+n.toFixed(3)+",bufferEnd:"+r.toFixed(3));var o=this.fragmentTracker.getState(e);this.fragCurrent=e,this.startFragRequested=!0,isNaN(e.sn)||e.bitrateTest||(this.nextLoadPosition=e.start+e.duration),e.backtracked||o===c.a.NOT_LOADED?(e.autoLevel=this.hls.autoLevelEnabled,e.bitrateTest=this.bitrateTest,this.hls.trigger(l.a.FRAG_LOADING,{frag:e}),this.demuxer||(this.demuxer=new u.a(this.hls,"main")),this.state=w.FRAG_LOADING):o===c.a.APPENDING&&this._reduceMaxBufferLength(e.duration)&&this.fragmentTracker.removeFragment(e)}},t.prototype.getBufferedFrag=function(e){return this.fragmentTracker.getBufferedFrag(e,d.a.LevelType.MAIN)},t.prototype.followingBufferedFrag=function(e){return e?this.getBufferedFrag(e.endPTS+.5):null},t.prototype._checkFragmentChanged=function(){var e=void 0,t=void 0,i=this.media;if(i&&i.readyState&&!1===i.seeking&&(t=i.currentTime,t>i.playbackRate*this.lastCurrentTime&&(this.lastCurrentTime=t),a.a.isBuffered(i,t)?e=this.getBufferedFrag(t):a.a.isBuffered(i,t+.1)&&(e=this.getBufferedFrag(t+.1)),e)){var n=e;if(n!==this.fragPlaying){this.hls.trigger(l.a.FRAG_CHANGED,{frag:n});var r=n.level;this.fragPlaying&&this.fragPlaying.level===r||this.hls.trigger(l.a.LEVEL_SWITCHED,{level:r}),this.fragPlaying=n}}},t.prototype.immediateLevelSwitch=function(){if(m.b.log("immediateLevelSwitch"),!this.immediateSwitch){this.immediateSwitch=!0;var e=this.media,t=void 0;e?(t=e.paused,e.pause()):t=!0,this.previouslyPaused=t}var i=this.fragCurrent;i&&i.loader&&i.loader.abort(),this.fragCurrent=null,this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},t.prototype.immediateLevelSwitchEnd=function(){var e=this.media;e&&e.buffered.length&&(this.immediateSwitch=!1,a.a.isBuffered(e,e.currentTime)&&(e.currentTime-=1e-4),this.previouslyPaused||e.play())},t.prototype.nextLevelSwitch=function(){var e=this.media;if(e&&e.readyState){var t=void 0,i=void 0,n=void 0;if(i=this.getBufferedFrag(e.currentTime),i&&i.startPTS>1&&this.flushMainBuffer(0,i.startPTS-1),e.paused)t=0;else{var r=this.hls.nextLoadLevel,o=this.levels[r],s=this.fragLastKbps;t=s&&this.fragCurrent?this.fragCurrent.duration*o.bitrate/(1e3*s)+1:0}if((n=this.getBufferedFrag(e.currentTime+t))&&(n=this.followingBufferedFrag(n))){var a=this.fragCurrent;a&&a.loader&&a.loader.abort(),this.fragCurrent=null,this.flushMainBuffer(n.maxStartPTS,Number.POSITIVE_INFINITY)}}},t.prototype.flushMainBuffer=function(e,t){this.state=w.BUFFER_FLUSHING;var i={startOffset:e,endOffset:t};this.altAudio&&(i.type="video"),this.hls.trigger(l.a.BUFFER_FLUSHING,i)},t.prototype.onMediaAttached=function(e){var t=this.media=this.mediaBuffer=e.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),this.onvended=this.onMediaEnded.bind(this),t.addEventListener("seeking",this.onvseeking),t.addEventListener("seeked",this.onvseeked),t.addEventListener("ended",this.onvended);var i=this.config;this.levels&&i.autoStartLoad&&this.hls.startLoad(i.startPosition)},t.prototype.onMediaDetaching=function(){var e=this.media;e&&e.ended&&(m.b.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0);var t=this.levels;t&&t.forEach(function(e){e.details&&e.details.fragments.forEach(function(e){e.backtracked=void 0})}),e&&(e.removeEventListener("seeking",this.onvseeking),e.removeEventListener("seeked",this.onvseeked),e.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.stopLoad()},t.prototype.onMediaSeeking=function(){var e=this.media,t=e?e.currentTime:void 0,i=this.config;isNaN(t)||m.b.log("media seeking to "+t.toFixed(3));var n=this.mediaBuffer?this.mediaBuffer:e,r=a.a.bufferInfo(n,t,this.config.maxBufferHole);if(this.state===w.FRAG_LOADING){var o=this.fragCurrent;if(0===r.len&&o){var s=i.maxFragLookUpTolerance,u=o.start-s,l=o.start+o.duration+s;t<u||t>l?(o.loader&&(m.b.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),o.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.state=w.IDLE):m.b.log("seeking outside of buffer but within currently loaded fragment range")}}else this.state===w.ENDED&&(0===r.len&&(this.fragPrevious=0),this.state=w.IDLE);e&&(this.lastCurrentTime=t),this.loadedmetadata||(this.nextLoadPosition=this.startPosition=t),this.tick()},t.prototype.onMediaSeeked=function(){var e=this.media,t=e?e.currentTime:void 0;isNaN(t)||m.b.log("media seeked to "+t.toFixed(3)),this.tick()},t.prototype.onMediaEnded=function(){m.b.log("media ended"),this.startPosition=this.lastCurrentTime=0},t.prototype.onManifestLoading=function(){m.b.log("trigger BUFFER_RESET"),this.hls.trigger(l.a.BUFFER_RESET),this.fragmentTracker.removeAllFragments(),this.stalled=!1,this.startPosition=this.lastCurrentTime=0},t.prototype.onManifestParsed=function(e){var t=!1,i=!1,n=void 0;e.levels.forEach(function(e){(n=e.audioCodec)&&(-1!==n.indexOf("mp4a.40.2")&&(t=!0),-1!==n.indexOf("mp4a.40.5")&&(i=!0))}),this.audioCodecSwitch=t&&i,this.audioCodecSwitch&&m.b.log("both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=e.levels,this.startFragRequested=!1;var r=this.config;(r.autoStartLoad||this.forceStartLoad)&&this.hls.startLoad(r.startPosition)},t.prototype.onLevelLoaded=function(e){var t=e.details,i=e.level,n=this.levels[this.levelLastLoaded],r=this.levels[i],o=t.totalduration,s=0;if(m.b.log("level "+i+" loaded ["+t.startSN+","+t.endSN+"],duration:"+o),t.live){var a=r.details;a&&t.fragments.length>0?(f.a(a,t),s=t.fragments[0].start,this.liveSyncPosition=this.computeLivePosition(s,a),t.PTSKnown&&!isNaN(s)?m.b.log("live playlist sliding:"+s.toFixed(3)):(m.b.log("live playlist - outdated PTS, unknown sliding"),Object(v.a)(this.fragPrevious,n,t))):(m.b.log("live playlist - first load, unknown sliding"),t.PTSKnown=!1,Object(v.a)(this.fragPrevious,n,t))}else t.PTSKnown=!1;if(r.details=t,this.levelLastLoaded=i,this.hls.trigger(l.a.LEVEL_UPDATED,{details:t,level:i}),!1===this.startFragRequested){if(-1===this.startPosition||-1===this.lastCurrentTime){var u=t.startTimeOffset;isNaN(u)?t.live?(this.startPosition=this.computeLivePosition(s,t),m.b.log("configure startPosition to "+this.startPosition)):this.startPosition=0:(u<0&&(m.b.log("negative start time offset "+u+", count from end of last fragment"),u=s+o+u),m.b.log("start time offset found in playlist, adjust startPosition to "+u),this.startPosition=u),this.lastCurrentTime=this.startPosition}this.nextLoadPosition=this.startPosition}this.state===w.WAITING_LEVEL&&(this.state=w.IDLE),this.tick()},t.prototype.onKeyLoaded=function(){this.state===w.KEY_LOADING&&(this.state=w.IDLE,this.tick())},t.prototype.onFragLoaded=function(e){var t=this.fragCurrent,i=e.frag;if(this.state===w.FRAG_LOADING&&t&&"main"===i.type&&i.level===t.level&&i.sn===t.sn){var n=e.stats,r=this.levels[t.level],o=r.details;if(m.b.log("Loaded  "+t.sn+" of ["+o.startSN+" ,"+o.endSN+"],level "+t.level),this.bitrateTest=!1,this.stats=n,!0===i.bitrateTest&&this.hls.nextLoadLevel)this.state=w.IDLE,this.startFragRequested=!1,n.tparsed=n.tbuffered=performance.now(),this.hls.trigger(l.a.FRAG_BUFFERED,{stats:n,frag:t,id:"main"}),this.tick();else if("initSegment"===i.sn)this.state=w.IDLE,n.tparsed=n.tbuffered=performance.now(),o.initSegment.data=e.payload,this.hls.trigger(l.a.FRAG_BUFFERED,{stats:n,frag:t,id:"main"}),this.tick();else{this.state=w.PARSING;var s=o.totalduration,a=t.level,c=t.sn,h=this.config.defaultAudioCodec||r.audioCodec;this.audioCodecSwap&&(m.b.log("swapping playlist audio codec"),void 0===h&&(h=this.lastAudioCodec),h&&(h=-1!==h.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5")),this.pendingBuffering=!0,this.appended=!1,m.b.log("Parsing "+c+" of ["+o.startSN+" ,"+o.endSN+"],level "+a+", cc "+t.cc);var d=this.demuxer;d||(d=this.demuxer=new u.a(this.hls,"main"));var f=this.media,p=f&&f.seeking,g=!p&&(o.PTSKnown||!o.live),v=o.initSegment?o.initSegment.data:[];d.push(e.payload,v,h,r.videoCodec,t,s,g,void 0)}}this.fragLoadError=0},t.prototype.onFragParsingInitSegment=function(e){var t=this.fragCurrent,i=e.frag;if(t&&"main"===e.id&&i.sn===t.sn&&i.level===t.level&&this.state===w.PARSING){var n=e.tracks,r=void 0,o=void 0;if(n.audio&&this.altAudio&&delete n.audio,o=n.audio){var s=this.levels[this.level].audioCodec,a=navigator.userAgent.toLowerCase();s&&this.audioCodecSwap&&(m.b.log("swapping playlist audio codec"),s=-1!==s.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),this.audioCodecSwitch&&1!==o.metadata.channelCount&&-1===a.indexOf("firefox")&&(s="mp4a.40.5"),-1!==a.indexOf("android")&&"audio/mpeg"!==o.container&&(s="mp4a.40.2",m.b.log("Android: force audio codec to "+s)),o.levelCodec=s,o.id=e.id}o=n.video,o&&(o.levelCodec=this.levels[this.level].videoCodec,o.id=e.id),this.hls.trigger(l.a.BUFFER_CODECS,n);for(r in n){o=n[r],m.b.log("main track:"+r+",container:"+o.container+",codecs[level/parsed]=["+o.levelCodec+"/"+o.codec+"]");var u=o.initSegment;u&&(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(l.a.BUFFER_APPENDING,{type:r,data:u,parent:"main",content:"initSegment"}))}this.tick()}},t.prototype.onFragParsingData=function(e){var t=this,i=this.fragCurrent,n=e.frag;if(i&&"main"===e.id&&n.sn===i.sn&&n.level===i.level&&("audio"!==e.type||!this.altAudio)&&this.state===w.PARSING){var r=this.levels[this.level],o=i;if(isNaN(e.endPTS)&&(e.endPTS=e.startPTS+i.duration,e.endDTS=e.startDTS+i.duration),!0===e.hasAudio&&o.addElementaryStream(h.a.ElementaryStreamTypes.AUDIO),!0===e.hasVideo&&o.addElementaryStream(h.a.ElementaryStreamTypes.VIDEO),m.b.log("Parsed "+e.type+",PTS:["+e.startPTS.toFixed(3)+","+e.endPTS.toFixed(3)+"],DTS:["+e.startDTS.toFixed(3)+"/"+e.endDTS.toFixed(3)+"],nb:"+e.nb+",dropped:"+(e.dropped||0)),"video"===e.type)if(o.dropped=e.dropped,o.dropped)if(o.backtracked)m.b.warn("Already backtracked on this fragment, appending with the gap");else{var s=r.details;if(!s||o.sn!==s.startSN)return m.b.warn("missing video frame(s), backtracking fragment"),this.fragmentTracker.removeFragment(o),o.backtracked=!0,this.nextLoadPosition=e.startPTS,this.state=w.IDLE,this.fragPrevious=o,void this.tick();m.b.warn("missing video frame(s) on first frag, appending with gap")}else o.backtracked=!1;var a=f.b(r.details,o,e.startPTS,e.endPTS,e.startDTS,e.endDTS),u=this.hls;u.trigger(l.a.LEVEL_PTS_UPDATED,{details:r.details,level:this.level,drift:a,type:e.type,start:e.startPTS,end:e.endPTS}),[e.data1,e.data2].forEach(function(i){i&&i.length&&t.state===w.PARSING&&(t.appended=!0,t.pendingBuffering=!0,u.trigger(l.a.BUFFER_APPENDING,{type:e.type,data:i,parent:"main",content:"data"}))}),this.tick()}},t.prototype.onFragParsed=function(e){var t=this.fragCurrent,i=e.frag;t&&"main"===e.id&&i.sn===t.sn&&i.level===t.level&&this.state===w.PARSING&&(this.stats.tparsed=performance.now(),this.state=w.PARSED,this._checkAppendedParsed())},t.prototype.onAudioTrackSwitching=function(e){var t=!!e.url,i=e.id;if(!t){if(this.mediaBuffer!==this.media){m.b.log("switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var n=this.fragCurrent;n.loader&&(m.b.log("switching to main audio track, cancel main fragment load"),n.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=w.IDLE}var r=this.hls;r.trigger(l.a.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),r.trigger(l.a.AUDIO_TRACK_SWITCHED,{id:i}),this.altAudio=!1}},t.prototype.onAudioTrackSwitched=function(e){var t=e.id,i=!!this.hls.audioTracks[t].url;if(i){var n=this.videoBuffer;n&&this.mediaBuffer!==n&&(m.b.log("switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=n)}this.altAudio=i,this.tick()},t.prototype.onBufferCreated=function(e){var t=e.tracks,i=void 0,n=void 0,r=!1;for(var o in t){var s=t[o];"main"===s.id?(n=o,i=s,"video"===o&&(this.videoBuffer=t[o].buffer)):r=!0}r&&i?(m.b.log("alternate track found, use "+n+".buffered to schedule main fragment loading"),this.mediaBuffer=i.buffer):this.mediaBuffer=this.media},t.prototype.onBufferAppended=function(e){if("main"===e.parent){var t=this.state;t!==w.PARSING&&t!==w.PARSED||(this.pendingBuffering=e.pending>0,this._checkAppendedParsed())}},t.prototype._checkAppendedParsed=function(){if(!(this.state!==w.PARSED||this.appended&&this.pendingBuffering)){var e=this.fragCurrent;if(e){var t=this.mediaBuffer?this.mediaBuffer:this.media;m.b.log("main buffered : "+p.a.toString(t.buffered)),this.fragPrevious=e;var i=this.stats;i.tbuffered=performance.now(),this.fragLastKbps=Math.round(8*i.total/(i.tbuffered-i.tfirst)),this.hls.trigger(l.a.FRAG_BUFFERED,{stats:i,frag:e,id:"main"}),this.state=w.IDLE}this.tick()}},t.prototype.onError=function(e){var t=e.frag||this.fragCurrent;if(!t||"main"===t.type){var i=!!this.media&&a.a.isBuffered(this.media,this.media.currentTime)&&a.a.isBuffered(this.media,this.media.currentTime+.5);switch(e.details){case g.a.FRAG_LOAD_ERROR:case g.a.FRAG_LOAD_TIMEOUT:case g.a.KEY_LOAD_ERROR:case g.a.KEY_LOAD_TIMEOUT:if(!e.fatal)if(this.fragLoadError+1<=this.config.fragLoadingMaxRetry){var n=Math.min(Math.pow(2,this.fragLoadError)*this.config.fragLoadingRetryDelay,this.config.fragLoadingMaxRetryTimeout);m.b.warn("mediaController: frag loading failed, retry in "+n+" ms"),this.retryDate=performance.now()+n,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.fragLoadError++,this.state=w.FRAG_LOADING_WAITING_RETRY}else m.b.error("mediaController: "+e.details+" reaches max retry, redispatch as fatal ..."),e.fatal=!0,this.state=w.ERROR;break;case g.a.LEVEL_LOAD_ERROR:case g.a.LEVEL_LOAD_TIMEOUT:this.state!==w.ERROR&&(e.fatal?(this.state=w.ERROR,m.b.warn("streamController: "+e.details+",switch to "+this.state+" state ...")):e.levelRetry||this.state!==w.WAITING_LEVEL||(this.state=w.IDLE));break;case g.a.BUFFER_FULL_ERROR:"main"!==e.parent||this.state!==w.PARSING&&this.state!==w.PARSED||(i?(this._reduceMaxBufferLength(this.config.maxBufferLength),this.state=w.IDLE):(m.b.warn("buffer full error also media.currentTime is not buffered, flush everything"),this.fragCurrent=null,this.flushMainBuffer(0,Number.POSITIVE_INFINITY)))}}},t.prototype._reduceMaxBufferLength=function(e){var t=this.config;return t.maxMaxBufferLength>=e&&(t.maxMaxBufferLength/=2,m.b.warn("main:reduce max buffer length to "+t.maxMaxBufferLength+"s"),!0)},t.prototype._checkBuffer=function(){var e=this.media,t=this.config;if(e&&e.readyState){var i=e.currentTime,n=this.mediaBuffer?this.mediaBuffer:e,r=n.buffered;if(!this.loadedmetadata&&r.length){this.loadedmetadata=!0;var o=e.seeking?i:this.startPosition;i!==o&&(m.b.log("target start position not buffered, seek to buffered.start(0) "+o+" from current time"+i+" "),e.currentTime=o)}else if(this.immediateSwitch)this.immediateLevelSwitchEnd();else{var s=a.a.bufferInfo(e,i,t.maxBufferHole),u=!(e.paused&&e.readyState>1||e.ended||0===e.buffered.length),c=i!==this.lastCurrentTime;if(c)this.stallReported&&(m.b.warn("playback not stuck anymore @"+i+", after "+Math.round(performance.now()-this.stalled)+"ms"),this.stallReported=!1),this.stalled=void 0,this.nudgeRetry=0;else if(u){var h=performance.now(),d=this.hls;if(this.stalled){var f=h-this.stalled,p=s.len,v=this.nudgeRetry||0,y=this.fragmentTracker.getPartialFragment(i);if(null!==y)for(var b=0,w=0;w<e.buffered.length;w++){var E=e.buffered.start(w);if(i>=b&&i<E)return e.currentTime=Math.max(E,e.currentTime+.1),m.b.warn("skipping hole, adjusting currentTime from "+i+" to "+e.currentTime),this.stalled=void 0,void d.trigger(l.a.ERROR,{type:g.b.MEDIA_ERROR,details:g.a.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+i+" to "+e.currentTime,frag:y});b=e.buffered.end(w)}if(p>.5&&f>1e3*t.highBufferWatchdogPeriod)if(this.stallReported||(this.stallReported=!0,m.b.warn("playback stalling in high buffer @"+i),d.trigger(l.a.ERROR,{type:g.b.MEDIA_ERROR,details:g.a.BUFFER_STALLED_ERROR,fatal:!1,buffer:p})),this.stalled=void 0,this.nudgeRetry=++v,v<t.nudgeMaxRetry){var _=e.currentTime,T=_+v*t.nudgeOffset;m.b.log("adjust currentTime from "+_+" to "+T),e.currentTime=T,d.trigger(l.a.ERROR,{type:g.b.MEDIA_ERROR,details:g.a.BUFFER_NUDGE_ON_STALL,fatal:!1})}else m.b.error("still stuck in high buffer @"+i+" after "+t.nudgeMaxRetry+", raise fatal error"),d.trigger(l.a.ERROR,{type:g.b.MEDIA_ERROR,details:g.a.BUFFER_STALLED_ERROR,fatal:!0})}else this.stalled=h,this.stallReported=!1}}}},t.prototype.onFragLoadEmergencyAborted=function(){this.state=w.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tick()},t.prototype.onBufferFlushed=function(){var e=this.mediaBuffer?this.mediaBuffer:this.media;this.fragmentTracker.detectEvictedFragments(h.a.ElementaryStreamTypes.VIDEO,e.buffered),this.state=w.IDLE,this.fragPrevious=null},t.prototype.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},t.prototype.computeLivePosition=function(e,t){var i=void 0!==this.config.liveSyncDuration?this.config.liveSyncDuration:this.config.liveSyncDurationCount*t.targetduration;return e+Math.max(0,t.totalduration-i)},b(t,[{key:"state",set:function(e){if(this.state!==e){var t=this.state;this._state=e,m.b.log("main stream:"+t+"->"+e),this.hls.trigger(l.a.STREAM_STATE_TRANSITION,{previousState:t,nextState:e})}},get:function(){return this._state}},{key:"currentLevel",get:function(){var e=this.media;if(e){var t=this.getBufferedFrag(e.currentTime);if(t)return t.level}return-1}},{key:"nextBufferedFrag",get:function(){var e=this.media;return e?this.followingBufferedFrag(this.getBufferedFrag(e.currentTime)):null}},{key:"nextLevel",get:function(){var e=this.nextBufferedFrag;return e?e.level:-1}},{key:"liveSyncPosition",get:function(){return this._liveSyncPosition},set:function(e){this._liveSyncPosition=e}}]),t}(y.a);t.a=E},function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function e(t,i){n(this,e),this.subtle=t,this.aesIV=i}return e.prototype.decrypt=function(e,t){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e)},e}();t.a=r},function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function e(t,i){n(this,e),this.subtle=t,this.key=i}return e.prototype.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},e}();t.a=r},function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e){var t=e.byteLength,i=t&&new DataView(e).getUint8(t-1);return i?e.slice(0,t-i):e}var o=function(){function e(){n(this,e),this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.initTable()}return e.prototype.uint8ArrayToUint32Array_=function(e){for(var t=new DataView(e),i=new Uint32Array(4),n=0;n<4;n++)i[n]=t.getUint32(4*n);return i},e.prototype.initTable=function(){var e=this.sBox,t=this.invSBox,i=this.subMix,n=i[0],r=i[1],o=i[2],s=i[3],a=this.invSubMix,u=a[0],l=a[1],c=a[2],h=a[3],d=new Uint32Array(256),f=0,p=0,g=0;for(g=0;g<256;g++)d[g]=g<128?g<<1:g<<1^283;for(g=0;g<256;g++){var m=p^p<<1^p<<2^p<<3^p<<4;m=m>>>8^255&m^99,e[f]=m,t[m]=f;var v=d[f],y=d[v],b=d[y],w=257*d[m]^16843008*m;n[f]=w<<24|w>>>8,r[f]=w<<16|w>>>16,o[f]=w<<8|w>>>24,s[f]=w,w=16843009*b^65537*y^257*v^16843008*f,u[m]=w<<24|w>>>8,l[m]=w<<16|w>>>16,c[m]=w<<8|w>>>24,h[m]=w,f?(f=v^d[d[d[b^v]]],p^=d[d[p]]):f=p=1}},e.prototype.expandKey=function(e){for(var t=this.uint8ArrayToUint32Array_(e),i=!0,n=0;n<t.length&&i;)i=t[n]===this.key[n],n++;if(!i){this.key=t;var r=this.keySize=t.length;if(4!==r&&6!==r&&8!==r)throw new Error("Invalid aes key size="+r);var o=this.ksRows=4*(r+6+1),s=void 0,a=void 0,u=this.keySchedule=new Uint32Array(o),l=this.invKeySchedule=new Uint32Array(o),c=this.sBox,h=this.rcon,d=this.invSubMix,f=d[0],p=d[1],g=d[2],m=d[3],v=void 0,y=void 0;for(s=0;s<o;s++)s<r?v=u[s]=t[s]:(y=v,s%r==0?(y=y<<8|y>>>24,y=c[y>>>24]<<24|c[y>>>16&255]<<16|c[y>>>8&255]<<8|c[255&y],y^=h[s/r|0]<<24):r>6&&s%r==4&&(y=c[y>>>24]<<24|c[y>>>16&255]<<16|c[y>>>8&255]<<8|c[255&y]),u[s]=v=(u[s-r]^y)>>>0);for(a=0;a<o;a++)s=o-a,y=3&a?u[s]:u[s-4],l[a]=a<4||s<=4?y:f[c[y>>>24]]^p[c[y>>>16&255]]^g[c[y>>>8&255]]^m[c[255&y]],l[a]=l[a]>>>0}},e.prototype.networkToHostOrderSwap=function(e){return e<<24|(65280&e)<<8|(16711680&e)>>8|e>>>24},e.prototype.decrypt=function(e,t,i,n){for(var o=this.keySize+6,s=this.invKeySchedule,a=this.invSBox,u=this.invSubMix,l=u[0],c=u[1],h=u[2],d=u[3],f=this.uint8ArrayToUint32Array_(i),p=f[0],g=f[1],m=f[2],v=f[3],y=new Int32Array(e),b=new Int32Array(y.length),w=void 0,E=void 0,_=void 0,T=void 0,S=void 0,A=void 0,P=void 0,I=void 0,x=void 0,C=void 0,R=void 0,k=void 0,O=void 0,L=void 0,D=this.networkToHostOrderSwap;t<y.length;){for(x=D(y[t]),C=D(y[t+1]),R=D(y[t+2]),k=D(y[t+3]),S=x^s[0],A=k^s[1],P=R^s[2],I=C^s[3],O=4,L=1;L<o;L++)w=l[S>>>24]^c[A>>16&255]^h[P>>8&255]^d[255&I]^s[O],E=l[A>>>24]^c[P>>16&255]^h[I>>8&255]^d[255&S]^s[O+1],_=l[P>>>24]^c[I>>16&255]^h[S>>8&255]^d[255&A]^s[O+2],T=l[I>>>24]^c[S>>16&255]^h[A>>8&255]^d[255&P]^s[O+3],S=w,A=E,P=_,I=T,O+=4;w=a[S>>>24]<<24^a[A>>16&255]<<16^a[P>>8&255]<<8^a[255&I]^s[O],E=a[A>>>24]<<24^a[P>>16&255]<<16^a[I>>8&255]<<8^a[255&S]^s[O+1],_=a[P>>>24]<<24^a[I>>16&255]<<16^a[S>>8&255]<<8^a[255&A]^s[O+2],T=a[I>>>24]<<24^a[S>>16&255]<<16^a[A>>8&255]<<8^a[255&P]^s[O+3],O+=3,b[t]=D(w^p),b[t+1]=D(T^g),b[t+2]=D(_^m),b[t+3]=D(E^v),p=x,g=C,m=R,v=k,t+=4}return n?r(b.buffer):b.buffer},e.prototype.destroy=function(){this.key=void 0,this.keySize=void 0,this.ksRows=void 0,this.sBox=void 0,this.invSBox=void 0,this.subMix=void 0,this.invSubMix=void 0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.rcon=void 0},e}();t.a=o},function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=i(20),o=i(0),s=i(5),a=function(){function e(t,i,r){n(this,e),this.observer=t,this.config=r,this.remuxer=i}return e.prototype.resetInitSegment=function(e,t,i,n){this._audioTrack={container:"audio/adts",type:"audio",id:0,sequenceNumber:0,isAAC:!0,samples:[],len:0,manifestCodec:t,duration:n,inputTimeScale:9e4}},e.prototype.resetTimeStamp=function(){},e.probe=function(e){if(!e)return!1;for(var t=s.a.getID3Data(e,0)||[],i=t.length,n=e.length;i<n;i++)if(r.e(e,i))return o.b.log("ADTS sync word found !"),!0;return!1},e.prototype.append=function(e,t,i,n){for(var a=this._audioTrack,u=s.a.getID3Data(e,0)||[],l=s.a.getTimeStamp(u),c=l?90*l:9e4*t,h=0,d=c,f=e.length,p=u.length,g=[{pts:d,dts:d,data:u}];p<f-1;)if(r.d(e,p)&&p+5<f){r.c(a,this.observer,e,p,a.manifestCodec);var m=r.a(a,e,p,c,h);if(!m){o.b.log("Unable to parse AAC frame");break}p+=m.length,d=m.sample.pts,h++}else s.a.isHeader(e,p)?(u=s.a.getID3Data(e,p),g.push({pts:d,dts:d,data:u}),p+=u.length):p++;this.remuxer.remux(a,{samples:[]},{samples:g,inputTimeScale:9e4},{samples:[]},t,i,n)},e.prototype.destroy=function(){},e}();t.a=a},function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=i(20),o=i(21),s=i(1),a=i(38),u=i(39),l=i(0),c=i(2),h={video:0,audio:1,id3:2,text:3},d=function(){function e(t,i,r,o){n(this,e),this.observer=t,this.config=r,this.typeSupported=o,this.remuxer=i,this.sampleAes=null}return e.prototype.setDecryptData=function(e){null!=e&&null!=e.key&&"SAMPLE-AES"===e.method?this.sampleAes=new u.a(this.observer,this.config,e,this.discardEPB):this.sampleAes=null},e.probe=function(t){var i=e._syncOffset(t);return!(i<0||(i&&l.b.warn("MPEG2-TS detected but first sync word found @ offset "+i+", junk ahead ?"),0))},e._syncOffset=function(e){for(var t=Math.min(1e3,e.length-564),i=0;i<t;){if(71===e[i]&&71===e[i+188]&&71===e[i+376])return i;i++}return-1},e.createTrack=function(e,t){return{container:"video"===e||"audio"===e?"video/mp2t":void 0,type:e,id:h[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],len:0,dropped:"video"===e?0:void 0,isAAC:"audio"===e||void 0,duration:"audio"===e?t:void 0}},e.prototype.resetInitSegment=function(t,i,n,r){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=e.createTrack("video",r),this._audioTrack=e.createTrack("audio",r),this._id3Track=e.createTrack("id3",r),this._txtTrack=e.createTrack("text",r),this.aacOverFlow=null,this.aacLastPTS=null,this.avcSample=null,this.audioCodec=i,this.videoCodec=n,this._duration=r},e.prototype.resetTimeStamp=function(){},e.prototype.append=function(t,i,n,r){var o=void 0,a=t.length,u=void 0,h=void 0,d=void 0,f=void 0,p=!1;this.contiguous=n;var g=this.pmtParsed,m=this._avcTrack,v=this._audioTrack,y=this._id3Track,b=m.pid,w=v.pid,E=y.pid,_=this._pmtId,T=m.pesData,S=v.pesData,A=y.pesData,P=this._parsePAT,I=this._parsePMT,x=this._parsePES,C=this._parseAVCPES.bind(this),R=this._parseAACPES.bind(this),k=this._parseMPEGPES.bind(this),O=this._parseID3PES.bind(this),L=e._syncOffset(t);for(a-=(a+L)%188,o=L;o<a;o+=188)if(71===t[o]){if(u=!!(64&t[o+1]),h=((31&t[o+1])<<8)+t[o+2],(48&t[o+3])>>4>1){if((d=o+5+t[o+4])===o+188)continue}else d=o+4;switch(h){case b:u&&(T&&(f=x(T))&&void 0!==f.pts&&C(f,!1),T={data:[],size:0}),T&&(T.data.push(t.subarray(d,o+188)),T.size+=o+188-d);break;case w:u&&(S&&(f=x(S))&&void 0!==f.pts&&(v.isAAC?R(f):k(f)),S={data:[],size:0}),S&&(S.data.push(t.subarray(d,o+188)),S.size+=o+188-d);break;case E:u&&(A&&(f=x(A))&&void 0!==f.pts&&O(f),A={data:[],size:0}),A&&(A.data.push(t.subarray(d,o+188)),A.size+=o+188-d);break;case 0:u&&(d+=t[d]+1),_=this._pmtId=P(t,d);break;case _:u&&(d+=t[d]+1);var D=I(t,d,!0===this.typeSupported.mpeg||!0===this.typeSupported.mp3,null!=this.sampleAes);b=D.avc,b>0&&(m.pid=b),w=D.audio,w>0&&(v.pid=w,v.isAAC=D.isAAC),E=D.id3,E>0&&(y.pid=E),p&&!g&&(l.b.log("reparse from beginning"),p=!1,o=L-188),g=this.pmtParsed=!0;break;case 17:case 8191:break;default:p=!0}}else this.observer.trigger(s.a.ERROR,{type:c.b.MEDIA_ERROR,details:c.a.FRAG_PARSING_ERROR,fatal:!1,reason:"TS packet did not start with 0x47"});T&&(f=x(T))&&void 0!==f.pts?(C(f,!0),m.pesData=null):m.pesData=T,S&&(f=x(S))&&void 0!==f.pts?(v.isAAC?R(f):k(f),v.pesData=null):(S&&S.size&&l.b.log("last AAC PES packet truncated,might overlap between fragments"),v.pesData=S),A&&(f=x(A))&&void 0!==f.pts?(O(f),y.pesData=null):y.pesData=A,null==this.sampleAes?this.remuxer.remux(v,m,y,this._txtTrack,i,n,r):this.decryptAndRemux(v,m,y,this._txtTrack,i,n,r)},e.prototype.decryptAndRemux=function(e,t,i,n,r,o,s){if(e.samples&&e.isAAC){var a=this;this.sampleAes.decryptAacSamples(e.samples,0,function(){a.decryptAndRemuxAvc(e,t,i,n,r,o,s)})}else this.decryptAndRemuxAvc(e,t,i,n,r,o,s)},e.prototype.decryptAndRemuxAvc=function(e,t,i,n,r,o,s){if(t.samples){var a=this;this.sampleAes.decryptAvcSamples(t.samples,0,0,function(){a.remuxer.remux(e,t,i,n,r,o,s)})}else this.remuxer.remux(e,t,i,n,r,o,s)},e.prototype.destroy=function(){this._initPTS=this._initDTS=void 0,this._duration=0},e.prototype._parsePAT=function(e,t){return(31&e[t+10])<<8|e[t+11]},e.prototype._parsePMT=function(e,t,i,n){var r=void 0,o=void 0,s=void 0,a=void 0,u={audio:-1,avc:-1,id3:-1,isAAC:!0};for(r=(15&e[t+1])<<8|e[t+2],o=t+3+r-4,s=(15&e[t+10])<<8|e[t+11],t+=12+s;t<o;){switch(a=(31&e[t+1])<<8|e[t+2],e[t]){case 207:if(!n){l.b.log("unkown stream type:"+e[t]);break}case 15:-1===u.audio&&(u.audio=a);break;case 21:-1===u.id3&&(u.id3=a);break;case 219:if(!n){l.b.log("unkown stream type:"+e[t]);break}
case 27:-1===u.avc&&(u.avc=a);break;case 3:case 4:i?-1===u.audio&&(u.audio=a,u.isAAC=!1):l.b.log("MPEG audio found, not supported in this browser for now");break;case 36:l.b.warn("HEVC stream type found, not supported for now");break;default:l.b.log("unkown stream type:"+e[t])}t+=5+((15&e[t+3])<<8|e[t+4])}return u},e.prototype._parsePES=function(e){var t=0,i=void 0,n=void 0,r=void 0,o=void 0,s=void 0,a=void 0,u=void 0,c=void 0,h=e.data;if(!e||0===e.size)return null;for(;h[0].length<19&&h.length>1;){var d=new Uint8Array(h[0].length+h[1].length);d.set(h[0]),d.set(h[1],h[0].length),h[0]=d,h.splice(1,1)}if(i=h[0],1===(i[0]<<16)+(i[1]<<8)+i[2]){if((r=(i[4]<<8)+i[5])&&r>e.size-6)return null;n=i[7],192&n&&(a=536870912*(14&i[9])+4194304*(255&i[10])+16384*(254&i[11])+128*(255&i[12])+(254&i[13])/2,a>4294967295&&(a-=8589934592),64&n?(u=536870912*(14&i[14])+4194304*(255&i[15])+16384*(254&i[16])+128*(255&i[17])+(254&i[18])/2,u>4294967295&&(u-=8589934592),a-u>54e5&&(l.b.warn(Math.round((a-u)/9e4)+"s delta between PTS and DTS, align them"),a=u)):u=a),o=i[8],c=o+9,e.size-=c,s=new Uint8Array(e.size);for(var f=0,p=h.length;f<p;f++){i=h[f];var g=i.byteLength;if(c){if(c>g){c-=g;continue}i=i.subarray(c),g-=c,c=0}s.set(i,t),t+=g}return r&&(r-=o+3),{data:s,pts:a,dts:u,len:r}}return null},e.prototype.pushAccesUnit=function(e,t){if(e.units.length&&e.frame){var i=t.samples,n=i.length;!this.config.forceKeyFrameOnDiscontinuity||!0===e.key||t.sps&&(n||this.contiguous)?(e.id=n,i.push(e)):t.dropped++}e.debug.length&&l.b.log(e.pts+"/"+e.dts+":"+e.debug)},e.prototype._parseAVCPES=function(e,t){var i=this,n=this._avcTrack,r=this._parseAVCNALu(e.data),o=void 0,s=this.avcSample,u=void 0,l=!1,c=void 0,h=this.pushAccesUnit.bind(this),d=function(e,t,i,n){return{key:e,pts:t,dts:i,units:[],debug:n}};e.data=null,s&&r.length&&!n.audFound&&(h(s,n),s=this.avcSample=d(!1,e.pts,e.dts,"")),r.forEach(function(t){switch(t.type){case 1:u=!0,s||(s=i.avcSample=d(!0,e.pts,e.dts,"")),s.frame=!0;var r=t.data;if(l&&r.length>4){var f=new a.a(r).readSliceType();2!==f&&4!==f&&7!==f&&9!==f||(s.key=!0)}break;case 5:u=!0,s||(s=i.avcSample=d(!0,e.pts,e.dts,"")),s.key=!0,s.frame=!0;break;case 6:u=!0,o=new a.a(i.discardEPB(t.data)),o.readUByte();for(var p=0,g=0,m=!1,v=0;!m&&o.bytesAvailable>1;){p=0;do{v=o.readUByte(),p+=v}while(255===v);g=0;do{v=o.readUByte(),g+=v}while(255===v);if(4===p&&0!==o.bytesAvailable){if(m=!0,181===o.readUByte()&&49===o.readUShort()&&1195456820===o.readUInt()&&3===o.readUByte()){var y=o.readUByte(),b=o.readUByte(),w=31&y,E=[y,b];for(c=0;c<w;c++)E.push(o.readUByte()),E.push(o.readUByte()),E.push(o.readUByte());i._insertSampleInOrder(i._txtTrack.samples,{type:3,pts:e.pts,bytes:E})}}else if(g<o.bytesAvailable)for(c=0;c<g;c++)o.readUByte()}break;case 7:if(u=!0,l=!0,!n.sps){o=new a.a(t.data);var _=o.readSPS();n.width=_.width,n.height=_.height,n.pixelRatio=_.pixelRatio,n.sps=[t.data],n.duration=i._duration;var T=t.data.subarray(1,4),S="avc1.";for(c=0;c<3;c++){var A=T[c].toString(16);A.length<2&&(A="0"+A),S+=A}n.codec=S}break;case 8:u=!0,n.pps||(n.pps=[t.data]);break;case 9:u=!1,n.audFound=!0,s&&h(s,n),s=i.avcSample=d(!1,e.pts,e.dts,"");break;case 12:u=!1;break;default:u=!1,s&&(s.debug+="unknown NAL "+t.type+" ")}s&&u&&s.units.push(t)}),t&&s&&(h(s,n),this.avcSample=null)},e.prototype._insertSampleInOrder=function(e,t){var i=e.length;if(i>0){if(t.pts>=e[i-1].pts)e.push(t);else for(var n=i-1;n>=0;n--)if(t.pts<e[n].pts){e.splice(n,0,t);break}}else e.push(t)},e.prototype._getLastNalUnit=function(){var e=this.avcSample,t=void 0;if(!e||0===e.units.length){var i=this._avcTrack,n=i.samples;e=n[n.length-1]}if(e){var r=e.units;t=r[r.length-1]}return t},e.prototype._parseAVCNALu=function(e){var t=0,i=e.byteLength,n=void 0,r=void 0,o=this._avcTrack,s=o.naluState||0,a=s,u=[],l=void 0,c=void 0,h=-1,d=void 0;for(-1===s&&(h=0,d=31&e[0],s=0,t=1);t<i;)if(n=e[t++],s)if(1!==s)if(n)if(1===n){if(h>=0)l={data:e.subarray(h,t-s-1),type:d},u.push(l);else{var f=this._getLastNalUnit();if(f&&(a&&t<=4-a&&f.state&&(f.data=f.data.subarray(0,f.data.byteLength-a)),(r=t-s-1)>0)){var p=new Uint8Array(f.data.byteLength+r);p.set(f.data,0),p.set(e.subarray(0,r),f.data.byteLength),f.data=p}}t<i?(c=31&e[t],h=t,d=c,s=0):s=-1}else s=0;else s=3;else s=n?0:2;else s=n?0:1;if(h>=0&&s>=0&&(l={data:e.subarray(h,i),type:d,state:s},u.push(l)),0===u.length){var g=this._getLastNalUnit();if(g){var m=new Uint8Array(g.data.byteLength+e.byteLength);m.set(g.data,0),m.set(e,g.data.byteLength),g.data=m}}return o.naluState=s,u},e.prototype.discardEPB=function(e){for(var t=e.byteLength,i=[],n=1,r=void 0,o=void 0;n<t-2;)0===e[n]&&0===e[n+1]&&3===e[n+2]?(i.push(n+2),n+=2):n++;if(0===i.length)return e;r=t-i.length,o=new Uint8Array(r);var s=0;for(n=0;n<r;s++,n++)s===i[0]&&(s++,i.shift()),o[n]=e[s];return o},e.prototype._parseAACPES=function(e){var t=this._audioTrack,i=e.data,n=e.pts,o=this.aacOverFlow,a=this.aacLastPTS,u=void 0,h=void 0,d=void 0,f=void 0,p=void 0;if(o){var g=new Uint8Array(o.byteLength+i.byteLength);g.set(o,0),g.set(i,o.byteLength),i=g}for(d=0,p=i.length;d<p-1&&!r.d(i,d);d++);if(d){var m=void 0,v=void 0;if(d<p-1?(m="AAC PES did not start with ADTS header,offset:"+d,v=!1):(m="no ADTS header found in AAC PES",v=!0),l.b.warn("parsing error:"+m),this.observer.trigger(s.a.ERROR,{type:c.b.MEDIA_ERROR,details:c.a.FRAG_PARSING_ERROR,fatal:v,reason:m}),v)return}if(r.c(t,this.observer,i,d,this.audioCodec),h=0,u=r.b(t.samplerate),o&&a){var y=a+u;Math.abs(y-n)>1&&(l.b.log("AAC: align PTS for overlapping frames by "+Math.round((y-n)/90)),n=y)}for(;d<p;)if(r.d(i,d)&&d+5<p){var b=r.a(t,i,d,n,h);if(!b)break;d+=b.length,f=b.sample.pts,h++}else d++;o=d<p?i.subarray(d,p):null,this.aacOverFlow=o,this.aacLastPTS=f},e.prototype._parseMPEGPES=function(e){for(var t=e.data,i=t.length,n=0,r=0,s=e.pts;r<i;)if(o.a.isHeader(t,r)){var a=o.a.appendFrame(this._audioTrack,t,r,s,n);if(!a)break;r+=a.length,n++}else r++},e.prototype._parseID3PES=function(e){this._id3Track.samples.push(e)},e}();t.a=d},function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=i(0),o=function(){function e(t){n(this,e),this.data=t,this.bytesAvailable=t.byteLength,this.word=0,this.bitsAvailable=0}return e.prototype.loadWord=function(){var e=this.data,t=this.bytesAvailable,i=e.byteLength-t,n=new Uint8Array(4),r=Math.min(4,t);if(0===r)throw new Error("no bytes available");n.set(e.subarray(i,i+r)),this.word=new DataView(n.buffer).getUint32(0),this.bitsAvailable=8*r,this.bytesAvailable-=r},e.prototype.skipBits=function(e){var t=void 0;this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,t=e>>3,e-=t>>3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)},e.prototype.readBits=function(e){var t=Math.min(this.bitsAvailable,e),i=this.word>>>32-t;return e>32&&r.b.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0?this.word<<=t:this.bytesAvailable>0&&this.loadWord(),t=e-t,t>0&&this.bitsAvailable?i<<t|this.readBits(t):i},e.prototype.skipLZ=function(){var e=void 0;for(e=0;e<this.bitsAvailable;++e)if(0!=(this.word&2147483648>>>e))return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()},e.prototype.skipUEG=function(){this.skipBits(1+this.skipLZ())},e.prototype.skipEG=function(){this.skipBits(1+this.skipLZ())},e.prototype.readUEG=function(){var e=this.skipLZ();return this.readBits(e+1)-1},e.prototype.readEG=function(){var e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)},e.prototype.readBoolean=function(){return 1===this.readBits(1)},e.prototype.readUByte=function(){return this.readBits(8)},e.prototype.readUShort=function(){return this.readBits(16)},e.prototype.readUInt=function(){return this.readBits(32)},e.prototype.skipScalingList=function(e){var t=8,i=8,n=void 0,r=void 0;for(n=0;n<e;n++)0!==i&&(r=this.readEG(),i=(t+r+256)%256),t=0===i?t:i},e.prototype.readSPS=function(){var e=0,t=0,i=0,n=0,r=void 0,o=void 0,s=void 0,a=void 0,u=void 0,l=void 0,c=void 0,h=this.readUByte.bind(this),d=this.readBits.bind(this),f=this.readUEG.bind(this),p=this.readBoolean.bind(this),g=this.skipBits.bind(this),m=this.skipEG.bind(this),v=this.skipUEG.bind(this),y=this.skipScalingList.bind(this);if(h(),r=h(),d(5),g(3),h(),v(),100===r||110===r||122===r||244===r||44===r||83===r||86===r||118===r||128===r){var b=f();if(3===b&&g(1),v(),v(),g(1),p())for(l=3!==b?8:12,c=0;c<l;c++)p()&&y(c<6?16:64)}v();var w=f();if(0===w)f();else if(1===w)for(g(1),m(),m(),o=f(),c=0;c<o;c++)m();v(),g(1),s=f(),a=f(),u=d(1),0===u&&g(1),g(1),p()&&(e=f(),t=f(),i=f(),n=f());var E=[1,1];if(p()&&p())switch(h()){case 1:E=[1,1];break;case 2:E=[12,11];break;case 3:E=[10,11];break;case 4:E=[16,11];break;case 5:E=[40,33];break;case 6:E=[24,11];break;case 7:E=[20,11];break;case 8:E=[32,11];break;case 9:E=[80,33];break;case 10:E=[18,11];break;case 11:E=[15,11];break;case 12:E=[64,33];break;case 13:E=[160,99];break;case 14:E=[4,3];break;case 15:E=[3,2];break;case 16:E=[2,1];break;case 255:E=[h()<<8|h(),h()<<8|h()]}return{width:Math.ceil(16*(s+1)-2*e-2*t),height:(2-u)*(a+1)*16-(u?2:4)*(i+n),pixelRatio:E}},e.prototype.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},e}();t.a=o},function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=i(9),o=function(){function e(t,i,o,s){n(this,e),this.decryptdata=o,this.discardEPB=s,this.decrypter=new r.a(t,i,{removePKCS7Padding:!1})}return e.prototype.decryptBuffer=function(e,t){this.decrypter.decrypt(e,this.decryptdata.key.buffer,this.decryptdata.iv.buffer,t)},e.prototype.decryptAacSample=function(e,t,i,n){var r=e[t].unit,o=r.subarray(16,r.length-r.length%16),s=o.buffer.slice(o.byteOffset,o.byteOffset+o.length),a=this;this.decryptBuffer(s,function(o){o=new Uint8Array(o),r.set(o,16),n||a.decryptAacSamples(e,t+1,i)})},e.prototype.decryptAacSamples=function(e,t,i){for(;;t++){if(t>=e.length)return void i();if(!(e[t].unit.length<32)){var n=this.decrypter.isSync();if(this.decryptAacSample(e,t,i,n),!n)return}}},e.prototype.getAvcEncryptedData=function(e){for(var t=16*Math.floor((e.length-48)/160)+16,i=new Int8Array(t),n=0,r=32;r<=e.length-16;r+=160,n+=16)i.set(e.subarray(r,r+16),n);return i},e.prototype.getAvcDecryptedUnit=function(e,t){t=new Uint8Array(t);for(var i=0,n=32;n<=e.length-16;n+=160,i+=16)e.set(t.subarray(i,i+16),n);return e},e.prototype.decryptAvcSample=function(e,t,i,n,r,o){var s=this.discardEPB(r.data),a=this.getAvcEncryptedData(s),u=this;this.decryptBuffer(a.buffer,function(a){r.data=u.getAvcDecryptedUnit(s,a),o||u.decryptAvcSamples(e,t,i+1,n)})},e.prototype.decryptAvcSamples=function(e,t,i,n){for(;;t++,i=0){if(t>=e.length)return void n();for(var r=e[t].units;!(i>=r.length);i++){var o=r[i];if(!(o.length<=48||1!==o.type&&5!==o.type)){var s=this.decrypter.isSync();if(this.decryptAvcSample(e,t,i,n,o,s),!s)return}}}},e}();t.a=o},function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=i(5),o=i(0),s=i(21),a=function(){function e(t,i,r){n(this,e),this.observer=t,this.config=r,this.remuxer=i}return e.prototype.resetInitSegment=function(e,t,i,n){this._audioTrack={container:"audio/mpeg",type:"audio",id:-1,sequenceNumber:0,isAAC:!1,samples:[],len:0,manifestCodec:t,duration:n,inputTimeScale:9e4}},e.prototype.resetTimeStamp=function(){},e.probe=function(e){var t=void 0,i=void 0,n=r.a.getID3Data(e,0);if(n&&void 0!==r.a.getTimeStamp(n))for(t=n.length,i=Math.min(e.length-1,t+100);t<i;t++)if(s.a.probe(e,t))return o.b.log("MPEG Audio sync word found !"),!0;return!1},e.prototype.append=function(e,t,i,n){for(var o=r.a.getID3Data(e,0),a=r.a.getTimeStamp(o),u=a?90*a:9e4*t,l=o.length,c=e.length,h=0,d=0,f=this._audioTrack,p=[{pts:u,dts:u,data:o}];l<c;)if(s.a.isHeader(e,l)){var g=s.a.appendFrame(f,e,l,u,h);if(!g)break;l+=g.length,d=g.sample.pts,h++}else r.a.isHeader(e,l)?(o=r.a.getID3Data(e,l),p.push({pts:d,dts:d,data:o}),l+=o.length):l++;this.remuxer.remux(f,{samples:[]},{samples:p,inputTimeScale:9e4},{samples:[]},t,i,n)},e.prototype.destroy=function(){},e}();t.a=a},function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=i(42),o=i(1),s=i(0),a=i(43),u=i(2),l=function(){function e(t,i,r,o){n(this,e),this.observer=t,this.config=i,this.typeSupported=r;var s=navigator.userAgent;this.isSafari=o&&o.indexOf("Apple")>-1&&s&&!s.match("CriOS"),this.ISGenerated=!1}return e.prototype.destroy=function(){},e.prototype.resetTimeStamp=function(e){this._initPTS=this._initDTS=e},e.prototype.resetInitSegment=function(){this.ISGenerated=!1},e.prototype.remux=function(e,t,i,n,r,a,u){if(this.ISGenerated||this.generateIS(e,t,r),this.ISGenerated){var l=e.samples.length,c=t.samples.length,h=r,d=r;if(l&&c){var f=(e.samples[0].dts-t.samples[0].dts)/t.inputTimeScale;h+=Math.max(0,f),d+=Math.max(0,-f)}if(l){e.timescale||(s.b.warn("regenerate InitSegment as audio detected"),this.generateIS(e,t,r));var p=this.remuxAudio(e,h,a,u);if(c){var g=void 0;p&&(g=p.endPTS-p.startPTS),t.timescale||(s.b.warn("regenerate InitSegment as video detected"),this.generateIS(e,t,r)),this.remuxVideo(t,d,a,g,u)}}else if(c){var m=this.remuxVideo(t,d,a,0,u);m&&e.codec&&this.remuxEmptyAudio(e,h,a,m)}}i.samples.length&&this.remuxID3(i,r),n.samples.length&&this.remuxText(n,r),this.observer.trigger(o.a.FRAG_PARSED)},e.prototype.generateIS=function(e,t,i){var n=this.observer,r=e.samples,l=t.samples,c=this.typeSupported,h="audio/mp4",d={},f={tracks:d},p=void 0===this._initPTS,g=void 0,m=void 0;if(p&&(g=m=1/0),e.config&&r.length&&(e.timescale=e.samplerate,s.b.log("audio sampling rate : "+e.samplerate),e.isAAC||(c.mpeg?(h="audio/mpeg",e.codec=""):c.mp3&&(e.codec="mp3")),d.audio={container:h,codec:e.codec,initSegment:!e.isAAC&&c.mpeg?new Uint8Array:a.a.initSegment([e]),metadata:{channelCount:e.channelCount}},p&&(g=m=r[0].pts-e.inputTimeScale*i)),t.sps&&t.pps&&l.length){var v=t.inputTimeScale;t.timescale=v,d.video={container:"video/mp4",codec:t.codec,initSegment:a.a.initSegment([t]),metadata:{width:t.width,height:t.height}},p&&(g=Math.min(g,l[0].pts-v*i),m=Math.min(m,l[0].dts-v*i),this.observer.trigger(o.a.INIT_PTS_FOUND,{initPTS:g}))}Object.keys(d).length?(n.trigger(o.a.FRAG_PARSING_INIT_SEGMENT,f),this.ISGenerated=!0,p&&(this._initPTS=g,this._initDTS=m)):n.trigger(o.a.ERROR,{type:u.b.MEDIA_ERROR,details:u.a.FRAG_PARSING_ERROR,fatal:!1,reason:"no audio/video samples found"})},e.prototype.remuxVideo=function(e,t,i,n,r){var l=8,c=e.timescale,h=void 0,d=void 0,f=void 0,p=void 0,g=void 0,m=void 0,v=void 0,y=e.samples,b=[],w=y.length,E=this._PTSNormalize,_=this._initDTS,T=this.nextAvcDts,S=this.isSafari;if(0!==w){S&&(i|=y.length&&T&&(r&&Math.abs(t-T/c)<.1||Math.abs(y[0].pts-T-_)<c/5)),i||(T=t*c),y.forEach(function(e){e.pts=E(e.pts-_,T),e.dts=E(e.dts-_,T)}),y.sort(function(e,t){var i=e.dts-t.dts,n=e.pts-t.pts;return i||n||e.id-t.id});var A=y.reduce(function(e,t){return Math.max(Math.min(e,t.pts-t.dts),-18e3)},0);if(A<0){s.b.warn("PTS < DTS detected in video samples, shifting DTS by "+Math.round(A/90)+" ms to overcome this issue");for(var P=0;P<y.length;P++)y[P].dts+=A}var I=y[0];g=Math.max(I.dts,0),p=Math.max(I.pts,0);var x=Math.round((g-T)/90);i&&x&&(x>1?s.b.log("AVC:"+x+" ms hole between fragments detected,filling it"):x<-1&&s.b.log("AVC:"+-x+" ms overlapping between fragments detected"),g=T,y[0].dts=g,p=Math.max(p-x,T),y[0].pts=p,s.b.log("Video/PTS/DTS adjusted: "+Math.round(p/90)+"/"+Math.round(g/90)+",delta:"+x+" ms")),I=y[y.length-1],v=Math.max(I.dts,0),m=Math.max(I.pts,0,v),S&&(h=Math.round((v-g)/(y.length-1)));for(var C=0,R=0,k=0;k<w;k++){for(var O=y[k],L=O.units,D=L.length,M=0,N=0;N<D;N++)M+=L[N].data.length;R+=M,C+=D,O.length=M,O.dts=S?g+k*h:Math.max(O.dts,g),O.pts=Math.max(O.pts,O.dts)}var F=R+4*C+8;try{d=new Uint8Array(F)}catch(e){return void this.observer.trigger(o.a.ERROR,{type:u.b.MUX_ERROR,details:u.a.REMUX_ALLOC_ERROR,fatal:!1,bytes:F,reason:"fail allocating video mdat "+F})}var V=new DataView(d.buffer);V.setUint32(0,F),d.set(a.a.types.mdat,4);for(var U=0;U<w;U++){for(var B=y[U],G=B.units,H=0,j=void 0,W=0,$=G.length;W<$;W++){var Y=G[W],q=Y.data,z=Y.data.byteLength;V.setUint32(l,z),l+=4,d.set(q,l),l+=z,H+=4+z}if(S)j=Math.max(0,h*Math.round((B.pts-B.dts)/h));else{if(U<w-1)h=y[U+1].dts-B.dts;else{var K=this.config,X=B.dts-y[U>0?U-1:U].dts;if(K.stretchShortVideoTrack){var Z=K.maxBufferHole,Q=Math.floor(Z*c),J=(n?p+n*c:this.nextAudioPts)-B.pts;J>Q?(h=J-X,h<0&&(h=X),s.b.log("It is approximately "+J/90+" ms to the next segment; using duration "+h/90+" ms for the last video frame.")):h=X}else h=X}j=Math.round(B.pts-B.dts)}b.push({size:H,duration:h,cts:j,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:B.key?2:1,isNonSync:B.key?0:1}})}this.nextAvcDts=v+h;var ee=e.dropped;if(e.len=0,e.nbNalu=0,e.dropped=0,b.length&&navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var te=b[0].flags;te.dependsOn=2,te.isNonSync=0}e.samples=b,f=a.a.moof(e.sequenceNumber++,g,e),e.samples=[];var ie={data1:f,data2:d,startPTS:p/c,endPTS:(m+h)/c,startDTS:g/c,endDTS:this.nextAvcDts/c,type:"video",hasAudio:!1,hasVideo:!0,nb:b.length,dropped:ee};return this.observer.trigger(o.a.FRAG_PARSING_DATA,ie),ie}},e.prototype.remuxAudio=function(e,t,i,n){var l=e.inputTimeScale,c=e.timescale,h=l/c,d=e.isAAC?1024:1152,f=d*h,p=this._PTSNormalize,g=this._initDTS,m=!e.isAAC&&this.typeSupported.mpeg,v=void 0,y=void 0,b=void 0,w=void 0,E=void 0,_=void 0,T=void 0,S=e.samples,A=[],P=this.nextAudioPts;if(i|=S.length&&P&&(n&&Math.abs(t-P/l)<.1||Math.abs(S[0].pts-P-g)<20*f),S.forEach(function(e){e.pts=e.dts=p(e.pts-g,t*l)}),S=S.filter(function(e){return e.pts>=0}),0!==S.length){if(i||(P=n?t*l:S[0].pts),e.isAAC)for(var I=this.config.maxAudioFramesDrift,x=0,C=P;x<S.length;){var R,k=S[x],O=k.pts;R=O-C;var L=Math.abs(1e3*R/l);if(R<=-I*f)s.b.warn("Dropping 1 audio frame @ "+(C/l).toFixed(3)+"s due to "+Math.round(L)+" ms overlap."),S.splice(x,1),e.len-=k.unit.length;else if(R>=I*f&&L<1e4&&C){var D=Math.round(R/f);s.b.warn("Injecting "+D+" audio frame @ "+(C/l).toFixed(3)+"s due to "+Math.round(1e3*R/l)+" ms gap.");for(var M=0;M<D;M++){var N=Math.max(C,0);b=r.a.getSilentFrame(e.manifestCodec||e.codec,e.channelCount),b||(s.b.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),b=k.unit.subarray()),S.splice(x,0,{unit:b,pts:N,dts:N}),e.len+=b.length,C+=f,x++}k.pts=k.dts=C,C+=f,x++}else Math.abs(R),k.pts=k.dts=C,C+=f,x++}for(var F=0,V=S.length;F<V;F++){var U=S[F],B=U.unit,G=U.pts;if(void 0!==T)y.duration=Math.round((G-T)/h);else{var H=Math.round(1e3*(G-P)/l),j=0;if(i&&e.isAAC&&H){if(H>0&&H<1e4)j=Math.round((G-P)/f),s.b.log(H+" ms hole between AAC samples detected,filling it"),j>0&&(b=r.a.getSilentFrame(e.manifestCodec||e.codec,e.channelCount),b||(b=B.subarray()),e.len+=j*b.length);else if(H<-12){s.b.log("drop overlapping AAC sample, expected/parsed/delta:"+(P/l).toFixed(3)+"s/"+(G/l).toFixed(3)+"s/"+-H+"ms"),e.len-=B.byteLength;continue}G=P}if(_=G,!(e.len>0))return;var W=m?e.len:e.len+8;v=m?0:8;try{w=new Uint8Array(W)}catch(e){return void this.observer.trigger(o.a.ERROR,{type:u.b.MUX_ERROR,details:u.a.REMUX_ALLOC_ERROR,fatal:!1,bytes:W,reason:"fail allocating audio mdat "+W})}m||(new DataView(w.buffer).setUint32(0,W),w.set(a.a.types.mdat,4));for(var $=0;$<j;$++)b=r.a.getSilentFrame(e.manifestCodec||e.codec,e.channelCount),b||(s.b.log("Unable to get silent frame for given audio codec; duplicating this frame instead."),b=B.subarray()),w.set(b,v),v+=b.byteLength,y={size:b.byteLength,cts:0,duration:1024,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},A.push(y)}w.set(B,v);var Y=B.byteLength;v+=Y,y={size:Y,cts:0,duration:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},A.push(y),T=G}var q=0,z=A.length;if(z>=2&&(q=A[z-2].duration,y.duration=q),z){this.nextAudioPts=P=T+h*q,e.len=0,e.samples=A,E=m?new Uint8Array:a.a.moof(e.sequenceNumber++,_/h,e),e.samples=[];var K=_/l,X=P/l,Z={data1:E,data2:w,startPTS:K,endPTS:X,startDTS:K,endDTS:X,type:"audio",hasAudio:!0,hasVideo:!1,nb:z};return this.observer.trigger(o.a.FRAG_PARSING_DATA,Z),Z}return null}},e.prototype.remuxEmptyAudio=function(e,t,i,n){var o=e.inputTimeScale,a=e.samplerate?e.samplerate:o,u=o/a,l=this.nextAudioPts,c=(void 0!==l?l:n.startDTS*o)+this._initDTS,h=n.endDTS*o+this._initDTS,d=1024*u,f=Math.ceil((h-c)/d),p=r.a.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);if(s.b.warn("remux empty Audio"),!p)return void s.b.trace("Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec!");for(var g=[],m=0;m<f;m++){var v=c+m*d;g.push({unit:p,pts:v,dts:v}),e.len+=p.length}e.samples=g,this.remuxAudio(e,t,i)},e.prototype.remuxID3=function(e,t){var i=e.samples.length,n=void 0,r=e.inputTimeScale,s=this._initPTS,a=this._initDTS;if(i){for(var u=0;u<i;u++)n=e.samples[u],n.pts=(n.pts-s)/r,n.dts=(n.dts-a)/r;this.observer.trigger(o.a.FRAG_PARSING_METADATA,{samples:e.samples})}e.samples=[],t=t},e.prototype.remuxText=function(e,t){e.samples.sort(function(e,t){return e.pts-t.pts});var i=e.samples.length,n=void 0,r=e.inputTimeScale,s=this._initPTS;if(i){for(var a=0;a<i;a++)n=e.samples[a],n.pts=(n.pts-s)/r;this.observer.trigger(o.a.FRAG_PARSING_USERDATA,{samples:e.samples})}e.samples=[],t=t},e.prototype._PTSNormalize=function(e,t){var i=void 0;if(void 0===t)return e;for(i=t<e?-8589934592:8589934592;Math.abs(e-t)>4294967296;)e+=i;return e},e}();t.a=l},function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function e(){n(this,e)}return e.getSilentFrame=function(e,t){switch(e){case"mp4a.40.2":if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null},e}();t.a=r},function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=Math.pow(2,32)-1,o=function(){function e(){n(this,e)}return e.init=function(){e.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};var t=void 0;for(t in e.types)e.types.hasOwnProperty(t)&&(e.types[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]);var i=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),n=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);e.HDLR_TYPES={video:i,audio:n};var r=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),o=new Uint8Array([0,0,0,0,0,0,0,0]);e.STTS=e.STSC=e.STCO=o,e.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),e.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),e.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),e.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var s=new Uint8Array([105,115,111,109]),a=new Uint8Array([97,118,99,49]),u=new Uint8Array([0,0,0,1]);e.FTYP=e.box(e.types.ftyp,s,u,s,a),e.DINF=e.box(e.types.dinf,e.box(e.types.dref,r))},e.box=function(e){for(var t=Array.prototype.slice.call(arguments,1),i=8,n=t.length,r=n,o=void 0;n--;)i+=t[n].byteLength;for(o=new Uint8Array(i),o[0]=i>>24&255,o[1]=i>>16&255,o[2]=i>>8&255,o[3]=255&i,o.set(e,4),n=0,i=8;n<r;n++)o.set(t[n],i),i+=t[n].byteLength;return o},e.hdlr=function(t){return e.box(e.types.hdlr,e.HDLR_TYPES[t])},e.mdat=function(t){return e.box(e.types.mdat,t)},e.mdhd=function(t,i){i*=t;var n=Math.floor(i/(r+1)),o=Math.floor(i%(r+1));return e.box(e.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,n>>24,n>>16&255,n>>8&255,255&n,o>>24,o>>16&255,o>>8&255,255&o,85,196,0,0]))},e.mdia=function(t){return e.box(e.types.mdia,e.mdhd(t.timescale,t.duration),e.hdlr(t.type),e.minf(t))},e.mfhd=function(t){return e.box(e.types.mfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t]))},e.minf=function(t){return"audio"===t.type?e.box(e.types.minf,e.box(e.types.smhd,e.SMHD),e.DINF,e.stbl(t)):e.box(e.types.minf,e.box(e.types.vmhd,e.VMHD),e.DINF,e.stbl(t))},e.moof=function(t,i,n){return e.box(e.types.moof,e.mfhd(t),e.traf(n,i))},e.moov=function(t){for(var i=t.length,n=[];i--;)n[i]=e.trak(t[i]);return e.box.apply(null,[e.types.moov,e.mvhd(t[0].timescale,t[0].duration)].concat(n).concat(e.mvex(t)))},e.mvex=function(t){for(var i=t.length,n=[];i--;)n[i]=e.trex(t[i]);return e.box.apply(null,[e.types.mvex].concat(n))},e.mvhd=function(t,i){i*=t;var n=Math.floor(i/(r+1)),o=Math.floor(i%(r+1)),s=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,n>>24,n>>16&255,n>>8&255,255&n,o>>24,o>>16&255,o>>8&255,255&o,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return e.box(e.types.mvhd,s)},e.sdtp=function(t){var i=t.samples||[],n=new Uint8Array(4+i.length),r=void 0,o=void 0;for(o=0;o<i.length;o++)r=i[o].flags,n[o+4]=r.dependsOn<<4|r.isDependedOn<<2|r.hasRedundancy;return e.box(e.types.sdtp,n)},e.stbl=function(t){return e.box(e.types.stbl,e.stsd(t),e.box(e.types.stts,e.STTS),e.box(e.types.stsc,e.STSC),e.box(e.types.stsz,e.STSZ),e.box(e.types.stco,e.STCO))},e.avc1=function(t){var i=[],n=[],r=void 0,o=void 0,s=void 0;for(r=0;r<t.sps.length;r++)o=t.sps[r],s=o.byteLength,i.push(s>>>8&255),i.push(255&s),i=i.concat(Array.prototype.slice.call(o));for(r=0;r<t.pps.length;r++)o=t.pps[r],s=o.byteLength,n.push(s>>>8&255),n.push(255&s),n=n.concat(Array.prototype.slice.call(o));var a=e.box(e.types.avcC,new Uint8Array([1,i[3],i[4],i[5],255,224|t.sps.length].concat(i).concat([t.pps.length]).concat(n))),u=t.width,l=t.height,c=t.pixelRatio[0],h=t.pixelRatio[1];return e.box(e.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,u>>8&255,255&u,l>>8&255,255&l,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),a,e.box(e.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),e.box(e.types.pasp,new Uint8Array([c>>24,c>>16&255,c>>8&255,255&c,h>>24,h>>16&255,h>>8&255,255&h])))},e.esds=function(e){var t=e.config.length;return new Uint8Array([0,0,0,0,3,23+t,0,1,0,4,15+t,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([t]).concat(e.config).concat([6,1,2]))},e.mp4a=function(t){var i=t.samplerate;return e.box(e.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,i>>8&255,255&i,0,0]),e.box(e.types.esds,e.esds(t)))},e.mp3=function(t){var i=t.samplerate;return e.box(e.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,i>>8&255,255&i,0,0]))},e.stsd=function(t){return"audio"===t.type?t.isAAC||"mp3"!==t.codec?e.box(e.types.stsd,e.STSD,e.mp4a(t)):e.box(e.types.stsd,e.STSD,e.mp3(t)):e.box(e.types.stsd,e.STSD,e.avc1(t))},e.tkhd=function(t){var i=t.id,n=t.duration*t.timescale,o=t.width,s=t.height,a=Math.floor(n/(r+1)),u=Math.floor(n%(r+1));return e.box(e.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,i>>24&255,i>>16&255,i>>8&255,255&i,0,0,0,0,a>>24,a>>16&255,a>>8&255,255&a,u>>24,u>>16&255,u>>8&255,255&u,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,o>>8&255,255&o,0,0,s>>8&255,255&s,0,0]))},e.traf=function(t,i){var n=e.sdtp(t),o=t.id,s=Math.floor(i/(r+1)),a=Math.floor(i%(r+1));return e.box(e.types.traf,e.box(e.types.tfhd,new Uint8Array([0,0,0,0,o>>24,o>>16&255,o>>8&255,255&o])),e.box(e.types.tfdt,new Uint8Array([1,0,0,0,s>>24,s>>16&255,s>>8&255,255&s,a>>24,a>>16&255,a>>8&255,255&a])),e.trun(t,n.length+16+20+8+16+8+8),n)},e.trak=function(t){return t.duration=t.duration||4294967295,e.box(e.types.trak,e.tkhd(t),e.mdia(t))},e.trex=function(t){var i=t.id;return e.box(e.types.trex,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,255&i,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},e.trun=function(t,i){var n=t.samples||[],r=n.length,o=12+16*r,s=new Uint8Array(o),a=void 0,u=void 0,l=void 0,c=void 0,h=void 0,d=void 0;for(i+=8+o,s.set([0,0,15,1,r>>>24&255,r>>>16&255,r>>>8&255,255&r,i>>>24&255,i>>>16&255,i>>>8&255,255&i],0),a=0;a<r;a++)u=n[a],l=u.duration,c=u.size,h=u.flags,d=u.cts,s.set([l>>>24&255,l>>>16&255,l>>>8&255,255&l,c>>>24&255,c>>>16&255,c>>>8&255,255&c,h.isLeading<<2|h.dependsOn,h.isDependedOn<<6|h.hasRedundancy<<4|h.paddingValue<<1|h.isNonSync,61440&h.degradPrio,15&h.degradPrio,d>>>24&255,d>>>16&255,d>>>8&255,255&d],12+16*a);return e.box(e.types.trun,s)},e.initSegment=function(t){e.types||e.init();var i=e.moov(t),n=void 0;return n=new Uint8Array(e.FTYP.byteLength+i.byteLength),n.set(e.FTYP),n.set(i,e.FTYP.byteLength),n},e}();t.a=o},function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=i(1),o=function(){function e(t){n(this,e),this.observer=t}return e.prototype.destroy=function(){},e.prototype.resetTimeStamp=function(){},e.prototype.resetInitSegment=function(){},e.prototype.remux=function(e,t,i,n,o,s,a,u){var l=this.observer,c="";e&&(c+="audio"),t&&(c+="video"),l.trigger(r.a.FRAG_PARSING_DATA,{data1:u,startPTS:o,startDTS:o,type:c,hasAudio:!!e,hasVideo:!!t,nb:1,dropped:0}),l.trigger(r.a.FRAG_PARSED)},e}();t.a=o},function(e,t,i){function n(e){function t(n){if(i[n])return i[n].exports;var r=i[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var i={};t.m=e,t.c=i,t.i=function(e){return e},t.d=function(e,i,n){t.o(e,i)||Object.defineProperty(e,i,{configurable:!1,enumerable:!0,get:n})},t.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},t.n=function(e){var i=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(i,"a",i),i},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="/",t.oe=function(e){throw console.error(e),e};var n=t(t.s=ENTRY_MODULE);return n.default||n}function r(e){return(e+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function o(e,t,n){var o={};o[n]=[];var s=t.toString(),a=s.match(/^function\s?\(\w+,\s*\w+,\s*(\w+)\)/);if(!a)return o;for(var c,h=a[1],d=new RegExp("(\\\\n|\\W)"+r(h)+l,"g");c=d.exec(s);)"dll-reference"!==c[3]&&o[n].push(c[3]);for(d=new RegExp("\\("+r(h)+'\\("(dll-reference\\s('+u+'))"\\)\\)'+l,"g");c=d.exec(s);)e[c[2]]||(o[n].push(c[1]),e[c[2]]=i(c[1]).m),o[c[2]]=o[c[2]]||[],o[c[2]].push(c[4]);return o}function s(e){return Object.keys(e).reduce(function(t,i){return t||e[i].length>0},!1)}function a(e,t){for(var i={main:[t]},n={main:[]},r={main:{}};s(i);)for(var a=Object.keys(i),u=0;u<a.length;u++){var l=a[u],c=i[l],h=c.pop();if(r[l]=r[l]||{},!r[l][h]&&e[l][h]){r[l][h]=!0,n[l]=n[l]||[],n[l].push(h)
;for(var d=o(e,e[l][h],l),f=Object.keys(d),p=0;p<f.length;p++)i[f[p]]=i[f[p]]||[],i[f[p]]=i[f[p]].concat(d[f[p]])}}return n}var u="[\\.|\\-|\\+|\\w|/|@]+",l="\\((/\\*.*?\\*/)?s?.*?("+u+").*?\\)";e.exports=function(e,t){t=t||{};var r={main:i.m},o=t.all?{main:Object.keys(r)}:a(r,e),s="";Object.keys(o).filter(function(e){return"main"!==e}).forEach(function(e){for(var t=0;o[e][t];)t++;o[e].push(t),r[e][t]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",s=s+"var "+e+" = ("+n.toString().replace("ENTRY_MODULE",JSON.stringify(t))+")({"+o[e].map(function(t){return JSON.stringify(t)+": "+r[e][t].toString()}).join(",")+"});\n"}),s=s+"("+n.toString().replace("ENTRY_MODULE",JSON.stringify(e))+")({"+o.main.map(function(e){return JSON.stringify(e)+": "+r.main[e].toString()}).join(",")+"})(self);";var u=new window.Blob([s],{type:"text/javascript"});if(t.bare)return u;var l=window.URL||window.webkitURL||window.mozURL||window.msURL,c=l.createObjectURL(u),h=new window.Worker(c);return h.objectURL=c,h}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(19),r=i(1),o=i(0),s=i(10),a=i.n(s),u=function(e){var t=new a.a;t.trigger=function(e){for(var i=arguments.length,n=Array(i>1?i-1:0),r=1;r<i;r++)n[r-1]=arguments[r];t.emit.apply(t,[e,e].concat(n))},t.off=function(e){for(var i=arguments.length,n=Array(i>1?i-1:0),r=1;r<i;r++)n[r-1]=arguments[r];t.removeListener.apply(t,[e].concat(n))};var i=function(t,i){e.postMessage({event:t,data:i})};e.addEventListener("message",function(r){var s=r.data;switch(s.cmd){case"init":var a=JSON.parse(s.config);e.demuxer=new n.a(t,s.typeSupported,a,s.vendor);try{Object(o.a)(!0===a.debug)}catch(e){console.warn("demuxerWorker: unable to enable logs")}i("init",null);break;case"demux":e.demuxer.push(s.data,s.decryptdata,s.initSegment,s.audioCodec,s.videoCodec,s.timeOffset,s.discontinuity,s.trackSwitch,s.contiguous,s.duration,s.accurateTimeOffset,s.defaultInitPTS)}}),t.on(r.a.FRAG_DECRYPTED,i),t.on(r.a.FRAG_PARSING_INIT_SEGMENT,i),t.on(r.a.FRAG_PARSED,i),t.on(r.a.ERROR,i),t.on(r.a.FRAG_PARSING_METADATA,i),t.on(r.a.FRAG_PARSING_USERDATA,i),t.on(r.a.INIT_PTS_FOUND,i),t.on(r.a.FRAG_PARSING_DATA,function(t,i){var n=[],r={event:t,data:i};i.data1&&(r.data1=i.data1.buffer,n.push(i.data1.buffer),delete i.data1),i.data2&&(r.data2=i.data2.buffer,n.push(i.data2.buffer),delete i.data2),e.postMessage(r,n)})};t.default=u},function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=i(1),a=i(3),u=i(0),l=i(2),c=i(17),h=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),d=function(e){function t(i){n(this,t);var o=r(this,e.call(this,i,s.a.MANIFEST_LOADED,s.a.LEVEL_LOADED,s.a.FRAG_LOADED,s.a.ERROR));return o.canload=!1,o.currentLevelIndex=null,o.manualLevelIndex=-1,o.timer=null,o}return o(t,e),t.prototype.onHandlerDestroying=function(){this.cleanTimer(),this.manualLevelIndex=-1},t.prototype.cleanTimer=function(){null!==this.timer&&(clearTimeout(this.timer),this.timer=null)},t.prototype.startLoad=function(){var e=this._levels;this.canload=!0,this.levelRetryCount=0,e&&e.forEach(function(e){e.loadError=0;var t=e.details;t&&t.live&&(e.details=void 0)}),null!==this.timer&&this.loadLevel()},t.prototype.stopLoad=function(){this.canload=!1},t.prototype.onManifestLoaded=function(e){var t=[],i=void 0,n={},r=null,o=!1,a=!1,h=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),d=[];if(e.levels.forEach(function(e){e.loadError=0,e.fragmentError=!1,o=o||!!e.videoCodec,a=a||!!e.audioCodec||!(!e.attrs||!e.attrs.AUDIO),!0===h&&e.audioCodec&&-1!==e.audioCodec.indexOf("mp4a.40.34")&&(e.audioCodec=void 0),r=n[e.bitrate],void 0===r?(e.url=[e.url],e.urlId=0,n[e.bitrate]=e,t.push(e)):r.url.push(e.url)}),!0===o&&!0===a&&(t=t.filter(function(e){return!!e.videoCodec})),t=t.filter(function(e){var t=e.audioCodec,i=e.videoCodec;return(!t||Object(c.a)(t))&&(!i||Object(c.a)(i))}),e.audioTracks&&(d=e.audioTracks.filter(function(e){return!e.audioCodec||Object(c.a)(e.audioCodec,"audio")})),t.length>0){i=t[0].bitrate,t.sort(function(e,t){return e.bitrate-t.bitrate}),this._levels=t;for(var f=0;f<t.length;f++)if(t[f].bitrate===i){this._firstLevel=f,u.b.log("manifest loaded,"+t.length+" level(s) found, first bitrate:"+i);break}this.hls.trigger(s.a.MANIFEST_PARSED,{levels:t,audioTracks:d,firstLevel:this._firstLevel,stats:e.stats,audio:a,video:o,altAudio:d.length>0})}else this.hls.trigger(s.a.ERROR,{type:l.b.MEDIA_ERROR,details:l.a.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:this.hls.url,reason:"no level with compatible codecs found in manifest"})},t.prototype.setLevelInternal=function(e){var t=this._levels,i=this.hls;if(e>=0&&e<t.length){if(this.cleanTimer(),this.currentLevelIndex!==e){u.b.log("switching to level "+e),this.currentLevelIndex=e;var n=t[e];n.level=e,i.trigger(s.a.LEVEL_SWITCHING,n)}var r=t[e],o=r.details;if(!o||!0===o.live){var a=r.urlId;i.trigger(s.a.LEVEL_LOADING,{url:r.url[a],level:e,id:a})}}else i.trigger(s.a.ERROR,{type:l.b.OTHER_ERROR,details:l.a.LEVEL_SWITCH_ERROR,level:e,fatal:!1,reason:"invalid level idx"})},t.prototype.onError=function(e){if(!0===e.fatal)return void(e.type===l.b.NETWORK_ERROR&&this.cleanTimer());var t=!1,i=!1,n=void 0;switch(e.details){case l.a.FRAG_LOAD_ERROR:case l.a.FRAG_LOAD_TIMEOUT:case l.a.KEY_LOAD_ERROR:case l.a.KEY_LOAD_TIMEOUT:n=e.frag.level,i=!0;break;case l.a.LEVEL_LOAD_ERROR:case l.a.LEVEL_LOAD_TIMEOUT:n=e.context.level,t=!0;break;case l.a.REMUX_ALLOC_ERROR:n=e.level,t=!0}void 0!==n&&this.recoverLevel(e,n,t,i)},t.prototype.recoverLevel=function(e,t,i,n){var r=this,o=this.hls.config,s=e.details,a=this._levels[t],l=void 0,c=void 0,h=void 0;if(a.loadError++,a.fragmentError=n,!0===i){if(!(this.levelRetryCount+1<=o.levelLoadingMaxRetry))return u.b.error("level controller, cannot recover from "+s+" error"),this.currentLevelIndex=null,this.cleanTimer(),void(e.fatal=!0);c=Math.min(Math.pow(2,this.levelRetryCount)*o.levelLoadingRetryDelay,o.levelLoadingMaxRetryTimeout),this.timer=setTimeout(function(){return r.loadLevel()},c),e.levelRetry=!0,this.levelRetryCount++,u.b.warn("level controller, "+s+", retry in "+c+" ms, current retry count is "+this.levelRetryCount)}!0!==i&&!0!==n||(l=a.url.length,l>1&&a.loadError<l?(u.b.warn("level controller, "+s+" for level "+t+": switching to redundant stream id "+a.urlId),a.urlId=(a.urlId+1)%l,a.details=void 0):-1===this.manualLevelIndex?(h=0===t?this._levels.length-1:t-1,u.b.warn("level controller, "+s+": switch to "+h),this.hls.nextAutoLevel=this.currentLevelIndex=h):!0===n&&(u.b.warn("level controller, "+s+": reload a fragment"),this.currentLevelIndex=null))},t.prototype.onFragLoaded=function(e){var t=e.frag;if(void 0!==t&&"main"===t.type){var i=this._levels[t.level];void 0!==i&&(i.fragmentError=!1,i.loadError=0,this.levelRetryCount=0)}},t.prototype.onLevelLoaded=function(e){var t=this,i=e.level;if(i===this.currentLevelIndex){var n=this._levels[i];!1===n.fragmentError&&(n.loadError=0,this.levelRetryCount=0);var r=e.details;if(r.live){var o=1e3*(r.averagetargetduration?r.averagetargetduration:r.targetduration),s=o,a=n.details;a&&r.endSN===a.endSN&&(s/=2,u.b.log("same live playlist, reload twice faster")),s-=performance.now()-e.stats.trequest,s=Math.max(o/2,Math.round(s)),u.b.log("live playlist, reload in "+Math.round(s)+" ms"),this.timer=setTimeout(function(){return t.loadLevel()},s)}else this.cleanTimer()}},t.prototype.loadLevel=function(){var e=void 0,t=void 0;null!==this.currentLevelIndex&&!0===this.canload&&void 0!==(e=this._levels[this.currentLevelIndex])&&e.url.length>0&&(t=e.urlId,this.hls.trigger(s.a.LEVEL_LOADING,{url:e.url[t],level:this.currentLevelIndex,id:t}))},h(t,[{key:"levels",get:function(){return this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(e){var t=this._levels;t&&(e=Math.min(e,t.length-1),this.currentLevelIndex===e&&void 0!==t[e].details||this.setLevelInternal(e))}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(e){this.manualLevelIndex=e,void 0===this._startLevel&&(this._startLevel=e),-1!==e&&(this.level=e)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(e){this._firstLevel=e}},{key:"startLevel",get:function(){if(void 0===this._startLevel){var e=this.hls.config.startLevel;return void 0!==e?e:this._firstLevel}return this._startLevel},set:function(e){this._startLevel=e}},{key:"nextLoadLevel",get:function(){return-1!==this.manualLevelIndex?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(e){this.level=e,-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=e)}}]),t}(a.a);t.a=d},function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=i(1),a=i(3),u=i(5),l=i(25),c=function(e){function t(i){n(this,t);var o=r(this,e.call(this,i,s.a.MEDIA_ATTACHED,s.a.MEDIA_DETACHING,s.a.FRAG_PARSING_METADATA));return o.id3Track=void 0,o.media=void 0,o}return o(t,e),t.prototype.destroy=function(){a.a.prototype.destroy.call(this)},t.prototype.onMediaAttached=function(e){this.media=e.media,this.media},t.prototype.onMediaDetaching=function(){Object(l.a)(this.id3Track),this.id3Track=void 0,this.media=void 0},t.prototype.getID3Track=function(e){for(var t=0;t<e.length;t++){var i=e[t];if("metadata"===i.kind&&"id3"===i.label)return Object(l.b)(i,this.media),i}return this.media.addTextTrack("metadata","id3")},t.prototype.onFragParsingMetadata=function(e){var t=e.frag,i=e.samples;this.id3Track||(this.id3Track=this.getID3Track(this.media.textTracks),this.id3Track.mode="hidden");for(var n=window.WebKitDataCue||window.VTTCue||window.TextTrackCue,r=0;r<i.length;r++){var o=u.a.getID3Frames(i[r].data);if(o){var s=i[r].pts,a=r<i.length-1?i[r+1].pts:t.endPTS;s===a&&(a+=1e-4);for(var l=0;l<o.length;l++){var c=o[l];if(!u.a.isTimeStampFrame(c)){var h=new n(s,a,"");h.value=c,this.id3Track.addCue(h)}}}}},t}(a.a);t.a=c},function(e,t,i){"use strict";function n(){var e=Object(r.a)(),t=window.SourceBuffer||window.WebKitSourceBuffer,i=e&&"function"==typeof e.isTypeSupported&&e.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),n=!t||t.prototype&&"function"==typeof t.prototype.appendBuffer&&"function"==typeof t.prototype.remove;return!!i&&!!n}t.a=n;var r=i(11)},function(e,t,i){"use strict";i.d(t,"a",function(){return m});var n=i(51),r=i(54),o=i(55),s=i(56),a=i(57),u=i(58),l=i(59),c=i(60),h=i(62),d=i(66),f=i(67),p=i(68),g=i(69),m={autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,initialLiveManifestSize:1,maxBufferLength:30,maxBufferSize:6e7,maxBufferHole:.5,lowBufferWatchdogPeriod:.5,highBufferWatchdogPeriod:3,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,liveDurationInfinity:!1,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:a.a,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,abrController:n.a,bufferController:r.a,capLevelController:o.a,fpsController:s.a,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,requestMediaKeySystemAccessFunc:g.a};m.subtitleStreamController=f.a,m.subtitleTrackController=d.a,m.timelineController=h.a,m.cueHandler=c,m.enableCEA708Captions=!0,m.enableWebVTT=!0,m.captionsTextTrack1Label="English",m.captionsTextTrack1LanguageCode="en",m.captionsTextTrack2Label="Spanish",m.captionsTextTrack2LanguageCode="es",m.audioStreamController=l.a,m.audioTrackController=u.a,m.emeController=p.a},function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=i(1),a=i(3),u=i(8),l=i(2),c=i(0),h=i(52),d=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),f=function(e){function t(i){n(this,t);var o=r(this,e.call(this,i,s.a.FRAG_LOADING,s.a.FRAG_LOADED,s.a.FRAG_BUFFERED,s.a.ERROR));return o.lastLoadedFragLevel=0,o._nextAutoLevel=-1,o.hls=i,o.timer=null,o._bwEstimator=null,o.onCheck=o._abandonRulesCheck.bind(o),o}return o(t,e),t.prototype.destroy=function(){this.clearTimer(),a.a.prototype.destroy.call(this)},t.prototype.onFragLoading=function(e){var t=e.frag;if("main"===t.type){if(this.timer||(this.timer=setInterval(this.onCheck,100)),!this._bwEstimator){var i=this.hls,n=e.frag.level,r=i.levels[n].details.live,o=i.config,s=void 0,a=void 0;r?(s=o.abrEwmaFastLive,a=o.abrEwmaSlowLive):(s=o.abrEwmaFastVoD,a=o.abrEwmaSlowVoD),this._bwEstimator=new h.a(i,a,s,o.abrEwmaDefaultEstimate)}this.fragCurrent=t}},t.prototype._abandonRulesCheck=function(){var e=this.hls,t=e.media,i=this.fragCurrent,n=i.loader,r=e.minAutoLevel;if(!n||n.stats&&n.stats.aborted)return c.b.warn("frag loader destroy or aborted, disarm abandonRules"),this.clearTimer(),void(this._nextAutoLevel=-1);var o=n.stats;if(t&&o&&(!t.paused&&0!==t.playbackRate||!t.readyState)&&i.autoLevel&&i.level){var a=performance.now()-o.trequest,l=Math.abs(t.playbackRate);if(a>500*i.duration/l){var h=e.levels,d=Math.max(1,o.bw?o.bw/8:1e3*o.loaded/a),f=h[i.level],p=f.realBitrate?Math.max(f.realBitrate,f.bitrate):f.bitrate,g=o.total?o.total:Math.max(o.loaded,Math.round(i.duration*p/8)),m=t.currentTime,v=(g-o.loaded)/d,y=(u.a.bufferInfo(t,m,e.config.maxBufferHole).end-m)/l;if(y<2*i.duration/l&&v>y){var b=void 0,w=void 0;for(w=i.level-1;w>r;w--){var E=h[w].realBitrate?Math.max(h[w].realBitrate,h[w].bitrate):h[w].bitrate;if((b=i.duration*E/(6.4*d))<y)break}b<v&&(c.b.warn("loading too slow, abort fragment loading and switch to level "+w+":fragLoadedDelay["+w+"]<fragLoadedDelay["+(i.level-1)+"];bufferStarvationDelay:"+b.toFixed(1)+"<"+v.toFixed(1)+":"+y.toFixed(1)),e.nextLoadLevel=w,this._bwEstimator.sample(a,o.loaded),n.abort(),this.clearTimer(),e.trigger(s.a.FRAG_LOAD_EMERGENCY_ABORTED,{frag:i,stats:o}))}}}},t.prototype.onFragLoaded=function(e){var t=e.frag;if("main"===t.type&&!isNaN(t.sn)){if(this.clearTimer(),this.lastLoadedFragLevel=t.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var i=this.hls.levels[t.level],n=(i.loaded?i.loaded.bytes:0)+e.stats.loaded,r=(i.loaded?i.loaded.duration:0)+e.frag.duration;i.loaded={bytes:n,duration:r},i.realBitrate=Math.round(8*n/r)}if(e.frag.bitrateTest){var o=e.stats;o.tparsed=o.tbuffered=o.tload,this.onFragBuffered(e)}}},t.prototype.onFragBuffered=function(e){var t=e.stats,i=e.frag;if(!(!0===t.aborted||"main"!==i.type||isNaN(i.sn)||i.bitrateTest&&t.tload!==t.tbuffered)){var n=t.tparsed-t.trequest;c.b.log("latency/loading/parsing/append/kbps:"+Math.round(t.tfirst-t.trequest)+"/"+Math.round(t.tload-t.tfirst)+"/"+Math.round(t.tparsed-t.tload)+"/"+Math.round(t.tbuffered-t.tparsed)+"/"+Math.round(8*t.loaded/(t.tbuffered-t.trequest))),this._bwEstimator.sample(n,t.loaded),t.bwEstimate=this._bwEstimator.getEstimate(),i.bitrateTest?this.bitrateTestDelay=n/1e3:this.bitrateTestDelay=0}},t.prototype.onError=function(e){switch(e.details){case l.a.FRAG_LOAD_ERROR:case l.a.FRAG_LOAD_TIMEOUT:this.clearTimer()}},t.prototype.clearTimer=function(){clearInterval(this.timer),this.timer=null},t.prototype._findBestLevel=function(e,t,i,n,r,o,s,a,u){for(var l=r;l>=n;l--){var h=u[l],d=h.details,f=d?d.totalduration/d.fragments.length:t,p=!!d&&d.live,g=void 0;g=l<=e?s*i:a*i;var m=u[l].realBitrate?Math.max(u[l].realBitrate,u[l].bitrate):u[l].bitrate,v=m*f/g;if(c.b.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+l+"/"+Math.round(g)+"/"+m+"/"+f+"/"+o+"/"+v),g>m&&(!v||p&&!this.bitrateTestDelay||v<o))return l}return-1},d(t,[{key:"nextAutoLevel",get:function(){var e=this._nextAutoLevel,t=this._bwEstimator;if(!(-1===e||t&&t.canEstimate()))return e;var i=this._nextABRAutoLevel;return-1!==e&&(i=Math.min(e,i)),i},set:function(e){this._nextAutoLevel=e}},{key:"_nextABRAutoLevel",get:function(){var e=this.hls,t=e.maxAutoLevel,i=e.levels,n=e.config,r=e.minAutoLevel,o=e.media,s=this.lastLoadedFragLevel,a=this.fragCurrent?this.fragCurrent.duration:0,l=o?o.currentTime:0,h=o&&0!==o.playbackRate?Math.abs(o.playbackRate):1,d=this._bwEstimator?this._bwEstimator.getEstimate():n.abrEwmaDefaultEstimate,f=(u.a.bufferInfo(o,l,n.maxBufferHole).end-l)/h,p=this._findBestLevel(s,a,d,r,t,f,n.abrBandWidthFactor,n.abrBandWidthUpFactor,i);if(p>=0)return p;c.b.trace("rebuffering expected to happen, lets try to find a quality level minimizing the rebuffering");var g=a?Math.min(a,n.maxStarvationDelay):n.maxStarvationDelay,m=n.abrBandWidthFactor,v=n.abrBandWidthUpFactor;if(0===f){var y=this.bitrateTestDelay;y&&(g=(a?Math.min(a,n.maxLoadingDelay):n.maxLoadingDelay)-y,c.b.trace("bitrate test took "+Math.round(1e3*y)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*g)+" ms"),m=v=1)}return p=this._findBestLevel(s,a,d,r,t,f+g,m,v,i),Math.max(p,0)}}]),t}(a.a);t.a=f},function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=i(53),o=function(){function e(t,i,o,s){n(this,e),this.hls=t,this.defaultEstimate_=s,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new r.a(i),this.fast_=new r.a(o)}return e.prototype.sample=function(e,t){e=Math.max(e,this.minDelayMs_);var i=8e3*t/e,n=e/1e3;this.fast_.sample(n,i),this.slow_.sample(n,i)},e.prototype.canEstimate=function(){var e=this.fast_;return e&&e.getTotalWeight()>=this.minWeight_},e.prototype.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},e.prototype.destroy=function(){},e}();t.a=o},function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function e(t){n(this,e),this.alpha_=t?Math.exp(Math.log(.5)/t):0,this.estimate_=0,this.totalWeight_=0}return e.prototype.sample=function(e,t){var i=Math.pow(this.alpha_,e);this.estimate_=t*(1-i)+i*this.estimate_,this.totalWeight_+=e},e.prototype.getTotalWeight=function(){return this.totalWeight_},e.prototype.getEstimate=function(){if(this.alpha_){var e=1-Math.pow(this.alpha_,this.totalWeight_);return this.estimate_/e}return this.estimate_},e}();t.a=r},function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=i(1),a=i(3),u=i(0),l=i(2),c=i(11),h=Object(c.a)(),d=function(e){function t(i){n(this,t);var o=r(this,e.call(this,i,s.a.MEDIA_ATTACHING,s.a.MEDIA_DETACHING,s.a.MANIFEST_PARSED,s.a.BUFFER_RESET,s.a.BUFFER_APPENDING,s.a.BUFFER_CODECS,s.a.BUFFER_EOS,s.a.BUFFER_FLUSHING,s.a.LEVEL_PTS_UPDATED,s.a.LEVEL_UPDATED));return o._msDuration=null,o._levelDuration=null,o._live=null,o._objectUrl=null,o.onsbue=o.onSBUpdateEnd.bind(o),o.onsbe=o.onSBUpdateError.bind(o),o.pendingTracks={},o.tracks={},o}return o(t,e),t.prototype.destroy=function(){a.a.prototype.destroy.call(this)},t.prototype.onLevelPtsUpdated=function(e){var t=e.type,i=this.tracks.audio;if("audio"===t&&i&&"audio/mpeg"===i.container){var n=this.sourceBuffer.audio;if(Math.abs(n.timestampOffset-e.start)>.1){var r=n.updating;try{n.abort()}catch(e){r=!0,u.b.warn("can not abort audio buffer: "+e)}r?this.audioTimestampOffset=e.start:(u.b.warn("change mpeg audio timestamp offset from "+n.timestampOffset+" to "+e.start),n.timestampOffset=e.start)}}},t.prototype.onManifestParsed=function(e){var t=e.audio,i=e.video||e.levels.length&&e.audio,n=0;e.altAudio&&(t||i)&&(n=(t?1:0)+(i?1:0),u.b.log(n+" sourceBuffer(s) expected")),this.sourceBufferNb=n},t.prototype.onMediaAttaching=function(e){var t=this.media=e.media;if(t){var i=this.mediaSource=new h;this.onmso=this.onMediaSourceOpen.bind(this),this.onmse=this.onMediaSourceEnded.bind(this),this.onmsc=this.onMediaSourceClose.bind(this),i.addEventListener("sourceopen",this.onmso),i.addEventListener("sourceended",this.onmse),i.addEventListener("sourceclose",this.onmsc),t.src=URL.createObjectURL(i),this._objectUrl=t.src}},t.prototype.onMediaDetaching=function(){u.b.log("media source detaching");var e=this.mediaSource;if(e){if("open"===e.readyState)try{e.endOfStream()}catch(e){u.b.warn("onMediaDetaching:"+e.message+" while calling endOfStream")}e.removeEventListener("sourceopen",this.onmso),e.removeEventListener("sourceended",this.onmse),e.removeEventListener("sourceclose",this.onmsc),this.media&&(URL.revokeObjectURL(this._objectUrl),this.media.src===this._objectUrl?(this.media.removeAttribute("src"),this.media.load()):u.b.warn("media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.pendingTracks={},this.tracks={},this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0}this.onmso=this.onmse=this.onmsc=null,this.hls.trigger(s.a.MEDIA_DETACHED)},t.prototype.onMediaSourceOpen=function(){u.b.log("media source opened"),this.hls.trigger(s.a.MEDIA_ATTACHED,{media:this.media});var e=this.mediaSource;e&&e.removeEventListener("sourceopen",this.onmso),this.checkPendingTracks()},t.prototype.checkPendingTracks=function(){var e=this.pendingTracks,t=Object.keys(e).length;t&&(this.sourceBufferNb<=t||0===this.sourceBufferNb)&&(this.createSourceBuffers(e),this.pendingTracks={},this.doAppending())},t.prototype.onMediaSourceClose=function(){u.b.log("media source closed")},t.prototype.onMediaSourceEnded=function(){u.b.log("media source ended")},t.prototype.onSBUpdateEnd=function(){if(this.audioTimestampOffset){var e=this.sourceBuffer.audio;u.b.warn("change mpeg audio timestamp offset from "+e.timestampOffset+" to "+this.audioTimestampOffset),e.timestampOffset=this.audioTimestampOffset,delete this.audioTimestampOffset}this._needsFlush&&this.doFlush(),this._needsEos&&this.checkEos(),this.appending=!1;var t=this.parent,i=this.segments.reduce(function(e,i){return i.parent===t?e+1:e},0),n={},r=this.sourceBuffer;for(var o in r)n[o]=r[o].buffered;this.hls.trigger(s.a.BUFFER_APPENDED,{parent:t,pending:i,timeRanges:n}),this._needsFlush||this.doAppending(),this.updateMediaElementDuration()},t.prototype.onSBUpdateError=function(e){u.b.error("sourceBuffer error:",e),this.hls.trigger(s.a.ERROR,{type:l.b.MEDIA_ERROR,details:l.a.BUFFER_APPENDING_ERROR,fatal:!1})},t.prototype.onBufferReset=function(){var e=this.sourceBuffer;for(var t in e){var i=e[t];try{this.mediaSource.removeSourceBuffer(i),i.removeEventListener("updateend",this.onsbue),i.removeEventListener("error",this.onsbe)}catch(e){}}this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0},t.prototype.onBufferCodecs=function(e){if(0===Object.keys(this.sourceBuffer).length){for(var t in e)this.pendingTracks[t]=e[t];var i=this.mediaSource;i&&"open"===i.readyState&&this.checkPendingTracks()}},t.prototype.createSourceBuffers=function(e){var t=this.sourceBuffer,i=this.mediaSource;for(var n in e)if(!t[n]){var r=e[n],o=r.levelCodec||r.codec,a=r.container+";codecs="+o;u.b.log("creating sourceBuffer("+a+")");try{var c=t[n]=i.addSourceBuffer(a);c.addEventListener("updateend",this.onsbue),c.addEventListener("error",this.onsbe),this.tracks[n]={codec:o,container:r.container},r.buffer=c}catch(e){u.b.error("error while trying to add sourceBuffer:"+e.message),this.hls.trigger(s.a.ERROR,{type:l.b.MEDIA_ERROR,details:l.a.BUFFER_ADD_CODEC_ERROR,fatal:!1,err:e,mimeType:a})}}this.hls.trigger(s.a.BUFFER_CREATED,{tracks:e})},t.prototype.onBufferAppending=function(e){this._needsFlush||(this.segments?this.segments.push(e):this.segments=[e],this.doAppending())},t.prototype.onBufferAppendFail=function(e){u.b.error("sourceBuffer error:",e.event),this.hls.trigger(s.a.ERROR,{type:l.b.MEDIA_ERROR,details:l.a.BUFFER_APPENDING_ERROR,fatal:!1})},t.prototype.onBufferEos=function(e){var t=this.sourceBuffer,i=e.type;for(var n in t)i&&n!==i||t[n].ended||(t[n].ended=!0,u.b.log(n+" sourceBuffer now EOS"));this.checkEos()},t.prototype.checkEos=function(){var e=this.sourceBuffer,t=this.mediaSource;if(!t||"open"!==t.readyState)return void(this._needsEos=!1);for(var i in e){var n=e[i];if(!n.ended)return;if(n.updating)return void(this._needsEos=!0)}u.b.log("all media data available, signal endOfStream() to MediaSource and stop loading fragment");try{t.endOfStream()}catch(e){u.b.warn("exception while calling mediaSource.endOfStream()")}this._needsEos=!1},t.prototype.onBufferFlushing=function(e){this.flushRange.push({start:e.startOffset,end:e.endOffset,type:e.type}),this.flushBufferCounter=0,this.doFlush()},t.prototype.onLevelUpdated=function(e){var t=e.details;t.fragments.length>0&&(this._levelDuration=t.totalduration+t.fragments[0].start,this._live=t.live,this.updateMediaElementDuration())},t.prototype.updateMediaElementDuration=function(){var e=this.hls.config,t=void 0;if(null!==this._levelDuration&&this.media&&this.mediaSource&&this.sourceBuffer&&0!==this.media.readyState&&"open"===this.mediaSource.readyState){for(var i in this.sourceBuffer)if(!0===this.sourceBuffer[i].updating)return;t=this.media.duration,null===this._msDuration&&(this._msDuration=this.mediaSource.duration),!0===this._live&&!0===e.liveDurationInfinity?(u.b.log("Media Source duration is set to Infinity"),this._msDuration=this.mediaSource.duration=1/0):(this._levelDuration>this._msDuration&&this._levelDuration>t||t===1/0||isNaN(t))&&(u.b.log("Updating Media Source duration to "+this._levelDuration.toFixed(3)),this._msDuration=this.mediaSource.duration=this._levelDuration)}},t.prototype.doFlush=function(){for(;this.flushRange.length;){var e=this.flushRange[0];if(!this.flushBuffer(e.start,e.end,e.type))return void(this._needsFlush=!0);this.flushRange.shift(),this.flushBufferCounter=0}if(0===this.flushRange.length){this._needsFlush=!1;var t=0,i=this.sourceBuffer;try{for(var n in i)t+=i[n].buffered.length}catch(e){u.b.error("error while accessing sourceBuffer.buffered")}this.appended=t,this.hls.trigger(s.a.BUFFER_FLUSHED)}},t.prototype.doAppending=function(){var e=this.hls,t=this.sourceBuffer,i=this.segments;if(Object.keys(t).length){if(this.media.error)return this.segments=[],void u.b.error("trying to append although a media error occured, flush segment and abort");if(this.appending)return;if(i&&i.length){var n=i.shift();try{var r=n.type,o=t[r];o?o.updating?i.unshift(n):(o.ended=!1,this.parent=n.parent,o.appendBuffer(n.data),this.appendError=0,this.appended++,this.appending=!0):this.onSBUpdateEnd()}catch(t){u.b.error("error while trying to append buffer:"+t.message),i.unshift(n);var a={type:l.b.MEDIA_ERROR,parent:n.parent};22!==t.code?(this.appendError?this.appendError++:this.appendError=1,a.details=l.a.BUFFER_APPEND_ERROR,this.appendError>e.config.appendErrorMaxRetry?(u.b.log("fail "+e.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),i=[],a.fatal=!0,e.trigger(s.a.ERROR,a)):(a.fatal=!1,e.trigger(s.a.ERROR,a))):(this.segments=[],a.details=l.a.BUFFER_FULL_ERROR,a.fatal=!1,e.trigger(s.a.ERROR,a))}}}},t.prototype.flushBuffer=function(e,t,i){var n=void 0,r=void 0,o=void 0,s=void 0,a=void 0,l=void 0,c=this.sourceBuffer;if(Object.keys(c).length){if(u.b.log("flushBuffer,pos/start/end: "+this.media.currentTime.toFixed(3)+"/"+e+"/"+t),this.flushBufferCounter<this.appended){for(var h in c)if(!i||h===i){if(n=c[h],n.ended=!1,n.updating)return u.b.warn("cannot flush, sb updating in progress"),!1;try{for(r=0;r<n.buffered.length;r++)if(o=n.buffered.start(r),s=n.buffered.end(r),-1!==navigator.userAgent.toLowerCase().indexOf("firefox")&&t===Number.POSITIVE_INFINITY?(a=e,l=t):(a=Math.max(o,e),l=Math.min(s,t)),Math.min(l,s)-a>.5)return this.flushBufferCounter++,u.b.log("flush "+h+" ["+a+","+l+"], of ["+o+","+s+"], pos:"+this.media.currentTime),n.remove(a,l),!1}catch(e){u.b.warn("exception while accessing sourcebuffer, it might have been removed from MediaSource")}}}else u.b.warn("abort flushing too many retries");u.b.log("buffer flushed")}return!0},t}(a.a);t.a=d},function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=i(1),a=i(3),u=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),l=function(e){function t(i){return n(this,t),r(this,e.call(this,i,s.a.FPS_DROP_LEVEL_CAPPING,s.a.MEDIA_ATTACHING,s.a.MANIFEST_PARSED))}return o(t,e),t.prototype.destroy=function(){this.hls.config.capLevelToPlayerSize&&(this.media=this.restrictedLevels=null,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(this.timer=clearInterval(this.timer)))},t.prototype.onFpsDropLevelCapping=function(e){
t.isLevelAllowed(e.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(e.droppedLevel)},t.prototype.onMediaAttaching=function(e){this.media=e.media instanceof HTMLVideoElement?e.media:null},t.prototype.onManifestParsed=function(e){var t=this.hls;this.restrictedLevels=[],t.config.capLevelToPlayerSize&&(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.levels=e.levels,t.firstLevel=this.getMaxLevel(e.firstLevel),clearInterval(this.timer),this.timer=setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},t.prototype.detectPlayerSize=function(){if(this.media){var e=this.levels?this.levels.length:0;if(e){var t=this.hls;t.autoLevelCapping=this.getMaxLevel(e-1),t.autoLevelCapping>this.autoLevelCapping&&t.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}},t.prototype.getMaxLevel=function(e){var i=this;if(!this.levels)return-1;var n=this.levels.filter(function(n,r){return t.isLevelAllowed(r,i.restrictedLevels)&&r<=e});return t.getMaxLevelByMediaSize(n,this.mediaWidth,this.mediaHeight)},t.isLevelAllowed=function(e){return-1===(arguments.length>1&&void 0!==arguments[1]?arguments[1]:[]).indexOf(e)},t.getMaxLevelByMediaSize=function(e,t,i){if(!e||e&&!e.length)return-1;for(var n=e.length-1,r=0;r<e.length;r+=1){var o=e[r];if((o.width>=t||o.height>=i)&&function(e,t){return!t||e.width!==t.width||e.height!==t.height}(o,e[r+1])){n=r;break}}return n},u(t,[{key:"mediaWidth",get:function(){var e=void 0,i=this.media;return i&&(e=i.width||i.clientWidth||i.offsetWidth,e*=t.contentScaleFactor),e}},{key:"mediaHeight",get:function(){var e=void 0,i=this.media;return i&&(e=i.height||i.clientHeight||i.offsetHeight,e*=t.contentScaleFactor),e}}],[{key:"contentScaleFactor",get:function(){var e=1;try{e=window.devicePixelRatio}catch(e){}return e}}]),t}(a.a);t.a=l},function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=i(1),a=i(3),u=i(0),l=function(e){function t(i){return n(this,t),r(this,e.call(this,i,s.a.MEDIA_ATTACHING))}return o(t,e),t.prototype.destroy=function(){this.timer&&clearInterval(this.timer),this.isVideoPlaybackQualityAvailable=!1},t.prototype.onMediaAttaching=function(e){var t=this.hls.config;t.capLevelOnFPSDrop&&("function"==typeof(this.video=e.media instanceof HTMLVideoElement?e.media:null).getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),clearInterval(this.timer),this.timer=setInterval(this.checkFPSInterval.bind(this),t.fpsDroppedMonitoringPeriod))},t.prototype.checkFPS=function(e,t,i){var n=performance.now();if(t){if(this.lastTime){var r=n-this.lastTime,o=i-this.lastDroppedFrames,a=t-this.lastDecodedFrames,l=1e3*o/r,c=this.hls;if(c.trigger(s.a.FPS_DROP,{currentDropped:o,currentDecoded:a,totalDroppedFrames:i}),l>0&&o>c.config.fpsDroppedMonitoringThreshold*a){var h=c.currentLevel;u.b.warn("drop FPS ratio greater than max allowed value for currentLevel: "+h),h>0&&(-1===c.autoLevelCapping||c.autoLevelCapping>=h)&&(h-=1,c.trigger(s.a.FPS_DROP_LEVEL_CAPPING,{level:h,droppedLevel:c.currentLevel}),c.autoLevelCapping=h,c.streamController.nextLevelSwitch())}}this.lastTime=n,this.lastDroppedFrames=i,this.lastDecodedFrames=t}},t.prototype.checkFPSInterval=function(){var e=this.video;if(e)if(this.isVideoPlaybackQualityAvailable){var t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)},t}(a.a);t.a=l},function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=i(0),o=function(){function e(t){n(this,e),t&&t.xhrSetup&&(this.xhrSetup=t.xhrSetup)}return e.prototype.destroy=function(){this.abort(),this.loader=null},e.prototype.abort=function(){var e=this.loader;e&&4!==e.readyState&&(this.stats.aborted=!0,e.abort()),window.clearTimeout(this.requestTimeout),this.requestTimeout=null,window.clearTimeout(this.retryTimeout),this.retryTimeout=null},e.prototype.load=function(e,t,i){this.context=e,this.config=t,this.callbacks=i,this.stats={trequest:performance.now(),retry:0},this.retryDelay=t.retryDelay,this.loadInternal()},e.prototype.loadInternal=function(){var e=void 0,t=this.context;e=this.loader=new XMLHttpRequest;var i=this.stats;i.tfirst=0,i.loaded=0;var n=this.xhrSetup;try{if(n)try{n(e,t.url)}catch(i){e.open("GET",t.url,!0),n(e,t.url)}e.readyState||e.open("GET",t.url,!0)}catch(i){return void this.callbacks.onError({code:e.status,text:i.message},t,e)}t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),this.config.timeout),e.send()},e.prototype.readystatechange=function(e){var t=e.currentTarget,i=t.readyState,n=this.stats,o=this.context,s=this.config;if(!n.aborted&&i>=2)if(window.clearTimeout(this.requestTimeout),0===n.tfirst&&(n.tfirst=Math.max(performance.now(),n.trequest)),4===i){var a=t.status;if(a>=200&&a<300){n.tload=Math.max(n.tfirst,performance.now());var u=void 0,l=void 0;"arraybuffer"===o.responseType?(u=t.response,l=u.byteLength):(u=t.responseText,l=u.length),n.loaded=n.total=l;var c={url:t.responseURL,data:u};this.callbacks.onSuccess(c,n,o,t)}else n.retry>=s.maxRetry||a>=400&&a<499?(r.b.error(a+" while loading "+o.url),this.callbacks.onError({code:a,text:t.statusText},o,t)):(r.b.warn(a+" while loading "+o.url+", retrying in "+this.retryDelay+"..."),this.destroy(),this.retryTimeout=window.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,s.maxRetryDelay),n.retry++)}else this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),s.timeout)},e.prototype.loadtimeout=function(){r.b.warn("timeout while loading "+this.context.url),this.callbacks.onTimeout(this.stats,this.context,null)},e.prototype.loadprogress=function(e){var t=e.currentTarget,i=this.stats;i.loaded=e.loaded,e.lengthComputable&&(i.total=e.total);var n=this.callbacks.onProgress;n&&n(i,this.context,null,t)},e}();t.a=o},function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=i(1),a=i(3),u=i(0),l=i(2),c=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),h=function(e){function t(i){n(this,t);var o=r(this,e.call(this,i,s.a.MANIFEST_LOADING,s.a.MANIFEST_PARSED,s.a.AUDIO_TRACK_LOADED,s.a.ERROR));return o.ticks=0,o.ontick=o.tick.bind(o),o}return o(t,e),t.prototype.destroy=function(){this.cleanTimer(),a.a.prototype.destroy.call(this)},t.prototype.cleanTimer=function(){this.timer&&(clearTimeout(this.timer),this.timer=null)},t.prototype.tick=function(){1==++this.ticks&&(this.doTick(),this.ticks>1&&setTimeout(this.tick,1),this.ticks=0)},t.prototype.doTick=function(){this.updateTrack(this.trackId)},t.prototype.onError=function(e){e.fatal&&e.type===l.b.NETWORK_ERROR&&this.cleanTimer()},t.prototype.onManifestLoading=function(){this.tracks=[],this.trackId=-1},t.prototype.onManifestParsed=function(e){var t=this,i=e.audioTracks||[],n=!1;this.tracks=i,this.hls.trigger(s.a.AUDIO_TRACKS_UPDATED,{audioTracks:i});var r=0;i.forEach(function(e){if(e.default&&!n)return t.audioTrack=r,void(n=!0);r++}),!1===n&&i.length&&(u.b.log("no default audio track defined, use first audio track as default"),this.audioTrack=0)},t.prototype.onAudioTrackLoaded=function(e){e.id<this.tracks.length&&(u.b.log("audioTrack "+e.id+" loaded"),this.tracks[e.id].details=e.details,e.details.live&&!this.timer&&(this.timer=setInterval(this.ontick,1e3*e.details.targetduration)),!e.details.live&&this.timer&&this.cleanTimer())},t.prototype.setAudioTrackInternal=function(e){if(e>=0&&e<this.tracks.length){this.cleanTimer(),this.trackId=e,u.b.log("switching to audioTrack "+e);var t=this.tracks[e],i=this.hls,n=t.type,r=t.url,o={id:e,type:n,url:r};i.trigger(s.a.AUDIO_TRACK_SWITCHING,o);var a=t.details;!r||void 0!==a&&!0!==a.live||(u.b.log("(re)loading playlist for audioTrack "+e),i.trigger(s.a.AUDIO_TRACK_LOADING,{url:r,id:e}))}},t.prototype.updateTrack=function(e){if(e>=0&&e<this.tracks.length){this.cleanTimer(),this.trackId=e,u.b.log("updating audioTrack "+e);var t=this.tracks[e],i=t.url,n=t.details;!i||void 0!==n&&!0!==n.live||(u.b.log("(re)loading playlist for audioTrack "+e),this.hls.trigger(s.a.AUDIO_TRACK_LOADING,{url:i,id:e}))}},c(t,[{key:"audioTracks",get:function(){return this.tracks}},{key:"audioTrack",get:function(){return this.trackId},set:function(e){this.trackId===e&&void 0!==this.tracks[e].details||this.setAudioTrackInternal(e)}}]),t}(a.a);t.a=h},function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=i(7),a=i(8),u=i(18),l=i(1),c=i(22),h=i(23),d=i(2),f=i(0),p=i(24),g=i(13),m=i(12),v=i(6),y=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),b={STOPPED:"STOPPED",STARTING:"STARTING",IDLE:"IDLE",PAUSED:"PAUSED",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",BUFFER_FLUSHING:"BUFFER_FLUSHING",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS"},w=function(e){function t(i,o){n(this,t);var s=r(this,e.call(this,i,l.a.MEDIA_ATTACHED,l.a.MEDIA_DETACHING,l.a.AUDIO_TRACKS_UPDATED,l.a.AUDIO_TRACK_SWITCHING,l.a.AUDIO_TRACK_LOADED,l.a.KEY_LOADED,l.a.FRAG_LOADED,l.a.FRAG_PARSING_INIT_SEGMENT,l.a.FRAG_PARSING_DATA,l.a.FRAG_PARSED,l.a.ERROR,l.a.BUFFER_RESET,l.a.BUFFER_CREATED,l.a.BUFFER_APPENDED,l.a.BUFFER_FLUSHED,l.a.INIT_PTS_FOUND));return s.fragmentTracker=o,s.config=i.config,s.audioCodecSwap=!1,s._state=b.STOPPED,s.initPTS=[],s.waitingFragment=null,s.videoTrackCC=null,s}return o(t,e),t.prototype.onHandlerDestroying=function(){this.stopLoad()},t.prototype.onHandlerDestroyed=function(){this.state=b.STOPPED,this.fragmentTracker=null},t.prototype.onInitPtsFound=function(e){var t=e.id,i=e.frag.cc,n=e.initPTS;"main"===t&&(this.initPTS[i]=n,this.videoTrackCC=i,f.b.log("InitPTS for cc: "+i+" found from video track: "+n),this.state===b.WAITING_INIT_PTS&&this.tick())},t.prototype.startLoad=function(e){if(this.tracks){var t=this.lastCurrentTime;this.stopLoad(),this.setInterval(100),this.fragLoadError=0,t>0&&-1===e?(f.b.log("audio:override startPosition with lastCurrentTime @"+t.toFixed(3)),this.state=b.IDLE):(this.lastCurrentTime=this.startPosition?this.startPosition:e,this.state=b.STARTING),this.nextLoadPosition=this.startPosition=this.lastCurrentTime,this.tick()}else this.startPosition=e,this.state=b.STOPPED},t.prototype.stopLoad=function(){var e=this.fragCurrent;e&&(e.loader&&e.loader.abort(),this.fragmentTracker.removeFragment(e),this.fragCurrent=null),this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=b.STOPPED},t.prototype.doTick=function(){var e=void 0,t=void 0,i=void 0,n=this.hls,r=n.config;switch(this.state){case b.ERROR:case b.PAUSED:case b.BUFFER_FLUSHING:break;case b.STARTING:this.state=b.WAITING_TRACK,this.loadedmetadata=!1;break;case b.IDLE:var o=this.tracks;if(!o)break;if(!this.media&&(this.startFragRequested||!r.startFragPrefetch))break;if(this.loadedmetadata)e=this.media.currentTime;else if(void 0===(e=this.nextLoadPosition))break;var u=this.mediaBuffer?this.mediaBuffer:this.media,c=this.videoBuffer?this.videoBuffer:this.media,h=a.a.bufferInfo(u,e,r.maxBufferHole),d=a.a.bufferInfo(c,e,r.maxBufferHole),g=h.len,v=h.end,y=this.fragPrevious,w=Math.min(r.maxBufferLength,r.maxMaxBufferLength),E=Math.max(w,d.len),_=this.audioSwitch,T=this.trackId;if((g<E||_)&&T<o.length){if(void 0===(i=o[T].details)){this.state=b.WAITING_TRACK;break}if(!_&&!i.live&&y&&y.sn===i.endSN&&!h.nextStart&&(!this.media.seeking||this.media.duration-v<y.duration/2)){this.hls.trigger(l.a.BUFFER_EOS,{type:"audio"}),this.state=b.ENDED;break}var S=i.fragments,A=S.length,P=S[0].start,I=S[A-1].start+S[A-1].duration,x=void 0;if(_)if(i.live&&!i.PTSKnown)f.b.log("switching audiotrack, live stream, unknown PTS,load first fragment"),v=0;else if(v=e,i.PTSKnown&&e<P){if(!(h.end>P||h.nextStart))return;f.b.log("alt audio track ahead of main track, seek to start of alt audio track"),this.media.currentTime=P+.05}if(i.initSegment&&!i.initSegment.data)x=i.initSegment;else if(v<=P){if(x=S[0],null!==this.videoTrackCC&&x.cc!==this.videoTrackCC&&(x=Object(p.b)(S,this.videoTrackCC)),i.live&&x.loadIdx&&x.loadIdx===this.fragLoadIdx){var C=h.nextStart?h.nextStart:P;return f.b.log("no alt audio available @currentTime:"+this.media.currentTime+", seeking @"+(C+.05)),void(this.media.currentTime=C+.05)}}else{var R=void 0,k=r.maxFragLookUpTolerance,O=y?S[y.sn-S[0].sn+1]:void 0,L=function(e){var t=Math.min(k,e.duration);return e.start+e.duration-t<=v?1:e.start-t>v&&e.start?-1:0};v<I?(v>I-k&&(k=0),R=O&&!L(O)?O:s.a.search(S,L)):R=S[A-1],R&&(x=R,P=R.start,y&&x.level===y.level&&x.sn===y.sn&&(x.sn<i.endSN?(x=S[x.sn+1-i.startSN],f.b.log("SN just loaded, load next one: "+x.sn)):x=null))}x&&(x.decryptdata&&null!=x.decryptdata.uri&&null==x.decryptdata.key?(f.b.log("Loading key for "+x.sn+" of ["+i.startSN+" ,"+i.endSN+"],track "+T),this.state=b.KEY_LOADING,n.trigger(l.a.KEY_LOADING,{frag:x})):(f.b.log("Loading "+x.sn+", cc: "+x.cc+" of ["+i.startSN+" ,"+i.endSN+"],track "+T+", currentTime:"+e+",bufferEnd:"+v.toFixed(3)),this.fragmentTracker.getState(x)===m.a.NOT_LOADED&&(this.fragCurrent=x,this.startFragRequested=!0,isNaN(x.sn)||(this.nextLoadPosition=x.start+x.duration),n.trigger(l.a.FRAG_LOADING,{frag:x}),this.state=b.FRAG_LOADING)))}break;case b.WAITING_TRACK:(t=this.tracks[this.trackId])&&t.details&&(this.state=b.IDLE);break;case b.FRAG_LOADING_WAITING_RETRY:var D=performance.now(),M=this.retryDate;u=this.media;var N=u&&u.seeking;(!M||D>=M||N)&&(f.b.log("audioStreamController: retryDate reached, switch back to IDLE state"),this.state=b.IDLE);break;case b.WAITING_INIT_PTS:var F=this.videoTrackCC;if(void 0===this.initPTS[F])break;var V=this.waitingFragment;if(V){var U=V.frag.cc;F!==U?(t=this.tracks[this.trackId],t.details&&t.details.live&&(f.b.warn("Waiting fragment CC ("+U+") does not match video track CC ("+F+")"),this.waitingFragment=null,this.state=b.IDLE)):(this.state=b.FRAG_LOADING,this.onFragLoaded(this.waitingFragment),this.waitingFragment=null)}else this.state=b.IDLE;break;case b.STOPPED:case b.FRAG_LOADING:case b.PARSING:case b.PARSED:case b.ENDED:}},t.prototype.onMediaAttached=function(e){var t=this.media=this.mediaBuffer=e.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),t.addEventListener("seeking",this.onvseeking),t.addEventListener("ended",this.onvended);var i=this.config;this.tracks&&i.autoStartLoad&&this.startLoad(i.startPosition)},t.prototype.onMediaDetaching=function(){var e=this.media;e&&e.ended&&(f.b.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),e&&(e.removeEventListener("seeking",this.onvseeking),e.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1,this.stopLoad()},t.prototype.onMediaSeeking=function(){this.state===b.ENDED&&(this.state=b.IDLE),this.media&&(this.lastCurrentTime=this.media.currentTime),this.tick()},t.prototype.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},t.prototype.onAudioTracksUpdated=function(e){f.b.log("audio tracks updated"),this.tracks=e.audioTracks},t.prototype.onAudioTrackSwitching=function(e){var t=!!e.url;this.trackId=e.id,this.fragCurrent=null,this.state=b.PAUSED,this.waitingFragment=null,t?this.setInterval(100):this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),t&&(this.audioSwitch=!0,this.state=b.IDLE),this.tick()},t.prototype.onAudioTrackLoaded=function(e){var t=e.details,i=e.id,n=this.tracks[i],r=t.totalduration,o=0;if(f.b.log("track "+i+" loaded ["+t.startSN+","+t.endSN+"],duration:"+r),t.live){var s=n.details;s&&t.fragments.length>0?(c.a(s,t),o=t.fragments[0].start,t.PTSKnown?f.b.log("live audio playlist sliding:"+o.toFixed(3)):f.b.log("live audio playlist - outdated PTS, unknown sliding")):(t.PTSKnown=!1,f.b.log("live audio playlist - first load, unknown sliding"))}else t.PTSKnown=!1;if(n.details=t,!this.startFragRequested){if(-1===this.startPosition){var a=t.startTimeOffset;isNaN(a)?this.startPosition=0:(f.b.log("start time offset found in playlist, adjust startPosition to "+a),this.startPosition=a)}this.nextLoadPosition=this.startPosition}this.state===b.WAITING_TRACK&&(this.state=b.IDLE),this.tick()},t.prototype.onKeyLoaded=function(){this.state===b.KEY_LOADING&&(this.state=b.IDLE,this.tick())},t.prototype.onFragLoaded=function(e){var t=this.fragCurrent,i=e.frag;if(this.state===b.FRAG_LOADING&&t&&"audio"===i.type&&i.level===t.level&&i.sn===t.sn){var n=this.tracks[this.trackId],r=n.details,o=r.totalduration,s=t.level,a=t.sn,c=t.cc,h=this.config.defaultAudioCodec||n.audioCodec||"mp4a.40.2",d=this.stats=e.stats;if("initSegment"===a)this.state=b.IDLE,d.tparsed=d.tbuffered=performance.now(),r.initSegment.data=e.payload,this.hls.trigger(l.a.FRAG_BUFFERED,{stats:d,frag:t,id:"audio"}),this.tick();else{this.state=b.PARSING,this.appended=!1,this.demuxer||(this.demuxer=new u.a(this.hls,"audio"));var p=this.initPTS[c],g=r.initSegment?r.initSegment.data:[];r.initSegment||void 0!==p?(this.pendingBuffering=!0,f.b.log("Demuxing "+a+" of ["+r.startSN+" ,"+r.endSN+"],track "+s),this.demuxer.push(e.payload,g,h,null,t,o,!1,p)):(f.b.log("unknown video PTS for continuity counter "+c+", waiting for video PTS before demuxing audio frag "+a+" of ["+r.startSN+" ,"+r.endSN+"],track "+s),this.waitingFragment=e,this.state=b.WAITING_INIT_PTS)}}this.fragLoadError=0},t.prototype.onFragParsingInitSegment=function(e){var t=this.fragCurrent,i=e.frag;if(t&&"audio"===e.id&&i.sn===t.sn&&i.level===t.level&&this.state===b.PARSING){var n=e.tracks,r=void 0;if(n.video&&delete n.video,r=n.audio){r.levelCodec=r.codec,r.id=e.id,this.hls.trigger(l.a.BUFFER_CODECS,n),f.b.log("audio track:audio,container:"+r.container+",codecs[level/parsed]=["+r.levelCodec+"/"+r.codec+"]");var o=r.initSegment;if(o){var s={type:"audio",data:o,parent:"audio",content:"initSegment"};this.audioSwitch?this.pendingData=[s]:(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(l.a.BUFFER_APPENDING,s))}this.tick()}}},t.prototype.onFragParsingData=function(e){var t=this,i=this.fragCurrent,n=e.frag;if(i&&"audio"===e.id&&"audio"===e.type&&n.sn===i.sn&&n.level===i.level&&this.state===b.PARSING){var r=this.trackId,o=this.tracks[r],s=this.hls;isNaN(e.endPTS)&&(e.endPTS=e.startPTS+i.duration,e.endDTS=e.startDTS+i.duration),i.addElementaryStream(v.a.ElementaryStreamTypes.AUDIO),f.b.log("parsed "+e.type+",PTS:["+e.startPTS.toFixed(3)+","+e.endPTS.toFixed(3)+"],DTS:["+e.startDTS.toFixed(3)+"/"+e.endDTS.toFixed(3)+"],nb:"+e.nb),c.b(o.details,i,e.startPTS,e.endPTS);var a=this.audioSwitch,u=this.media,h=!1;if(a&&u)if(u.readyState){var p=u.currentTime;f.b.log("switching audio track : currentTime:"+p),p>=e.startPTS&&(f.b.log("switching audio track : flushing all audio"),this.state=b.BUFFER_FLUSHING,s.trigger(l.a.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),h=!0,this.audioSwitch=!1,s.trigger(l.a.AUDIO_TRACK_SWITCHED,{id:r}))}else this.audioSwitch=!1,s.trigger(l.a.AUDIO_TRACK_SWITCHED,{id:r});var g=this.pendingData;if(!g)return console.warn("Apparently attempt to enqueue media payload without codec initialization data upfront"),void s.trigger(l.a.ERROR,{type:d.b.MEDIA_ERROR,details:null,fatal:!0});this.audioSwitch||([e.data1,e.data2].forEach(function(t){t&&t.length&&g.push({type:e.type,data:t,parent:"audio",content:"data"})}),!h&&g.length&&(g.forEach(function(e){t.state===b.PARSING&&(t.pendingBuffering=!0,t.hls.trigger(l.a.BUFFER_APPENDING,e))}),this.pendingData=[],this.appended=!0)),this.tick()}},t.prototype.onFragParsed=function(e){var t=this.fragCurrent,i=e.frag;t&&"audio"===e.id&&i.sn===t.sn&&i.level===t.level&&this.state===b.PARSING&&(this.stats.tparsed=performance.now(),this.state=b.PARSED,this._checkAppendedParsed())},t.prototype.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},t.prototype.onBufferCreated=function(e){var t=e.tracks.audio;t&&(this.mediaBuffer=t.buffer,this.loadedmetadata=!0),e.tracks.video&&(this.videoBuffer=e.tracks.video.buffer)},t.prototype.onBufferAppended=function(e){if("audio"===e.parent){var t=this.state;t!==b.PARSING&&t!==b.PARSED||(this.pendingBuffering=e.pending>0,this._checkAppendedParsed())}},t.prototype._checkAppendedParsed=function(){if(!(this.state!==b.PARSED||this.appended&&this.pendingBuffering)){var e=this.fragCurrent,t=this.stats,i=this.hls;if(e){this.fragPrevious=e,t.tbuffered=performance.now(),i.trigger(l.a.FRAG_BUFFERED,{stats:t,frag:e,id:"audio"});var n=this.mediaBuffer?this.mediaBuffer:this.media;f.b.log("audio buffered : "+h.a.toString(n.buffered)),this.audioSwitch&&this.appended&&(this.audioSwitch=!1,i.trigger(l.a.AUDIO_TRACK_SWITCHED,{id:this.trackId})),this.state=b.IDLE}this.tick()}},t.prototype.onError=function(e){var t=e.frag;if(!t||"audio"===t.type)switch(e.details){case d.a.FRAG_LOAD_ERROR:case d.a.FRAG_LOAD_TIMEOUT:if(!e.fatal){var i=this.fragLoadError;i?i++:i=1;var n=this.config;if(i<=n.fragLoadingMaxRetry){this.fragLoadError=i;var r=Math.min(Math.pow(2,i-1)*n.fragLoadingRetryDelay,n.fragLoadingMaxRetryTimeout);f.b.warn("audioStreamController: frag loading failed, retry in "+r+" ms"),this.retryDate=performance.now()+r,this.state=b.FRAG_LOADING_WAITING_RETRY}else f.b.error("audioStreamController: "+e.details+" reaches max retry, redispatch as fatal ..."),e.fatal=!0,this.state=b.ERROR}break;case d.a.AUDIO_TRACK_LOAD_ERROR:case d.a.AUDIO_TRACK_LOAD_TIMEOUT:case d.a.KEY_LOAD_ERROR:case d.a.KEY_LOAD_TIMEOUT:this.state!==b.ERROR&&(this.state=e.fatal?b.ERROR:b.IDLE,f.b.warn("audioStreamController: "+e.details+" while loading frag,switch to "+this.state+" state ..."));break;case d.a.BUFFER_FULL_ERROR:if("audio"===e.parent&&(this.state===b.PARSING||this.state===b.PARSED)){var o=this.mediaBuffer,s=this.media.currentTime;if(o&&a.a.isBuffered(o,s)&&a.a.isBuffered(o,s+.5)){var u=this.config;u.maxMaxBufferLength>=u.maxBufferLength&&(u.maxMaxBufferLength/=2,f.b.warn("audio:reduce max buffer length to "+u.maxMaxBufferLength+"s")),this.state=b.IDLE}else f.b.warn("buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,this.state=b.BUFFER_FLUSHING,this.hls.trigger(l.a.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"})}}},t.prototype.onBufferFlushed=function(){var e=this,t=this.pendingData;t&&t.length?(f.b.log("appending pending audio data on Buffer Flushed"),t.forEach(function(t){e.hls.trigger(l.a.BUFFER_APPENDING,t)}),this.appended=!0,this.pendingData=[],this.state=b.PARSED):(this.state=b.IDLE,this.fragPrevious=null,this.tick())},y(t,[{key:"state",set:function(e){if(this.state!==e){var t=this.state;this._state=e,f.b.log("audio stream:"+t+"->"+e)}},get:function(){return this._state}}]),t}(g.a);t.a=w},function(e,t,i){"use strict";function n(e,t,i,n){for(var o=void 0,s=void 0,a=void 0,u=void 0,l=void 0,c=window.VTTCue||window.TextTrackCue,h=0;h<n.rows.length;h++)if(o=n.rows[h],a=!0,u=0,l="",!o.isEmpty()){for(var d=0;d<o.chars.length;d++)o.chars[d].uchar.match(/\s/)&&a?u++:(l+=o.chars[d].uchar,a=!1);o.cueStartTime=t,t===i&&(i+=1e-4),s=new c(t,i,Object(r.b)(l.trim())),u>=16?u--:u++,navigator.userAgent.match(/Firefox\//)?s.line=h+1:s.line=h>7?h-2:h+1,s.align="left",s.position=Math.max(0,Math.min(100,u/32*100+(navigator.userAgent.match(/Firefox\//)?50:0))),e.addCue(s)}}Object.defineProperty(t,"__esModule",{value:!0}),t.newCue=n;var r=i(26)},function(e,t,i){"use strict";t.a=function(){function e(e){return"string"==typeof e&&!!o[e.toLowerCase()]&&e.toLowerCase()}function t(e){return"string"==typeof e&&!!s[e.toLowerCase()]&&e.toLowerCase()}function i(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)e[n]=i[n]}return e}function n(n,o,s){var a=this,u=function(){if("undefined"!=typeof navigator)return/MSIE\s8\.0/.test(navigator.userAgent)}(),l={};u?a=document.createElement("custom"):l.enumerable=!0,a.hasBeenReset=!1;var c="",h=!1,d=n,f=o,p=s,g=null,m="",v=!0,y="auto",b="start",w=50,E="middle",_=50,T="middle";if(Object.defineProperty(a,"id",i({},l,{get:function(){return c},set:function(e){c=""+e}})),Object.defineProperty(a,"pauseOnExit",i({},l,{get:function(){return h},set:function(e){h=!!e}})),Object.defineProperty(a,"startTime",i({},l,{get:function(){return d},set:function(e){if("number"!=typeof e)throw new TypeError("Start time must be set to a number.");d=e,this.hasBeenReset=!0}})),Object.defineProperty(a,"endTime",i({},l,{get:function(){return f},set:function(e){if("number"!=typeof e)throw new TypeError("End time must be set to a number.");f=e,this.hasBeenReset=!0}})),Object.defineProperty(a,"text",i({},l,{get:function(){return p},set:function(e){p=""+e,this.hasBeenReset=!0}})),Object.defineProperty(a,"region",i({},l,{get:function(){return g},set:function(e){g=e,this.hasBeenReset=!0}})),Object.defineProperty(a,"vertical",i({},l,{get:function(){return m},set:function(t){var i=e(t);if(!1===i)throw new SyntaxError("An invalid or illegal string was specified.");m=i,this.hasBeenReset=!0}})),Object.defineProperty(a,"snapToLines",i({},l,{get:function(){return v},set:function(e){v=!!e,this.hasBeenReset=!0}})),Object.defineProperty(a,"line",i({},l,{get:function(){return y},set:function(e){if("number"!=typeof e&&e!==r)throw new SyntaxError("An invalid number or illegal string was specified.");y=e,this.hasBeenReset=!0}})),Object.defineProperty(a,"lineAlign",i({},l,{get:function(){return b},set:function(e){var i=t(e);if(!i)throw new SyntaxError("An invalid or illegal string was specified.");b=i,this.hasBeenReset=!0}})),Object.defineProperty(a,"position",i({},l,{get:function(){return w},set:function(e){if(e<0||e>100)throw new Error("Position must be between 0 and 100.");w=e,this.hasBeenReset=!0}})),Object.defineProperty(a,"positionAlign",i({},l,{get:function(){return E},set:function(e){var i=t(e);if(!i)throw new SyntaxError("An invalid or illegal string was specified.");E=i,this.hasBeenReset=!0}})),Object.defineProperty(a,"size",i({},l,{get:function(){return _},set:function(e){if(e<0||e>100)throw new Error("Size must be between 0 and 100.");_=e,this.hasBeenReset=!0}})),Object.defineProperty(a,"align",i({},l,{get:function(){return T},set:function(e){var i=t(e);if(!i)throw new SyntaxError("An invalid or illegal string was specified.");T=i,this.hasBeenReset=!0}})),a.displayState=void 0,u)return a}if("undefined"!=typeof window&&window.VTTCue)return window.VTTCue;var r="auto",o={"":!0,lr:!0,rl:!0},s={start:!0,middle:!0,end:!0,left:!0,right:!0};return n.prototype.getCueAsHTML=function(){return window.WebVTT.convertCueToDOMTree(window,this.text)},n}()},function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function s(e,t){return e&&e.label===t.name&&!(e.textTrack1||e.textTrack2)}function a(e,t,i,n){return Math.min(t,n)-Math.max(e,i)}var u=i(1),l=i(3),c=i(63),h=i(64),d=i(65),f=i(0),p=i(25),g=function(e){function t(i){n(this,t);var o=r(this,e.call(this,i,u.a.MEDIA_ATTACHING,u.a.MEDIA_DETACHING,u.a.FRAG_PARSING_USERDATA,u.a.FRAG_DECRYPTED,u.a.MANIFEST_LOADING,u.a.MANIFEST_LOADED,u.a.FRAG_LOADED,u.a.LEVEL_SWITCHING,u.a.INIT_PTS_FOUND));if(o.hls=i,o.config=i.config,o.enabled=!0,o.Cues=i.config.cueHandler,o.textTracks=[],o.tracks=[],o.unparsedVttFrags=[],o.initPTS=void 0,o.cueRanges=[],o.config.enableCEA708Captions){var s=new h.a(o,1),a=new h.a(o,2);o.cea608Parser=new c.a(0,s,a)}return o}return o(t,e),t.prototype.addCues=function(e,t,i,n){for(var r=this.cueRanges,o=!1,s=r.length;s--;){var u=r[s],l=a(u[0],u[1],t,i);if(l>=0&&(u[0]=Math.min(u[0],t),u[1]=Math.max(u[1],i),o=!0,l/(i-t)>.5))return}o||r.push([t,i]),this.Cues.newCue(this[e],t,i,n)},t.prototype.onInitPtsFound=function(e){var t=this;void 0===this.initPTS&&(this.initPTS=e.initPTS),this.unparsedVttFrags.length&&(this.unparsedVttFrags.forEach(function(e){t.onFragLoaded(e)}),this.unparsedVttFrags=[])},t.prototype.getExistingTrack=function(e){var t=this.media;if(t)for(var i=0;i<t.textTracks.length;i++){var n=t.textTracks[i],r="textTrack"+e;if(!0===n[r])return n}return null},t.prototype.createCaptionsTrack=function(e){var t="textTrack"+e;if(!this[t]){var i=this.getExistingTrack(e);if(i)this[t]=i,Object(p.a)(this[t]),Object(p.b)(this[t],this.media);else{var n=this.createTextTrack("captions",this.config["captionsTextTrack"+e+"Label"],this.config["captionsTextTrack"+e+"LanguageCode"]);n&&(n[t]=!0,this[t]=n)}}},t.prototype.createTextTrack=function(e,t,i){var n=this.media;if(n)return n.addTextTrack(e,t,i)},t.prototype.destroy=function(){l.a.prototype.destroy.call(this)},t.prototype.onMediaAttaching=function(e){this.media=e.media,this._cleanTracks()},t.prototype.onMediaDetaching=function(){Object(p.a)(this.textTrack1),Object(p.a)(this.textTrack2)},t.prototype.onManifestLoading=function(){this.lastSn=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0},this._cleanTracks()},t.prototype._cleanTracks=function(){var e=this.media;if(e){var t=e.textTracks;if(t)for(var i=0;i<t.length;i++)Object(p.a)(t[i])}},t.prototype.onManifestLoaded=function(e){var t=this;if(this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=void 0,this.cueRanges=[],this.config.enableWebVTT){this.tracks=e.subtitles||[];var i=this.media?this.media.textTracks:[];this.tracks.forEach(function(e,n){var r=void 0
;if(n<i.length){var o=i[n];s(o,e)&&(r=o)}r||(r=t.createTextTrack("subtitles",e.name,e.lang)),e.default?r.mode=t.hls.subtitleDisplay?"showing":"hidden":r.mode="disabled",t.textTracks.push(r)})}},t.prototype.onLevelSwitching=function(){this.enabled="NONE"!==this.hls.currentLevel.closedCaptions},t.prototype.onFragLoaded=function(e){var t=e.frag,i=e.payload;if("main"===t.type){var n=t.sn;if(n!==this.lastSn+1){var r=this.cea608Parser;r&&r.reset()}this.lastSn=n}else if("subtitle"===t.type)if(i.byteLength){if(void 0===this.initPTS)return void this.unparsedVttFrags.push(e);var o=t.decryptdata;null!=o&&null!=o.key&&"AES-128"===o.method||this._parseVTTs(t,i)}else this.hls.trigger(u.a.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t})},t.prototype._parseVTTs=function(e,t){var i=this.vttCCs;i[e.cc]||(i[e.cc]={start:e.start,prevCC:this.prevCC,new:!0},this.prevCC=e.cc);var n=this.textTracks,r=this.hls;d.a.parse(t,this.initPTS,i,e.cc,function(t){var i=n[e.trackId];if("disabled"===i.mode)return void r.trigger(u.a.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e});t.forEach(function(e){if(!i.cues.getCueById(e.id))try{i.addCue(e)}catch(n){var t=new window.TextTrackCue(e.startTime,e.endTime,e.text);t.id=e.id,i.addCue(t)}}),r.trigger(u.a.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},function(t){f.b.log("Failed to parse VTT cue: "+t),r.trigger(u.a.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e})})},t.prototype.onFragDecrypted=function(e){var t=e.payload,i=e.frag;if("subtitle"===i.type){if(void 0===this.initPTS)return void this.unparsedVttFrags.push(e);this._parseVTTs(i,t)}},t.prototype.onFragParsingUserdata=function(e){if(this.enabled&&this.config.enableCEA708Captions)for(var t=0;t<e.samples.length;t++){var i=this.extractCea608Data(e.samples[t].bytes);this.cea608Parser.addData(e.samples[t].pts,i)}},t.prototype.extractCea608Data=function(e){for(var t=31&e[0],i=2,n=void 0,r=void 0,o=void 0,s=void 0,a=void 0,u=[],l=0;l<t;l++)n=e[i++],r=127&e[i++],o=127&e[i++],s=0!=(4&n),a=3&n,0===r&&0===o||s&&0===a&&(u.push(r),u.push(o));return u},t}(l.a);t.a=g},function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},o=function(e){var t=e;return r.hasOwnProperty(e)&&(t=r[e]),String.fromCharCode(t)},s=15,a=100,u={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},l={17:2,18:4,21:6,22:8,23:10,19:13,20:15},c={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},h={25:2,26:4,29:6,30:8,31:10,27:13,28:15},d=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],f={verboseFilter:{DATA:3,DEBUG:3,INFO:2,WARNING:2,TEXT:1,ERROR:0},time:null,verboseLevel:0,setTime:function(e){this.time=e},log:function(e,t){var i=this.verboseFilter[e];this.verboseLevel>=i&&console.log(this.time+" ["+e+"] "+t)}},p=function(e){for(var t=[],i=0;i<e.length;i++)t.push(e[i].toString(16));return t},g=function(){function e(t,i,r,o,s){n(this,e),this.foreground=t||"white",this.underline=i||!1,this.italics=r||!1,this.background=o||"black",this.flash=s||!1}return e.prototype.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},e.prototype.setStyles=function(e){for(var t=["foreground","underline","italics","background","flash"],i=0;i<t.length;i++){var n=t[i];e.hasOwnProperty(n)&&(this[n]=e[n])}},e.prototype.isDefault=function(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash},e.prototype.equals=function(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash},e.prototype.copy=function(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash},e.prototype.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},e}(),m=function(){function e(t,i,r,o,s,a){n(this,e),this.uchar=t||" ",this.penState=new g(i,r,o,s,a)}return e.prototype.reset=function(){this.uchar=" ",this.penState.reset()},e.prototype.setChar=function(e,t){this.uchar=e,this.penState.copy(t)},e.prototype.setPenState=function(e){this.penState.copy(e)},e.prototype.equals=function(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)},e.prototype.copy=function(e){this.uchar=e.uchar,this.penState.copy(e.penState)},e.prototype.isEmpty=function(){return" "===this.uchar&&this.penState.isDefault()},e}(),v=function(){function e(){n(this,e),this.chars=[];for(var t=0;t<a;t++)this.chars.push(new m);this.pos=0,this.currPenState=new g}return e.prototype.equals=function(e){for(var t=!0,i=0;i<a;i++)if(!this.chars[i].equals(e.chars[i])){t=!1;break}return t},e.prototype.copy=function(e){for(var t=0;t<a;t++)this.chars[t].copy(e.chars[t])},e.prototype.isEmpty=function(){for(var e=!0,t=0;t<a;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e},e.prototype.setCursor=function(e){this.pos!==e&&(this.pos=e),this.pos<0?(f.log("ERROR","Negative cursor position "+this.pos),this.pos=0):this.pos>a&&(f.log("ERROR","Too large cursor position "+this.pos),this.pos=a)},e.prototype.moveCursor=function(e){var t=this.pos+e;if(e>1)for(var i=this.pos+1;i<t+1;i++)this.chars[i].setPenState(this.currPenState);this.setCursor(t)},e.prototype.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},e.prototype.insertChar=function(e){e>=144&&this.backSpace();var t=o(e);if(this.pos>=a)return void f.log("ERROR","Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!");this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1)},e.prototype.clearFromPos=function(e){var t=void 0;for(t=e;t<a;t++)this.chars[t].reset()},e.prototype.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},e.prototype.clearToEndOfRow=function(){this.clearFromPos(this.pos)},e.prototype.getTextString=function(){for(var e=[],t=!0,i=0;i<a;i++){var n=this.chars[i].uchar;" "!==n&&(t=!1),e.push(n)}return t?"":e.join("")},e.prototype.setPenStyles=function(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)},e}(),y=function(){function e(){n(this,e),this.rows=[];for(var t=0;t<s;t++)this.rows.push(new v);this.currRow=s-1,this.nrRollUpRows=null,this.reset()}return e.prototype.reset=function(){for(var e=0;e<s;e++)this.rows[e].clear();this.currRow=s-1},e.prototype.equals=function(e){for(var t=!0,i=0;i<s;i++)if(!this.rows[i].equals(e.rows[i])){t=!1;break}return t},e.prototype.copy=function(e){for(var t=0;t<s;t++)this.rows[t].copy(e.rows[t])},e.prototype.isEmpty=function(){for(var e=!0,t=0;t<s;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e},e.prototype.backSpace=function(){this.rows[this.currRow].backSpace()},e.prototype.clearToEndOfRow=function(){this.rows[this.currRow].clearToEndOfRow()},e.prototype.insertChar=function(e){this.rows[this.currRow].insertChar(e)},e.prototype.setPen=function(e){this.rows[this.currRow].setPenStyles(e)},e.prototype.moveCursor=function(e){this.rows[this.currRow].moveCursor(e)},e.prototype.setCursor=function(e){f.log("INFO","setCursor: "+e),this.rows[this.currRow].setCursor(e)},e.prototype.setPAC=function(e){f.log("INFO","pacData = "+JSON.stringify(e));var t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(var i=0;i<s;i++)this.rows[i].clear();var n=this.currRow+1-this.nrRollUpRows,r=this.lastOutputScreen;if(r){var o=r.rows[n].cueStartTime;if(o&&o<f.time)for(var a=0;a<this.nrRollUpRows;a++)this.rows[t-this.nrRollUpRows+a+1].copy(r.rows[n+a])}}this.currRow=t;var u=this.rows[this.currRow];if(null!==e.indent){var l=e.indent,c=Math.max(l-1,0);u.setCursor(e.indent),e.color=u.chars[c].penState.foreground}var h={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(h)},e.prototype.setBkgData=function(e){f.log("INFO","bkgData = "+JSON.stringify(e)),this.backSpace(),this.setPen(e),this.insertChar(32)},e.prototype.setRollUpRows=function(e){this.nrRollUpRows=e},e.prototype.rollUp=function(){if(null===this.nrRollUpRows)return void f.log("DEBUG","roll_up but nrRollUpRows not set yet");f.log("TEXT",this.getDisplayText());var e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),f.log("INFO","Rolling up")},e.prototype.getDisplayText=function(e){e=e||!1;for(var t=[],i="",n=-1,r=0;r<s;r++){var o=this.rows[r].getTextString();o&&(n=r+1,e?t.push("Row "+n+": '"+o+"'"):t.push(o.trim()))}return t.length>0&&(i=e?"["+t.join(" | ")+"]":t.join("\n")),i},e.prototype.getTextAndFormat=function(){return this.rows},e}(),b=function(){function e(t,i){n(this,e),this.chNr=t,this.outputFilter=i,this.mode=null,this.verbose=0,this.displayedMemory=new y,this.nonDisplayedMemory=new y,this.lastOutputScreen=new y,this.currRollUpRow=this.displayedMemory.rows[s-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}return e.prototype.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.currRollUpRow=this.displayedMemory.rows[s-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.lastCueEndTime=null},e.prototype.getHandler=function(){return this.outputFilter},e.prototype.setHandler=function(e){this.outputFilter=e},e.prototype.setPAC=function(e){this.writeScreen.setPAC(e)},e.prototype.setBkgData=function(e){this.writeScreen.setBkgData(e)},e.prototype.setMode=function(e){e!==this.mode&&(this.mode=e,f.log("INFO","MODE="+e),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)},e.prototype.insertChars=function(e){for(var t=0;t<e.length;t++)this.writeScreen.insertChar(e[t]);var i=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";f.log("INFO",i+": "+this.writeScreen.getDisplayText(!0)),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(f.log("TEXT","DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},e.prototype.ccRCL=function(){f.log("INFO","RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},e.prototype.ccBS=function(){f.log("INFO","BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},e.prototype.ccAOF=function(){},e.prototype.ccAON=function(){},e.prototype.ccDER=function(){f.log("INFO","DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},e.prototype.ccRU=function(e){f.log("INFO","RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)},e.prototype.ccFON=function(){f.log("INFO","FON - Flash On"),this.writeScreen.setPen({flash:!0})},e.prototype.ccRDC=function(){f.log("INFO","RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},e.prototype.ccTR=function(){f.log("INFO","TR"),this.setMode("MODE_TEXT")},e.prototype.ccRTD=function(){f.log("INFO","RTD"),this.setMode("MODE_TEXT")},e.prototype.ccEDM=function(){f.log("INFO","EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},e.prototype.ccCR=function(){f.log("CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},e.prototype.ccENM=function(){f.log("INFO","ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},e.prototype.ccEOC=function(){if(f.log("INFO","EOC - End Of Caption"),"MODE_POP-ON"===this.mode){var e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,f.log("TEXT","DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)},e.prototype.ccTO=function(e){f.log("INFO","TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)},e.prototype.ccMIDROW=function(e){var t={flash:!1};if(t.underline=e%2==1,t.italics=e>=46,t.italics)t.foreground="white";else{var i=Math.floor(e/2)-16,n=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=n[i]}f.log("INFO","MIDROW: "+JSON.stringify(t)),this.writeScreen.setPen(t)},e.prototype.outputDataUpdate=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=f.time;null!==t&&this.outputFilter&&(null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue&&(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),!0===e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue()),this.cueStartTime=this.displayedMemory.isEmpty()?null:t):this.cueStartTime=t,this.lastOutputScreen.copy(this.displayedMemory))},e.prototype.cueSplitAtTime=function(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))},e}(),w=function(){function e(t,i,r){n(this,e),this.field=t||1,this.outputs=[i,r],this.channels=[new b(1,i),new b(2,r)],this.currChNr=-1,this.lastCmdA=null,this.lastCmdB=null,this.bufferedData=[],this.startTime=null,this.lastTime=null,this.dataCounters={padding:0,char:0,cmd:0,other:0}}return e.prototype.getHandler=function(e){return this.channels[e].getHandler()},e.prototype.setHandler=function(e,t){this.channels[e].setHandler(t)},e.prototype.addData=function(e,t){var i=void 0,n=void 0,r=void 0,o=!1;this.lastTime=e,f.setTime(e);for(var s=0;s<t.length;s+=2)if(n=127&t[s],r=127&t[s+1],0!==n||0!==r){if(f.log("DATA","["+p([t[s],t[s+1]])+"] -> ("+p([n,r])+")"),i=this.parseCmd(n,r),i||(i=this.parseMidrow(n,r)),i||(i=this.parsePAC(n,r)),i||(i=this.parseBackgroundAttributes(n,r)),!i&&(o=this.parseChars(n,r)))if(this.currChNr&&this.currChNr>=0){var a=this.channels[this.currChNr-1];a.insertChars(o)}else f.log("WARNING","No channel found yet. TEXT-MODE?");i?this.dataCounters.cmd+=2:o?this.dataCounters.char+=2:(this.dataCounters.other+=2,f.log("WARNING","Couldn't parse cleaned data "+p([n,r])+" orig: "+p([t[s],t[s+1]])))}else this.dataCounters.padding+=2},e.prototype.parseCmd=function(e,t){var i=null,n=(20===e||28===e)&&t>=32&&t<=47,r=(23===e||31===e)&&t>=33&&t<=35;if(!n&&!r)return!1;if(e===this.lastCmdA&&t===this.lastCmdB)return this.lastCmdA=null,this.lastCmdB=null,f.log("DEBUG","Repeated command ("+p([e,t])+") is dropped"),!0;i=20===e||23===e?1:2;var o=this.channels[i-1];return 20===e||28===e?32===t?o.ccRCL():33===t?o.ccBS():34===t?o.ccAOF():35===t?o.ccAON():36===t?o.ccDER():37===t?o.ccRU(2):38===t?o.ccRU(3):39===t?o.ccRU(4):40===t?o.ccFON():41===t?o.ccRDC():42===t?o.ccTR():43===t?o.ccRTD():44===t?o.ccEDM():45===t?o.ccCR():46===t?o.ccENM():47===t&&o.ccEOC():o.ccTO(t-32),this.lastCmdA=e,this.lastCmdB=t,this.currChNr=i,!0},e.prototype.parseMidrow=function(e,t){var i=null;return(17===e||25===e)&&t>=32&&t<=47&&((i=17===e?1:2)!==this.currChNr?(f.log("ERROR","Mismatch channel in midrow parsing"),!1):(this.channels[i-1].ccMIDROW(t),f.log("DEBUG","MIDROW ("+p([e,t])+")"),!0))},e.prototype.parsePAC=function(e,t){var i=null,n=null,r=(e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127,o=(16===e||24===e)&&t>=64&&t<=95;if(!r&&!o)return!1;if(e===this.lastCmdA&&t===this.lastCmdB)return this.lastCmdA=null,this.lastCmdB=null,!0;i=e<=23?1:2,n=t>=64&&t<=95?1===i?u[e]:c[e]:1===i?l[e]:h[e];var s=this.interpretPAC(n,t);return this.channels[i-1].setPAC(s),this.lastCmdA=e,this.lastCmdB=t,this.currChNr=i,!0},e.prototype.interpretPAC=function(e,t){var i=t,n={color:null,italics:!1,indent:null,underline:!1,row:e};return i=t>95?t-96:t-64,n.underline=1==(1&i),i<=13?n.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(i/2)]:i<=15?(n.italics=!0,n.color="white"):n.indent=4*Math.floor((i-16)/2),n},e.prototype.parseChars=function(e,t){var i=null,n=null,r=null;if(e>=25?(i=2,r=e-8):(i=1,r=e),r>=17&&r<=19){var s=t;s=17===r?t+80:18===r?t+112:t+144,f.log("INFO","Special char '"+o(s)+"' in channel "+i),n=[s]}else e>=32&&e<=127&&(n=0===t?[e]:[e,t]);if(n){var a=p(n);f.log("DEBUG","Char codes =  "+a.join(",")),this.lastCmdA=null,this.lastCmdB=null}return n},e.prototype.parseBackgroundAttributes=function(e,t){var i=void 0,n=void 0,r=void 0,o=void 0,s=(16===e||24===e)&&t>=32&&t<=47,a=(23===e||31===e)&&t>=45&&t<=47;return!(!s&&!a||(i={},16===e||24===e?(n=Math.floor((t-32)/2),i.background=d[n],t%2==1&&(i.background=i.background+"_semi")):45===t?i.background="transparent":(i.foreground="black",47===t&&(i.underline=!0)),r=e<24?1:2,o=this.channels[r-1],o.setBkgData(i),this.lastCmdA=null,this.lastCmdB=null,0))},e.prototype.reset=function(){for(var e=0;e<this.channels.length;e++)this.channels[e]&&this.channels[e].reset();this.lastCmdA=null,this.lastCmdB=null},e.prototype.cueSplitAtTime=function(e){for(var t=0;t<this.channels.length;t++)this.channels[t]&&this.channels[t].cueSplitAtTime(e)},e}();t.a=w},function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function e(t,i){n(this,e),this.timelineController=t,this.track=i,this.startTime=null,this.endTime=null,this.screen=null}return e.prototype.dispatchCue=function(){null!==this.startTime&&(this.timelineController.addCues("textTrack"+this.track,this.startTime,this.endTime,this.screen),this.startTime=null)},e.prototype.newCue=function(e,t,i){(null===this.startTime||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=i,this.timelineController.createCaptionsTrack(this.track)},e}();t.a=r},function(e,t,i){"use strict";var n=i(26),r=i(5),o=function(e,t,i){return e.substr(i||0,t.length)===t},s=function(e){var t=parseInt(e.substr(-3)),i=parseInt(e.substr(-6,2)),n=parseInt(e.substr(-9,2)),r=e.length>9?parseInt(e.substr(0,e.indexOf(":"))):0;return isNaN(t)||isNaN(i)||isNaN(n)||isNaN(r)?-1:(t+=1e3*i,t+=6e4*n,t+=36e5*r)},a=function(e){for(var t=5381,i=e.length;i;)t=33*t^e.charCodeAt(--i);return(t>>>0).toString()},u=function(e,t,i){var n=e[t],r=e[n.prevCC];if(!r||!r.new&&n.new)return e.ccOffset=e.presentationOffset=n.start,void(n.new=!1);for(;r&&r.new;)e.ccOffset+=n.start-r.start,n.new=!1,n=r,r=e[n.prevCC];e.presentationOffset=i},l={parse:function(e,t,i,l,c,h){var d=/\r\n|\n\r|\n|\r/g,f=Object(r.b)(new Uint8Array(e)).trim().replace(d,"\n").split("\n"),p="00:00.000",g=0,m=0,v=0,y=[],b=void 0,w=!0,E=new n.a;E.oncue=function(e){var t=i[l],n=i.ccOffset;t&&t.new&&(void 0!==m?n=i.ccOffset=t.start:u(i,l,v)),v&&(n=v+i.ccOffset-i.presentationOffset),e.startTime+=n-m,e.endTime+=n-m,e.id=a(e.startTime.toString())+a(e.endTime.toString())+a(e.text),e.text=decodeURIComponent(encodeURIComponent(e.text)),e.endTime>0&&y.push(e)},E.onparsingerror=function(e){b=e},E.onflush=function(){if(b&&h)return void h(b);c(y)},f.forEach(function(e){if(w){if(o(e,"X-TIMESTAMP-MAP=")){w=!1,e.substr(16).split(",").forEach(function(e){o(e,"LOCAL:")?p=e.substr(6):o(e,"MPEGTS:")&&(g=parseInt(e.substr(7)))});try{t=t<0?t+8589934592:t,g-=t,m=s(p)/1e3,v=g/9e4,-1===m&&(b=new Error("Malformed X-TIMESTAMP-MAP: "+e))}catch(t){b=new Error("Malformed X-TIMESTAMP-MAP: "+e)}return}""===e&&(w=!1)}E.parse(e+"\n")}),E.flush()}};t.a=l},function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function s(e){for(var t=[],i=0;i<e.length;i++)"subtitles"===e[i].kind&&t.push(e[i]);return t}var a=i(1),u=i(3),l=i(0),c=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),h=function(e){function t(i){n(this,t);var o=r(this,e.call(this,i,a.a.MEDIA_ATTACHED,a.a.MEDIA_DETACHING,a.a.MANIFEST_LOADING,a.a.MANIFEST_LOADED,a.a.SUBTITLE_TRACK_LOADED));return o.tracks=[],o.trackId=-1,o.media=void 0,o.subtitleDisplay=!1,o}return o(t,e),t.prototype._onTextTracksChanged=function(){if(this.media){for(var e=-1,t=s(this.media.textTracks),i=0;i<t.length;i++)if("hidden"===t[i].mode)e=i;else if("showing"===t[i].mode){e=i;break}this.subtitleTrack=e}},t.prototype.destroy=function(){u.a.prototype.destroy.call(this)},t.prototype.onMediaAttached=function(e){var t=this;this.media=e.media,this.media&&(void 0!==this.queuedDefaultTrack&&(this.subtitleTrack=this.queuedDefaultTrack,delete this.queuedDefaultTrack),this.trackChangeListener=this._onTextTracksChanged.bind(this),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.subtitlePollingInterval=setInterval(function(){t.trackChangeListener()},500):this.media.textTracks.addEventListener("change",this.trackChangeListener))},t.prototype.onMediaDetaching=function(){this.media&&(this.useTextTrackPolling?clearInterval(this.subtitlePollingInterval):this.media.textTracks.removeEventListener("change",this.trackChangeListener),this.media=void 0)},t.prototype.onManifestLoading=function(){this.tracks=[],this.trackId=-1},t.prototype.onManifestLoaded=function(e){var t=this,i=e.subtitles||[];this.tracks=i,this.trackId=-1,this.hls.trigger(a.a.SUBTITLE_TRACKS_UPDATED,{subtitleTracks:i}),i.forEach(function(e){e.default&&(t.media?t.subtitleTrack=e.id:t.queuedDefaultTrack=e.id)})},t.prototype.onTick=function(){var e=this.trackId,t=this.tracks[e];if(t){var i=t.details;void 0!==i&&!0!==i.live||(l.b.log("(re)loading playlist for subtitle track "+e),this.hls.trigger(a.a.SUBTITLE_TRACK_LOADING,{url:t.url,id:e}))}},t.prototype.onSubtitleTrackLoaded=function(e){var t=this;e.id<this.tracks.length&&(l.b.log("subtitle track "+e.id+" loaded"),this.tracks[e.id].details=e.details,e.details.live&&!this.timer&&(this.timer=setInterval(function(){t.onTick()},1e3*e.details.targetduration,this)),!e.details.live&&this.timer&&(clearInterval(this.timer),this.timer=null))},t.prototype.setSubtitleTrackInternal=function(e){if(!(e<-1||e>=this.tracks.length)){this.timer&&(clearInterval(this.timer),this.timer=null);var t=s(this.media.textTracks);if(-1!==this.trackId&&(t[this.trackId].mode="disabled"),this.trackId=e,l.b.log("switching to subtitle track "+e),this.hls.trigger(a.a.SUBTITLE_TRACK_SWITCH,{id:e}),-1!==e){var i=this.tracks[e];e<t.length&&(t[e].mode=this.subtitleDisplay?"showing":"hidden");var n=i.details;void 0!==n&&!0!==n.live||(l.b.log("(re)loading playlist for subtitle track "+e),this.hls.trigger(a.a.SUBTITLE_TRACK_LOADING,{url:i.url,id:e}))}}},c(t,[{key:"subtitleTracks",get:function(){return this.tracks}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(e){this.trackId!==e&&this.setSubtitleTrackInternal(e)}}]),t}(u.a);t.a=h},function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=i(1),a=i(0),u=i(9),l=i(13),c={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING"},h=function(e){function t(i){n(this,t);var o=r(this,e.call(this,i,s.a.MEDIA_ATTACHED,s.a.ERROR,s.a.KEY_LOADED,s.a.FRAG_LOADED,s.a.SUBTITLE_TRACKS_UPDATED,s.a.SUBTITLE_TRACK_SWITCH,s.a.SUBTITLE_TRACK_LOADED,s.a.SUBTITLE_FRAG_PROCESSED));return o.config=i.config,o.vttFragSNsProcessed={},o.vttFragQueues=void 0,o.currentlyProcessing=null,o.state=c.STOPPED,o.currentTrackId=-1,o.decrypter=new u.a(i.observer,i.config),o}return o(t,e),t.prototype.onHandlerDestroyed=function(){this.state=c.STOPPED},t.prototype.clearVttFragQueues=function(){var e=this;this.vttFragQueues={},this.tracks.forEach(function(t){e.vttFragQueues[t.id]=[]})},t.prototype.nextFrag=function(){if(null===this.currentlyProcessing&&this.currentTrackId>-1&&this.vttFragQueues[this.currentTrackId].length){var e=this.currentlyProcessing=this.vttFragQueues[this.currentTrackId].shift();this.fragCurrent=e,this.hls.trigger(s.a.FRAG_LOADING,{frag:e}),this.state=c.FRAG_LOADING}},t.prototype.onSubtitleFragProcessed=function(e){e.success&&this.vttFragSNsProcessed[e.frag.trackId].push(e.frag.sn),this.currentlyProcessing=null,this.state=c.IDLE,this.nextFrag()},t.prototype.onMediaAttached=function(){this.state=c.IDLE},t.prototype.onError=function(e){var t=e.frag;t&&"subtitle"!==t.type||this.currentlyProcessing&&(this.currentlyProcessing=null,this.nextFrag())},t.prototype.doTick=function(){var e=this;switch(this.state){case c.IDLE:var t=this.tracks,i=this.currentTrackId,n=this.vttFragSNsProcessed[i],r=this.vttFragQueues[i],o=this.currentlyProcessing?this.currentlyProcessing.sn:-1,u=function(e){return n.indexOf(e.sn)>-1},l=function(e){return r.some(function(t){return t.sn===e.sn})};if(!t)break;var h;if(i<t.length&&(h=t[i].details),void 0===h)break;h.fragments.forEach(function(t){u(t)||t.sn===o||l(t)||(t.decryptdata&&null!=t.decryptdata.uri&&null==t.decryptdata.key?(a.b.log("Loading key for "+t.sn),e.state=c.KEY_LOADING,e.hls.trigger(s.a.KEY_LOADING,{frag:t})):(t.trackId=i,r.push(t),e.nextFrag()))})}},t.prototype.onSubtitleTracksUpdated=function(e){var t=this;a.b.log("subtitle tracks updated"),this.tracks=e.subtitleTracks,this.clearVttFragQueues(),this.vttFragSNsProcessed={},this.tracks.forEach(function(e){t.vttFragSNsProcessed[e.id]=[]})},t.prototype.onSubtitleTrackSwitch=function(e){this.currentTrackId=e.id,-1!==this.currentTrackId&&void 0!==this.tracks[this.currentTrackId].details&&this.tick()},t.prototype.onSubtitleTrackLoaded=function(){this.tick()},t.prototype.onKeyLoaded=function(){this.state===c.KEY_LOADING&&(this.state=c.IDLE,this.tick())},t.prototype.onFragLoaded=function(e){var t=this.fragCurrent,i=e.frag.decryptdata,n=e.frag,r=this.hls;if(this.state===c.FRAG_LOADING&&t&&"subtitle"===e.frag.type&&t.sn===e.frag.sn&&e.payload.byteLength>0&&null!=i&&null!=i.key&&"AES-128"===i.method){var o=void 0;try{o=performance.now()}catch(e){o=Date.now()}this.decrypter.decrypt(e.payload,i.key.buffer,i.iv.buffer,function(e){var t=void 0;try{t=performance.now()}catch(e){t=Date.now()}r.trigger(s.a.FRAG_DECRYPTED,{frag:n,payload:e,stats:{tstart:o,tdecrypt:t}})})}},t}(l.a);t.a=h},function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=i(3),a=i(1),u=i(2),l=i(0),c=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),h={WIDEVINE:"com.widevine.alpha",PLAYREADY:"com.microsoft.playready"},d=function(e,t,i){var n={videoCapabilities:[]};return t.forEach(function(e){n.videoCapabilities.push({contentType:'video/mp4; codecs="'+e+'"'})}),[n]},f=function(e,t,i){switch(e){case h.WIDEVINE:return d(0,i);default:throw Error("Unknown key-system: "+e)}},p=function(e){function t(i){n(this,t);var o=r(this,e.call(this,i,a.a.MEDIA_ATTACHED,a.a.MANIFEST_PARSED));return o._widevineLicenseUrl=i.config.widevineLicenseUrl,o._licenseXhrSetup=i.config.licenseXhrSetup,o._emeEnabled=i.config.emeEnabled,o._requestMediaKeySystemAccess=i.config.requestMediaKeySystemAccessFunc,o._mediaKeysList=[],o._media=null,o._hasSetMediaKeys=!1,o._isMediaEncrypted=!1,o._requestLicenseFailureCount=0,o}return o(t,e),t.prototype.getLicenseServerUrl=function(e){var t=void 0;switch(e){case h.WIDEVINE:t=this._widevineLicenseUrl;break;default:t=null}return t||(l.b.error('No license server URL configured for key-system "'+e+'"'),this.hls.trigger(a.a.ERROR,{type:u.b.KEY_SYSTEM_ERROR,details:u.a.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})),t},t.prototype._attemptKeySystemAccess=function(e,t,i){var n=this,r=f(e,0,i);if(!r)return void l.b.warn("Can not create config for key-system (maybe because platform is not supported):",e);l.b.log("Requesting encrypted media key-system access"),this.requestMediaKeySystemAccess(e,r).then(function(t){n._onMediaKeySystemAccessObtained(e,t)}).catch(function(t){l.b.error('Failed to obtain key-system "'+e+'" access:',t)})},t.prototype._onMediaKeySystemAccessObtained=function(e,t){var i=this;l.b.log('Access for key-system "'+e+'" obtained');var n={mediaKeys:null,mediaKeysSession:null,mediaKeysSessionInitialized:!1,mediaKeySystemAccess:t,mediaKeySystemDomain:e};this._mediaKeysList.push(n),t.createMediaKeys().then(function(t){n.mediaKeys=t,l.b.log('Media-keys created for key-system "'+e+'"'),i._onMediaKeysCreated()}).catch(function(e){l.b.error("Failed to create media-keys:",e)})},t.prototype._onMediaKeysCreated=function(){var e=this;this._mediaKeysList.forEach(function(t){t.mediaKeysSession||(t.mediaKeysSession=t.mediaKeys.createSession(),e._onNewMediaKeySession(t.mediaKeysSession))})},t.prototype._onNewMediaKeySession=function(e){var t=this;l.b.log("New key-system session "+e.sessionId),e.addEventListener("message",function(i){t._onKeySessionMessage(e,i.message)},!1)},t.prototype._onKeySessionMessage=function(e,t){l.b.log("Got EME message event, creating license request"),this._requestLicense(t,function(t){l.b.log("Received license data, updating key-session"),e.update(t)})},t.prototype._onMediaEncrypted=function(e,t){l.b.log('Media is encrypted using "'+e+'" init data type'),this._isMediaEncrypted=!0,this._mediaEncryptionInitDataType=e,this._mediaEncryptionInitData=t,this._attemptSetMediaKeys(),this._generateRequestWithPreferredKeySession()},t.prototype._attemptSetMediaKeys=function(){if(!this._hasSetMediaKeys){var e=this._mediaKeysList[0];if(!e||!e.mediaKeys)return l.b.error("Fatal: Media is encrypted but no CDM access or no keys have been obtained yet"),void this.hls.trigger(a.a.ERROR,{type:u.b.KEY_SYSTEM_ERROR,details:u.a.KEY_SYSTEM_NO_KEYS,fatal:!0});l.b.log("Setting keys for encrypted media"),this._media.setMediaKeys(e.mediaKeys),this._hasSetMediaKeys=!0}},t.prototype._generateRequestWithPreferredKeySession=function(){
var e=this,t=this._mediaKeysList[0];if(!t)return l.b.error("Fatal: Media is encrypted but not any key-system access has been obtained yet"),void this.hls.trigger(a.a.ERROR,{type:u.b.KEY_SYSTEM_ERROR,details:u.a.KEY_SYSTEM_NO_ACCESS,fatal:!0});if(t.mediaKeysSessionInitialized)return void l.b.warn("Key-Session already initialized but requested again");var i=t.mediaKeysSession;i||(l.b.error("Fatal: Media is encrypted but no key-session existing"),this.hls.trigger(a.a.ERROR,{type:u.b.KEY_SYSTEM_ERROR,details:u.a.KEY_SYSTEM_NO_SESSION,fatal:!0}));var n=this._mediaEncryptionInitDataType,r=this._mediaEncryptionInitData;l.b.log('Generating key-session request for "'+n+'" init data type'),t.mediaKeysSessionInitialized=!0,i.generateRequest(n,r).then(function(){l.b.debug("Key-session generation succeeded")}).catch(function(t){l.b.error("Error generating key-session request:",t),e.hls.trigger(a.a.ERROR,{type:u.b.KEY_SYSTEM_ERROR,details:u.a.KEY_SYSTEM_NO_SESSION,fatal:!1})})},t.prototype._createLicenseXhr=function(e,t,i){var n=new XMLHttpRequest,r=this._licenseXhrSetup;try{if(r)try{r(n,e)}catch(t){n.open("POST",e,!0),r(n,e)}n.readyState||n.open("POST",e,!0)}catch(e){return l.b.error("Error setting up key-system license XHR",e),void this.hls.trigger(a.a.ERROR,{type:u.b.KEY_SYSTEM_ERROR,details:u.a.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}return n.responseType="arraybuffer",n.onreadystatechange=this._onLicenseRequestReadyStageChange.bind(this,n,e,t,i),n},t.prototype._onLicenseRequestReadyStageChange=function(e,t,i,n){switch(e.readyState){case 4:if(200===e.status)this._requestLicenseFailureCount=0,l.b.log("License request succeeded"),n(e.response);else{if(l.b.error("License Request XHR failed ("+t+"). Status: "+e.status+" ("+e.statusText+")"),++this._requestLicenseFailureCount<=3){var r=3-this._requestLicenseFailureCount+1;return l.b.warn("Retrying license request, "+r+" attempts left"),void this._requestLicense(i,n)}this.hls.trigger(a.a.ERROR,{type:u.b.KEY_SYSTEM_ERROR,details:u.a.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}}},t.prototype._generateLicenseRequestChallenge=function(e,t){var i=void 0;return e.mediaKeySystemDomain===h.PLAYREADY?l.b.error("PlayReady is not supported (yet)"):e.mediaKeySystemDomain===h.WIDEVINE?i=t:l.b.error("Unsupported key-system:",e.mediaKeySystemDomain),i},t.prototype._requestLicense=function(e,t){l.b.log("Requesting content license for key-system");var i=this._mediaKeysList[0];if(!i)return l.b.error("Fatal error: Media is encrypted but no key-system access has been obtained yet"),void this.hls.trigger(a.a.ERROR,{type:u.b.KEY_SYSTEM_ERROR,details:u.a.KEY_SYSTEM_NO_ACCESS,fatal:!0});var n=this.getLicenseServerUrl(i.mediaKeySystemDomain),r=this._createLicenseXhr(n,e,t);l.b.log("Sending license request to URL: "+n),r.send(this._generateLicenseRequestChallenge(i,e))},t.prototype.onMediaAttached=function(e){var t=this;if(this._emeEnabled){var i=e.media;this._media=i,i.addEventListener("encrypted",function(e){t._onMediaEncrypted(e.initDataType,e.initData)})}},t.prototype.onManifestParsed=function(e){if(this._emeEnabled){var t=e.levels.map(function(e){return e.audioCodec}),i=e.levels.map(function(e){return e.videoCodec});this._attemptKeySystemAccess(h.WIDEVINE,t,i)}},c(t,[{key:"requestMediaKeySystemAccess",get:function(){if(!this._requestMediaKeySystemAccess)throw new Error("No requestMediaKeySystemAccess function configured");return this._requestMediaKeySystemAccess}}]),t}(s.a);t.a=p},function(e,t,i){"use strict";i.d(t,"a",function(){return n});var n=function(){return window.navigator&&window.navigator.requestMediaKeySystemAccess?window.navigator.requestMediaKeySystemAccess.bind(window.navigator):null}()},function(e,t){String.prototype.endsWith||function(){"use strict";var e=function(){try{var e={},t=Object.defineProperty,i=t(e,e,e)&&t}catch(e){}return i}(),t={}.toString,i=function(e){if(null==this)throw TypeError();var i=String(this);if(e&&"[object RegExp]"==t.call(e))throw TypeError();var n=i.length,r=String(e),o=r.length,s=n;if(arguments.length>1){var a=arguments[1];void 0!==a&&(s=a?Number(a):0)!=s&&(s=0)}var u=Math.min(Math.max(s,0),n),l=u-o;if(l<0)return!1;for(var c=-1;++c<o;)if(i.charCodeAt(l+c)!=r.charCodeAt(c))return!1;return!0};e?e(String.prototype,"endsWith",{value:i,configurable:!0,writable:!0}):String.prototype.endsWith=i}()}]).default}),define("modules/page/views/components/video/DesktopVideoComponentView",["jquery","lodash","device","log","modules/page/views/components/video/AbstractVideoComponentView","modules/page/models/video/HTMLVideo","modules/page/utils/VideoTracker","hlsjs"],function(e,t,i,n,r,o,s,a){"use strict";return r.extend({_getVideoFormats:function(){var e=[];return i.isIE11()&&i.isWindowsLessThan("8.1")||e.push({format:"hls-playlist",type:"vnd.apple.mpegurl"}),e.concat([{format:"original",type:"mp4"},{format:"h264-high",type:"mp4"},{format:"h264-low",type:"mp4"}])},doPlatformSpecificSetup:function(){var e=this.getResolvedVideoUrlForFormat("hls-playlist");if(a.isSupported()&&e){var n=new a;n.startLevel=-1,n.loadSource(e),n.attachMedia(this.videoHandle)}else this._setVideoSources();i.isBrowserChromeGreaterThanOrEqualTo(67)&&this._isShowControls()&&(this.$el.addClass("hide-native-play-button"),this.$el.hover(t.bind(function(e){this.videoHandle.readyState<=1||(this._isPlaying()?this.showPauseButton():this.showPlayButton())},this),t.bind(function(e){this.$pauseButton&&this.$pauseButton.fadeOut()},this)),this.$vid.bind("ended",t.bind(function(e){this.showPlayButton()},this)),this.$el.mousemove(t.bind(function(e){this._isPlaying()&&this.showPauseButton()},this)))},configurePlatformSpecificEvents:function(){this.$vid.on("progress load canplaythrough",t.bind(function(){this.videoHandle.readyState>1&&(this.isVideoReady=!0,this.canAutoplay()?this._hidePosterAndShowVideo():this.showPlayButton(),this.trigger(this.EVENTS.VIDEO_READY),this.$vid.off("progress load canplaythrough"))},this)),this.$vid.bind("play",t.bind(function(e){this.$playButton&&this.$playButton.hide()},this))},showPlayButton:function(){if(!this._isPlaying()){if(this.$playButton)return void this.$playButton.show();this.$playButton=e("<div>",{class:"video-play-button"}),this.options.width>64&&this.options.height>64?this.$playButton.addClass("video-play-button-large"):this.$playButton.addClass("video-play-button-small"),this.$el.append(this.$playButton),this.$playButton.on("click",t.bind(function(e){e.preventDefault(),this._hidePosterAndShowVideo(),this.$playButton.hide(),this.videoHandle.play(),i.isBrowserChromeGreaterThanOrEqualTo(67)&&this.showPauseButton()},this))}},showPauseButton:function(){if(this._isPlaying()){if(this.$pauseButton)return this.pauseButtonTimeout&&clearTimeout(this.pauseButtonTimeout),this.$pauseButton.show(),void this.setPauseButtonTimeout();this.$pauseButton=e("<div>",{class:"video-pause-button"}),this.options.width>64&&this.options.height>64?this.$pauseButton.addClass("video-pause-button-large"):this.$pauseButton.addClass("video-pause-button-small"),this.$el.append(this.$pauseButton),this.$pauseButton.on("click",t.bind(function(e){e.preventDefault(),this.manuallyPause(),this.$pauseButton.hide(),this.showPlayButton()},this)),this.setPauseButtonTimeout()}},setPauseButtonTimeout:function(){this.pauseButtonTimeout=setTimeout(t.bind(function(){this.$pauseButton.fadeOut()},this),2500)}})}),define("modules/page/views/components/video/MobileVideoComponentView",["jquery","lodash","device","log","modules/page/views/components/video/AbstractVideoComponentView"],function(e,t,i,n,r){"use strict";return r.extend({_getVideoFormats:function(){var e="h264-high";return i.smartPhone()&&(e="h264-low"),[{format:"hls-playlist",type:"vnd.apple.mpegurl"},{format:e,type:"mp4"},{format:"original",type:"mp4"}]},onClick:function(e){return e&&e.preventDefault(),this._isPlaying()?this.manuallyPause():this.play(),!1},getElementWidth:function(){var e=this.options.pageView.getScaleContext().ratio;return this.options.width*e},getElementHeight:function(){var e=this.options.pageView.getScaleContext().ratio;return this.options.height*e},doPlatformSpecificSetup:function(){this._setVideoSources(),this.applyVideoControlsFix(!0),i.isMobileSafari()&&this._isShowControls()&&this.$vid.on("touchmove",function(e){e.stopPropagation()})},configurePlatformSpecificEvents:function(){this._isShowControls()||this.bindInteraction(this.$el,t.bind(this.onClick,this)),this.$vid.on("progress load canplaythrough",t.bind(function(){this.videoHandle.readyState>=1&&(this.isVideoReady=!0,this._hidePosterAndShowVideo(),this.applyVideoControlsFix(!1),window.addEventListener("resize",t.bind(this.applyVideoControlsFix,this,!1)),this.trigger(this.EVENTS.VIDEO_READY),this.$vid.off("progress load canplaythrough"))},this))},applyVideoControlsFix:function(e){var t=this.options.pageView.getScaleContext().ratio,i="";e&&(i="translateX(-2048px) "),i+="scale("+1/t+", "+1/t+")",this.$vid.css({transform:i,"transform-origin":"top left",left:this.options.x*t,top:this.options.y*t,width:Math.ceil(this.options.width*t),height:Math.ceil(this.options.height*t)})}})}),define("modules/page/utils/VideoAutoplayCapabilities",["lodash","device"],function(e,t){"use strict";var i={FULL:"full",MUTED:"muted",NONE:"none"},n=e.once(function(){return t.isIos()?t.isIosLessThan(10)?i.NONE:i.MUTED:t.isAndroid()&&t.isBrowserChrome()?t.isBrowserChromeLessThan(53)?i.NONE:i.MUTED:t.isDesktopSafari()&&!t.isDesktopSafariLessThan(11)?i.MUTED:t.desktop()&&t.isBrowserChrome()&&!t.isBrowserChromeLessThan(66)?i.MUTED:t.desktop()&&t.isBrowserFirefoxGreaterThanOrEqualTo(63)?i.MUTED:i.FULL});return{isFullSupport:function(){return n()===i.FULL},isMutedSupport:function(){return n()===i.MUTED},isNoSupport:function(){return n()===i.NONE}}}),define("libs/utils/VideoAutoplayConstants",[],function(){"use strict";return{NO_AUTOPLAY_FALLBACK_OPTIONS:{TAP_TO_PLAY:"tap-to-play",SHOW_THUMBNAIL_IMAGE:"show-thumbnail-image"},MUTED_AUTOPLAY_FALLBACK_OPTIONS:{PLAY_MUTED_VIDEO:"play-muted-video",TAP_TO_PLAY:"tap-to-play",SHOW_THUMBNAIL_IMAGE:"show-thumbnail-image"}}}),define("modules/page/views/components/video/VideoComponentViewFactory",["device","modules/page/views/components/video/DesktopVideoComponentView","modules/page/views/components/video/MobileVideoComponentView","modules/page/views/components/ImageComponentView","modules/page/utils/VideoAutoplayCapabilities","libs/utils/VideoAutoplayConstants"],function(e,t,i,n,r,o){"use strict";function s(n){return e.mobile()?new i(n):new t(n)}function a(e){return e.imageLoader=e.posterLoader,new n(e)}function u(e){return r.isNoSupport()?c(e):r.isMutedSupport()?l(e):(e.tapToPlay=!1,s(e))}function l(e){var t=e.mutedAutoplayFallbackOption;return t===o.MUTED_AUTOPLAY_FALLBACK_OPTIONS.TAP_TO_PLAY?s(e):t===o.MUTED_AUTOPLAY_FALLBACK_OPTIONS.SHOW_THUMBNAIL_IMAGE?a(e):(e.tapToPlay=!1,e.muted=!0,s(e))}function c(e){return e.noAutoplayFallbackOption===o.NO_AUTOPLAY_FALLBACK_OPTIONS.SHOW_THUMBNAIL_IMAGE?a(e):s(e)}return{create:function(e){return e.videoAutoPlay?u(e):s(e)}}}),define("modules/page/views/GroupView",["jquery","lodash","backbone","modules/page/views/components/AbstractComponentView","globals","ExtentsUtils","shared/utils/CssUtils"],function(e,t,i,n,r,o,s){"use strict";return n.extend({initialize:function(){n.prototype.initialize.call(this),this.$el.addClass("group"),this.childViews={}},addParentView:function(e){n.prototype.addParentView.call(this,e),t.each(this.childViews,function(t){t.addParentView(e)})},areAllParentsVisible:function(){return t.every(this.parentViews,function(e){return e.visible})},_applyDimensions:function(e,t){var i=this.options.width/2+"px "+this.options.height/2+"px";this.$el.css("transform-origin",i),this.$el.css("-moz-transform-origin",i),this.$el.css("-webkit-transform-origin",i),this.$el.css("-ms-transform-origin",i)}})}),define("modules/page/utils/ComponentFactory",["log","globals","lodash","modules/page/views/components/SquareShapeComponentView","modules/page/views/components/ShapeComponentView","modules/page/views/components/HtmlComponentView","modules/page/views/components/HubspotFormComponentView","modules/page/views/components/MarketoFormComponentView","modules/page/views/components/HotspotComponentView","modules/page/views/components/HotspotPathComponentView","modules/page/views/components/ImageComponentView","modules/page/views/components/VectorImageComponentView","modules/page/views/components/LineComponentView","modules/page/views/components/TextComponentView","modules/page/views/components/video/VideoComponentViewFactory","modules/page/views/SmartgroupView","modules/page/views/GroupView","VectorImageUtils","modules/page/utils/PlayerVariantDetector"],function(e,t,i,n,r,o,s,a,u,l,c,h,d,f,p,g,m,v,y){"use strict";return{createComponentFromObject:function(t){var b=y.getVariant();t="desktop"!==b?i.extend(t,t.overrides[b]):i.extend(t);var w=null;switch(t.type){case"html-component":w=new o(t);break;case"hubspot-form-component":w=new s(t);break;case"marketo-form-component":w=new a(t);break;case"hotspot-component":w=new u(t);break;case"hotspot-path-component":w=new l(t);break;case"shape-component":w="square"===t.shape?new n(t):new r(t);break;case"line-component":w=new d(t);break;case"image-component":w=v.isVectorBased(t.contentType)?new h(t):new c(t);break;case"smartgroup":w=new g(t);break;case"group":w=new m(t);break;case"text-component":w=new f(t);break;case"video-widget":w=p.create(t);break;default:return e.warn("Object type on page "+this.options.physicalPageNumber+" not supported:",t.type),null}return w}}}),define("modules/page/utils/Record",["lodash"],function(e){"use strict";var t=function(e,t){this.parentItem=e,this.model=t,this.childViews=[],this.view=null};return t.prototype={isSmartgroupLayer:function(){return this.model&&!e.isUndefined(this.model.smartgroupId)},isFolder:function(){return this.model&&"folder"===this.model.type},isGroup:function(){return this.model&&"group"===this.model.type},findParentSmartgroupOrGroupModel:function(){for(var e=null,t=this;null!==t;){if(t.isSmartgroupLayer()||t.isGroup()){e=t.model;break}t=t.parentItem}return e},setView:function(e){this.view=e,this.parentItem.childViews.push(e)}},t}),define("modules/page/utils/PageChildPreRenderList",["lodash","modules/page/utils/Record","modules/page/utils/PlayerVariantDetector"],function(e,t,i){"use strict";return{createPreRenderList:function(i){var n=i.model.get("layers"),r=[];if(!n)return r;var o=function(i,n){i&&e.each(i,function(e){var i=new t(n,e);r.push(i),e.smartgroupId?o(e.layers,i):"folder"!==e.type&&"group"!==e.type||o(e.items,i)})},s=new t(null,null);return s.childViews=i.childViews,o(n,s),r.reverse()}}}),define("modules/page/utils/PageViewPrerenderer",["device","jquery","lodash","log","modules/page/views/FolderView","modules/page/views/SmartgroupView","modules/page/utils/ComponentFactory","modules/page/utils/PageChildPreRenderList"],function(e,t,i,n,r,o,s,a){"use strict";var u=function(e){this.prerenderDeferred=new t.Deferred,this.prerenderWorkQueue=[],this.pageView=e,this.pageIndex=this.pageView.getPageIndex(),this.nextZIndex=1,this.docFrag=document.createDocumentFragment(),this.pinnedDocFrag=document.createDocumentFragment()};return u.prototype={prerender:function(){n.debug("Pre-rendering page idx: "+this.pageIndex);var e=Date.now();for(this.isPrerenderQueueEmpty()&&this.initPrerenderQueue();!this.isPrerenderQueueEmpty();)this.prerenderNextWorkItem();n.debug("Prerender complete for page idx: "+this.pageIndex+". Elapsed time: "+(Date.now()-e)+" ms"),this.prerenderDeferred.resolve()},lazyPrerender:function(){if(!this.isPrerendered()){var e=Date.now();n.debug("Starting lazy prerender on page idx: "+this.pageIndex);var t=i.bind(function(){var i=Date.now();if(!this.isPrerendered()){if(this.isPrerenderQueueEmpty())this.initPrerenderQueue();else for(this.prerenderNextWorkItem();!this.isPrerenderQueueEmpty()&&Date.now()-i<10;)this.prerenderNextWorkItem();this.isPrerenderQueueEmpty()?(n.debug("Lazy prerender complete for page idx: "+this.pageIndex+". Elapsed time: "+(Date.now()-e)+" ms"),this.prerenderDeferred.resolve()):window.requestAnimationFrame(t)}},this);window.requestAnimationFrame(t)}return this.prerenderDeferred.promise()},initPrerenderQueue:function(){this.pageView.resetPageForPrerender(),this.nextZIndex=1,this.docFrag=document.createDocumentFragment(),this.pinnedDocFrag=document.createDocumentFragment(),this.prerenderWorkQueue=a.createPreRenderList(this.pageView),n.debug("Prerender queue for page idx: "+this.pageIndex+" has "+this.prerenderWorkQueue.length+" items.")},prerenderObjectView:function(t,i){t=this.pageView.applyPageContext(t);var n=s.createComponentFromObject(t);return null!==n&&(n.render(),n.doTriggerOnScroll()&&this.pageView._addScrollTriggeredObject(n),n.hasResettableHoverInteractions()&&this.pageView.addResetWhenOffscreenHoverTrigger(n),n.options.fixedPosition&&this.pageView.setFixedPosition(n),i||(this.setObjectViewToNextHighestZIndex(n),n.options.fixedPosition&&e.desktop()?this.pinnedDocFrag.appendChild(n.$el[0]):this.docFrag.appendChild(n.$el[0]))),n},prerenderFolderView:function(e,t){var n=new r(e);return n.childViews=t,i.each(n.childViews,i.bind(function(e){n.isInitiallyVisible()||e.hide(),e.addParentView(n),e.addContainerId(n.getId())},this)),n},prerenderGroupView:function(t,n){var r=this;t=this.pageView.applyPageContext(t);var o=s.createComponentFromObject(t);return o.childViews=n,this.setObjectViewToNextHighestZIndex(o),i.each(n,function(e){var t=e;t.addParentView(o),t.addContainerId(o.getId()),r.setObjectViewToNextHighestZIndex(t),o.$el.append(t.$el[0])}),o.render(),o.doTriggerOnScroll()&&this.pageView._addScrollTriggeredObject(o),o.hasResettableHoverInteractions()&&this.pageView.addResetWhenOffscreenHoverTrigger(o),o.options.fixedPosition&&this.pageView.setFixedPosition(o),o.options.fixedPosition&&e.desktop()?this.pinnedDocFrag.appendChild(o.$el[0]):this.docFrag.appendChild(o.$el[0]),o},prerenderSmartgroupView:function(t,n){function r(e){i.each(e,function(e){if("folder"===e.options.type)r(e.childViews);else{var t=e;o.setObjectViewToNextHighestZIndex(t),a.$el.append(t.$el[0]),t.options.parentSmartgroup=a}})}var o=this;t=this.pageView.applyPageContext(t);var a=s.createComponentFromObject(t);return a.childViews=n,this.setObjectViewToNextHighestZIndex(a),r(a.childViews),a.render(),a.addContainerId(a.id),a.doTriggerOnScroll()&&this.pageView._addScrollTriggeredObject(a),a.options.fixedPosition&&this.pageView.setFixedPosition(a),a.options.fixedPosition&&e.desktop()?this.pinnedDocFrag.appendChild(a.$el[0]):this.docFrag.appendChild(a.$el[0]),a},setObjectViewToNextHighestZIndex:function(e){e.$el.css("zIndex",this.nextZIndex),this.nextZIndex++},isPrerendered:function(){return"resolved"===this.prerenderDeferred.state()},getPrerenderPromise:function(){return this.prerenderDeferred.promise()},getDocumentFragment:function(){return this.docFrag},getPinnedDocumentFragment:function(){return this.pinnedDocFrag},isPrerenderQueueEmpty:function(){return!this.prerenderWorkQueue||0===this.prerenderWorkQueue.length},prerenderNextWorkItem:function(){var e=this.prerenderWorkQueue.shift();this.prerenderSingleWorkItem(e)},prerenderSingleWorkItem:function(e){if(e)if(e.isSmartgroupLayer()){var t=this.prerenderSmartgroupView(e.model,e.childViews);e.setView(t)}else if(e.isFolder()){var i=this.prerenderFolderView(e.model,e.childViews);e.setView(i)}else if(e.isGroup()){var n=this.prerenderGroupView(e.model,e.childViews);e.setView(n)}else{var r;r=e.findParentSmartgroupOrGroupModel();var o=this.prerenderObjectView(e.model,r);e.setView(o)}}},u}),define("modules/page/utils/PageChildViewFinder",["lodash","modules/page/views/components/video/AbstractVideoComponentView"],function(e,t){"use strict";function i(i,n){var r=null,o=function(i){return e.some(i,function(e){return e.id===n?(r=e,!0):e instanceof t&&e.el&&e.el.id===n?(r=e,!0):!!e.childViews&&o(e.childViews)})};return i&&o(i),r}return{find:i}}),define("modules/page/utils/AnimationRunner",["jquery","lodash","modules/page/views/components/AbstractComponentView","modules/page/views/components/video/AbstractVideoComponentView","modules/page/views/FolderView","modules/page/utils/PageChildViewFinder"],function(e,t,i,n,r,o){"use strict";function s(e,n){var r=function(e){t.each(e,function(e){if(e instanceof i&&(t.isUndefined(e.visible)||e.visible)){var o=e.isAnyPartOfComponentWithinBoundaries(n);o&&e.setWasInsideVisibleBoundaries(!0),(o||e.isOutsideOfPage())&&e.activateAndRunEntryAnimations()}e.childViews&&e.visible&&r(e.childViews)})};r(e)}function a(e,i){t.each(e,function(e){e.isAnyPartOfComponentWithinBoundaries(i)&&e.createTimedTriggers()})}function u(e,t){e.areAllParentsVisible()&&(p(e),l(e,t),c(e))}function l(e,n){e instanceof i&&e.isAnyPartOfComponentWithinBoundaries(n)&&e.createTimedTriggers(),e.childViews&&t.each(e.childViews,function(e){l(e,n)})}function c(e){null!==e&&!1!==e.visible&&(e.reset(),e instanceof i&&e.activateAndRunEntryAnimations(),e.childViews&&t.each(e.childViews,function(e){c(e)}))}function h(i){t.each(i,function(t){if(!t.runningExitAnimations){var i=t.runAllChildViewExitAnimations();e.when.apply(e,i).done(function(){g(t),E(t)})}})}function d(e,t){for(var i=0;i<e.length;i++){var n=e[i],r=n.getComponentBoundaries(),o=n.isAnyPartOfComponentWithinBoundaries(t,r),s=n.getWasInsideVisibleBoundaries(),a=s&&!o,u=!s&&o;if(a?(n.setWasInsideVisibleBoundaries(!1),n.whenLeavingVisibleBoundaries()):u&&(n.setWasInsideVisibleBoundaries(!0),n.createTimedTriggers()),o){if(!n.visible||n.areAnyParentsNotVisible())continue;n.isAnyPartOfComponentWithinEntryAnimationBoundaries(t,r)&&!n.isOutsideOfPage()&&n.activateAndRunEntryAnimations()}}}function f(e,i,n){for(var r=b(e,i,n),o=0;o<r.length;o++){var s=r[o];t.isUndefined(s.initiallyVisible)||s.initiallyVisible?p(s):v(s)}}function p(e){e&&(e.visible=!0,e instanceof i?e.show():t.each(e.childViews,function(e){e.visible&&p(e)}))}function g(e){e&&(e.visible=!1,(e instanceof i||e instanceof r)&&e.hide(),m(e))}function m(e){e instanceof i&&e.resetTimers(),e.childViews&&t.each(e.childViews,function(e){m(e)})}function v(e){e&&(e.visible=!1,(e instanceof i||e instanceof r)&&e.hide(),y(e))}function y(e){e instanceof i&&(e.resetTimers(),e instanceof n&&e.disableVideoTrackingAndAutoPlayingVideo()),e.childViews&&t.each(e.childViews,function(e){y(e)})}function b(e,i,n){function s(e){if(!e.resetWhenScrolledOffscreen)return[];var n=t.map(e.layerTargets,function(e){return o.find(i,e)});return t.every(n,a)?n:[]}function a(e){function i(e){e instanceof r?t.each(e.childViews,function(e){i(e)}):o.push(e)}var o=[];return i(e),t.every(o,function(e){return!(e&&e.isAnyPartOfComponentWithinBoundaries(n))})}for(var u=[],l=0;l<e.length;l++){var c=e[l];if(!c.isAnyPartOfComponentWithinBoundaries(n)){var h=t.flatMap(c.getResettableHoverInteractions(),s);h.length>0&&(u.push(c),u=u.concat(h))}}return u}function w(e){var i=function(e){t.each(e,function(e){e.childViews&&i(e.childViews),t.isUndefined(e.initiallyVisible)||e.initiallyVisible?p(e):g(e),e.reset()})};i(e)}function E(e){e.reset(),e.childViews&&t.each(e.childViews,function(e){e.reset()})}function _(){}return _.prototype={activateAndRunEntryAnimationsForAllVisible:s,createTimedTriggers:a,whenVisibleBoundariesChange:d,resetHoverInteractionViewsToInitialVisibility:f,resetAnimationsAndInitialVisibility:w,showChildViewIfAllParentsVisible:u,hideAllChildViewsAndRunExitAnimations:h},_}),define("modules/page/views/PageView",["log","jquery","lodash","backbone","device","globals","shared/models/EmbeddedViewportModel","shared/views/AbstractView","modules/page/views/FolderView","modules/page/views/components/AbstractComponentView","modules/page/views/components/video/AbstractVideoComponentView","modules/page/utils/PageViewPrerenderer","modules/page/utils/AnimationRunner","modules/page/utils/PageChildViewFinder","modules/page/utils/VisibleBoundaries","modules/splash-screen/module","modules/page/utils/PlayerVariantService","modules/page/utils/PlayerVariantDetector","ExtentsUtils","InteractionUtils","urlUtils"],function(e,t,i,n,r,o,s,a,u,l,c,h,d,f,p,g,m,v,y,b,w){"use strict";return a.extend({className:"page-viewport",tagName:"div",activated:!1,documentVersion:null,$pageContainer:null,$pinnedContainer:null,$pageScroll:null,scaleContext:null,scaleTransformKey:null,scaleTransformValue:null,scaleExperience:null,prerenderer:null,activeHoversGroupedByInteraction:null,defaults:{physicalPageNumber:"unknown"},initialize:function(){if(this.options=i.defaults(this.options,this.defaults),this.animationRunner=new d,this.documentVersion=this.options.documentVersion,this.scaleContext=this.options.scaleContext,this.scaleExperience=this.documentVersion.getScaleExperience(),this.scrollTriggeredObjects=[],this.resetWhenOffscreenHoverTriggers=[],this.prerenderer=new h(this),this.$pageContainer=t("<div>",{class:"page-container"}),this.throttleReload=i.debounce(i.bind(this.reload,this),1e3),this.documentVersion.on("reload",this.throttleReload),this.$pageScroll=t("<div>",{class:"page-scroll"}),this.$pageContainer.append(this.$pageScroll),this.documentVersion.shouldLazyLoad()&&w.getUrlParams(window.location.href).showLazyLoadBreakpoint){var e=t("<hr/>",{class:"lazyLoadingBreakpointLine"});e.css("top",this.model.getlazyLoadingVerticalBreakpoint()+"px"),this.$pageScroll.append(e)}var n=this;r.desktop()&&(this.$pinnedContainer=t("<div>",{class:"pinned-container"}),this.$el.append(this.$pinnedContainer),this.$pinnedContainer.on("wheel mousewheel",function(e){if(e.originalEvent.deltaY){e.preventDefault(),e.stopPropagation();var t=n.$pageContainer.scrollTop(),i=e.originalEvent.deltaY;1===e.originalEvent.deltaMode&&(i*=n.getUnstyledLineHeight()),n.$pageContainer.scrollTop(t+i)}})),this.$pageContainer.on("wheel mousewheel",function(e){if(e.originalEvent.deltaY){var t=n.$pageContainer.scrollTop(),i=t+e.originalEvent.deltaY;1===e.originalEvent.deltaMode&&(i=t+e.originalEvent.deltaY*n.getUnstyledLineHeight());var r=n.$pageContainer[0].scrollHeight>n.$pageContainer[0].offsetHeight,s=n.$pageContainer[0].scrollHeight-n.$pageContainer[0].scrollTop>0,a=n.$pageContainer[0].scrollHeight-n.$pageContainer[0].scrollTop<n.$pageContainer[0].clientHeight;if(o.isEmbedded){if(!(-1===window.location.href.indexOf("?heightOverride=")&&r&&s&&a))return;e.preventDefault(),e.stopPropagation(),n.$pageContainer.scrollTop(i)}else e.preventDefault(),e.stopPropagation(),n.$pageContainer.scrollTop(i)}}),this.$el.append(this.$pageContainer),a.prototype.initialize.call(this),this.el=function(){return this.$el},this.$el.attr("data-slug",this.model.get("slug")),this.prepare=i.once(i.bind(this.prepare,this)),this.attach=i.once(i.bind(this.attach,this)),this.spinner=null,this.pageReady=new t.Deferred,this.renderPlaceholder(),this.activeHoversGroupedByInteraction=[],this.lastViewportUpdate=performance.now(),this.isProcessingScroll=!1;var u=this,l=function(e){e-u.lastViewportUpdate>100?(u.onScrollAndWindowResize(),u.lastViewportUpdate=e,u.isProcessingScroll=!1):requestAnimationFrame(l)};this.$pageContainer.on("scroll",function(e){u.isProcessingScroll||(u.isProcessingScroll=!0,requestAnimationFrame(l))}),s.getInstance().on("change",i.bind(this.onScrollAndWindowResize,this)),o.previewMode&&this.registerVariantListeners(),this.childViews=[]},registerVariantListeners:function(){v.on("change",i.debounce(i.bind(this.reload,this),50,{leading:!0,trailing:!0})),s.getInstance().on("change:windowWidth change:windowHeight",function(){v.detect()}),t(window).on("resize",function(){v.detect()})},startLazyPrerender:function(){return this.prerenderer.lazyPrerender()},prerender:function(){this.prerenderer.prerender()},getPrerenderDeferred:function(){return this.prerenderer.prerenderDeferred},isPrerendered:function(){return this.prerenderer.isPrerendered()},resetPageForPrerender:function(){this.closeAllComponents(),this.childViews=[],this.scrollTriggeredObjects=[],this.resetWhenOffscreenHoverTriggers=[]},getUnstyledLineHeight:function(){if(!this.unstyledLineHeight){var e=document.createElement("iframe");e.src="#",document.body.appendChild(e);var t=e.contentWindow,i=t.document;i.open(),i.write("<!DOCTYPE html><html><head></head><body><span>a</span></body></html>"),i.close();var n=i.body.firstElementChild;this.unstyledLineHeight=n.offsetHeight,document.body.removeChild(e)}return this.unstyledLineHeight},getPageHeight:function(){return this.model.getPageHeight(this.documentVersion)},getPageWidth:function(){return this.model.getPageWidth(this.documentVersion)},getScrollPosition:function(){return this.$pageContainer.scrollTop()},setScrollPosition:function(e){this.$pageContainer.scrollTop(e)},focusScrollContainer:function(){this.$pageContainer.focus()},triggerModuleScrollEvent:function(e){this.getModule().trigger(this.getModule().publishedEvents.PAGE_SCROLL,{slug:this.model.get("slug"),topY:e.topY,bottomY:e.bottomY,pageHeight:this.getPageHeight()})},onScrollAndWindowResize:function(){if(this.activated){var e=this.getVisibleBoundaries();this.animationRunner.whenVisibleBoundariesChange(this.scrollTriggeredObjects,e),this.animationRunner.resetHoverInteractionViewsToInitialVisibility(this.resetWhenOffscreenHoverTriggers,this.childViews,e),this.triggerModuleScrollEvent(e)}},resetTimedTriggers:function(){i.each(this.scrollTriggeredObjects,function(e){e.resetTimers(),e.timedTriggersCreatedAtLeastOnce=!1})},getVisibleBoundaries:function(){var e=this.getVisibleYBoundaries(),t=this.getVisibleXBoundaries();return t?new p(e.topY,e.bottomY,t.leftX,t.rightX):new p(e.topY,e.bottomY)},getVisibleYBoundaries:function(){var e,t,i=this.getScaleContext(),n=i.height/i.ratio,r=s.getInstance(),o=this.$pageContainer.scrollTop();if(r.isActive()){var a=this.getPageHeight(),u=Math.max((n-a)/2,0),l=r.getTop()/i.ratio,c=r.getBottom()/i.ratio;e=Math.max(l,0)+o-u,t=Math.min(c,n)+o-u}else e=o,t=e+n;return{topY:Math.round(e),bottomY:Math.round(t)}},getVisibleXBoundaries:function(){if(this.scaleExperience)return null;var e=this.getScaleContext();return{leftX:this.$pageContainer.scrollLeft(),rightX:this.$pageContainer.scrollLeft()+e.width}},getScaleContext:function(){return this.scaleContext.getPageScaleContext(this.model)},getSlug:function(){return this.model.get("slug")},onClose:function(){this.closeAllComponents()},closeAllComponents:function(){if(this.childViews){var e=function(t){i.each(t,function(t){t.close(),t.childViews&&e(t.childViews)})};e(this.childViews)}},_bindModel:function(){this.model.on("remote",this.applyRemoteChange,this),this.model.on("reload",this.throttleReload,this)},renderPlaceholder:function(){this.closeAllComponents();var e=t(window);this.$el.css({width:e.width(),height:e.height()}),this._createSpinner(!1)},setFixedPosition:function(e){var t=this;r.desktop()||(e.$el.css("position","fixed"),e.$el.on("mousewheel",function(e){e.preventDefault(),e.stopPropagation();var i=t.$pageContainer.scrollTop();e.originalEvent.deltaY&&t.$pageContainer.scrollTop(i+e.originalEvent.deltaY)}))},findChildView:function(e){return f.find(this.childViews,e)},findVideo:function(e){var t=null,n=function(r){return i.some(r,function(i){return i.el&&i.el.id===e?(t=i,!0):!!i.childViews&&n(i.childViews)})};return this.childViews&&n(this.childViews),t},_addScrollTriggeredObject:function(e){i.some(this.scrollTriggeredObjects,function(t){return t.id==e.id})||this.scrollTriggeredObjects.push(e)},_removeScrollTriggeredObject:function(e){var t;i.find(this.scrollTriggeredObjects,function(i,n){return i.id==e.id&&(t=n,!0)})&&this.scrollTriggeredObjects.splice(t,1)},addResetWhenOffscreenHoverTrigger:function(e){i.some(this.resetWhenOffscreenHoverTriggers,function(t){return t.id==e.id})||this.resetWhenOffscreenHoverTriggers.push(e)},removeResetWhenOffscreenHoverTrigger:function(e){var t;i.find(this.resetWhenOffscreenHoverTriggers,function(i,n){return i.id==e.id&&(t=n,!0)})&&this.resetWhenOffscreenHoverTriggers.splice(t,1)},prepare:function(){return this.prerenderer.isPrerendered()||this.prerenderer.prerender(),this.prerenderer.getPrerenderPromise().done(i.bind(function(){
t.when.apply(t,this.attachInitialMedia()).done(i.bind(function(){e.debug("All page media attached"),this.pageReady.resolve()},this)).fail(i.bind(function(){e.debug("Page media failed"),this.pageReady.reject()},this))},this)),this.pageReady.promise()},attachInitialMedia:function(){return this.documentVersion.shouldLazyLoad()?(this.attachChildMedia(this,!0),this.attachInitialViewportMedia(this)):this.attachChildMedia(this,!0)},attachViewMedia:function(e){var t=[];t.push(e.attachMedia());return t=t.concat(this.attachChildMedia(e,!1))},attachChildMedia:function(e,t){var n=[],r=this,o=function(e){i.each(e,function(e){t&&!e.initiallyVisible||((!r.documentVersion.shouldLazyLoad()||r.documentVersion.shouldLazyLoad()&&!e.options.isInInitialViewport)&&n.push(e.attachMedia()),e.childViews&&o(e.childViews))})};return e&&e.childViews&&o(e.childViews),n},attachInitialViewportMedia:function(e){var t=[],n=function(e){i.each(e,function(e){e.options.isInInitialViewport&&t.push(e.attachMedia()),e.childViews&&n(e.childViews)})};return e&&e.childViews&&n(e.childViews),t},scale:function(){var e=this.getScaleContext();this.model.preloadImages(e);var t=function(e){i.each(e,function(e){(e.mediaHasBeenLoaded||e.initiallyVisible)&&(e.scaleComponent(),e.childViews&&t(e.childViews))})};t(this.childViews)},doCustomScaling:function(){var e=function(t){i.each(t,function(t){(t.mediaHasBeenLoaded||t.initiallyVisible)&&(t.doCustomScaling(!0),t.childViews&&e(t.childViews))})};e(this.childViews)},attach:function(){this._destroySpinner(),this.pageReady.resolve(),this.render(),e.debug("Page idx: "+this.getPageIndex()+" attached!")},render:function(){this.$pageScroll[0].appendChild(this.prerenderer.getDocumentFragment()),r.desktop()&&this.$pinnedContainer[0].appendChild(this.prerenderer.getPinnedDocumentFragment());var e=function(t){i.each(t,function(t){t.onAttach(),t.childViews&&e(t.childViews)})};e(this.childViews),this.$pageScroll.focus()},applyRemoteChange:function(e){var t=this,i=this.findChildView(e.id);if(t.model.updateLayerDictionaryFromRemoteChange(e),i&&i instanceof l){var n=!1;n=!i.areAllParentsVisible(),i.applyChanges(t.applyPageContext(e.options)),n&&i.hide(),i.doTriggerOnScroll()?t._addScrollTriggeredObject(i):t._removeScrollTriggeredObject(i),i.getResettableHoverInteractions()?t.addResetWhenOffscreenHoverTrigger(i):t.removeResetWhenOffscreenHoverTrigger(i)}},reload:function(){var e=v.getVariant();if(e!==this.model.getReconciledVariant()){var t=this.model.reconcileLayers(this.model.get("layerHierarchies")[e],this.model.get("layerDictionary"));this.model.set("layers",t),this.model.resolveSmartgroupsAndMedia()}this.scaleExperience=this.documentVersion.getScaleExperience();var i=this.getScaleContext();this.documentVersion.shouldLazyLoad()?this.model.lazyPreloadAllMedia(i,this.options.isRequestedPage):(this.model.preloadVisibleMedia(i,!0),this.model.preloadHiddenMedia(i)),this.prerender(),this.$pageScroll.empty(),r.desktop()&&this.$pinnedContainer.empty(),this.render(),this.getModule().trigger(this.getModule().publishedEvents.PAGE_RELOAD),this.attachInitialMedia(),this.activateAndRunEntryAnimationsForAllVisible()},storeScaleTransform:function(e,t){this.scaleTransformKey=e,this.scaleTransformValue=t},setBackgroundPositionAndScaleTransform:function(e,t){var i={"background-position-x":e+"px",zoom:"",transform:""};(this.scaleExperience||t)&&(t?"transform"===this.scaleTransformKey?i.transform="translateX("+e+"px) "+this.scaleTransformValue:(i.transform="translateX("+e+"px)",i[this.scaleTransformKey]=this.scaleTransformValue):i[this.scaleTransformKey]=this.scaleTransformValue),this.$el.css(i)},getLeft:function(){return parseInt(this.$el.css("background-position-x"),10)},setOpacity:function(e){this.$pageScroll.css("opacity",e)},isInTransition:function(){return this.$el.hasClass("in-transition")},isPending:function(){return this.$el.hasClass("pending")},isTop:function(){return this.$el.hasClass("top")},isViewed:function(){return this.$el.hasClass("viewed")},isReady:function(){return"resolved"===this.pageReady.state()},isDisabled:function(){return!0===this.model.get("disabled")},disable:function(){this.model.set("disabled",!0)},enable:function(){this.model.set("disabled",!1)},makeInTransition:function(){this.$el.addClass("in-transition"),this._startSpinner()},makePending:function(){this.$el.removeClass("top viewed in-transition").addClass("pending");var e=this.getScaleContext();this.setBackgroundPositionAndScaleTransform(e.originalWindowWidth,!1),this._stopSpinner()},makeTop:function(){this._startSpinner(),this.$el.removeClass("pending viewed in-transition").addClass("top"),this.setBackgroundPositionAndScaleTransform(0,!1)},activate:function(){this.activateAndRunEntryAnimationsForAllVisible();var e=this.getVisibleBoundaries();this.animationRunner.createTimedTriggers(this.scrollTriggeredObjects,e),this.getModule().trigger(this.getModule().publishedEvents.PAGE_ACTIVATED,{slug:this.model.get("slug"),topY:e.topY,bottomY:e.bottomY,pageHeight:this.getPageHeight()}),this.activated=!0},makeViewed:function(){this.$el.removeClass("top pending in-transition").addClass("viewed");var e=this.getScaleContext();this.setBackgroundPositionAndScaleTransform(-e.originalWindowWidth,!1),this._stopSpinner()},getThumbnail:function(){return w.makeUrlAbsolute(this.options.thumbnail)},getChildViews:function(){return this.childViews},isChildVisible:function(e){return null!==e&&!0===e.visible},reset:function(){this.childViews&&(this.deactivateHovers(),this.animationRunner.resetAnimationsAndInitialVisibility(this.childViews))},activateAndRunEntryAnimationsForAllVisible:function(){this.childViews&&this.animationRunner.activateAndRunEntryAnimationsForAllVisible(this.childViews,this.getVisibleBoundaries())},pauseAnimations:function(){if(this.childViews){var e=function(t){i.each(t,function(t){t.pauseAnimations(),t.childViews&&e(t.childViews)})};e(this.childViews)}},resumeAnimations:function(){if(this.childViews){var e=function(t){i.each(t,function(t){t.resumeAnimations(),t.childViews&&e(t.childViews)})};e(this.childViews)}},isValidChildView:function(e){return null!==this.findChildView(e)},applyPageContext:function(e){return i.defaults(e,{pageWidth:this.getPageWidth(),pageHeight:this.getPageHeight(),module:this.getModule(),pageView:this,theme:this.options.theme,allowCommerceIntegration:this.options.allowCommerceIntegration,allowLightboxes:this.options.allowLightboxes})},invokeShowAction:function(e){if(e&&0!==e.length){var t=this,n=[];i.each(e,function(e){var i=t.findChildView(e);i&&n.push(i)}),this.loadAllMediaThenShowChildViews(i.uniq(n))}},invokeHideAction:function(e){if(e&&0!==e.length){var t=[],n=this;i.each(e,function(e){var i=n.findChildView(e);i&&t.push(i)}),this.hideAllChildViews(i.uniq(t))}},invokeToggleAction:function(e){if(e&&0!==e.length){var t=[],n=[],r=this;i.each(e,function(e){var i=r.findChildView(e);i&&(r.isChildVisible(i)?t.push(i):n.push(i))}),this.hideAllChildViews(i.uniq(t)),this.loadAllMediaThenShowChildViews(i.uniq(n))}},invokeShowOrHideOnlyAction:function(e,t){if(e&&0!==e.length){var n=[];i.each(e,i.bind(function(e){var t=this.findChildView(e);t&&(t.parentViews.length>0?n.push(t.parentViews[0]):n.push(this))},this));var r=[],o=[];i.each(i.uniq(n),function(n){i.each(n.childViews,function(i){var n=-1!==e.indexOf(i.id);n&&t||!n&&!t?o.push(i):r.push(i)})}),this.loadAllMediaThenShowChildViews(i.uniq(o)),this.hideAllChildViews(i.uniq(r))}},invokeShowOnlyAction:function(e){this.invokeShowOrHideOnlyAction(e,!0)},invokeHideOnlyAction:function(e){this.invokeShowOrHideOnlyAction(e,!1)},invokeCycleNextOrPreviousAction:function(e,t){if(e&&0!==e.length){var n=[],r=[];i.each(e,i.bind(function(e){var o=this.findChildView(e);if(o&&o.childViews&&0!==o.childViews.length){var s,a=i.findLast(o.childViews,function(e){return e.visible});if(a){var u=o.childViews.indexOf(a);s=t?0===u?o.childViews.length-1:u-1:u===o.childViews.length-1?0:u+1}else s=t?o.childViews.length-1:0;r.push(o.childViews[s]),n=n.concat(o.childViews.slice(0,s)).concat(o.childViews.slice(s+1))}},this)),this.loadAllMediaThenShowChildViews(i.uniq(r)),this.hideAllChildViews(i.uniq(n))}},invokeCycleNextAction:function(e){this.invokeCycleNextOrPreviousAction(e,!0)},invokeCyclePreviousAction:function(e){this.invokeCycleNextOrPreviousAction(e,!1)},loadAllMediaThenShowChildViews:function(n){function r(){var e=o.getVisibleBoundaries();i.each(n,function(t){t.mediaHasBeenLoaded=!0,o.animationRunner.showChildViewIfAllParentsVisible(t,e)})}var o=this,s=[];if(i.each(n,function(e){e.mediaHasBeenLoaded||(s=s.concat(o.attachViewMedia(e)))}),i.isEmpty(s))r();else{i.isNull(o.childLoadingTimeout)||clearTimeout(o.childLoadingTimeout),o.childLoadingTimeout=i.delay(function(){o._createSpinner(!0)},200);var a=function(){clearTimeout(o.childLoadingTimeout),o.childLoadingTimeout=null,o._destroySpinner(),r()};t.when.apply(t,s).done(function(){e.debug("Successfully attached child media being shown."),a()}).fail(function(){e.debug("Failed to load child media being shown."),a()})}},hideAllChildViews:function(e){this.animationRunner.hideAllChildViewsAndRunExitAnimations(e)},_createSpinner:function(e){i.isNull(this.spinner)&&(this.spinner=g.showLoading(this.$el,{startImmediately:e}))},_destroySpinner:function(){this.spinner&&(this.spinner.destroy(),this.spinner=null)},_stopSpinner:function(){this.spinner&&this.spinner.stop()},_startSpinner:function(){this.spinner&&this.spinner.start()},addActiveHoverAndBindMouseEvents:function(e,t){0===this.activeHoversGroupedByInteraction.length&&(this.$pageScroll.on("mousemove",i.bind(this._handleMouseMove,this)),this.$pageScroll.on("mouseleave",i.bind(this._handleMouseLeave,this)),this.$pinnedContainer.on("mousemove",i.bind(this._handleMouseMove,this)));var n=t.layerTargets,r=e.getExtents(),o=[];if(i.isEmpty(r))return void this.deactivateHovers();i.each(n,i.bind(function(i){if(this.isValidChildView(i)){var n=this.calculateHoverArea(e,e.getExtents(),i,t),r={object:e,interaction:t,area:n,target:this.findChildView(i)};(e.options.fixedPosition||e.options.parentSmartgroup&&e.options.parentSmartgroup.options.fixedPosition)&&(r.pinned=!0),o.push(r)}},this)),this.activeHoversGroupedByInteraction.push(o)},calculateHoverArea:function(e,t,n,r){var o,s=e.getHoverArea();if(b.shouldCreateHoverArea(r)){var a=this.getChildViewExtents(n);if(i.isEmpty(a))return void this.deactivateHovers();o=y.createHoverArea(t,a,!1)}else o=s||y.createHoverArea(t,t,!1);return o},_handleMouseMove:function(e){var t,n,r=this,o=this.getScaleContext(),s=this.$pageScroll.offset();this.scaleContext.doBlurryFontFix(o.ratio)?(t=e.pageX/o.ratio-s.left,n=e.pageY/o.ratio-s.top):(t=(e.pageX-s.left)/o.ratio,n=(e.pageY-s.top)/o.ratio);var a=[],u=Math.ceil(t),l=Math.floor(t),c=Math.ceil(n),h=Math.floor(n);i.each(this.activeHoversGroupedByInteraction,i.bind(function(e){i.every(e,function(e){var t=i.cloneDeep(e.area);if(e.pinned){var n=i.cloneDeep(e.object.getExtents());n.y1-=s.top,n.y2-=s.top,t=r.calculateHoverArea(e.object,n,e.target.id,e.interaction)}return e.target.mediaHasBeenLoaded&&!Math.pointInPoly(t,u,c)&&!Math.pointInPoly(t,l,h)})?e[0].object.triggerMouseOutAction(e[0].interaction):a.push(e)},this)),this.activeHoversGroupedByInteraction=a,0===this.activeHoversGroupedByInteraction.length&&this.deactivateHovers()},_handleMouseLeave:function(e){i.each(this.activeHoversGroupedByInteraction,i.bind(function(e){e[0].object.triggerMouseOutAction(e[0].interaction)},this)),this.deactivateHovers()},deactivateNonParentHovers:function(e){var t=[];i.each(this.activeHoversGroupedByInteraction,i.bind(function(n){if(n.length>0){i.every(n,i.bind(function(t){var i=e.idBelongsToParent(t.target.id)||t.target.id===e.id,n=t.object.id===e.id;return!(i||n||!t.target.mediaHasBeenLoaded)},this))?n[0].object.triggerMouseOutAction(n[0].interaction):t.push(n)}},this)),this.activeHoversGroupedByInteraction=t},deactivateHovers:function(){this.activeHoversGroupedByInteraction=[],this.$pageScroll.off("mousemove"),this.$pageScroll.off("mouseleave")},getChildViewExtents:function(e){var t=this.findChildView(e),i={};return t&&(i=t.getExtents()),i},getPageIndex:function(){return this.model.getPageIndex()}})}),define("modules/page/module",["lodash","ceros","globals","modules/page/views/PageView"],function(e,t,i,n){"use strict";var r=new t.Module({id:"page",description:"",version:"1.0",dependencies:{splashScreen:"1.0"},publishedEvents:{PAGE_COMPONENT_INTERACTION:"page.component.interaction",PAGE_COMPONENT_CLICKED:"page.component.clicked",PAGE_COMPONENT_FORM_SUBMITTED:"page.component.form_submitted",PAGE_PRELOAD_READY:"page.preload_ready",PAGE_ACTIVATED:"page.activated",PAGE_SCROLL:"page.scroll",PAGE_ACTION_SCROLL_TO:"page.action.scroll_to",PAGE_ACTION_GO_TO_PREV_PAGE:"page.action.go_to_prev_page",PAGE_ACTION_GO_TO_NEXT_PAGE:"page.action.go_to_next_page",PAGE_ACTION_GO_TO_PAGE:"page.action.go_to_page",PAGE_ACTION_ENABLE_DISABLE_PAGES:"page.action.enable_disable_pages",PAGE_ACTION_GO_TO_URL:"page.action.go_to_url",PAGE_ACTION_OPEN_LIGHTBOX:"page.action.open_lightbox",PAGE_ACTION_OPEN_PRODUCT_PANEL:"page.action.open_product_panel",PAGE_ACTION_OPEN_SHOPPING_CART:"page.action.open_shopping_cart",PAGE_ACTION_LAYER_VISIBILITY:"page.action.layer_visibility",PAGE_ACTION_INVOKE_ANIMATION:"page.action.invoke.animation",PAGE_ACTION_PLAY_AUDIO:"page.action.play_audio",PAGE_ACTION_SHARE_PAGE:"page.action.share.page",PAGE_VIDEO_PLAY:"page.video.play",PAGE_VIDEO_PROGRESS_TIME:"page.video.progress_time",PAGE_VIDEO_PROGRESS_PERCENT:"page.video.progress_percent",PAGE_RELOAD:"page.reload",PAGE_COMPONENT_ANIMATION_START:"page.component.animation.start",PAGE_COMPONENT_ANIMATION_END:"page.component.animation.end",TIMED_INTERACTION:"page.component.timed.interaction"},INTERACTION_TRIGGERS:{CLICK:"click",HOVER:"hover",VIEW:"view",SUBMIT:"submit"},delegate:{createPageView:function(t,o){var s={theme:e.isUndefined(i.themeObj)?{}:i.themeObj};return o=e.extend({enableLoadingThumbnail:!1,enableLoadingSpinner:!1,allowCommerceIntegration:i.allowCommerceIntegration,allowLightboxes:i.allowLightboxes},s,o||{}),new n(e.extend(o,{module:r,model:t}))}}});return r}),define("modules/viewport/module",["jquery","lodash","log","ceros","globals","modules/viewport/views/ViewportView","socialSharing","device","shared/utils/NavigationUtils","shared/utils/CerosResourceLoader","libs/image/ImageResource","modules/viewport/utils/PageLoadPolicy","modules/page/module","shared/utils/ScaleContext","shared/utils/ModuleEventManager","urlUtils"],function(e,t,i,n,r,o,s,a,u,l,c,h,d,f,p,g){"use strict";var m={TOP:"top",BOTTOM:"bottom",SCRANCHOR:"scranchor"},v=null,y=null,b=null,w=null,E=null,_=null,T=null,S=new n.Module({id:"viewport",description:"",version:"1.0",dependencies:{page:"1.0"},firstPageShown:new e.Deferred,publishedEvents:{LONGPRESS:"viewport.longpress",SCALE:"viewport.scale",PAGE_CHANGE:"viewport.page_change",PAGE_CHANGING:"viewport.page_changing",PAGE_BATCH_LOAD_START:"viewport.page_batch_load_start",PAGE_UPDATE:"viewport.page_update",PAGE_ENABLED_CHANGE:"viewport.page_enabled_change",CURRENT_PAGE_DELETED:"viewport.current_page_deleted",TIMED_LIGHTBOX:"viewport.timed.lightbox",TIMED_PRODUCT_PANEL:"viewport.timed.product_panel",TIMED_SHOPPING_CART:"viewport.timed.shopping_cart"},delegate:{init:function(e,n){b=e,T=n.performanceTracker;var s=t.extend({module:S,marginTopCallback:function(){return 0},documentVersion:b},n||{});y=new f(s);var a=t.extend({module:S,documentVersion:b,scaleContext:y},n||{});v=new o(a),v.preloadMedia();var l=new h(b.getEnabledPageIndexes(),b.isCarousel()),c=u.parsePageFromLocation();E=b.getPageInfoByNumberOrSlug(c).number;var d=b.getNearestEnabledPage(E);E===d||r.previewMode||(i.info("Requesting disabled page",E),E=d),_=l.getPageIndexesToLoad(E-1),this.registerEvents()},triggerExperienceLevelInteractions:function(e){e.get("interactions")&&t.each(e.get("interactions"),function(e){switch(e.action){case"lightbox":setTimeout(function(){S.trigger(S.publishedEvents.TIMED_LIGHTBOX,e)},1e3*e.delay);break;case"product":setTimeout(function(){S.trigger(S.publishedEvents.TIMED_PRODUCT_PANEL,e)},1e3*e.delay);break;case"shopping-cart":setTimeout(function(){S.trigger(S.publishedEvents.TIMED_SHOPPING_CART,e)},1e3*e.delay)}})},registerEvents:function(){p.on("sdk.experience.page.goto",t.bind(function(e){this.jumpToPage(e.pageNum,!0)},this)),p.on("sdk.experience.page.next",t.bind(function(e){this.nextPage()},this)),p.on("sdk.experience.page.previous",t.bind(function(e){this.previousPage()},this)),p.on("sdk.component.video.start",t.bind(function(e){this.startVideo(e.componentId)},this)),p.on("sdk.component.video.stop",t.bind(function(e){this.stopVideo(e.componentId)},this)),p.on("sdk.component.text.settext",t.bind(function(e){this.setComponentText(e.componentId,e.textContent)},this)),p.on("sdk.component.image.seturl",t.bind(function(e){this.setImageUrl(e.componentId,e.url,e.useNewImageSize)},this)),p.on("sdk.component.image.reset",t.bind(function(e){this.resetImage(e.componentId)},this)),p.on("sdk.component.click",t.bind(function(e){this.clickComponent(e.componentId)},this)),p.on("sdk.component.show",t.bind(function(e){this.showComponent(e.componentId)},this)),p.on("sdk.component.hide",t.bind(function(e){this.hideComponent(e.componentId)},this)),p.on("sdk.layer.show",t.bind(function(e){this.showLayer(e.layerId)},this)),p.on("sdk.layer.hide",t.bind(function(e){this.hideLayer(e.layerId)},this)),p.on("sdk.page.animations.start",t.bind(function(e){this.startPageAnimations(e.pageSlug)},this)),p.on("sdk.page.animations.pause",t.bind(function(e){this.pausePageAnimations(e.pageSlug)},this)),p.on("sdk.page.disable",t.bind(function(e){this.disablePage(e.pageNum)},this)),p.on("sdk.page.enable",t.bind(function(e){this.enablePage(e.pageNum)},this))},createPageViews:function(){var e=[];d.on(d.publishedEvents.PAGE_RELOAD,function(){v.scale()}),w=b.editorPagesManifest,w.each(t.bind(function(t,i){var n=this.createSinglePageView(t,i);e.push(n)},this)),this.pageViews=e},createSinglePageView:function(e,t){var i=b.getPages()[t];return d.createPageView(i,{physicalPageNumber:t,enableLoadingThumbnail:!1,enableLoadingSpinner:!0,thumbnail:e.get("thumbnail"),documentVersion:b,scaleContext:y,isRequestedPage:t===E-1})},getPageViews:function(){return this.pageViews},scale:function(){v.scalePageComponents()},preloadPageMedia:function(){var e=t.map(b.getPages(),function(e){return y.getPageScaleContext(e)});b.shouldLazyLoad()?(t.each(_,t.bind(function(t,n){var r=b.getPages()[t];0===n?T.mark(T.MARKS.PLAYER.HIGH_PRIORITY_IMAGES_START_LOADING):1===n&&T.mark(T.MARKS.PLAYER.LOW_PRIORITY_IMAGES_START_LOADING),i.debug("Lazy preloading media for page: "+(t+1));var o=0===n;r.lazyPreloadAllMedia(e[t],o)},this)),1===_.length&&T.mark(T.MARKS.PLAYER.LOW_PRIORITY_IMAGES_START_LOADING),t.each(b.getPages(),function(n,r){t.includes(_,r)||(i.debug("Lazy preloading media for page: "+(r+1)),n.lazyPreloadAllMedia(e[r],!1))})):(T.mark(T.MARKS.PLAYER.HIGH_PRIORITY_IMAGES_START_LOADING),t.each(_,t.bind(function(t,n){var r=b.getPages()[t],o=e[t];i.debug("Preloading visible media for page: "+(t+1)),r.preloadVisibleMedia(o,!0)},this)),T.mark(T.MARKS.PLAYER.LOW_PRIORITY_IMAGES_START_LOADING),t.each(b.getPages(),function(n,r){t.includes(_,r)||(i.debug("Preloading visible media for page: "+(r+1)),n.preloadVisibleMedia(e[r],!1))}),t.each(b.getPages(),function(t,n){i.debug("Preloading hidden media for page: "+(n+1)),t.preloadHiddenMedia(e[n])}))},renderPages:function(){this.createPageViews(),v.reset(this.pageViews,E),this.preRenderPages(),i.debug("Setting up the lazy preRender Defer"),t.defer(t.bind(S.startLazyPrerender,S));var e=v.showPage(E);return e.done(S.firstPageShown.resolve),e},activateFirstPage:function(){v.getBackgroundImagePromise().done(t.bind(v.showBackground,v)),v.activatePage(v.getCurrentPage()),S.triggerExperienceLevelInteractions(b)},preRenderPages:function(){T.mark(T.MARKS.PLAYER.BEGIN_PRERENDERING_PAGES);var i=this.pageViews;i=b.shouldLazyLoad()?[this.pageViews[_[0]]]:t.map(_,t.bind(function(e){return this.pageViews[e]},this));var n=[];t.each(i,t.bind(function(e){e.prerender(),n.push(e.getPrerenderDeferred())},this)),e.when.apply(e,n).done(t.bind(function(){T.mark(T.MARKS.PLAYER.ALL_PAGES_PRERENDERED)},this))},isFirstPageReadyToShow:function(){return"resolved"===S.firstPageShown.state()},getFirstPageReadyPromise:function(){return S.firstPageShown},nextPage:function(){v&&v.nextPage()},previousPage:function(){v&&v.previousPage()},jumpToPage:function(e,t){v&&v.jumpToPage(e,t)},show:function(){v&&v.show()},hide:function(){v&&v.hide()},el:function(){return v?v.$el:null},getCurrentPageHeight:function(){if(v){var e=v.getCurrentPage();if(e)return e.getPageHeight()}return null},getCurrentPageSlug:function(){return v?v.currentPageSlug:null},getCurrentPageNumber:function(){return v?v.currentPage:null},isLastPage:function(e){var i=w.length,n=w.at(i-1);return t.last(n.uri.split("/"))===e},isFirstPage:function(e){var i=w.at(0);return t.last(i.uri.split("/"))===e},scrollTo:function(e,t){var i=v.getCurrentPage(),n=this.getScrollPositionForInteraction(e,t);return i.$pageContainer.animate({scrollTop:n},300,"easeOutCubic"),{scrollPosition:n,pageHeight:i.model.getPageHeight(b),visibleHeight:i.$pageContainer.height()}},getScrollPositionForInteraction:function(e,n){switch(e){case m.TOP:return 0;case m.BOTTOM:return v.getCurrentPage().model.getPageHeight(b);case m.SCRANCHOR:var r=v.getCurrentPage().model.getScranchorsForCurrentVariant();return r&&t.has(r,n)?r[n]:(i.warn("Could not find scranchor for id: "+n),null);default:return i.warn("Scroll interaction target type is invalid: "+e),null}},shareCurrentPageOnSocial:function(e,t){if(v){var i=u.buildUriForPageNumber(v.currentPage),n=v.getCurrentPage();this.shareOnSocial(e,window.location.protocol+"//"+window.location.host+i,n.getThumbnail(),t.get("title"))}},shareOnSocial:function(e,t,n,o){switch(t=g.removeEmbedParams(t),e){case"share-twitter":s.shareOnTwitter(t,o);break;case"share-linkedin":s.shareOnLinkedIn(t,o);break;case"share-pinterest":if(!n){var a="Sorry, sharing to Pinterest is currently not supported in the Previewer.";i.info(a),r.previewMode&&alert(a);break}s.shareOnPinterest(t,n,o);break;case"share-facebook":s.shareOnFacebook(t,n,o);break;case"share-email":s.shareViaEmail(t,o)}},addClickShield:function(){v&&v.addClickShield()},removeClickShield:function(){v&&v.removeClickShield()},disableGestures:function(){t.isFunction(v.disableGestures)&&v.disableGestures()},enableGestures:function(){t.isFunction(v.enableGestures)&&v.enableGestures()},getExperienceWidth:function(){return v.getExperienceWidth()},getExperienceHeight:function(){return v.getExperienceHeight()},startVideo:function(e){var i=v.getCurrentPage(),n=i.model.getAllSmartgroupInstanceComponentIds(e),r=[e].concat(n);t.each(r,function(e){var t=v.getCurrentPage().findVideo(e);t&&t.play()})},stopVideo:function(e){var i=v.getCurrentPage(),n=i.model.getAllSmartgroupInstanceComponentIds(e),r=[e].concat(n);t.each(r,function(e){var t=v.getCurrentPage().findVideo(e);t&&t.manuallyPause()})},setComponentText:function(e,i){var n=v.getCurrentPage(),r=n.model.getAllSmartgroupInstanceComponentIds(e),o=[e].concat(r);t.each(o,function(e){var n=v.getCurrentPage().findChildView(e);n&&"text"===n.type&&n.setTextFromSDK(t.isNil(i)?"":String(i))})},setImageUrl:function(i,n,r){var o=v.getCurrentPage(),s=o.model.getAllSmartgroupInstanceComponentIds(i),a=[i].concat(s);t.each(a,function(t){var i=v.getCurrentPage().findChildView(t);if(i&&"image"===i.type)if(i.srcOverride=n,i.dimensionsOverride=r,r){var o=new Image;o.onload=function(){var t=i.$imgEl.attr("style"),n=i.$imgEl.attr("alt");i.$imgEl.remove();var r=e(o);r.attr("style",t).attr("alt",n),i.$imgEl=e(r),i.$el.append(i.$imgEl)},o.src=n}else i.$imgEl.attr("src",n)})},resetImage:function(e){var i=v.getCurrentPage(),n=i.model.getAllSmartgroupInstanceComponentIds(e),r=[e].concat(n);t.each(r,function(e){var t=v.getCurrentPage().findChildView(e);t&&"image"===t.type&&(t.srcOverride=null,t.dimensionsOverride=null,t.render())})},showLayer:function(e){var t=v.getCurrentPage(),i=t.model.getAllSmartgroupInstanceLayerIds(e),n=[e].concat(i);v.getCurrentPage().invokeShowAction(n)},hideLayer:function(e){var t=v.getCurrentPage(),i=t.model.getAllSmartgroupInstanceLayerIds(e),n=[e].concat(i);t.invokeHideAction(n)},clickComponent:function(e){var i=v.getCurrentPage(),n=i.model.getAllSmartgroupInstanceComponentIds(e),r=[e].concat(n);t.each(r,function(e){var t=i.findChildView(e);t&&t.simulateClick()})},showComponent:function(e){var i=v.getCurrentPage(),n=i.model.getAllSmartgroupInstanceComponentIds(e),r=[e].concat(n);t.each(r,function(e){var t=v.getCurrentPage().findChildView(e);t&&(t.reset(),t._applyVisibility(!0),t.activateAndRunEntryAnimations())})},hideComponent:function(e){var i=v.getCurrentPage(),n=i.model.getAllSmartgroupInstanceComponentIds(e),r=[e].concat(n);t.each(r,function(e){var t=v.getCurrentPage().findChildView(e);t&&t._applyVisibility(!1)})},startPageAnimations:function(e){var t=v.getCurrentPage();t.model.get("slug")===e&&(t.reset(),t.activateAndRunEntryAnimationsForAllVisible())},pausePageAnimations:function(e){var t=v.getCurrentPage();t.model.get("slug")===e&&t.pauseAnimations()},disablePage:function(e){v.disablePage(e)},enablePage:function(e){v.enablePage(e)},isLayerVisible:function(e){return t.some(this.pageViews,function(t){return t.isChildVisible(e)})}},startLazyPrerender:function(){i.debug("Lazy prerender process starting...");var n=Date.now(),r=[],o=this.getPageViews();t.each(_,function(e){r.push(o[e])}),t.each(o,function(e,i){t.includes(_,i)||r.push(e)});var s=e.Deferred().resolve();return t.each(r,function(e){e.isPrerendered()||(s=s.pipe(t.bind(e.startLazyPrerender,e)))}),s.pipe(function(){i.debug("Lazy prerender process complete. Total elapsed time: "+(Date.now()-n)+" ms")}),s.promise()}});return S}),define("text!modules/lightbox/templates/lightbox.html",[],function(){return'<div class="container ceros-lightbox">\n    <div class="close">&#xE00B;</div>\n    <div class="scrolling">\n        <iframe src="about:blank" frameborder="0" allowfullscreen></iframe>\n    </div>\n</div>\n'}),define("modules/lightbox/views/LightboxView",["log","jquery","lodash","backbone","shared/utils/CerosResourceLoader","shared/models/EmbeddedViewportModel","shared/views/AbstractView","device","text!modules/lightbox/templates/lightbox.html"],function(e,t,i,n,r,o,s,a,u){"use strict";var l={"click .close":"_close",click:"_backgroundClick"},c={"touchstart .close":"_close",touchstart:"_backgroundClick"};return s.extend({id:"lightbox",events:function(){var e={};return a.desktop()&&i.extend(e,l),a.touch()&&i.extend(e,c),e}(),lightboxWidth:null,lightboxHeight:null,initialize:function(){s.prototype.initialize.apply(this,arguments),this._render()},setSizeAndPosition:function(){var e=o.getInstance();if(e.isActive()){var t=this.$el,i=this.$(".container"),n=e.getVerticalCenterOfVisibleArea(t.height())-this.lightboxHeight/2,r=Math.max(t.width()-this.lightboxWidth,0)/2;t.css({padding:0}),i.css({transform:"none",top:n+"px",left:r+"px"})}a.smallWindow()?this.$el.addClass("fullscreen-lightbox"):this.$(".container").css({"max-width":this.lightboxWidth,"max-height":this.lightboxHeight})},_close:function(e){e&&e.preventDefault(),this.deactivate()},_backgroundClick:function(e){e.target==this.$el[0]&&this._close(e)},_render:function(){this.$el.html(u)},openLightbox:function(t){return i.isEmpty(t)?void e.warn("missing options for lightbox"):i.isEmpty(t.url)?void e.warn("missing URL for lightbox"):t.width?t.height?(t.showCloseButton?(this.$el.removeClass("without-close-button"),this.$el.addClass("with-close-button")):(this.$el.removeClass("with-close-button"),this.$el.addClass("without-close-button")),this.lightboxWidth=t.width,this.lightboxHeight=t.height,this.setSizeAndPosition(),this.$(".close").css("background-color",t.closeButtonBgColor),this.$(".close").css("color",t.closeButtonFgColor),this.$("iframe").attr("src",t.url),this.show(),void r.pause()):void e.warn("missing height for lightbox"):void e.warn("missing width for lightbox")},deactivate:function(){r.resume(),this.$("iframe").attr("src","about:blank"),this.hide()},hide:function(){this.$el.hide()},show:function(){this.$el.show()}})}),define("modules/lightbox/module",["lodash","jquery","ceros","globals","device","shared/models/EmbeddedViewportModel","modules/lightbox/views/LightboxView","urlUtils"],function(e,t,i,n,r,o,s,a){"use strict";var u=new i.Module({id:"lightbox",description:"",version:"1.0",dependencies:{},lightboxView:null,delegate:{load:function(){return this.lightboxView=new s({module:u}),this.registerEvents(),this},showLightbox:function(t,i,r,o){var s=e.isUndefined(n.themeObj)?{}:n.themeObj,u=e.extend({},this.getBrowserUrlParams(),this.getDefaultUrlParams());this.lightboxView.openLightbox({url:a.appendQueryParams(t,u),width:i,height:r,showCloseButton:o,closeButtonBgColor:s.menuBgColor,closeButtonFgColor:s.menuFgColor})},showProduct:function(t){if(!e.isEmpty(t)){var i=this.getUrlForProduct(t);e.isEmpty(i)||this.lightboxView.openLightbox({url:i,width:n.commerceSettings.panelWidth,height:n.commerceSettings.panelHeight})}},getUrlForProduct:function(t){var i=n.allowCommerceIntegration?n.commerceSettings.productUrl:"";if(e.isUndefined(i)||e.isEmpty(i)||-1===i.indexOf("{id}"))return"";var r=!1;-1!==i.indexOf("?")&&i.indexOf("?")<i.indexOf("{id}")&&(r=!0);var o=null,s=t.lastIndexOf("?");s>0&&(o=a.getUrlParams(t.substring(s)),t=t.substring(0,s));var u;u=r?encodeURIComponent(t):t.replace(/[^\/]+/gi,function(e,t){return encodeURIComponent(e)}),i=i.replace("{id}",u);var l=e.extend({},this.getBrowserUrlParams(),o,this.getDefaultUrlParams());return i=a.appendQueryParams(i,l)},showShoppingCart:function(){var t=this.getUrlForShoppingCart();e.isEmpty(t)||this.lightboxView.openLightbox({url:t,width:n.commerceSettings.panelWidth,height:n.commerceSettings.panelHeight})},getUrlForShoppingCart:function(){var t=n.allowCommerceIntegration?n.commerceSettings.shoppingCartUrl:"";return e.isUndefined(t)||e.isEmpty(t)?"":a.appendQueryParams(t,this.getDefaultUrlParams())},getDefaultUrlParams:function(){return{ceros_device_pixel_ratio:r.pixelRatio(),ceros_account_slug:n.accountSlug,ceros_app_slug:n.appSlug,ceros_issue_slug:n.issue.slug,ceros_device_type:r.deviceType(),ceros_player_type:r.playerType()}},getBrowserUrlParams:function(){var e=a.removeEmbedParams(this.getWindowUrl());return a.getUrlParams(e)},show:function(){this.lightboxView.show()},hide:function(){this.lightboxView.hide()},deactivate:function(){this.lightboxView.deactivate()},el:function(){return this.lightboxView.$el},iframe:function(){return this.lightboxView.$("iframe")[0]},getWindowUrl:function(){return window.location.href},registerEvents:function(){o.getInstance().on("change",this.lightboxView.setSizeAndPosition,this.lightboxView)}}});return u}),define("text!modules/error/templates/error.html",[],function(){return'<div id="float"></div>\n<div id="dialog">\n    <div id="content">\n        <div id="title">\n            {{title}}\n        </div>\n        <div id="image" {{#imageCssClass}}class="{{imageCssClass}}"{{/imageCssClass}}></div>\n        <div id="message">\n            {{{message}}}\n        </div>\n    </div>\n</div>'}),define("modules/error/views/ErrorView",["jquery","lodash","backbone","mustache","shared/views/AbstractView","text!modules/error/templates/error.html"],function(e,t,i,n,r,o){"use strict";return r.extend({id:"errorModal",initialize:function(e){r.prototype.initialize.call(this,e),this.options=e,this.render()},render:function(){var e=n.render(o,{title:this.options.title,message:this.options.message,imageCssClass:this.options.imageCssClass});this.$el.html(e)}})}),define("modules/error/module",["jquery","ceros","modules/error/views/ErrorView"],function(e,t,i){"use strict";return new t.Module({id:"Error",description:"Provides an error display module",version:"1.0",publishedEvents:{},dependencies:{},delegate:{load:function(e){this.errorView=new i({
title:e.title,message:e.message,imageCssClass:e.imageCssClass})},el:function(){return this.errorView.$el}}})}),define("applications/html5-player/TopView",["log","lodash","jquery","device","globals","backbone","shared/utils/CerosResourceLoader","shared/utils/ModuleEventManager","shared/models/EmbeddedViewportModel","applications/html5-player/PreviewerSelectionView","applications/html5-player/AdaptiveLayoutsPreviewerFrameView","modules/splash-screen/module","modules/chrome/module","modules/branding/module","modules/flippers/module","modules/viewport/module","modules/lightbox/module","modules/error/module"],function(e,t,i,n,r,o,s,a,u,l,c,h,d,f,p,g,m,v){"use strict";var y=null;return t.extend({},o.Events,{publishedEvents:{PLAYER_DOCUMENT_SHOWN:"player.document.shown"},setupInitialDom:function(){var e=i("html");n.mobile()?e.addClass("mobile"):e.addClass("desktop"),n.msie?e.addClass("msie"+n.msieVersion()):e.addClass("non-msie"),e.addClass(n.renderingEngine()),e.addClass(n.orientation()),n.retina()&&e.addClass("retina"),i(window).bind(n.supportsOrientationChange()?"orientationchange":"resize",t.debounce(t.bind(function(){e.removeClass("portrait landscape"),e.addClass(n.orientation())},this),100));var r=i("body"),o=i("#main");d.shouldShow()&&o.append('<div id="chrome"></div>'),o.append('<div id="viewport"></div>'),o.append('<div id="flippers"></div>'),r.append('<div id="lightbox"></div>')},attachModuleViews:function(e){i("#viewport").replaceWith(g.el()),i("#flippers").replaceWith(p.el()),i("#lightbox").replaceWith(m.el()),i("#viewport").append(f.el()),r.isEmbedded||(i("#chrome").replaceWith(d.el()),d.setTitle(e.get("title")))},setupAdaptiveLayoutsPreviewerFrameView:function(){this.previewerFrame=this.initPreviewerFrameView()},showPreviewerFadingMessage:function(){r.previewMode&&r.allowAdaptiveLayouts&&this.previewerFrame.showFadingHelpMessage()},initPreviewerSelectionView:function(){return new l({el:".previewer-selection-header"})},initPreviewerFrameView:function(){return new c({el:".adaptive-layouts-frame"})},showDocument:function(){d.shouldShow()&&(d.show(),d.initiallyHidden()&&d.hide()),f.shouldShow()&&f.show(),i("#main").addClass("document"),g.show(),p.show(),this.hideLoadingExperience(),this.trigger(this.publishedEvents.PLAYER_DOCUMENT_SHOWN)},showLoadingExperience:function(){y=h.showLoading(i("#main"),{showCerosBranding:r.showCerosBranding,showPreviewLabel:r.previewMode,overlayed:!1})},hideLoadingExperience:function(){y?y.destroy():e.warn("Showing document but never showed the loading experience")},show404:function(){this.showError({title:"Sorry, page not found",message:"Please check the url and<br/>try again"})},show503:function(){this.showError({title:"Previewer for this experience is currently unavailable due to an excessive number of requests",message:"Please try again later",imageCssClass:"error503"})},showError:function(e){this.hideLoadingExperience(),v.load(e),i("html").css({height:"100%"}),i("body").empty().css({display:"block",height:"100%"}).append(v.el())}})}),define("modules/page/utils/ShareJSConnection",["jquery","lodash","globals","log","applications/html5-player/TopView"],function(e,t,i,n,r){"use strict";var o=!1,s=function(){if(!1!==o)return o;if("undefined"==typeof sharejs)throw Error("Unable to connect to ShareJS Server");return o=new sharejs.Connection(i.shareJsServer),o.on("error",t.bind(a._showErrorInternal,a)),e(window).unload(function(){o&&o.disconnect()}),o},a={initialize:function(){s()},getConnection:function(){return o},_showErrorInternal:function(e){if("Unknown session ID"===e)return!1;var t="There was a problem connecting to the server.";return e&&(t=e,t.match(/\bOp apply failed/gi)&&(t="Your changes were unable to be saved.")),this.showError(t)},showError:function(e){return this.readOnlyConnectionLimitExceededError||window.onerror(e,null,null),o&&(o.disconnect(),o=!1),!0},listenForReadOnlyConnectionLimitError:function(e){e.on("shout",t.bind(function(e){if(e){try{e=JSON.parse(e)}catch(e){return}"READONLY_CONNECTION_LIMIT_EXCEEDED"===e.name&&(this.readOnlyConnectionLimitExceededError=!0,r.show503())}},this))}};return a}),define("modules/page/models/media-loaders/ComponentImageLoader",["lodash","backbone","log"],function(e,t,i){"use strict";var n=function(e,t){this.componentWidth=e.width,this.componentHeight=e.height,this.componentId=e.id,this.currentResource=null,this.url=t.url};return e.extend(n.prototype,t.Events,{IMAGE_LOADED_EVENT:"image-loaded",LOW_RES_IMAGE_LOADED_EVENT:"low-res-image-loaded",url:null,loadLowRes:function(e){throw"implement loadLowRes in subclasses"},load:function(e){throw"implement load in subclasses"},getCurrentUrl:function(){throw"implement getCurrentUrl in subclasses"},loadNow:function(e){this.load(e),this.currentResource&&this.currentResource.loadNow()},loadLowResNow:function(e){this.loadLowRes(e),this.currentResource&&this.currentResource.loadNow()},onImageLoaded:function(e,t){this.currentResource?("resolved"===this.currentResource.getPromise().state()&&e.call(t),this.bind(this.IMAGE_LOADED_EVENT,e,t)):i.warn("No resource was ever loaded",{componentId:this.componentId})},onLowResImageLoaded:function(e,t){this.currentResource?("resolved"===this.currentResource.getPromise().state()&&e.call(t),this.bind(this.LOW_RES_IMAGE_LOADED_EVENT,e,t)):i.warn("No resource was ever loaded",{componentId:this.componentId})},getFullResolutionUrl:function(){return this.url},getCurrentResource:function(){return this.currentResource}}),n}),define("modules/page/models/media-loaders/ComponentVectorImageLoader",["lodash","urlUtils","modules/page/models/media-loaders/ComponentImageLoader","shared/utils/CerosResourceLoader"],function(e,t,i,n){"use strict";var r=function(e,t){i.call(this,e,t)};return e.extend(r.prototype,i.prototype,{loadLowRes:function(e){this.load(e)},load:function(i){if(!this.currentResource){var r=t.replaceProtocolIfHttpsRequest(this.url);this.currentResource=n.addVectorImage(r),this.currentResource.getPromise().done(e.bind(function(){this.trigger(this.IMAGE_LOADED_EVENT)},this))}},getCurrentUrl:function(){return this.url}}),r}),define("modules/page/models/media-loaders/ComponentRasterImageLoader",["lodash","modules/page/models/media-loaders/ComponentImageLoader","shared/utils/CerosResourceLoader","ImageUtils","ImageCroppingUtils"],function(e,t,i,n,r){"use strict";var o=function(i,n){t.call(this,i,n),this.imageId=n.id,r.isValidCropObject(i.crop)?(this.cropDimensions=i.crop,this.originalWidth=this.cropDimensions.width,this.originalHeight=this.cropDimensions.height):(this.originalWidth=e.get(n,["original","width"],null),this.originalHeight=e.get(n,["original","height"],null))};return e.extend(o.prototype,t.prototype,{imageId:null,originalWidth:null,originalHeight:null,currentUrl:null,currentWidth:-1,cropDimensions:null,loadLowRes:function(e){var t=this.componentWidth*e.adjustedRatio,i=this.componentHeight*e.adjustedRatio,n=this._calculateLowResDimensions(t,i);n.width<=50&&n.height<=50?this.load(e):this._loadLowResWidth(n.width,e)},load:function(t){var i=Math.round(this.componentWidth*t.ratio),r=n.calculateWidthForDevicePixelRatio(i);this.loadWidth(r).done(e.bind(function(){this.trigger(this.IMAGE_LOADED_EVENT)},this))},getCurrentUrl:function(){return this.currentUrl},loadWidth:function(t){if(this.currentResource){if(t<=this.currentWidth)return this.currentResource.getPromise();this.currentResource.cancel()}return this.currentResource=i.addRasterImage(this.imageId,t,this.cropDimensions),this.currentResource.getPromise().done(e.bind(function(e){this.currentUrl=e.getSrc(),this.currentWidth=e.getWidth()},this))},_loadLowResWidth:function(t,i){this.loadWidth(t).done(e.bind(function(){this.trigger(this.LOW_RES_IMAGE_LOADED_EVENT),this.loadNow(i)},this))},_calculateLowResDimensions:function(e,t){var i,n,r=Math.min(e,this.originalWidth),o=Math.min(t,this.originalHeight),s=r/this.originalWidth,a=o/this.originalHeight,u=this.originalWidth/this.originalHeight;return s<a?(i=Math.ceil(.25*r),n=Math.ceil(r*u*.25)):(i=Math.ceil(o*u*.25),n=Math.ceil(.25*o)),{width:i,height:n}}}),o}),define("modules/page/models/media-loaders/ComponentImageLoaderFactory",["globals","VectorImageUtils","modules/page/models/media-loaders/ComponentVectorImageLoader","modules/page/models/media-loaders/ComponentRasterImageLoader"],function(e,t,i,n){"use strict";return{create:function(e,r){return t.isVectorBased(e.contentType)?new i(e,r):new n(e,r)}}}),define("shared/models/OverrideablePropertyModelMixin",["lodash","backbone","modules/page/utils/PlayerVariantDetector"],function(e,t,i){"use strict";return{getOverrideablePropertyForCurrentVariant:function(t){var n=i.getVariant();if("desktop"===n)return this.get(t);var r=this.get("overrides");return e.get(r,[n,t])}}}),define("LazyMigrationUtils",["lodash"],function(e){"use strict";var t=["crop"];return{isLazyAddedField:function(i){var n=e.get(i.p,i.p.length-1);return n&&-1!==t.indexOf(n)},isUpdateForLazyAddedField:function(t){return(!e.isUndefined(t.oi)||!e.isUndefined(t.od))&&this.isLazyAddedField(t)},normalizeIfLazyAddedField:function(e){this.isUpdateForLazyAddedField(e)&&(e.od&&!e.oi?e.oi=null:e.oi&&!e.od&&(e.od=null))}}}),define("shared/utils/ShareJSUtils",["lodash","modules/page/utils/PlayerVariantDetector","LazyMigrationUtils"],function(e,t,i){"use strict";var n=["image","background","backgroundHasBeenSet","crop"],r=["video","poster"];return{isMediaReloadRequiredForComponent:function(t,i){if(i){if(this.isComponentCreation(t)){var n=this.getLayerTypeFromLayer(i);if(e.includes(["smartgroup_definition","folder","group"],n)||this.isMediaComponentWithMediaPropertiesSet(i))return!0}else if(this.isComponentUpdate(t)){var r=this.someOpPropertySuchThat(t,e.bind(function(e){return this.isMediaProperty(i,e)||"visible"===e},this));return r}}return!1},isMediaReloadRequiredForOp:function(e,t){var i=this.getComponentFromOp(e,t);return this.isMediaReloadRequiredForComponent(t,i)},someOpPropertySuchThat:function(i,n){var r=t.getVariant();if("desktop"===r){return n(this.getPropertyNameFromPath(i.p))}var o=this.getPropertyNamesFromOverridesOp(i,r);return e.some(o,n)},isPageReloadRequiredForComponent:function(t,i){if(i){if(this.isComponentCreation(t))return!0;if(this.isComponentUpdate(t)){var n=!1;return this.someOpPropertySuchThat(t,function(t){"video-widget"===i.type&&e.includes(["height","width"],t)?n=!0:"smartgroup"===i.type&&e.includes(["x","y","height","width"],t)?n=!0:"opacity"===t?n=!0:"fixedPosition"===t&&(n=!0)}),n}throw"Wrong Op Type passed"}return!0},isComponentCreation:function(t){return!!e.isArray(t.p)&&(2===t.p.length&&"layerDictionary"===t.p[0]&&!e.isUndefined(t.oi)&&e.isUndefined(t.od))},isLayerHierarchiesChange:function(e){return"layerHierarchies"===e.p[0]},isLayerHierarchiesMoveOrDelete:function(t){return"layerHierarchies"===t.p[0]&&!e.isUndefined(t.ld)},isLayerDictionaryDelete:function(t){return!i.isUpdateForLazyAddedField(t)&&("layerDictionary"===t.p[0]&&!e.isUndefined(t.od)&&e.isUndefined(t.oi))},isComponentUpdate:function(t){return!!e.isArray(t.p)&&(!!i.isUpdateForLazyAddedField(t)||!(2!==t.p.length&&3!==t.p.length||"layerDictionary"!==t.p[0]||e.isUndefined(t.oi)||e.isUndefined(t.od)))},getPropertyNameFromPath:function(t){var i;return t.length>2&&e.isString(e.last(t))&&(i=e.last(t)),i},getPropertyNamesFromOverridesOp:function(t,i){if(e.isUndefined(t.oi)||e.isUndefined(t.od))throw"Cannot get properties changed without old and new objects";var n=t.oi[i],r=t.od[i],o=e.union(e.keys(n),e.keys(r));return e.filter(o,function(t){return!e.isEqual(n[t],r[t])})},getComponentFromOp:function(t,i){if(!e.isUndefined(i.oi)||!e.isUndefined(i.od)){var n=e.slice(i.p,0,2),r=n.join(".");return e.at(t.snapshot,r)[0]}return null},getLayerTypeFromLayer:function(e){return e.type?e.type:void 0!==e.layers?"smartgroup_definition":void 0},isMediaProperty:function(t,i){return!!t&&("image-component"===t.type?e.includes(n,i):"video-widget"===t.type&&e.includes(r,i))},isMediaComponentWithMediaPropertiesSet:function(e){return e&&("image-component"===e.type&&e.image||"video-widget"===e.type&&e.video&&e.poster)}}}),define("modules/page/utils/MediaPreloader",["jquery","lodash","globals","device","log"],function(e,t,i,n,r){"use strict";var o=function(e,i){this.documentVersion=e,this.layers=i,this.visibleMedia=[],this.hiddenMedia=[],this.visibleImages=[],this.hiddenImages=[],this.sortMediaForLayers(this.layers,!1,0),this.visibleMedia=t.orderBy(this.visibleMedia,"absoluteY"),this.hiddenMedia=t.orderBy(this.hiddenMedia,"absoluteY")};return o.prototype={lazyPreloadAllMedia:function(e,t){this.lazyLoadingVerticalBreakpoint=this.getHighPriorityMediaLoadVerticalBreakpoint(e);var i,n=null,r=0;for(i=0;i<this.visibleMedia.length&&(r=i,n=this.visibleMedia[i],n.absoluteY<=this.lazyLoadingVerticalBreakpoint);i++)n.layer.isInInitialViewport=!0,this.loadMediaItem(n,e,t);var o=0;for(i=0;i<this.hiddenMedia.length&&(o=i,n=this.hiddenMedia[i],n.absoluteY<=this.lazyLoadingVerticalBreakpoint);i++)n.layer.isInInitialViewport=!0,this.loadMediaItem(n,e,t);for(i=r;i<this.visibleMedia.length;i++)n=this.visibleMedia[i],this.loadMediaItem(n,e,t);for(i=o;i<this.hiddenMedia.length;i++)n=this.hiddenMedia[i],this.loadMediaItem(n,e,t)},preloadVisibleMedia:function(e,t){this.loadMediaItems(this.visibleMedia,e,t)},preloadImages:function(e){this.loadMediaItems(this.visibleImages,e,!1),this.loadMediaItems(this.hiddenImages,e,!1)},preloadHiddenMedia:function(e){this.loadMediaItems(this.hiddenMedia,e,!1)},getlazyLoadingVerticalBreakpoint:function(){return this.lazyLoadingVerticalBreakpoint},sortMediaForLayers:function(e,i,n){n||(n=0),t.each(e,t.bind(function(e){if(this.isContainerLayer(e)){var t=i||!e.visible;this.sortMediaForLayers(this.getChildLayers(e),t,this.isSmartGroupOrGroup(e)?n+e.y:n)}else this.sortMediaForLayer(e,i,n)},this))},sortMediaForLayer:function(e,t,i){if(this.getLoader(e)){var n={layer:e,absoluteY:e.y+i};t||!e.visible?(this.hiddenMedia.push(n),this.isImage(e)&&this.hiddenImages.push(n)):(this.visibleMedia.push(n),this.isImage(e)&&this.visibleImages.push(n))}},getHighPriorityMediaLoadVerticalBreakpoint:function(t){var r=e(window).height(),o=r/t.ratio;if(i.isEmbedded&&i.heightOverride)if(n.desktop())o=Math.min(o,window.screen.height/t.ratio);else{var s=window.screen.height/window.screen.width;n.landscape()&&s>1&&(s=1/s),o=this.documentVersion.getExperienceWidth()*s}return o},isSmartGroupOrGroup:function(e){return!(!e.smartgroupId&&"group"!==e.type)},getChildLayers:function(e){return e.smartgroupId?e.layers:e.items},isContainerLayer:function(e){return!(!e.smartgroupId&&"folder"!==e.type&&"group"!==e.type)},getLoader:function(e){return e.imageLoader||e.posterLoader||e.fontLoader},isImage:function(e){return!(!e.imageLoader&&!e.posterLoader)},shouldLoadLowRes:function(e){return t.isFunction(this.getLoader(e).loadLowRes)&&!e.posterLoader&&this.documentVersion.shouldLoadLowRes()},loadMediaItems:function(e,i,n){t.each(e,t.bind(function(e){this.loadMediaItem(e,i,n)},this))},loadMediaItem:function(e,t,i){var n=this.getLoader(e.layer);this.shouldLoadLowRes(e.layer)?i?n.loadLowResNow(t):n.loadLowRes(t):i?n.loadNow(t):n.load(t)}},o}),define("modules/page/models/PageModel",["jquery","lodash","backbone","globals","log","urlUtils","device","modules/page/utils/ShareJSConnection","modules/page/models/media-loaders/ComponentImageLoaderFactory","modules/page/models/media-loaders/ComponentFontLoader","shared/models/OverrideablePropertyModelMixin","shared/utils/ShareJSUtils","modules/page/utils/MediaPreloader","libs/media/MediaInfoCache","libs/media/MediaInfoService","modules/page/utils/PlayerVariantDetector"],function(e,t,i,n,r,o,s,a,u,l,c,h,d,f,p,g){"use strict";var m=i.Model.extend({idAttribute:"slug",urlRoot:"/{api-version}/account/{scope}/pages",defaults:{sdkTags:[],sdkPayload:""},initialize:function(e,t){i.Model.prototype.initialize.call(this,e,t),this.documentVersion=t.documentVersion,this.pageIndex=t.pageIndex},fetch:function(t){if(t=t||{},n.previewMode)return this._fetchFromShareJS();this._finishLoading();var i=new e.Deferred;return i.resolve(),i.promise()},getSlug:function(){return this.get("slug")},getSdkTags:function(){return this.get("sdkTags")},getSdkPayload:function(){return this.get("sdkPayload")},getDisabled:function(){return this.get("disabled")},getPageWidth:function(e){if(t.isUndefined(e))throw new Error("Document Version Model is required.");return e.getExperienceWidth()},getPageHeight:function(e){if(t.isUndefined(e))throw new Error("Document Version Model is required.");var i=this.getOverHeight(),n=e.getExperienceHeight();return i>n?i:n},getOverHeight:function(){return this.getOverrideablePropertyForCurrentVariant("overHeight")},_fetchFromShareJS:function(){var i=new e.Deferred;a.getConnection().openExisting(this._getDocumentName(),t.bind(function(e,n){if(e)throw r.error(e),i.reject(e),Error(e);n.on("remoteop",t.bind(function(e){this._processRemoteOps(n,e)},this)),a.listenForReadOnlyConnectionLimitError(n),this.setDocSnapshotAndReconciledLayers(n.snapshot),this.documentVersion.on("resolveMedia",t.bind(this.refetchMedia,this,n)),i.resolve()},this));var n=this._loadResolvedMedia();return e.when(i,n).done(t.bind(function(){this._finishLoading()},this))},reconcileLayers:function(e,i){var n=this,r=[],o=g.getVariant();return t.reduce(e,function(e,r){var s=t.cloneDeep(i[r.id]);return"desktop"!==o&&t.extend(s,t.get(s,"overrides."+o)),s&&(r.items&&r.items.length>0&&(s.items=n.reconcileLayers(r.items,i)),e.push(s)),e},r),n.setReconciledVariant(o),r},getScranchorsForCurrentVariant:function(){var e=g.getVariant(),t=this.get("scranchors");if("desktop"!==e){t=this.get("overrides")[e].scranchors||t}return t},setReconciledVariant:function(e){this.reconciledVariant=e},getReconciledVariant:function(){return this.reconciledVariant},_finishLoading:function(){if(!this.get("layers")){var e=this.get("layerHierarchies")[g.getVariant()],t=this.get("layerDictionary"),i=this.reconcileLayers(e,t);this.set("layers",i)}this.documentVersion.on("reload",this.resolveSmartgroupsAndMedia,this),this.resolveSmartgroupsAndMedia(),this.trigger("loaded")},_loadResolvedMedia:function(){return p.loadMediaForUri(this.getUri())},resolveSmartgroupsAndMedia:function(e){var i=this,n=e||i.get("layers")||[];t.each(n,function(e){return e.smartgroupId?i.resolveSmartgroupReference(e):e.items&&e.items.length>0?i.resolveSmartgroupsAndMedia(e.items):i.resolveObjectMedia(e),e}),i.mediaPreloader=new d(i.documentVersion,i.get("layers"))},refetchMedia:function(e){this._loadResolvedMedia().done(t.bind(function(t){f.putMediaArray(t),this.setDocSnapshotAndReconciledLayers(e.snapshot),this.set("media",t),this.resolveSmartgroupsAndMedia(),this.trigger("reload")},this))},resolveSmartgroupReference:function(i){var n=this,o=this.documentVersion.getSmartgroupDefinition(i.smartgroupId);o?i.layers=t.map(o.layerHierarchies.desktop,t.bind(function(r){function s(r){var a=o.layerDictionary[r.id];return r=e.extend(!0,{},a,r),r.id=m.buildSmartgroupInstanceObjectId(i.id,r.id),r.parentSmartGroup=i,"folder"===r.type?r.items=t.map(r.items,s):n.resolveObjectInSmartgroup(r,i.id),r}return r=s(r)},this)):r.warn("Smartgroup "+i.smartgroupId+" could not be resolved")},resolveObjectInSmartgroup:function(e,i){e.originalObjectId=e.id,e.interactions&&t.each(e.interactions,t.bind(function(e){e.layerTargets&&(e.layerTargets=t.map(e.layerTargets,t.bind(function(e){return m.buildSmartgroupInstanceObjectId(i,e)},this)))},this)),this.resolveObjectMedia(e)},resolveObjectMedia:function(e){var t=null;switch(e.type){case"image-component":t=f.get(e.image),t&&(e.imageLoader=u.create(e,t));break;case"video-widget":t=f.get(e.poster),t&&(e.posterLoader=u.create(e,t)),e.videoMedia=f.get(e.video);break;case"text-component":e.fontLoader=new l(e),e.forceLineMode=this.documentVersion.shouldForceLineMode()}},lazyPreloadAllMedia:function(e,t){this.mediaPreloader.lazyPreloadAllMedia(e,t)},preloadVisibleMedia:function(e,t){this.mediaPreloader.preloadVisibleMedia(e,t)},preloadImages:function(e){this.mediaPreloader.preloadImages(e)},preloadHiddenMedia:function(e){this.mediaPreloader.preloadHiddenMedia(e)},getlazyLoadingVerticalBreakpoint:function(){return this.mediaPreloader.getlazyLoadingVerticalBreakpoint()},_processRemoteOps:function(e,i){for(var n={},r=!1,o=!1,s=0;s<i.length;s++){var a=i[s];if(h.isLayerHierarchiesMoveOrDelete(a))o=!0;else if(!h.isLayerDictionaryDelete(a)){var u=h.getComponentFromOp(e,a);if(h.isMediaReloadRequiredForComponent(a,u)){r=!0;break}!u||h.isPageReloadRequiredForComponent(a,u)?o=!0:n[u.id]=JSON.parse(JSON.stringify(u))}}r?this.refetchMedia(e):o?this.triggerPageReload(e):t.each(n,t.bind(function(e,t){this.trigger("remote",{id:t,options:e})},this))},setDocSnapshotAndReconciledLayers:function(e){var i=JSON.parse(JSON.stringify(e));this.set(i,{silent:!0});var n=this.reconcileLayers(t.cloneDeep(i.layerHierarchies[g.getVariant()]),i.layerDictionary);this.set("layers",n)},triggerPageReload:function(e){this.setDocSnapshotAndReconciledLayers(e.snapshot),this.resolveSmartgroupsAndMedia(),this.trigger("reload")},_getDocumentName:function(){return this.getUri().replace(/\//g,"_")},getPageIndex:function(){return this.pageIndex},getAllSmartgroupInstanceLayerIds:function(e,t){return this.getAllSmartgroupInstanceComponentIds(e,t)},getAllSmartgroupInstanceComponentIds:function(e,i){var n=i||this.get("layerDictionary"),r=t.filter(n,"smartgroupId");return t.reduce(r,t.bind(function(i,n){var r=this.getSmartgroupLayerDictionary(n.smartgroupId);return t.some(r,function(t){return t.id===e})&&i.push(m.buildSmartgroupInstanceObjectId(n.id,e)),i},this),[])},getSmartgroupLayerDictionary:function(e){return t.get(this.documentVersion.getSmartgroupDefinition(e),"layerDictionary")},getUri:function(){return i.Model.prototype.url.call(this).replace(/\{api-version\}/,n.apiVersion).replace(/\{scope\}/,n.accountSlug)},updateLayerDictionaryFromRemoteChange:function(e){var i=this.get("layerDictionary");i[e.id]=t.cloneDeep(e.options),this.set("layerDictionary",i)}},{layerIsComponentWithId:function(e,i){return"folder"===i.type?t.some(i.items,t.partial(m.layerIsComponentWithId,e)):i.id===e},buildSmartgroupInstanceObjectId:function(e,t){return e+"|"+t},extractObjectIdFromSmartgroupInstanceId:function(e){var t=e.indexOf("|");return-1!==t&&(e=e.substr(t+1)),e}});return t.extend(m.prototype,c),m}),define("shared/models/OverridesGetterModelMixin",["lodash","backbone","modules/page/utils/PlayerVariantDetector"],function(e,t,i){"use strict";return{setParentModel:function(e){if(!(e.prototype instanceof t.Model))throw new Error("ParentModel should extend Backbone.Model");this.ParentModel=e},get:function(e,t){var n=t&&t.variant?t.variant:i.getVariant();return"overrides"===e||"desktop"===n?this.nonVariantGet(e):this.getVariantAttribute(n,e,t)},getVariantAttribute:function(t,i,n){var r=!n||!n.doNotFallbackToDesktop,o=this.nonVariantGet("overrides"),s=e.get(o,[t,i],void 0);return e.isUndefined(s)&&r?this.nonVariantGet(i):s},nonVariantGet:function(e){return(this.ParentModel?this.ParentModel:t.Model).prototype.get.call(this,e)}}}),define("modules/viewport/models/PageManifestModel",["backbone","lodash","shared/models/OverridesGetterModelMixin"],function(e,t,i){"use strict";var n=e.Model.extend({getSlug:function(){var i=e.Model.prototype.get.call(this,"uri");return t.last(i.split("/"))}});return t.extend(n.prototype,i),n}),define("modules/viewport/models/DocumentVersionModel",["lodash","jquery","backbone","globals","log","urlUtils","modules/page/utils/ShareJSConnection","modules/page/models/PageModel","modules/viewport/models/PageManifestModel","shared/models/OverrideablePropertyModelMixin","shared/utils/ShareJSUtils","libs/font/FontConstants","libs/media/MediaInfoService","libs/media/MediaInfoCache","modules/page/utils/PlayerVariantDetector"],function(e,t,i,n,r,o,s,a,u,l,c,h,d,f,p){"use strict";var g=i.Collection.extend({model:u}),m=i.Model.extend({idAttribute:"slug",urlRoot:"/{api-version}/account/{scope}/document-versions",MANIFEST_ADD_PAGE:"manifestAddPage",MANIFEST_REMOVE_PAGE:"manifestRemovePage",MANIFEST_MOVE_PAGE:"manifestMovePage",initialize:function(e,t){if(i.Model.prototype.initialize.call(this,e,t),!n.previewMode&&!t.docVersionRequest)throw new Error("A doc version request must be passed in when not in preview mode");this.docVersionRequest=t.docVersionRequest,this.pages=[]},fetch:function(e){return this.loadBackgroundImageInfo(),n.previewMode?this.fetchForPreviewMode(e):this.fetchForPublished(e)},fetchForPreviewMode:function(i){var n=t.Deferred();try{s.getConnection().openExisting(this._getDocumentName(),e.bind(function(e,t){if(e)r.warn(e),n.reject();else if(t){s.listenForReadOnlyConnectionLimitError(t);var i=JSON.parse(JSON.stringify(t.snapshot));this.set(i),n.resolve(i,t)}},this))}catch(e){r.warn(e),n.reject()}n.then(e.bind(function(e,t){this.bindToDocChanges(t)},this));var o=this.loadResolvedMedia().fail(function(){r.warn("Could not fetch docversion media!")});return t.when(n,o)},fetchForPublished:function(t){return this.docVersionRequest.then(e.bind(function(e){f.putMediaArray(e.media),delete e.media,this.set(e)},this))},loadPageModels:function(){r.debug("Loading page models");var i=this.editorPagesManifest.map(e.bind(function(e,t){var i=this.createPageModel(e,t);return this.pages.push(i),i.fetch()},this));return t.when.apply(t,i)},createPageModel:function(t,i){var r={slug:t.getSlug(),disabled:t.get("initiallyDisabled",{doNotFallbackToDesktop:!0})};if(!n.previewMode){var o=this.get("pages")[t.getSlug()];f.putMediaArray(o.media),delete o.media,r=e.extend(r,o)}var s=new a(r,{documentVersion:this,pageIndex:i});return t.on("change:initiallyDisabled change:overrides",function(){s.set("disabled",t.get("initiallyDisabled",{doNotFallbackToDesktop:!0}))}),p.on("change",function(){s.set("disabled",t.get("initiallyDisabled",{doNotFallbackToDesktop:!0}))}),s},processRemoteOps:function(t,i){for(var n=!1,r=!1,o=0;o<i.length;o++){var s=i[o],a=s.p[0];"editorPagesManifest"===a?this.processManifestRemoteOp(s):(this.set(a,JSON.parse(JSON.stringify(t.snapshot[a]))),"smartgroups"===a?(n=n||c.isMediaReloadRequiredForOp(t,s),r=!0):"fonts"===a&&this.processFontRemoteOp(s))}n?this.loadResolvedMedia().done(e.bind(function(){this.trigger("reload")},this)):r&&this.trigger("reload")},processFontRemoteOp:function(i){2===i.p.length&&i.p[1]===h.EXPERIENCE_FAMILY_GUIDS_KEY&&t.when(this.loadFontMetrics()).done(e.bind(function(e){n.fontManifest=e,this.trigger("reload")},this))},createManifestCollection:function(){this.editorPagesManifest=new g(this.get("editorPagesManifest")),n.previewMode&&this.bindToManifestChanges()},bindToDocChanges:function(t){t.on("shout",e.bind(function(e){e=JSON.parse(e),"updateViewportSize"!==e.name&&"updateScaleExperience"!==e.name||window.location.reload()},this)),t.on("remoteop",e.bind(function(e){this.processRemoteOps(t,e)},this))},bindToManifestChanges:function(){this.editorPagesManifest.on("add",e.bind(function(t,i,n){var r=n.at,o=this.createPageModel(t,r);this.pages.splice(r,0,o),o.fetch().done(e.bind(function(){this.trigger(this.MANIFEST_ADD_PAGE,t,n.at)},this))},this)),this.editorPagesManifest.on("remove",e.bind(function(e,t,i){this.pages.splice(i.index,1),this.trigger(this.MANIFEST_REMOVE_PAGE,i.index)},this)),this.editorPagesManifest.on("move",e.bind(function(e,t){this.pages.splice(t,0,this.pages.splice(e,1)[0]),this.trigger(this.MANIFEST_MOVE_PAGE,e,t)},this))},processManifestRemoteOp:function(t){var i,n=t.p[1];if(2===t.p.length)if(e.isUndefined(t.li))if(e.isUndefined(t.ld)){if(!e.isUndefined(t.lm)){var r=t.lm;i=this.editorPagesManifest.at(n),this.editorPagesManifest.remove(i,{silent:!0}),this.editorPagesManifest.add(i,{at:r,silent:!0}),this.editorPagesManifest.trigger("move",n,r)}}else i=this.editorPagesManifest.at(n),this.editorPagesManifest.remove(i);else this.editorPagesManifest.add(t.li,{at:n});else if(3===t.p.length&&!e.isUndefined(t.oi)){var o=t.p[2];this.editorPagesManifest.at(n).set(o,t.oi)}},getPageNumberBySlug:function(t){var i=this.editorPagesManifest;if(e.isEmpty(i))return null;var n=null;return i.find(function(e,i){return e.getSlug()===t&&(n=i+1,!0)}),n},getPageInfoByNumberOrSlug:function(t){var i=this.editorPagesManifest,n=null,r=null;return e.isString(t)?(n=this.getPageNumberBySlug(t),n?r=t:n=1):((n=parseInt(t,10))<1||n>i.length)&&(n=1),!r&&i.at(n-1)&&(r=i.at(n-1).getSlug()),{number:n,slug:r}},getExperienceWidth:function(){return this.getOverrideablePropertyForCurrentVariant("viewportWidth")},getExperienceHeight:function(){return this.getOverrideablePropertyForCurrentVariant("viewportHeight")},getScaleExperience:function(){return this.getOverrideablePropertyForCurrentVariant("scaleExperience")},getPages:function(){return this.pages},getEnabledPageIndexes:function(){var t=[];return e.each(this.pages,function(e,i){e.get("disabled")||t.push(i)}),t},getNearestEnabledPage:function(e){var t=e-1;if(!this.pages[t].get("disabled"))return e;for(var i=1;t-i>=0||t+i<this.pages.length;i++){if(this.pages[t+i]&&!this.pages[t+i].get("disabled"))return t+i+1;if(this.pages[t-i]&&!this.pages[t-i].get("disabled"))return t-i+1}},isCarousel:function(){var e=this.editorPagesManifest,t=this.get("carousel");return t&&t.enabled&&e.length>1},isAutoTransitioning:function(){var e=this.get("carousel");return this.isCarousel()&&e.autoTransition},shouldLoadLowRes:function(){return this.get("loadLowRes")},shouldLazyLoad:function(){return this.get("lazyLoading")},shouldForceLineMode:function(){return this.get("forceLineMode")},getAutoTransitionDelay:function(){var e=this.get("carousel");return e?e.autoTransitionDelay:0},_getDocumentName:function(){return this.get("uri").replace(/\//g,"_")},getSmartgroupDefinition:function(t){return e.find(this.get("smartgroups"),function(e){return e.id===t})},loadBackgroundImageInfo:function(){var t=e.get(n,"themeObj.backgroundImage",null);t&&f.put(t.id,t)},loadResolvedMedia:function(){return d.loadMediaForRestUri(this.getUri())},loadFontMetrics:function(){return t.ajax({url:this.getUri()+"/font-metrics",type:"GET",dataType:"json"})},getUri:function(){return"/rest"+i.Model.prototype.url.call(this).replace(/\{api-version\}/,n.apiVersion).replace(/\{scope\}/,n.accountSlug)}});return e.extend(m.prototype,l),m}),define("libs/uuid/UuidGenerator",[],function(){"use strict";var e=navigator.userAgent;return{generate:function(){var t=function(){for(var e=1*new Date,t=0;e==1*new Date;)t++;return e.toString(16)+t.toString(16)},i=function(){return Math.random().toString(16).replace(".","")},n=function(t){function i(e,t){var i,n=0;for(i=0;i<t.length;i++)n|=s[i]<<8*i;return e^n}var n,r,o=e,s=[],a=0;for(n=0;n<o.length;n++)r=o.charCodeAt(n),s.unshift(255&r),s.length>=4&&(a=i(a,s),s=[]);return s.length>0&&(a=i(a,s)),a.toString(16)};return function(){var e=(screen.height*screen.width).toString(16);return t()+"-"+i()+"-"+n()+"-"+e+"-"+t()}}()}}),define("libs/analytics/AnalyticsEnvironmentData",["lodash","jquery","device","globals","urlUtils"],function(e,t,i,n,r){"use strict";var o=window.navigator.userAgent,s=function(){};return s.prototype={data:null,scale:null,initialScale:null,getData:function(){return this.data||(this.data=e.extend(this.getStandardParams(),this.getCampaignParams())),e.extend(this.data,this.getDynamicTrackingInfo())},updateScale:function(e){this.initialScale=this.initialScale||e,this.scale=e},getDynamicTrackingInfo:function(){var e={screen_width:window.screen.width,screen_height:window.screen.height};return this.initialScale&&(e.initial_scale=this.initialScale),this.scale&&(e.scale=this.scale),e},getBrowserAndVersionUsingMixpanelAlgorithm:function(t,i,n){var r=function(e){var i=t.match(e);return i&&i[1]},o=null,s=null;i=i||"",e.includes(t,"PhantomJS")?(o="PhantomJS",s=r(/PhantomJS\/(\d+)/)):n?o=e.includes(t,"Mini")?"Opera Mini":"Opera":/(BlackBerry|PlayBook|BB10)/i.test(t)?o="BlackBerry":e.includes(t,"Edge")?(o="Microsoft Edge",s=r(/Edge\/(\d+)/)):e.includes(t,"FBIOS")?o="Facebook Mobile":e.includes(t,"Chrome")?(o="Chrome",s=r(/Chrome\/(\d+)/)):e.includes(t,"CriOS")?(o="Chrome iOS",
s=r(/CriOS\/(\d+)/)):e.includes(i||"","Apple")?(o=e.includes(t,"Mobile")?"Mobile Safari":"Safari",s=r(/Version\/(\d+)/)):e.includes(t,"Android")?o="Android Mobile":e.includes(t,"Konqueror")?o="Konqueror":e.includes(t,"Firefox")?(o="Firefox",s=r(/Firefox\/(\d+)/)):/msie|trident/i.test(t)?(o="Internet Explorer",s=r(/(?:msie |rv:)(\d+)/i)):e.includes(t,"Gecko")&&(o="Mozilla");var a={};return o&&(a.name=o),s&&(a.version=s),a},getStandardParams:function(){var e=window.document.referrer,t=this.getSearchEngine(e),r=this.getBrowserAndVersionUsingMixpanelAlgorithm(o,navigator.vendor,window.opera);return{browser:r.name,trial:n.isTrialAccount?1:0,browser_version:r.version,user_agent:o,device_type:i.deviceType(),player_type:i.playerType(),initial_orientation:i.orientation(),cookies_enabled:i.cookies()?1:0,embedded:i.isIframe()?1:0,https:"https:"===window.location.protocol?1:0,device:this.getDevice(),device_pixel_ratio:i.pixelRatio(),search_engine:t,search_keyword:this.getSearchKeyword(t,e),os:i.os.name,os_version:i.os.version,referrer:e||null,referring_domain:this.extractReferringDomain(e)}},extractReferringDomain:function(e){var t=null;return e&&((t=r.extractDomain(e))||(t=e)),t},getDevice:function(){return/Windows Phone/i.test(o)||/WPDesktop/.test(o)?"Windows Phone":/iPad/.test(o)?"iPad":/iPod/.test(o)?"iPod Touch":/iPhone/.test(o)?"iPhone":/(BlackBerry|PlayBook|BB10)/i.test(o)?"BlackBerry":/Android/.test(o)?"Android":null},getSearchEngine:function(e){return 0===e.search("https?://(.*)google.([^/?]*)")?"google":0===e.search("https?://(.*)bing.com")?"bing":0===e.search("https?://(.*)yahoo.com")?"yahoo":0===e.search("https?://(.*)duckduckgo.com")?"duckduckgo":null},getSearchKeyword:function(e,t){var i="yahoo"!=e?"q":"p";if(null!==e){var n=r.getUrlParams(t)[i];if(n&&n.length)return n}return null},getCampaignParams:function(){return e.pick(r.getUrlParams(window.document.URL),"utm_source","utm_medium","utm_campaign","utm_content","utm_term")}},s}),define("libs/analytics/EventQueue",["jquery","lodash","backbone"],function(e,t,i){"use strict";var n=function(){this.queue=[],this.timerId=null};return n.prototype=t.extend({},i.Events,{EVENTS:{AGGREGATE_EVENT:"aggregate-event"},addEvent:function(e){this.queue.push(e),this.startTimer()},isEmpty:function(){return 0===this.queue.length},popEvents:function(){var e=this.queue.splice(0,5);return this.clearTimer(),t.isEmpty(this.queue)||this.startTimer(),e},startTimer:function(){null===this.timerId&&(this.timerId=setTimeout(t.bind(this.postEvents,this),5e3))},clearTimer:function(){null!==this.timerId&&(clearTimeout(this.timerId),this.timerId=null)},postEvents:function(){this.queue.length>0?this.trigger(this.EVENTS.AGGREGATE_EVENT,this.popEvents()):this.clearTimer()}}),n}),define("libs/analytics/CerosTracker",["jquery","lodash","cookie","globals","libs/uuid/UuidGenerator","device","libs/analytics/AnalyticsEnvironmentData","libs/analytics/EventQueue"],function(e,t,i,n,r,o,s,a){"use strict";var u=["player.page.dwell","player.video.progress_percent","player.video.progress_time","player.performance.marker","previewer.performance.marker","studio.performance.marker","admin.performance.marker"],l=function(e){if(this.options=e||{},this.userEmail=null,this.fullName=null,this.clientVersion=9,this.anonymousUserTrackingData=null,this.domain=this.getRootDomain(),this.experienceCookiePath=this.getExperienceCookiePath(),this.noAnalyticsTracking=!!n.noAnalyticsTracking,this.defaultAttributes={timezone:this.getTimezoneOffset(),user_agent:navigator.userAgent,visit_slug:r.generate()},this.eventQueue=new a,this.eventQueue.on(this.eventQueue.EVENTS.AGGREGATE_EVENT,t.bind(function(e){this.trackEvents(e,!1)},this)),this.environmentData=new s,this.options.trackInitialReferrer){var i=this.environmentData.getData();this.setInitialReferrer(i.referrer,i.referring_domain)}};return t.extend(l.prototype,{setUser:function(e,t,i){this.setDomainTrackingCookie({email:e,full_name:t,user_token:e,slug:i}),this.userEmail=e,this.fullName=t,this.userSlug=i},setInitialReferrer:function(e,i){var n=this.getExperienceTrackingCookieData();(t.isUndefined(n.initial_referrer)||t.isUndefined(n.initial_referring_domain))&&(n.initial_referrer=e||null,n.initial_referring_domain=i||null,this.setExperienceTrackingCookie(n))},encodeData:function(e){return encodeURIComponent(btoa(unescape(encodeURIComponent(JSON.stringify(e)))))},getEvent:function(e,i){var n=t.extend({},{event_slug:r.generate()},i||{},{event_name:e,client_timestamp:(new Date).getTime()});return n=t.omitBy(n,t.isNull)},track:function(i,n){var r=this.getEvent(i,n);return t.includes(u,r.event_name)?(this.eventQueue.addEvent(r),e.Deferred().resolve()):this.trackEvents([r],!0)},trackEvents:function(i,r){if(this.noAnalyticsTracking)return e.Deferred().resolve();if(!n.analyticsUrl)return e.Deferred().resolve();if(!i||0===i.length)return e.Deferred().resolve();var o=this.getDomainTrackingCookieData();o.user_token||(o=this.createDomainTrackingData()),this.setDomainTrackingCookie(o);var s=this.getCommonProps(o),a=this.environmentData.getData();this.options.envPropertyList&&(a=t.pick(a,this.options.envPropertyList));var u=this.getExperienceTrackingCookieData();a=t.extend(a,{email:o.email,full_name:o.full_name,timezone:this.defaultAttributes.timezone,user_agent:this.defaultAttributes.user_agent,initial_referrer:u.initial_referrer,initial_referring_domain:u.initial_referring_domain}),s=t.omitBy(s,t.isNull),a=t.omitBy(a,t.isNull),r&&(i=i.concat(this.eventQueue.popEvents()));var l={common:s,extended_common:a,events:i},c=n.analyticsUrl+"?data="+this.encodeData(l);return this._sendTrackingRequest(c,0)},getCommonProps:function(e){return{account_slug:n.accountSlug,client_version:this.clientVersion,user_token:e.user_token,visit_slug:this.defaultAttributes.visit_slug}},_handleTrackingError:function(e,t,i,n){var r=this;n<3?setTimeout(function(){r._sendTrackingRequest(i,n)},3e3):3!==n||window.sentRollbarForAnalyticsRetryFail||(window.Rollbar&&window.Rollbar.error("One or more analytics events are failing due to HTTP or connection errors.",{errorThrown:t,errorCode:e.status,url:i}),window.sentRollbarForAnalyticsRetryFail=!0)},_sendTrackingRequest:function(t,i){var n=this,r=new e.Deferred;if(o.isIE9OrEarlier()&&"http:"===location.protocol){var s=new Image;s.crossOrigin="Anonymous",s.src=t+"&_="+Math.random(),s.onload=function(){r.resolve()},s.onerror=function(){r.resolve()}}else e.ajax({url:t,type:"GET",cache:!1,crossDomain:!0}).then(r.resolve,function(e,o,s){n._handleTrackingError(e,s,t,++i),r.resolve()});return r},getRootDomain:function(){var e=location.host.split(".").reverse();return"."+e[1]+"."+e[0]},getExperienceCookiePath:function(){var e=window.location.pathname,t=e.search(/\/p\/\d+/g);return t>=0?e.substr(0,t):e},getTimezoneOffset:function(){var e=(new Date).getTimezoneOffset()/60;return Math.abs(e)>15?null:e},createAnonymousUserDomainTrackingData:function(){return{user_token:r.generate()}},createDomainTrackingData:function(){return this.userEmail?{email:this.userEmail,full_name:this.fullName,user_token:this.userEmail,slug:this.userSlug}:(null===this.anonymousUserTrackingData&&(this.anonymousUserTrackingData=this.createAnonymousUserDomainTrackingData()),this.anonymousUserTrackingData)},setDomainTrackingCookie:function(e){if(!this.noAnalyticsTracking){var t=JSON.stringify(e);t=encodeURIComponent(t),i.set("cerosdomaintracking",t,{expires:365,path:"/",domain:this.domain})}},setExperienceTrackingCookie:function(e){if(!this.noAnalyticsTracking){var t=JSON.stringify(e);t=encodeURIComponent(t),i.set("cerosexperiencetracking",t,{expires:365,path:this.experienceCookiePath,domain:this.domain})}},getDomainTrackingCookieData:function(){return this.getCookieData("cerosdomaintracking")},getExperienceTrackingCookieData:function(){return this.getCookieData("cerosexperiencetracking")},getCookieData:function(e){var t=i.get(e);if(t){var n=decodeURIComponent(t);try{return JSON.parse(n)}catch(t){this.parseError(e,t)}}return{}},parseError:function(e,t){var i=(new Date).getTime();i-(this.lastParseError||0)>36e5&&(window.Rollbar.error("Unable to parse "+e+" cookie data, the content was malformed. Exception was: "+t),this.lastParseError=i)},updateScale:function(e){this.environmentData.updateScale(e)},isPlayerPreviewer:function(){return"player"===n.analyticsApplicationKey||"previewer"===n.analyticsApplicationKey}}),l}),define("modules/analytics/trackers/CerosPlayerTracker",["lodash","libs/analytics/CerosTracker","modules/page/utils/PlayerVariantDetector","globals"],function(e,t,i,n){"use strict";var r=function(e){t.call(this,e)};return r.prototype=e.extend({},t.prototype,{getCommonProps:function(r){var o=t.prototype.getCommonProps.call(this,r);return e.extend(o,{experience_alias:n.issueAliasSlug,experience_slug:n.issue.slug,experience_version_slug:n.docVersion.slug,project_slug:n.appSlug,current_layout:i.hasDetectedVariant()?i.getVariant():"unknown"})}}),r}),define("libs/analytics/PerformanceTracker",["jquery","lodash","globals","libs/analytics/CerosTracker"],function(e,t,i,n){"use strict";var r=function(e){this.tracker=e,this.eventName=i.analyticsApplicationKey+".performance.marker",this.startTime=null};return r.prototype=t.extend(r.prototype,{MARKS:{PLAYER:{RUN_START:"run-start",DOM_READY:"dom-ready",SPINNER_SHOWN:"spinner-shown",DOC_VERSION_LOADED:"doc-version-loaded",SPINNER_HIDDEN:"spinner-hidden",HIGH_PRIORITY_IMAGES_START_LOADING:"high-priority-images-start-loading",LOW_PRIORITY_IMAGES_START_LOADING:"low-priority-images-start-loading",BEGIN_PRERENDERING_PAGES:"begin-prerendering-pages",ALL_PAGES_PRERENDERED:"all-pages-prerendered",PRIORITY_QUEUE_EMPTIED:"priority-queue-emptied",ALL_RESOURCES_LOADED:"all-resources-loaded"},STUDIO:{SHAREJS_CONNECTION_INITIALIZED:"sharejs-connection-initialized",ALL_DATA_LOADED:"all-data-loaded",ALL_PAGES_LOADED:"all-pages-loaded",USER_LOADED:"user-loaded",THUMBNAIL_POLICY_LOADED:"thumbnail-policy-loaded"}},optionalProperties:{},setOptionalProperties:function(e){return this.optionalProperties=e,this},startTracking:function(e){this.startTime=e||(new Date).getTime();var i=t.extend({},this.optionalProperties,{performance_marker_name:"start-tracking",performance_marker_time:0});this.tracker.track(this.eventName,i)},mark:function(e){if(null===this.startTime)return!1;var i=(new Date).getTime()-this.startTime;if(i<0||i>18e5)return!1;var n=t.extend({},this.optionalProperties,{performance_marker_name:e,performance_marker_time:i});return this.tracker.track(this.eventName,n),!0}}),r}),define("modules/analytics/trackers/GoogleAnalyticsTracker",["lodash","globals","shared/utils/NavigationUtils","urlUtils"],function(e,t,i,n){"use strict";var r=function(e){if(!window.ga)throw Error("No Google Analytics loaded.");this.googleAnalyticsId=e,t.isEmbedded||window.ga("create",this.googleAnalyticsId,"auto")};return r.prototype={isEnabled:function(){return!!this.googleAnalyticsId},viewPage:function(e){var n=i.buildUriForPageNumber(e);t.isEmbedded||window.ga("send","pageview",{page:n})}},r}),define("libs/analytics/AbstractPageViewTracker",["jquery","lodash","backbone"],function(e,t,i){"use strict";var n=function(){this.lastUserActivityTime=null,this.timerId=null,this.paused=!1,this.pageActivated=!1,document.addEventListener&&document.addEventListener("visibilitychange",t.bind(function(){"hidden"===document.visibilityState?this.pause():"visible"===document.visibilityState&&this.registerUserActivity()},this))};return n.prototype=t.extend({},i.Events,{EVENTS:{USER_ACTIVITY_PING:"user-activity-ping"},PAGE_PING_INTERVAL_MILLIS:5e3,USER_INACTIVITY_TIMEOUT_MILLIS:3e4,pause:function(){this.isRunning()&&(this.logDebug("Pausing page ping timer"),clearTimeout(this.timerId),this.timerId=null,this.paused=!0)},registerUserActivity:function(){this.pageActivated&&(this.lastUserActivityTime=new Date,this.paused=!1,this.isRunning()||this.startTimer())},registerUserActivityIfNotPaused:function(){this.paused||this.registerUserActivity()},startTimer:function(){this.logDebug("Starting page ping timer");var e=t.bind(function(){this.timerId=setTimeout(t.bind(function(){this.trigger(this.EVENTS.USER_ACTIVITY_PING,this.getDwellTimeEventData()),this.setPostEventFireData(),this.shouldStartPagePingEventTimer()?e():(this.logDebug("Stopping page pings. User is not active."),this.timerId=null)},this),this.PAGE_PING_INTERVAL_MILLIS),this.timerStartTime=Date.now()},this);e()},getDwellTimeEventData:function(){return{dwellTime:this.PAGE_PING_INTERVAL_MILLIS/1e3}},setPostEventFireData:function(){},shouldStartPagePingEventTimer:function(){return this.isUserActive()},isUserActive:function(){return new Date-this.lastUserActivityTime<this.USER_INACTIVITY_TIMEOUT_MILLIS},isRunning:function(){return null!==this.timerId},logDebug:function(e){console.debug(e)}}),n}),define("modules/analytics/PlayerPageViewTracker",["jquery","log","lodash","backbone","libs/analytics/AbstractPageViewTracker"],function(e,t,i,n,r){"use strict";var o=function(){r.call(this)};o.prototype=Object.create(r.prototype),o.prototype.constructor=o;return i.extend(o.prototype,{activatePage:function(e,i,n){this.timerId&&(t.debug("Stopping page ping timer"),clearTimeout(this.timerId),this.timerId=null),e=isNaN(e)?0:e,i=isNaN(i)?n:i,this.minY=e,this.maxY=i,this.lastTopY=e,this.lastBottomY=i,this.pageHeight=n,this.pageActivated=!0,this.registerUserActivity()},resetYMinMax:function(){this.minY=void 0,this.maxY=void 0},trackPageScroll:i.throttle(function(e,t){isNaN(e)||isNaN(t)||(this.minY=void 0===this.minY?e:Math.min(e,this.minY),this.maxY=void 0===this.maxY?t:Math.max(t,this.maxY),this.lastTopY=e,this.lastBottomY=t,this.registerUserActivity())},200),setPostEventFireData:function(){this.minY=this.lastTopY,this.maxY=this.lastBottomY},shouldStartPagePingEventTimer:function(){return this.isUserActive()||this.isLightboxOpen()},getDwellTimeEventData:function(){var e=Math.max(0,this.minY),t=this.maxY;return this.pageHeight&&(t=Math.min(this.pageHeight,t)),{minY:e,maxY:t,dwellTime:this.PAGE_PING_INTERVAL_MILLIS/1e3}},isLightboxOpen:function(){return e(".ceros-lightbox").is(":visible")},logDebug:function(e){t.debug(e)}}),o}),define("modules/analytics/Analytics",["log","lodash","jquery","device","globals","modules/analytics/trackers/CerosPlayerTracker","libs/analytics/PerformanceTracker","modules/analytics/trackers/GoogleAnalyticsTracker","modules/analytics/PlayerPageViewTracker"],function(e,t,i,n,r,o,s,a,u){"use strict";var l=function(){this.ready=!1,this.lastPageLoadedAttr=null};return l.prototype={init:function(e){this.options=t.extend({application:"player"},e||{}),this.cerosTracker=new o({trackInitialReferrer:!0,application:this.options.application}),this.performanceTracker=new s(this.cerosTracker),!e.previewMode&&e.googleAnalyticsId?this.googleAnalyticsTracker=new a(e.googleAnalyticsId):this.googleAnalyticsTracker=null,this.playerPageViewTracker=new u,this.playerPageViewTracker.on(this.playerPageViewTracker.EVENTS.USER_ACTIVITY_PING,this.sendPageDwellEvent,this),this.ready=!0},isGoogleAnalyticsEnabled:function(){return null!==this.googleAnalyticsTracker&&this.googleAnalyticsTracker.isEnabled()},getPerformanceTracker:function(){return this.performanceTracker},updateScale:function(e){return this.cerosTracker.updateScale(e)},unsupportedOpen:function(e){return this._track(this.options.application+".unsupported_browser.open",e)},unsupportedEmbed:function(e){this._track(this.options.application+".unsupported_embed.open",e)},_openExperience:function(e){this._track(this.options.application+".experience.open",e)},viewExperience:function(i){if(window.cerosPlayerLoadStart){var n=new Date,r=(n-window.cerosPlayerLoadStart)/1e3;e.info("First Page Load Time: "+r);r<0&&(e.warn(new Error("Analytics: negative load time calculated. Start time: "+window.cerosPlayerLoadStart+", End time: "+n)),r=0),this._openExperience(t.extend({load_time:r},i)),window.cerosPlayerLoadStart=null}},viewPage:function(e){n.isBot()||this._trackViewPage(e),this.googleAnalyticsTracker&&this.googleAnalyticsTracker.viewPage(e.page_num)},playVideo:function(e){this._track(this.options.application+".video.play",e)},trackVideoProgressTime:function(e){this.isPlayer()&&this._track(this.options.application+".video.progress_time",e)},trackVideoProgressPercent:function(e){this.isPlayer()&&this._track(this.options.application+".video.progress_percent",e)},clickComponent:function(e){this._track(this.options.application+".component.click",e)},clickLink:function(e){this._track(this.options.application+".link.click",e)},clickLightbox:function(e){this._track(this.options.application+".lightbox.click",e)},clickProduct:function(e){this._track(this.options.application+".product.click",e)},clickShoppingCart:function(e){this._track(this.options.application+".shopping_cart.click",e)},clickPageShare:function(e){this._track(this.options.application+".page.share",e)},clickCerosBranding:function(e){this._track(this.options.application+".ceros_branding.click",e)},experienceLoadInteraction:function(e){this._track(this.options.application+".experience_load.timed",e)},formSubmit:function(e){t.isNil(e.form_origin_form_id)||(e=t.clone(e),e.form_origin_form_id=""+e.form_origin_form_id),this._track(this.options.application+".component.form_submit",e)},handleApiRequest:function(e,t){this._track(this.options.application+".ceros.api.request",{sdk_event_name:e.name,sdk_version:e.client.sdkVersion})},_trackViewPage:function(e){this._track(this.options.application+".page.view",t.pick(e,["page_slug","page_num"])),this.playerPageViewTracker.activatePage(e.topY,e.bottomY,e.pageHeight),this.lastPageLoadedAttr=e},_track:function(e,t){if(!this.ready)throw Error("please call init() before attempting to capture analytics!");return n.isBot()?i.Deferred().resolve():(this.playerPageViewTracker.registerUserActivity(),this._sendToCeros(e,t))},resetPageTrackingMinMaxY:function(){this.playerPageViewTracker.resetYMinMax()},_sendToCeros:function(e,t){return n.isBot()?i.Deferred().resolve():this.cerosTracker.track(e,t)},trackPageScroll:function(e){this.lastPageLoadedAttr&&this.lastPageLoadedAttr.page_slug===e.page_slug&&this.playerPageViewTracker.trackPageScroll(e.topY,e.bottomY)},registerUserActivity:function(){this.playerPageViewTracker.registerUserActivity()},registerUserActivityIfVisible:function(){this.playerPageViewTracker.registerUserActivityIfNotPaused()},sendPageDwellEvent:function(t){if(!n.isBot()&&this.isPlayer()&&this.lastPageLoadedAttr){var i={page_slug:this.lastPageLoadedAttr.page_slug,page_num:this.lastPageLoadedAttr.page_num,page_height:this.lastPageLoadedAttr.pageHeight,min_y:t.minY,max_y:t.maxY,dwell_time:t.dwellTime};e.debug("SENDING PING, min_y: "+i.min_y+", max_y: "+i.max_y+", Dur: "+i.dwell_time+", page_height: "+i.page_height),this._sendToCeros(this.options.application+".page.dwell",i)}},isPlayer:function(){return"player"===this.options.application},getUserToken:function(){return this.cerosTracker.getDomainTrackingCookieData().user_token}},new l}),define("modules/analytics/module",["lodash","ceros","modules/analytics/Analytics"],function(e,t,i){"use strict";return new t.Module({id:"analytics",description:"Provides an interface for tracking statistics on the analytics service.",version:"1.0",delegate:function(){var t={},n=e.functionsIn(i);return e.each(n,function(n){"_"!=n.substr(0,1)&&(t[n]=e.bind(i[n],i))}),t}()})}),define("modules/url-navigation/module",["log","ceros","device","shared/utils/NavigationUtils","lodash","shared/utils/ModuleEventManager"],function(e,t,i,n,r,o){"use strict";var s=new t.Module({id:"url-navigation",description:"",version:"1.0",publishedEvents:{POPSTATE:"url-navigation.popstate"},handledEvents:{},dependencies:{},PAGE_MODES:{NUMBER:"page_number",SLUG:"page_slug"},delegate:{getHistoryState:function(e,t,i){var n={mode:e,pageNumber:null,pageSlug:null,title:i};return e===s.PAGE_MODES.NUMBER?n.pageNumber=t:n.pageSlug=t,n},navigateTo:function(e,t,o){var a=n.buildUri(e,t);a&&(r.endsWith(location.href,a)&&null!==window.history.state||(o||(o=window.document.title),i.html5()&&window.history&&window.history.pushState&&(document.title=o,window.history.pushState(s.getHistoryState(e,t,o),o,a))))},navigateToPageNumber:function(e,t){s.navigateTo(s.PAGE_MODES.NUMBER,e,t)},navigateToPageSlug:function(e,t){s.navigateTo(s.PAGE_MODES.SLUG,e,t)},bindPopstate:r.once(function(){window.onpopstate=function(e){e.state&&e.state.mode&&o.trigger(s.publishedEvents.POPSTATE,e.state)}})}});return s}),define("modules/sdk-backend/module",["jquery","lodash","log","ceros","globals","shared/utils/ModuleEventManager","shared/utils/NavigationUtils","modules/page/models/PageModel","modules/page/utils/PlayerVariantDetector"],function(e,t,i,n,r,o,s,a,u){"use strict";var l=["sdk.experience.container.ready","sdk.experience.container.scrolled","sdk.experience.container.resized","sdk.experience.page.goto","sdk.experience.page.next","sdk.experience.page.previous","sdk.component.video.start","sdk.component.video.stop","sdk.component.text.settext","sdk.component.image.seturl","sdk.component.image.reset","sdk.component.click","sdk.component.show","sdk.component.hide","sdk.layer.show","sdk.layer.hide","sdk.page.animations.start","sdk.page.animations.pause","sdk.page.disable","sdk.page.enable"],c=function(e,t){t=JSON.stringify(t),e.postMessage(t,"*")},h=function(e,t){var i={name:"ceros.sdk.player:"+e,version:"1.1.0",params:t};r.isEmbedded&&c(parent,i),c(window,i)},d=function(e){var t=new RegExp("^ceros.sdk.player:");return e.replace(t,"")},f=function(e){if(e=e.originalEvent,t.isString(e.data)&&-1!==e.data.indexOf("ceros.sdk.player:")){var n={};try{n=JSON.parse(e.data)}catch(e){return void i.debug("Error processing message: "+e)}if(n.name){if(n.name=d(n.name),-1===l.indexOf(n.name))return void i.debug("Received message that is not an SDK event: "+n.name);o.trigger(n.name,n.params)}}},p=function(){var e={},i=function(i,n,r){r&&!t.isEmpty(r)&&t.each(r,function(t){e[t]||(e[t]={pages:[],syncedObjects:[],smartgroups:[],layers:[],components:[]}),e[t][i].push(n)})};this.addPageTags=function(e,t){i("pages",e,t)},this.addSyncedObjectTags=function(e,t){i("syncedObjects",e,t),i("smartgroups",e,t)},this.addLayerTags=function(e,t){i("layers",e,t)},this.addComponentTags=function(e,t){i("components",e,t)},this.getTags=function(){return e}};return new n.Module({id:"sdk-backend",description:"The API for the player SDK.",version:"1.0",delegate:{experienceID:null,initialize:function(n,r,o){if(t.isUndefined(window.postMessage))return void i.warn("This browser does not support inter-frame communication.");i.debug("Embedded Player SDK listening for inter-frame messages."),e(window).bind("message",f);var s=this.buildExperienceData(n,r,o);this.experienceID=n.get("slug"),this.registerEvents(),h("ready",s)},buildExperienceData:function(e,t,i){var n=new p,o=this.buildPages(t,n),a=this.buildSyncedObjects(t.get("smartgroups"),n),u={experienceId:e.get("slug"),experienceAlias:r.issueAliasSlug,experienceTitle:e.get("title"),currentPageNumber:t.getPageInfoByNumberOrSlug(s.parsePageFromLocation()).number,documentVersion:r.docVersion,allPageData:o,allSyncedObjectData:a,allSmartgroupData:a,tags:n.getTags(),userToken:i};return u.documentVersion.viewportWidth=t.get("viewportWidth"),u.documentVersion.viewportHeight=t.get("viewportHeight"),u},buildSyncedObjects:function(e,i){var n=[],r=this;return t.each(e,t.bind(function(e){var t=[];e.layerHierarchies&&(t=r.buildLayers(e.layerHierarchies.desktop,i,void 0,e.layerDictionary)),n.push({id:e.id,payload:e.sdkPayload,tags:e.sdkTags,layers:t})},this)),n},buildPages:function(e,i){var n=[];return t.each(e.getPages(),t.bind(function(t,r){var o=[];t.get("layerHierarchies")&&(o=this.buildLayers(t.get("layerHierarchies")[u.getVariant()],i,t.getSlug(),t.get("layerDictionary"))),n.push({pageSlug:t.getSlug(),pageNumber:t.getPageIndex()+1,payload:t.getSdkPayload(),tags:t.getSdkTags(),layers:o,width:t.getPageWidth(e),height:t.getPageHeight(e),enabled:!t.getDisabled()}),i.addPageTags(t.getSlug(),t.getSdkTags())},this)),n},buildLayers:function(e,i,n,r){function o(e){var s=e.items;if(e=t.cloneDeep(r[e.id]),"desktop"!==l&&(e=t.extend({},e,e.overrides[l])),e){if(e.items=s,e.smartgroupId)return i.addSyncedObjectTags(e.id,e.sdkTags),{id:e.id,syncedObjectId:e.smartgroupId,smartgroupId:e.smartgroupId,tags:e.sdkTags,payload:e.sdkPayload,pageSlug:n,objects:[]};if("folder"===e.type||"group"===e.type){i.addLayerTags(e.id,e.sdkTags);var u=[];return t.each(e.items,function(e){var t=o(e);t&&u.push(t)}),{id:e.id,payload:e.sdkPayload,items:u,tags:e.sdkTags,pageSlug:n,type:e.type}}return a.buildComponent(e,i,n)}}var s=[],a=this,l=u.getVariant();return e&&t.each(e,function(e){var t=o(e);t&&s.push(t)}),s},buildComponent:function(e,t,i){var n=e.id;t.addComponentTags(e.id,e.sdkTags),t.addLayerTags(e.id,e.sdkTags);var r;switch(e.type){case"hotspot-component":r="hotspot";break;case"image-component":r="image";break;case"line-component":r="line";break;case"shape-component":r="shape";break;case"text-component":r="text";break;case"video-widget":r="video"}var o={id:n,type:r,payload:e.sdkPayload,tags:e.sdkTags,x:e.x,y:e.y,width:e.width,height:e.height,pageSlug:i};return"text"===r&&(o.textContent=e.textContent),"image"===r&&e.imageLoader&&(o.fullResolutionUrl=e.imageLoader.getFullResolutionUrl(),o.url=e.imageLoader.getCurrentUrl()),o},registerEvents:function(){o.on("page.action.share.page",t.bind(function(e){this.announceSocialShare(e.componentSlug,e.action)},this)),o.on("page.component.clicked",t.bind(function(e){this.announceComponentClick(e.componentSlug)},this)),o.on("page.component.animation.start",t.bind(function(e){this.announceAnimationStarted(e)},this)),o.on("page.component.animation.end",t.bind(function(e){this.announceAnimationEnded(e)},this))},announcePageChanged:function(e){h("page.changed",{pageNum:e,experienceId:this.experienceID})},announcePageChanging:function(e){h("page.changing",{pageNum:e,experienceId:this.experienceID})},announceSocialShare:function(e,t){e=a.extractObjectIdFromSmartgroupInstanceId(e),h("social.share",{componentId:e,shareType:t,experienceId:this.experienceID})},announceComponentClick:function(e){e=a.extractObjectIdFromSmartgroupInstanceId(e),h("component.clicked",{componentId:e,experienceId:this.experienceID})},announceLayersShown:function(e){e=t.map(e,a.extractObjectIdFromSmartgroupInstanceId),t.each(e,t.bind(function(e){h("layer.shown",{layerId:e,experienceId:this.experienceID})},this))},announceLayersHidden:function(e){e=t.map(e,a.extractObjectIdFromSmartgroupInstanceId),t.each(e,t.bind(function(e){h("layer.hidden",{layerId:e,experienceId:this.experienceID})},this))},announceVideoPlayed:function(e){e=a.extractObjectIdFromSmartgroupInstanceId(e),h("video.played",{componentId:e,experienceId:this.experienceID})},announceAnimationStarted:function(e){e=a.extractObjectIdFromSmartgroupInstanceId(e),h("animation.started",{componentId:e,experienceId:this.experienceID})},announceAnimationEnded:function(e){e=a.extractObjectIdFromSmartgroupInstanceId(e),h("animation.ended",{componentId:e,experienceId:this.experienceID})},announceScrollTo:function(e){h("scroll.to",{scrollPosition:e.scrollPosition,pageHeight:e.pageHeight,experienceId:this.experienceID,innerHeight:window.innerHeight})},announceTimedInteraction:function(e){h("timed.interaction.fired",e)},getNewTagMap:function(){return new p}}})}),define("applications/html5-player/noembed",["globals","jquery"],function(e,t){"use strict";return function(){t("html").addClass("noembed");var i=t("body");i.empty();var n=t('<div id="embed-breakout">&#9654;</div>').click(function(e){e.preventDefault(),window.open(window.location.href)});e.themeObj&&(i.css("background",e.themeObj.backgroundColor),n.css({color:e.themeObj.menuFgColor,background:e.themeObj.menuBgColor})),i.append(n),setTimeout(function(){n.css("visibility","visible")},1)}}),define("iosorientationfix",[],function(){"use strict";!function(e){function t(){c.setAttribute("content",f),p=!0}function i(){c.setAttribute("content",d),p=!1}function n(n){l=n.accelerationIncludingGravity,s=Math.abs(l.x),a=Math.abs(l.y),u=Math.abs(l.z),e.orientation&&180!==e.orientation||!(s>7||(u>6&&a<8||u<8&&a>6)&&s>5)?p||t():p&&i()}var r=navigator.userAgent;if(/iPhone|iPad|iPod/.test(navigator.platform)&&/OS [1-5]_[0-9_]* like Mac OS X/i.test(r)&&r.indexOf("AppleWebKit")>-1){var o=e.document;if(o.querySelector){var s,a,u,l,c=o.querySelector("meta[name=viewport]"),h=c&&c.getAttribute("content"),d=h+",maximum-scale=1",f=h+",maximum-scale=10",p=!0;c&&(e.addEventListener("orientationchange",t,!1),e.addEventListener("devicemotion",n,!1))}}}(window)}),define("applications/html5-player/Player",["log","lodash","jquery","backbone","device","globals","domReady","playerApi","cookie","shared/utils/NavigationUtils","shared/utils/CerosResourceLoader","shared/utils/ModuleEventManager","shared/utils/ScrollProxy","modules/viewport/models/DocumentVersionModel","shared/models/EmbeddedViewportModel","modules/splash-screen/module","modules/page/module","modules/page/utils/PlayerVariantDetector","modules/page/utils/PlayerVariantService","modules/chrome/module","modules/branding/module","modules/flippers/module","modules/viewport/module","modules/analytics/module","modules/lightbox/module","modules/url-navigation/module","modules/error/module","modules/page/utils/ShareJSConnection","modules/sdk-backend/module","applications/html5-player/noembed","applications/html5-player/TopView","InteractionUtils","iosorientationfix"],function(e,t,i,n,r,o,s,a,u,l,c,h,d,f,p,g,m,v,y,b,w,E,_,T,S,A,P,I,x,C,R,k){"use strict";var O=null,L=null,D={documentVersion:null,issue:null},M=function(){if(j(),q(),L.mark(L.MARKS.PLAYER.RUN_START),e.init(o.logging),e.debug("Player.run() start"),!W()){J().done(function(){z(),ee()||(te(),s(function(){L.mark(L.MARKS.PLAYER.DOM_READY),e.debug("domReady: About to load the doc version."),R.setupInitialDom(),Z(),R.showLoadingExperience(),L.mark(L.MARKS.PLAYER.SPINNER_SHOWN),X().then(t.bind(R.showPreviewerFadingMessage,R)),b.load();var i=re();i.done(function(){e.debug("Doc Version is loaded"),L.mark(L.MARKS.PLAYER.DOC_VERSION_LOADED),Q(),$();var t=ie();o.isEmbedded&&y.hasVariants()?(e.debug("Waiting for ScrollProxy to send first message with viewport dimensions"),N(t,F)):F()}),i.fail(t.bind(R.show404,R))}))})}},N=function(t,i){t.done(function(){e.debug("ScrollProxy received viewport dimensions, rendering experience"),i()}),setTimeout(function(){"resolved"!==t.state()&&(e.devWarn("ScrollProxy viewport dimensions promise timed out"),i())},2e3)},F=function(){v.detect(),B().done(function(){G().done(function(){V(),U()})})},V=function(){K(),ae(),pe(),E.load({}),S.load(),w.load(),se()},U=function(){R.attachModuleViews(D.issue),_.renderPages().always(function(){x.initialize(D.issue,D.documentVersion,T.getUserToken())});var t=_.getFirstPageReadyPromise();t.fail(function(){R.show404()});var n=[O.promise(),t];i.when.apply(i,n).then(function(){e.debug("About to render initial pages."),R.showDocument(),L.mark(L.MARKS.PLAYER.SPINNER_HIDDEN),A.bindPopstate(),document.hidden?document.addEventListener("visibilitychange",H):H()})},B=function(){return D.documentVersion.createManifestCollection(),D.documentVersion.loadPageModels().done(function(){e.debug("Page models loaded")})},G=function(){return oe().done(function(){e.debug("initViewportAndPreloadMedia done. About to render initial pages.")}).fail(function(){R.show404()})},H=function(){document.hidden||(e.debug("First page(s) media is loaded. Showing first page."),_.activateFirstPage()),document.removeEventListener("visibilitychange",H)},j=function(){u.remove("mobile-help-overlay")},W=function(){var e=o.isEmbedded&&!o.allowEmbedding;return e&&(T.unsupportedEmbed(),C()),e},$=function(){var e=Y();o.heightOverridesPerLayout=e,o.heightOverride=t.get(e,"desktop",null),v.on("change",function(i){o.heightOverride=t.get(e,i,null)})},Y=function(){var e={desktop:"heightOverride"};return t.each(y.getExistingVariants(),function(i){e[i]=t.lowerFirst(i)+"HeightOverride"}),
t.mapValues(e,function(e){var t=new RegExp("[\\?&]"+e+"=(\\d+)(&|$)"),i=window.location.search.match(t);return i?+i[1]:null})},q=function(){T.init({application:o.analyticsApplicationKey,googleAnalyticsId:o.googleAnalyticsId}),L=T.getPerformanceTracker(),window.cerosPlayerLoadStart&&L.startTracking(window.cerosPlayerLoadStart),c.onPriorityQueueCompletion(function(){L.mark(L.MARKS.PLAYER.PRIORITY_QUEUE_EMPTIED)}),c.onAllResourcesLoaded(function(){L.mark(L.MARKS.PLAYER.ALL_RESOURCES_LOADED)})},z=function(){var e=null;o.previewMode?I.initialize():e=window.docVersionRequest,D.issue=new n.Model(o.issue),D.documentVersion=new f(o.docVersion,{docVersionRequest:e})},K=function(){if(e.isEnabled("debug")){var i=[R,g,m,_,E,T,S,P];o.isEmbedded||(i=i.concat([b,A])),t.each(i,function(i){t.each(i.publishedEvents,function(t){i.on(t,function(i){e.debug("EVENT: "+t,i)})})})}},X=function(){if(!O){O=new i.Deferred;var t=o.publicAssetsBaseUrl+"ceros-fonts-2018-11-14.css",n=c.addCustomWebFont(["CerosIcons-Regular"],t,"").loadNow(),r=c.addGoogleWebFont("Varela+Round::latin").loadNow(),s=c.addGoogleWebFont("Montserrat::latin").loadNow();i.when(n,s,r).always(function(){O.resolve()}),setTimeout(function(){"resolved"!==O.state()&&(e.devWarn("Font loading timed out"),O.resolve())},5e3)}return O.promise().then(function(){e.debug("InitialFontsReady promise is resolved.")})},Z=function(){o.previewMode&&o.allowAdaptiveLayouts&&R.setupAdaptiveLayoutsPreviewerFrameView()},Q=function(){y.setDocVersion(D.documentVersion),o.previewMode&&o.allowAdaptiveLayouts&&R.initPreviewerSelectionView()},J=function(){var e=new i.Deferred;return o.previewMode&&o.isEmbedded?X().always(function(){g.showEmbeddedPreviewerWarning(i("body")),g.on(g.publishedEvents.EMBED_WARNING_DISMISSED,function(){e.resolve(),g.hideEmbeddedPreviewerWarning(i("body"))})}):e.resolve(),e},ee=function(){return o.gracePeriodExpired&&X().done(function(){g.showUnavailableScreen(i("body"),{theme:D.documentVersion.get("theming")});var e=D.documentVersion.getPageInfoByNumberOrSlug(l.parsePageFromLocation());T.viewExperience({page_slug:e.slug,page_num:e.number,grace_period_expired:!0})}),o.gracePeriodExpired},te=function(){if(o.previewMode){var e={"X-Powered-By":"Ceros Player/HTML5"};o.revalidateWithCore&&(e["Cache-Control"]="must-revalidate"),i.ajaxSetup({timeout:6e4,cache:o.ajaxCaching,headers:e,statusCode:{404:function(){s(t.bind(R.show404,R))}}}),i.ajaxPrefilter(function(e){e.crossDomain&&(e.headers={})})}},ie=function(){var e=i.Deferred();d.init(D.issue.get("slug")),ne();var n=!1;d.on(d.EVENTS.UPDATE_POSITION,function(t){var i=_.getCurrentPageHeight(),r=i&&t.top<i&&t.top<t.bottom;e.resolve(),!n&&r&&(T.resetPageTrackingMinMaxY(),n=!0)});var r=function(e){p.getInstance().setPositionData(e)};return h.on("sdk.experience.container.ready",r),h.on("sdk.experience.container.scrolled",t.debounce(r,50)),h.on("sdk.experience.container.resized",r),e.promise()},ne=function(){var e=function(){if(y.hasVariants()){var e=v.getVariant();d.announceVariantDetection(e)}};v.on("change",e),v.hasDetectedVariant()&&e()},re=function(){var t=new i.Deferred;return e.debug("Fetching docVersion"),D.documentVersion.fetch().done(t.resolve).fail(t.reject),t.promise()},oe=function(){var n=new i.Deferred;return e.debug("Init viewport"),_.init(D.documentVersion,{performanceTracker:L,marginTopCallback:function(){return b.shouldShow()&&!b.initiallyHidden()?b.getHeight():0}}),e.debug("About to preload media"),_.preloadPageMedia(),t.defer(n.resolve),n.promise()},se=function(){a.on("*",t.bind(T.handleApiRequest,T)).on("ceros.sdk.ping",function(e,t){t.data="pong"}).on("ceros.sdk.productPanel.close",S.deactivate),a.bindToIframe(S.iframe())},ae=function(){h.registerEvents(m.publishedEvents,m),h.registerEvents(A.publishedEvents,A),ce(),de(),he(),fe(),ue(),le()},ue=function(){var e=function(e){var t=_.getFirstPageReadyPromise();"pending"===t.state()?t.done(_.scale):_.scale()};_.on(_.publishedEvents.SCALE,e)},le=function(){_.on(_.publishedEvents.SCALE,function(e){E.updateScale(e)}),_.on(_.publishedEvents.PAGE_CHANGE,function(e){E.determineFlipperState(e.isFirstPage,e.isLastPage,!0),_.removeClickShield(),_.enableGestures(),x.announcePageChanged(_.getCurrentPageNumber())}),_.on(_.publishedEvents.PAGE_CHANGING,function(e){E.determineFlipperState(e.isFirstPage,e.isLastPage,e.isPageReady),x.announcePageChanging(_.getCurrentPageNumber())}),_.on(_.publishedEvents.PAGE_UPDATE,function(e){E.determineFlipperState(e.isFirstPage,e.isLastPage,e.isPageReady)}),_.on(_.publishedEvents.PAGE_ENABLED_CHANGE,function(e){E.determineFlipperState(e.isFirstPage,e.isLastPage,e.isPageReady)}),_.on(_.publishedEvents.PAGE_BATCH_LOAD_START,function(){_.addClickShield(),_.disableGestures()}),_.on(_.publishedEvents.TIMED_LIGHTBOX,function(e){S.showLightbox(e.lightboxUrl,e.lightboxWidth,e.lightboxHeight,e.lightboxHasCloseButton),x.announceTimedInteraction(e),T.experienceLoadInteraction({action:e.action,delay:e.delay})}),_.on(_.publishedEvents.TIMED_PRODUCT_PANEL,function(e){S.showProduct(e.productPanelId),x.announceTimedInteraction(e),T.experienceLoadInteraction({action:e.action,delay:e.delay})}),_.on(_.publishedEvents.TIMED_SHOPPING_CART,function(e){S.showShoppingCart(),x.announceTimedInteraction(e),T.experienceLoadInteraction({action:e.action,delay:e.delay})}),E.on(E.publishedEvents.NEXT_PAGE,function(){_.nextPage()}),E.on(E.publishedEvents.PREVIOUS_PAGE,function(){_.previousPage()})},ce=function(){_.on(_.publishedEvents.SCALE,function(e){g.scale()}),_.on(_.publishedEvents.CURRENT_PAGE_DELETED,function(e){g.showDeletedPageWarning(i("body"))})},he=function(){w.on(w.publishedEvents.BRANDING_CEROS_BRANDING_CLICK,function(e){var t=["utm_source=M-W-CerosPower","account="+encodeURIComponent(o.accountSlug),"experience="+encodeURIComponent(o.issueAliasSlug)];window.open("http://www3.ceros.com/poweredbyceros?"+t.join("&"))})},de=function(){b.shouldShow()&&(b.initiallyHidden()&&(_.on(_.publishedEvents.LONGPRESS,function(e){b.toggle()}),m.on(m.publishedEvents.PAGE_COMPONENT_INTERACTION,function(e){b.hide(!0)})),b.on(b.publishedEvents.CHROME_SHARE_PAGE,function(e){_.shareCurrentPageOnSocial(e.action,D.issue)}),b.on(b.publishedEvents.CHROME_SHOPPING_CART,function(e){S.showShoppingCart()}),b.on(b.publishedEvents.CHROME_TITLE_CLICK,function(e){_.jumpToPage(1,!1)}))},fe=function(){h.on(m.publishedEvents.PAGE_ACTION_SCROLL_TO,function(e){var t=_.scrollTo(e.scrollTargetType,e.scrollTargetScranchor);x.announceScrollTo(t),d.announceScrollTo(t)}),h.on(m.publishedEvents.PAGE_ACTION_GO_TO_PREV_PAGE,function(e){_.previousPage()}),h.on(m.publishedEvents.PAGE_ACTION_GO_TO_NEXT_PAGE,function(e){_.nextPage()}),h.on(m.publishedEvents.PAGE_ACTION_GO_TO_PAGE,function(e){_.jumpToPage(e.pageTarget)}),h.on(m.publishedEvents.PAGE_ACTION_ENABLE_DISABLE_PAGES,function(e){t.each(e.pageTargets,function(e,t){e?_.enablePage(t):_.disablePage(t)})}),o.isEmbedded||m.on(m.publishedEvents.PAGE_ACTIVATED,function(e){e.slug&&D.issue.get("slug")&&(o.usePageSlugsInNavigation?A.navigateToPageSlug(e.slug,D.issue.get("title")):A.navigateToPageNumber(D.documentVersion.getPageNumberBySlug(e.slug),D.issue.get("title")))}),h.on(A.publishedEvents.POPSTATE,function(e){if(e.pageNumber)_.jumpToPage(e.pageNumber);else if(e.pageSlug){var t=D.documentVersion.getPageNumberBySlug(e.pageSlug);_.jumpToPage(t)}}),m.on(m.publishedEvents.PAGE_ACTION_GO_TO_URL,function(e){o.isEmbedded&&T.isGoogleAnalyticsEnabled()?d.announceGotoUrl(e.url,e.urlOpenInNewWindow):e.urlOpenInNewWindow?window.open(e.url):top.location=e.url}),m.on(m.publishedEvents.PAGE_ACTION_OPEN_LIGHTBOX,function(e){S.showLightbox(e.lightboxUrl,e.lightboxWidth,e.lightboxHeight,e.lightboxHasCloseButton)}),m.on(m.publishedEvents.PAGE_ACTION_OPEN_PRODUCT_PANEL,function(e){S.showProduct(e.productPanelId)}),m.on(m.publishedEvents.PAGE_ACTION_OPEN_SHOPPING_CART,function(e){S.showShoppingCart()}),h.on(m.publishedEvents.PAGE_ACTION_SHARE_PAGE,function(e){_.shareCurrentPageOnSocial(e.action,D.issue)}),h.on(m.publishedEvents.TIMED_INTERACTION,function(e){x.announceTimedInteraction(e)}),h.on(m.publishedEvents.PAGE_ACTION_LAYER_VISIBILITY,function(e){if(k.isShowLayersInteraction(e)&&x.announceLayersShown(e.layerTargets),k.isHideLayersInteraction(e)&&x.announceLayersHidden(e.layerTargets),"toggle-layers"===e.action){var i=[],n=[];t.each(e.layerTargets,function(e){_.isLayerVisible(e)?i.push(e):n.push(e)}),i.length>0&&x.announceLayersShown(i),n.length>0&&x.announceLayersHidden(n)}})},pe=function(){if(o.analyticsApplicationKey){_.on(_.publishedEvents.SCALE,function(e){var t=e.ratio;T.updateScale(t)}),m.on(m.publishedEvents.PAGE_SCROLL,function(e){T.trackPageScroll({page_slug:e.slug,page_num:D.documentVersion.getPageNumberBySlug(e.slug),topY:e.topY,bottomY:e.bottomY,pageHeight:e.pageHeight})}),m.on(m.publishedEvents.PAGE_ACTIVATED,function(e){T.viewExperience({page_slug:e.slug,page_num:D.documentVersion.getPageNumberBySlug(e.slug),grace_period_expired:!1}),D.documentVersion.isAutoTransitioning()||T.viewPage({page_slug:e.slug,page_num:D.documentVersion.getPageNumberBySlug(e.slug),topY:e.topY,bottomY:e.bottomY,pageHeight:e.pageHeight})});var e=function(e){var t={experience_slug:D.issue.get("slug"),experience_version_slug:D.documentVersion.get("slug"),page_slug:e.pageSlug,page_num:D.documentVersion.getPageNumberBySlug(e.pageSlug),component_slug:e.componentSlug,video_slug:e.videoSlug};return e.videoLength&&(t.video_length=e.videoLength),t};m.on(m.publishedEvents.PAGE_VIDEO_PLAY,function(i){T.playVideo(t.extend(e(i),{video_position:i.videoPosition})),x.announceVideoPlayed(i.componentSlug)}),m.on(m.publishedEvents.PAGE_VIDEO_PROGRESS_TIME,function(i){T.trackVideoProgressTime(t.extend(e(i),{video_position:i.videoPosition,video_play_time:i.videoPlayTime}))}),m.on(m.publishedEvents.PAGE_VIDEO_PROGRESS_PERCENT,function(i){T.trackVideoProgressPercent(t.extend(e(i),{video_progress_percent:i.progressPercent}))}),m.on(m.publishedEvents.PAGE_ACTION_GO_TO_URL,function(e){T.clickLink({page_slug:e.pageSlug,page_num:D.documentVersion.getPageNumberBySlug(e.pageSlug),component_slug:e.componentSlug,component_name:e.componentName,component_type:e.componentType,outgoing_url:e.url,outgoing_domain:e.domain})}),m.on(m.publishedEvents.PAGE_ACTION_OPEN_LIGHTBOX,function(e){T.clickLightbox({page_slug:e.pageSlug,page_num:D.documentVersion.getPageNumberBySlug(e.pageSlug),component_slug:e.componentSlug,component_name:e.componentName,component_type:e.componentType,lightbox_url:e.lightboxUrl,lightbox_width:e.lightboxWidth,lightbox_height:e.lightboxHeight,lightbox_has_close_button:e.lightboxHasCloseButton})}),m.on(m.publishedEvents.PAGE_ACTION_OPEN_PRODUCT_PANEL,function(e){T.clickProduct({page_slug:e.pageSlug,page_num:D.documentVersion.getPageNumberBySlug(e.pageSlug),component_slug:e.componentSlug,component_name:e.componentName,component_type:e.componentType,product_id:e.productPanelId})}),m.on(m.publishedEvents.PAGE_ACTION_OPEN_SHOPPING_CART,function(e){T.clickShoppingCart({page_slug:e.pageSlug,page_num:D.documentVersion.getPageNumberBySlug(e.pageSlug),component_slug:e.componentSlug,component_name:e.componentName,component_type:e.componentType})}),m.on(m.publishedEvents.PAGE_COMPONENT_INTERACTION,function(e){T.clickComponent({page_slug:e.pageSlug,page_num:D.documentVersion.getPageNumberBySlug(e.pageSlug),component_slug:e.componentSlug,component_name:e.componentName,component_type:e.componentType,click_x:e.clickX,click_y:e.clickY})}),m.on(m.publishedEvents.PAGE_COMPONENT_FORM_SUBMITTED,function(e){T.formSubmit({page_slug:e.pageSlug,page_num:D.documentVersion.getPageNumberBySlug(e.pageSlug),component_slug:e.componentSlug,component_name:e.componentName,component_type:e.componentType,form_origin:e.formOrigin,form_origin_account_id:e.formOriginAccountId,form_origin_form_id:e.formOriginFormId,form_origin_form_name:e.formOriginFormName,interaction_triggered:e.interactionTriggered})}),b.on(b.publishedEvents.CHROME_SHOPPING_CART,function(e){T.clickShoppingCart({page_slug:_.getCurrentPageSlug(),page_num:_.getCurrentPageNumber()})}),h.on(m.publishedEvents.PAGE_ACTION_SHARE_PAGE,function(e){T.clickPageShare({page_slug:e.pageSlug,page_num:D.documentVersion.getPageNumberBySlug(e.pageSlug),component_slug:e.componentSlug,component_name:e.componentName,component_type:e.componentType,service:e.action})}),b.on(b.publishedEvents.CHROME_SHARE_PAGE,function(e){T.clickPageShare({page_slug:_.getCurrentPageSlug(),page_num:_.getCurrentPageNumber(),service:e.action})}),w.on(w.publishedEvents.BRANDING_CEROS_BRANDING_CLICK,function(){T.clickCerosBranding({page_slug:_.getCurrentPageSlug(),page_num:_.getCurrentPageNumber()})}),i(document).click(T.registerUserActivity)}};return{run:M}}),define("jquery",[],function(){"use strict";return window.jQuery}),define("webfont",[],function(){"use strict";return window.WebFont}),require.config({baseUrl:window.cerosContext.viewAssetsDomain,paths:{log:"shared/libs/ceros/log-1.0",lodash:"../js/libs/lodash/lodash",backbone:"../js/libs/backbone/backbone",ceros:"shared/libs/ceros/ceros-1.0",globals:"shared/libs/ceros/globals-1.0",animation:"shared/libs/ceros/animation-css3-1.0",animationTypes:"shared/libs/ceros/animation-types-1.0",sequenceBuilder:"shared/libs/ceros/animation-sequence-builder-1.0",color:"shared/libs/ceros/color-1.0",device:"../js/libs/device/DeviceProfile",browser:"../js/libs/device/MobileBrowserDetector",modernizr:"../js/libs/device/modernizr-custom-2.6.2",cssresource:"shared/libs/ceros/css-resource-1.0",playerApi:"shared/libs/ceros/player-api-1.0",socialSharing:"shared/libs/ceros/social-sharing-1.0",domReady:"shared/libs/require/plugins/domReady",text:"shared/libs/require/plugins/text",crypto:"shared/libs/crypto/crypto-2.2",hammer:"shared/libs/hammer/hammer",mustache:"../js/libs/mustache/mustache.amd",moment:"../js/libs/moment/moment",iosorientationfix:"shared/libs/ios-orientation-fix/ios-orientation-fix",easing:"shared/libs/jquery/plugins/jquery.animation.easing",cssHooksTransform:"shared/libs/ceros/css-hooks-transform-1.0",cssHooksGradients:"shared/libs/ceros/css-hooks-gradients-1.0",polyfills:"shared/libs/ceros/polyfills-1.0",base64:"shared/libs/base64/base64",jqueryajaxie9corsfix:"shared/libs/jquery/fixes/jquery-ajax-ie9-cors-fix",hlsjs:"shared/video/hls.min",ExtentsUtils:"../js/libs/utils/ExtentsUtils",InteractionUtils:"../js/libs/utils/InteractionUtils","utils/KeyboardUtils":"../js/libs/utils/KeyboardUtils","utils/Keycodes":"../js/libs/utils/Keycodes",urlUtils:"../js/libs/utils/UrlUtils",ThumbnailVariantUtils:"../js/libs/utils/ThumbnailVariantUtils",cookie:"../js/libs/utils/Cookies",hubspotFormUtils:"../js/libs/utils/HubspotFormUtils",marketoFormUtils:"../js/libs/utils/MarketoFormUtils",ImageUtils:"../js/libs/utils/ImageUtils",VectorImageUtils:"../js/libs/utils/VectorImageUtils",ImageCroppingUtils:"../js/libs/utils/ImageCroppingUtils",LazyMigrationUtils:"../js/libs/utils/LazyMigrationUtils",BasicCache:"../js/libs/utils/BasicCache",cerosMath:"../js/libs/utils/CerosMath",rect:"../js/libs/utils/Rect",jsBezier:"../js/libs/jsbezier/jsBezier-0.8","libs/analytics":"../js/libs/analytics","libs/font":"../js/libs/font","libs/image":"../js/libs/image","libs/media":"../js/libs/media","libs/typesetter":"../js/libs/typesetter","libs/uuid":"../js/libs/uuid","libs/device":"../js/libs/device","libs/utils":"../js/libs/utils","utils/TimerUtils":"../js/libs/utils/TimerUtils"},shim:{modernizr:{exports:"Modernizr"}},config:{text:{useXhr:function(e,t,i,n){"use strict";return!0}}}}),require.onError=function(e){"use strict";var t="error: "+e.requireType+" loading modules: "+e.requireModules;window.Rollbar&&window.Rollbar.error(t)},require(["modernizr","polyfills","easing","cssHooksTransform","cssHooksGradients"],function(){"use strict";require(["applications/html5-player/Player"],function(e){e.run()})}),define("applications/html5-player/bootstrap",function(){});